% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Software R para avaliação de dados experimentais},
  pdfauthor={Tiago Olivoto, Bruno Giacomini Sari},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{chngcntr}
\counterwithout{figure}{chapter} % remove chapter number from figures
\counterwithout{table}{chapter} % remove chapter number from tables
\counterwithout{footnote}{chapter} % remove chapter number from footnote
\usepackage{pdfpages}
\usepackage{parskip}
\usepackage{bm}
\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\baselinestretch}{1}
\setlength{\parindent}{1.25cm}
\usepackage{wrapfig}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{booktabs}
\usepackage{caption}
% rename
\captionsetup[table]{name=Tabela}
\captionsetup[figure]{name=Figura}
\usepackage[titletoc,title]{appendix} % appendix
\renewcommand{\appendixname}{Apêndice}
\renewcommand{\appendixtocname}{Apêndices}
\renewcommand{\appendixpagename}{Apêndice}
\renewcommand{\contentsname}{Sumário}
\renewcommand{\chaptername}{Capítulo}
\renewcommand{\partname}{Parte}
\usepackage{qrcode} % qrcode
% \abstractname [only article, report]: Abstract
% \appendixname: Appendix
% \bibname [only book, report]: Bibliography
% \chaptername [only book, report]: Chapter
% \contentsname: Contents
% \figurename: Figure
% \indexname: Index
% \listfigurename: List of Figures
% \listtablename: List of Tables
% \partname: Part
\renewcommand{\listfigurename}{Lista de figuras}
%\renewcommand{\listtablename}{Lista de tabelas}
\usepackage[many]{tcolorbox}
\usepackage{graphicx}
\usetikzlibrary{calc}
\usepackage{hyperref}
\usepackage{float}
%\floatplacement{figure}{H}
% \usepackage{amsmath}
% \usepackage{unicode-math}
\numberwithin{equation}{section}
\usepackage{multicol}
\newcommand{\hideFromPandoc}[1]{#1}
\hideFromPandoc{ \let\Begin\begin \let\End\end }
\hypersetup{colorlinks, linkcolor=black}
\usepackage{imakeidx}
\indexsetup{level=\chapter,toclevel=chapter}
\makeindex[program=makeindex, name=function, title=Índice de códigos R, options=-s pyro,columns=3]
\makeindex[program=makeindex, title=Índice de texto, options=-s pyro,columns=3]
\newcommand{\ST}[1]{\textbf{\hyperpage{#1}}\normalsize}
\newcommand{\indf}[1]{\index[function]{#1@\texttt{#1()}|ST}}
\newcommand{\indt}[1]{\index{#1|ST}}

\usepackage{titlesec}
\usepackage{xcolor}
\usepackage{amsmath,array}
\usepackage{lipsum}
\usepackage{tikz}
\usepackage{geometry}
\geometry{
  top=3cm,
  bottom=2cm,
  left=3cm,
  right=2cm,
  bindingoffset=1cm,
  % marginparwidth=0cm,
  % marginparsep=0cm,
  headheight=13.6pt}
\usepackage{fancyhdr}

\newcommand{\chapnumfont}{
  \fontsize{144}{0}
  \selectfont
}

\colorlet{chapnumcol}{blue}

\titleformat{\chapter}[display]
{\bfseries}
{\begin{tikzpicture}
  \node[minimum width=\textwidth, text=black!25, fill=black!25, inner sep=1, outer sep=0, anchor=south] (rectinit) {\huge CHAPTER};
  \node[minimum width=.8\textwidth, text=blue, inner sep=1, outer sep=0, anchor=south west, text width=.5\textwidth, align=right] at (rectinit.south west) (chapname) {\chaptername};
  \node[minimum width=.15\textwidth, inner sep=0, outer sep=0, anchor=south east, text width=.15\textwidth, align=right] at (chapname.south east) {\chapnumfont\textcolor{chapnumcol}{\thechapter}};
\end{tikzpicture}}
{0pt}
{\Huge}



% footnotes

\fancyhead[LE]{\nouppercase \rightmark}
\fancyhead[RE]{}
\fancyhead[LO]{}
\fancyhead[RO]{\nouppercase \leftmark}
\fancyfoot[LE,RO]{\thepage}
\fancyfoot[RE,LO]{Olivoto \& Sari}
\cfoot{}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}
\hypersetup{colorlinks, linkcolor=blue, urlcolor=blue}
\setlength{\parskip}{0cm}
\textheight=640pt
\hypersetup{colorlinks, linkcolor=blue}
\evensidemargin=0in
\oddsidemargin=0.55in
\headsep=15pt
\textheight=640pt


% blank page
\usepackage{scrextend}
\newcommand*{\blankpage}{%
  \par\vspace*{\fill}%
  {\centering Esta página foi deixada em branco intencionalmente.\par}
  \vspace{\fill}%
}

\usepackage{scrlayer}
\DeclareNewLayer[
    foreground,
    textarea,% use only the textarea
    contents=\blankpage
  ]{blankpage.fg}
\DeclarePageStyleByLayers{blank}{blankpage.fg}
\KOMAoptions{cleardoublepage=blank}


\definecolor{customGrey}{HTML}{F2F4F4}
\definecolor{customRed}{HTML}{B03A2E}


% Create our custom box without images
\newtcolorbox{customBlock}{
  colback = customGrey,
  colframe = customRed,
  boxsep=5pt,
  arc=4pt}


% Create our custom box: template for images
\newtcolorbox{customBlockImage}[2][]{
  enhanced,
  top=6pt,
  bottom=6pt,
  colframe = white,
  width=\textwidth,
  boxsep=8pt,
  arc=6pt,
  outer arc=6pt,
  leftupper=1.5cm,
overlay={
    \node[anchor=west]
      at ([xshift=10pt] $ (interior.north west)!0.5!(interior.south west) $ )
       {{\setkeys{Gin}{width=2.5em,keepaspectratio}\includegraphics{#2}}};},
#1}


% Define HTML colours for use
\definecolor{customPurple}{HTML}{6C3483}
\definecolor{customGreen}{HTML}{117A65}
\definecolor{customOrange}{HTML}{B9770E}
\definecolor{customBlue}{HTML}{2E86C1}

% Create the new environments for R Markdown

\newenvironment{rmdwarning}
  {\begin{customBlockImage}[colframe=customRed]{figures/warning.png}}
  {\end{customBlockImage}}

\newenvironment{rmdcustom}
  {\begin{customBlockImage}[colframe=customBlue]{figures/warning.png}}
  {\end{customBlockImage}}

\newenvironment{rmdwarning2}
  {\begin{customBlockImage}[colframe=customRed, title=Warning]{figures/warning.png}}
  {\end{customBlockImage}}

% Examples including titles
\newenvironment{importante}
  {\begin{customBlockImage}[colframe=customPurple, title=Importante]{figures/important}}
  {\end{customBlockImage}}

\newenvironment{note}
  {\begin{customBlockImage}[colframe=customGreen]{figures/note}}
  {\end{customBlockImage}}

\newenvironment{vcsabia}
  {\begin{customBlockImage}[colframe=customGreen, title=Curiosidade]{figures/curiosity.png}}
  {\end{customBlockImage}}

\newenvironment{dica}
  {\begin{customBlockImage}[colframe=customBlue, title=Dica]{figures/tip}}
  {\end{customBlockImage}}

\newenvironment{tarefa}
  {\begin{customBlockImage}[colframe=customOrange, title=Tarefa de casa]{figures/head}}
  {\end{customBlockImage}}


\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newenvironment{cslreferences}%
  {\setlength{\parindent}{0pt}%
  \everypar{\setlength{\hangindent}{\cslhangindent}}\ignorespaces}%
  {\par}

\title{Software R para avaliação de dados experimentais}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{Um foco em experimentos agronômicos}
\author{Tiago Olivoto, Bruno Giacomini Sari}
\date{2021-01-20}

\begin{document}
\maketitle

\begin{titlepage}
\includepdf[pages=-]{figures/tpage.pdf}
\end{titlepage}

\newpage
\thispagestyle{empty}



    \begin{center}
    
    \textbf{\LARGE
    Prefácio
    }
    
    \end{center}
    
    \vspace{1cm}

\large

Atualmente na área das Ciências Agrárias identificam-se o uso de diversos sofwares para a análise estatística de dados originados em coletas de experimentos. Esta miscelânea de \textit{softwares} pode confundir o pesquisador no momento de escolher qual é o \textit{software} que será adotado para suas análises estatísticas, já que existem aqueles que devem ser adquiridas licenças para uso e nem todos disponibilizam opções de todos os métodos de análise estatística de dados.


Dentre esses o \href{https://www.r-project.org/}{Software R} destaca-se por ser uma linguagem de programação de código aberto \textit{open source} basicamente destinado para computação estatística e gráficos. Com a proposta de organização de um curso e capacitação de acadêmicos e professores envolvidos em Pós-Graduação na Área de Ciências Agrárias, os Drs. Bruno Giacomini Sari e Tiago Olivoto propuseram-se a elaborar um documento onde oferecem uma excelente apresentação e introdução ao ambiente R, bem como diversas aplicações de abordagens estatísticas em experimentos agrícolas. 


Em sua segunda edição ampliada e atualizada apresentam-se variações nos tipos de tratamentos (qualitativos e quantitativos), variações nos desdobramentos das interações e variações nas formas da casualização de experimentos bifatoriais. Uma breve abordagem ao uso de modelos lineares generalizados é apresentada. Técnicas biométricas voltadas ao melhoramento genético vegetal como análise conjunta de experimentos, análise de estabilidade e associações entre variáveis ou grupo de variáveis são também abordadas. Todos os exemplos são reproduzíveis. A expectativa é de que este documento seja útil para aqueles pesquisadores que desejam utilizar este ambiente de programação para a realização de suas análises estatísticas.

\setlength{\parindent}{0in}
\noindent

    Parabenizamos os autores pela iniciativa e qualidade do material oferecido.

    \vspace{1.5cm}
    Alessandro Dal'Col Lúcio\\
    Professor Titular, Setor de Experimentação Vegetal\\
    Departamento de Fitotecnia\\
    Centro de Ciências Rurais\\
    Universidade Federal de Santa Maria




\newpage
\thispagestyle{empty}
    \begin{center}
     \textbf{\LARGE
    Comissão Organizadora}
    \end{center}


\LARGE 
Alessandro Dal'Col Lúcio

\normalsize
Possui graduação em Agronomia pela Universidade Federal do Espirito Santo (1994), mestrado em Agronomia pela Universidade Federal de Santa Maria (1997), doutorado em Agronomia (Produção Vegetal) [Jaboticabal] pela Universidade Estadual Paulista Júlio de Mesquita Filho (1999) e pós-doutorado no Instituto Politécnico de Bragança [Portugal] (2015). É professor titular do Departamento de Fitotecnia do Centro de Ciências Rurais da Universidade Federal de Santa Maria e líder do grupo de pesquisa Experimentação registrado no CNPq. Atualmente é associado e ocupa o cargo de Conselheiro da Região Brasileira da Sociedade Internacional de Biometria - RBRAS, é membro da The International Biometric Society, da Associação Brasileira de Horticultura - ABH e da Sociedade Brasileira para o Progresso da Ciência - SBPC. Tem experiência na área de Probabilidade e Estatística, com ênfase em Experimentação Agrícola, atuando principalmente nos seguintes temas: planejamento de experimentos, precisão experimental, ambiente protegido, amostragem e variabilidade.



\vspace{0.5cm}

\LARGE 
Bruno Giacomini Sari

\normalsize
Possui graduação (2012), mestrado (2015) e doutorado (2018) em Agronomia pela Universidade Federal de Santa Maria - UFSM. Atualmente realiza estágio pós doutoral junto ao Programa de Pós Graduação em Agronomia da UFSM. Tem experiência na área de estatística, com enfase em experimentação agrícola, atuando nos seguintes temas: probabilidade, amostragem, planejamento experimental, análise de regressão linear e
não linear. 

E-mail:
\href{mailto:brunosari@hotmail.com}{\nolinkurl{brunosari@hotmail.com}}
\textbar{}
\href{http://buscatextual.cnpq.br/buscatextual/visualizacv.do?id=K4406856U6}{Curriculo
Lattes} \textbar{} \href{https://orcid.org/0000-0003-3405-9628}{ORCID}
\textbar{}
\href{https://www.researchgate.net/profile/Bruno_Sari}{Research Gate}

\vspace{0.5cm}

\LARGE 
Tiago Olivoto

\normalsize
Tiago Olivoto é Técnico Agrícola pela Escola Estadual de Educação Básica Viadutos (2008), Engenheiro agrônomo pela Universidade do Oeste de Santa Catarina (2014), Mestre em Agronomia: Agricultura e Ambiente pela Universidade Federal de Santa Maria (2017) e Doutorando do Programa de Pós-Graduação em Agronomia pela Universidade Federal de Santa Maria (2017-). Tem experiência profissional como Técnico Agrícola (2008-2011), consultor técnico de vendas (2012-2013), na administração pública e gestão de pessoas (2014-2015), atuando como Secretário Municipal da Agricultura e Meio Ambiente no município de Cacique Doble-RS. Foi professor (bolsista) do Instituto Federal de Educação, Ciência e Tecnologia do Rio Grande do Sul. Atualmente é Professor do Ensino Superior no Instituto de Desenvolvimento Educacional do Alto Uruguai (IDEAU). Tiago exerce atividades de pesquisa e extensão relacionadas ao planejamento, condução e avaliação de experimentos com culturas anuais, com ênfase no desenvolvimento e aperfeiçoamento de métodos estatístico-experimentais para avaliação de ensaios multi-ambientes. É membro atuante da International Biometric Society (IBS), American Society of Agronomy (ASA), Crop Science Society of America (CSSA) e da Soil Science Society of America (SSSA). Atua também como revisor ad hoc em revistas científicas nacionais e internacionais, sendo membro do Conselho Editorial da revista Genetics and Molecular Research. Em seu currículo, os termos mais frequentes na contextualização da produção científica são: análise de ensaios multi-ambientes, índices multivariados, intervalo de confiança para correlação, planejamento de experimentos, seleção indireta, interação genótipo-vs-ambiente, modelos mistos e parâmetros genéticos.

E-mail:
\href{mailto:tiagoolivoto@gmail.com}{\nolinkurl{tiagoolivoto@gmail.com}}
\textbar{}
\href{http://buscatextual.cnpq.br/buscatextual/visualizacv.do?id=K4416862T6}{Curriculo
Lattes} \textbar{} \href{https://github.com/TiagoOlivoto}{GitHub}
\textbar{} \href{https://orcid.org/0000-0002-0241-9636}{ORCID}
\textbar{}
\href{http://buscatextual.cnpq.br/buscatextual/visualizacv.do?id=K4416862T6}{Research
Gate} \textbar{}
\href{https://publons.com/researcher/1431679/tiago-olivoto/}{ResearcherID}

\setlength{\parindent}{3em}


{
\setcounter{tocdepth}{3}
\tableofcontents
}
\hypertarget{prefuxe1cio}{%
\chapter*{Prefácio}\label{prefuxe1cio}}
\addcontentsline{toc}{chapter}{Prefácio}

Atualmente na área das Ciências Agrárias identifica-se o uso de diversos sofwares para a análise estatística de dados originados em coletas de experimentos. Esta miscelânea de sofwares pode confundir o pesquisador no momento de escolher qual é o software que será adotado para suas análises estatísticas, já que existem aqueles que devem ser adquiridas licenças para uso e nem todos disponibilizam opções de todos os métodos de análise estatística de dados.

Dentre esses o \href{https://www.r-project.org/}{Software R} destaca-se por ser uma linguagem de programação de código aberto \emph{open source} basicamente destinado para computação estatística e gráficos. Com a proposta de organização de um curso e capacitação de acadêmicos e professores envolvidos em Pós-Graduação na Área de Ciências Agrárias, os Drs. Bruno Giacomini Sari e Tiago Olivoto propuseram-se a elaborar um documento onde oferecem uma excelente apresentação e introdução ao ambiente R, bem como diversas aplicações de abordagens estatísticas em experimentos agrícolas.

Em sua segunda edição ampliada e atualizada apresentam-se variações nos tipos de tratamentos (qualitativos e quantitativos), variações nos desdobramentos das interações e variações nas formas da casualização de experimentos bifatoriais. Uma breve abordagem ao uso de modelos lineares generalizados é apresentada. Técnicas biométricas voltadas ao melhoramento genético vegetal como análise conjunta de experimentos, análise de estabilidade e associações entre variáveis ou grupo de variáveis são também abordadas. Todos os exemplos são reproduzíveis. A expectativa é de que este documento seja útil para aqueles pesquisadores que desejam utilizar este ambiente de programação para a realização de suas análises estatísticas

Parabenizamos os autores pela iniciativa e qualidade do material oferecido.

Alessandro Dal'Col Lúcio

Professor Titular, Setor de Experimentação Vegetal

Departamento de Fitotecnia

Centro de Ciências Rurais

Universidade Federal de Santa Maria

\hypertarget{por-que-eu-deveria-ler-este-e-book}{%
\section*{Por que eu deveria ler este e-Book}\label{por-que-eu-deveria-ler-este-e-book}}
\addcontentsline{toc}{section}{Por que eu deveria ler este e-Book}

Com uma disponibilidade cada vez maior de bons softwares estatísticos, a escolha por um único programa se torna uma tarefa difícil, até mesmo para alguém com vasta experiência na área de análise de dados de experimentos agronômicos. O ambiente de programação R é, também, um poderoso software estatístico. Assim, inúmeras são as fontes com informações relacionadas a análise de dados, criação de gráficos, etc.

A grande maioria dos blogs\footnote{\url{http://www.sthda.com/english/wiki/easy-r-programming-basics}}\footnote{\url{http://www.sthda.com/english/wiki/data-visualization}}\footnote{\url{http://www.sthda.com/english/wiki/r-basic-statistics}}\footnote{\url{https://ggplot2.tidyverse.org/}}\footnote{\url{https://stats.stackexchange.com/}}\footnote{\url{https://www.r-graph-gallery.com/}}\footnote{\url{https://www.r-graph-gallery.com/}}\footnote{\url{https://www.r-bloggers.com}} relacionados ao software R estão na língua Inglesa e mesmo que nos tempos atuais esta não seja uma questão limitante, materiais de qualidade em língua Portuguesa são muito bem-vindos. Por exemplo, a \href{http://r-br.2285057.n4.nabble.com/}{R-br}\footnote{\url{http://r-br.2285057.n4.nabble.com/}} é a lista Brasileira oficial de discussão do programa R e tem o propósito de permitir a troca de informações entre os usuários de R (em português) e contém inúmeras dicas/discussões sobre as mais diversas áreas de estudo.

Esta material, voltado para a análise de dados de experimentos agronômicos, apresenta a teoria e a aplicação no software R dos procedimentos mais utilizados na análise de experimentos agronômicos. Assim, ela pode servir de referência para aqueles que querem realizar suas análises no R, principalmente para os que ainda possuem pouca ou nenhuma experiência com este ambiente de programação.

\hypertarget{estrutura}{%
\section*{Estrutura}\label{estrutura}}
\addcontentsline{toc}{section}{Estrutura}

Este material contém 14 capítulos divididos em 3 principais partes. Na parte I (Capítulos 1 a 5 ) o ambiente R é apresentado. O \protect\hyperlink{intro}{Capítulo 1}, apresenta uma breve introdução sobre os softwares R e RStudio, mostrando como instalar e carregar os pacotes necessários, além de mostrar ao leitor como criar seu primeiro script. O \protect\hyperlink{objects}{Capítulo 2} apresenta os tipos de objetos. No \protect\hyperlink{math}{Capítulo 3}, as principais operações matemáticas são mostradas. No \protect\hyperlink{loops}{Capítulo 4} é mostrado como \emph{loops} podem ser úteis para repetir um determinado código diversas vezes. No \protect\hyperlink{dataframe}{Capítulo 5} é mostrado os dados podem ser armazenados em objetos com diferentes classes.

A parte II (Capítulos 6 a 9) é voltada para a organização, manipulação e apresentação gráfica de dados. No \protect\hyperlink{entrada}{Capítulo 6} é mostrado diversos formatos de dados podem ser carregados no ambiente R. O \protect\hyperlink{manipula}{Capítulo 7} trata da manimulação dos dados, tais como adição, seleção, resumo e combinação de variáveis. O \protect\hyperlink{graph}{Capítulo 8} trata da apresentação dos dados utilizando diversos tipos de gráficos, tais como barra, histogramas e gráficos de dispersão. O \protect\hyperlink{exporta}{Capítulo 9} é voltado para a exportação dos dados, tanto numérico quanto gráficos.

A parte III (Capítulos 10 a 14) é voltada para a análise dos dados. O \protect\hyperlink{analdata}{Capítulo 10} trata da análise de dados experimentais, incluindo a estatística básica, análise descritiva, análise de experimentos uni- e bi-fatoriais considerando os principais delineamentos, transformações de dados, análise de covariância bem como uma breve abordagem ao uso de modelos lineares generalizados. O \protect\hyperlink{reg}{Capítulo 11} é voltado exclusivamente para análise de regressão linear e não linear. O \protect\hyperlink{relations}{Capítulo 12} trata da associação entre variáveis tais como correlação linear, correlação parcial e análise de trilha. No \protect\hyperlink{multivariate}{Capítulo 13} a análise multivariada de dados é apresentada. Por fim --mas não menos importante-- no \protect\hyperlink{interaction}{Capítulo 14} são apresentados diversos modelos para análise de ensaios multi-ambientes, com ênfase na aplicação dos métodos AMMI\footnote{Additive Main Effect and Multiplicative Interaction}, BLUP\footnote{Best Linear Unbiased Prediction} e GGE\footnote{Genotype plus Genotype-vs-Environment Interaction}.

\hypertarget{conjunto-de-dados}{%
\section*{Conjunto de dados}\label{conjunto-de-dados}}
\addcontentsline{toc}{section}{Conjunto de dados}

Exemplos reproduzíveis são muito importante para uma curva de aprendizado satisfatória no ambiente de programação R. Os leitores podem interagir com os exemplos deste material ao lê-lo. Por exemplo, é possível, utilizando \texttt{Ctrl+C}, copiar uma programação, colar em seu ambiente de trabalho utilizando \texttt{Ctrl+V} e saber imediatamente o que acontece se certos parâmetros/argumentos de um modelo/análise forem alterados. Todos os dados utilizados estão disponíveis no \href{https://github.com/TiagoOlivoto/e-bookr/tree/master/data}{repositório digital} deste e-book. Os dados são carregados no ambiente R utilizando a função \texttt{import()} do pacote \href{https://cran.r-project.org/web/packages/rio/index.html}{\texttt{rio}}.

\hypertarget{sobre-os-autores}{%
\chapter*{Sobre os autores}\label{sobre-os-autores}}
\addcontentsline{toc}{chapter}{Sobre os autores}

\hypertarget{tiago-olivoto}{%
\section*{Tiago Olivoto}\label{tiago-olivoto}}
\addcontentsline{toc}{section}{Tiago Olivoto}

Tiago Olivoto é Técnico Agrícola pela Escola Estadual de Educação Básica Viadutos (2008), Engenheiro agrônomo pela Universidade do Oeste de Santa Catarina (2014), Mestre em Agronomia: Agricultura e Ambiente pela Universidade Federal de Santa Maria (2017) e Doutor em Agronomia com ênfase em Melhoramento Genético Vegetal e Experimentação Agrícola pela Universidade Federal de Santa Maria (2020). Tem experiência profissional como Técnico Agrícola (2008-2011), consultor técnico de vendas (2012-2013), na administração pública e gestão de pessoas (2014-2015), atuando como Secretário Municipal da Agricultura e Meio Ambiente no município de Cacique Doble-RS. Foi professor (bolsista) do Instituto Federal de Educação, Ciência e Tecnologia do Rio Grande do Sul, edital nº 271, de 17 de julho de 2014, atuando na ação Bolsa-Formação do Programa Nacional de Acesso ao Ensino Técnico e Emprego (PRONATEC), na Unidade Remota de Cacique Doble. Atualmente é Professor do Ensino Superior do Instituto de Desenvolvimento Educacional do Alto Uruguai (IDEAU), sendo membro do Núcleo Docente Estruturante do curso de Agronomia. É membro atuante da International Biometric Society (IBS), American Society of Agronomy (ASA), Crop Science Society of America (CSSA) e da Soil Science Society of America (SSSA). É integrante da comissão de Jovens Pesquisadores da Região Brasileira da Sociedade Internacional de Biometria, RBras, (JP-RBras) representando os estados do RS, SC e PR. Atua também como revisor ad hoc em revistas científicas nacionais e internacionais, sendo membro do Conselho Editorial da revista Genetics and Molecular Research. Exerce atividades de pesquisa relacionadas ao planejamento, condução e avaliação de experimentos com culturas anuais, com ênfase no desenvolvimento e aperfeiçoamento de métodos estatístico-experimentais para avaliação de ensaios multi-ambientes em melhoramento genético de plantas. Em seu \href{http://buscatextual.cnpq.br/buscatextual/visualizacv.do?id=K4416862T6}{currículo}, os termos mais frequentes na contextualização da produção científica são: análise de ensaios multi-ambientes, índices multivariados, intervalo de confiança para correlação, planejamento de experimentos, seleção indireta, interação genótipo-vs-ambiente, modelos mistos e parâmetros genéticos. Tem experiência com os softwares Gênes, GEA-R, R, SAS e SPSS. Desenvolveu o pacote para sofware R metan \url{https://tiagoolivoto.github.io/metan/}, voltado para a checagem, manipulação, análise e apresentação de dados de ensaios multi-ambientes.

Sua mais recente pesquisa publicada em uma série de dois artigos diz respeito ao desenvolvimento de um \href{https://www.researchgate.net/publication/334635697_Mean_performance_and_stability_in_multi-environment_trials_I_Combining_features_of_AMMI_and_BLUP_techniques}{novo índice de estabilidade} para análise de ensaios multi-ambientes, bem comoo desenvolvimento de um \href{https://www.researchgate.net/publication/334636021_Mean_performance_and_stability_in_multi-environment_trials_II_Selection_based_on_multiple_traits}{índice multivariado}, para seleção de genótipos baseado na estabilidade ou performance e estabilidade quando diversas variáveis são analizadas.

Como um usuário ativo de R, Tiago desenvolveu o pacote \href{https://tiagoolivoto.github.io/metan/}{metan}, acrônimo para \textbf{m}ulti-\textbf{e}nvironment \textbf{t}rial \textbf{an}alysis. O código fonte pode ser encontrado em sua página do \href{https://github.com/TiagoOlivoto/metan}{GitHub}.

\begin{itemize}
\tightlist
\item
  \textbf{Contatos}
\end{itemize}

\begin{quote}
E-mail: \href{mailto:tiagoolivoto@gmail.com}{\nolinkurl{tiagoolivoto@gmail.com}} \textbar{} \href{http://buscatextual.cnpq.br/buscatextual/visualizacv.do?id=K4416862T6}{Curriculo Lattes} \textbar{} \href{https://github.com/TiagoOlivoto}{GitHub} \textbar{} \href{https://orcid.org/0000-0002-0241-9636}{ORCID} \textbar{} \href{https://www.researchgate.net/profile/Tiago_Olivoto2}{Research Gate} \textbar{} \href{https://publons.com/researcher/1431679/tiago-olivoto/}{ResearcherID}
\end{quote}

\hypertarget{bruno-giacomini-sari}{%
\section*{Bruno Giacomini Sari}\label{bruno-giacomini-sari}}
\addcontentsline{toc}{section}{Bruno Giacomini Sari}

Possui graduação (2012), mestrado (2015) e doutorado (2018) em Agronomia pela Universidade Federal de Santa Maria - UFSM. Atualmente realiza estágio pós doutoral junto ao Programa de Pós Graduação em Agronomia da UFSM. Tem experiência na área de estatística, com enfase em experimentação agrícola, atuando nos seguintes temas: probabilidade, amostragem, planejamento experimental, análise de regressão linear e não linear.

\begin{itemize}
\tightlist
\item
  \textbf{Contatos}
\end{itemize}

\begin{quote}
E-mail: \href{mailto:brunosari@hotmail.com}{\nolinkurl{brunosari@hotmail.com}} \textbar{} \href{http://buscatextual.cnpq.br/buscatextual/visualizacv.do?id=K4406856U6}{Curriculo Lattes} \textbar{} \href{https://orcid.org/0000-0003-3405-9628}{ORCID} \textbar{} \href{https://www.researchgate.net/profile/Bruno_Sari}{Research Gate}
\end{quote}

\hypertarget{detalhes-importantes}{%
\chapter*{Detalhes importantes}\label{detalhes-importantes}}
\addcontentsline{toc}{chapter}{Detalhes importantes}

\textbf{Ambiente de criação}

Este e-book foi escrito em \href{https://rmarkdown.rstudio.com/}{RMarkdown}, usando o pacote \href{https://bookdown.org/yihui/bookdown/}{bookdown} e hospedado na web em \href{https://tiagoolivoto.github.io/e-bookr/}{GitHub}. A versão pdf deste material pode ser baixada \href{https://github.com/TiagoOlivoto/e-bookr/raw/master/data/pdf_r.pdf}{aqui}.

\textbf{Código fonte}

O código fonte deste e-book pode ser encontrado neste \href{https://github.com/TiagoOlivoto/e-bookr}{repositório} GitHub. Para informar qualquer problema, por favor, crie um \href{https://github.com/TiagoOlivoto/e-bookr/pulls}{pull request}.

\textbf{Licença}

Este trabalho está licenciado com uma Licença Creative Commons - Atribuição-NãoComercial-CompartilhaIgual 4.0 Internacional. O resumo legível da licença afirma que você tem o direito de:

\begin{itemize}
\item
  \textbf{Compartilhar} --- copiar e redistribuir o material em qualquer suporte ou formato
\item
  \textbf{Adaptar} --- remixar, transformar, e criar a partir do material
\item
  \textbf{Atribuição} --- Você deve dar o crédito apropriado, prover um link para a licença e indicar se mudanças foram feitas. Você deve fazê-lo em qualquer circunstância razoável, mas de nenhuma maneira que sugira que o licenciante apoia você ou o seu uso.
\item
  \textbf{De acordo com os termos seguintes}

  \begin{itemize}
  \item
    \textbf{Não Comercial} --- Você não pode usar o material para fins comerciais.
  \item
    \textbf{CompartilhaIgual} --- Se você remixar, transformar, ou criar a partir do material, tem de distribuir as suas contribuições sob a mesma licença que o original.
  \item
    \textbf{Sem restrições adicionais} --- Você não pode aplicar termos jurídicos ou medidas de caráter tecnológico que restrinjam legalmente outros de fazerem algo que a licença permita.
  \end{itemize}
\end{itemize}

\hypertarget{part-o-ambiente-r}{%
\part{O ambiente R}\label{part-o-ambiente-r}}

\hypertarget{intro}{%
\chapter{\texorpdfstring{Introdução ao ambiente \emph{R}}{Introdução ao ambiente R}}\label{intro}}

\hypertarget{o-software-r}{%
\section{O software R}\label{o-software-r}}

O artigo \href{https://www.jstor.org/stable/1390807?seq=1\#page_scan_tab_contents}{R: A Language for Data Analysis and Graphics}\footnote{\url{https://www.jstor.org/stable/1390807?seq=1\#page_scan_tab_contents}} marca o início de uma nova era no processamento e análise de dados: o desenvolvimento do software R. O R é uma linguagem e ambiente estatístico que traz muitas vantagens para o usuário, embora elas não sejam tão obvias inicialmente: (i) o R é um Software Livre (livre no sentido de liberdade) distribuído sob a \href{https://www.gnu.org/licenses/quick-guide-gplv3.html}{Licença Pública Geral}\footnote{\url{https://www.gnu.org/licenses/quick-guide-gplv3.html}}, podendo ser livremente copiado, distribuído, e instalado em diversos computadores livremente. Isso contrasta com softwares comerciais, que têm licenças altamente restritivas, que não permitem que cópias sejam distribuídas ou instaladas em mais de um computador sem a devida licença (que obviamente é paga!); (ii) a grande maioria dos Softwares livres são grátis, e o R não é uma exceção; (iii) os códigos-fontes R estão disponíveis para os usuários, e atualmente são gerenciados por um grupo chamado \href{https://www.r-project.org/}{R Development Core Team}\footnote{\url{https://www.r-project.org/}}. A vantagem de ter o código aberto é que falhas podem ser detectadas e rapidamente corrigidas. Este sistema de revisão depende da participação dos usuários. Em contraste, em muitos pacotes comerciais, as falhas não são corrigidas até o lançamento da próxima versão, o que pode levar vários anos; (iv) o R fornece um interface de entrada por linha de comando (ELC).

No software R, todos os comandos são digitados e o mouse é pouco usado. Pode parecer antigo, pouco amigável ou até pobre em recursos visuais, mas isso faz com que nos deparemos com o melhor recurso do R: a sua flexibilidade. Para usuários familiarizados, a linguagem do R se torna clara e simples. Com poucos comandos, funções poderosas podem ser criadas e o usuário é sempre consciente do que foi pedido através da ELC (Meus dados, minhas análises!). Isso contrasta com pacotes que possuem uma interface amigável (Windows-based), mas escondem a dinâmica dos cálculos e, potencialmente, os seus erros. Finalmente, o R fornece uma ampla variedade de procedimentos estatísticos básicos ou que exigem grande esforço computacional (modelagem linear e não linear, testes estatísticos clássicos, análise de séries temporais, classificação, agrupamento, etc.) e recursos gráficos elegantes. Um dos pontos fortes de R é a facilidade com que gráficos de qualidade podem ser produzidos, incluindo símbolos matemáticos e fórmulas, quando necessário. O software R está disponível em uma ampla variedade de plataformas UNIX e sistemas similares (incluindo FreeBSD e Linux), Windows e MacOS.

\hypertarget{o-software-rstudio}{%
\section{O software RStudio}\label{o-software-rstudio}}

Quem ja é usuário de softwares por linhas de comando, como o SAS, provavelmente não notou nenhuma grande diferença até aqui. Toda análise se resume à seguinte sequência \emph{dados \textgreater{} códigos \textgreater{} saída}. A experiência do usuário com o R, no entanto, pode ser mais atrativa utilizando o \href{https://www.rstudio.com/}{RStudio}\footnote{\url{https://www.rstudio.com/}}. O Rstudio é um produto de código aberto disponível publicamente em 28/02/2011 que está disponível gratuitamente. Ele é um ambiente de desenvolvimento integrado para R que inclui (i) janelas de edição de texto a partir das quais o código pode ser enviado para o console e/ou salvo no sistema operacional, (ii) listas de objetos em sua área de trabalho, (iii) histórico infinito dos comandos facilmente pesquisável com capacidade de inserir, a partir do histórico, um comando no console novamente; (iv); interface com o sistema operacional para acesso a arquivos; (v) janela de ajuda com botões de voltar e avançar; (vi) download de pacotes. Apesar de todas estas capacidades, o RStudio é muito fácil de utilizar.

Nesta seção serão abordados alguns aspectos básicos para que o usuário do R possa desenvolver as suas análises. Será dado enfoque para áreas básicas da interface, cujo conhecimento é necessário para que um usuário inicante possa realizar sua primeira análisee. A figura abaixo mostra as principais janelas do \textbf{Rstudio}, incluindo o \emph{script}, o \emph{console}, a \emph{``área de trabalho''} e o \emph{output} para gráficos.

\begin{figure}
\centering
\includegraphics{figures/Console.png}
\caption{Interface do RStudio}
\end{figure}

Antes de iniciar as análises, recomenda-se escolher um diretório \indt{diretório} onde devem estar os \emph{inputs} (dados) e para onde serão enviados os \emph{outputs} (gráficos, arquivos .txt, .xlsx, etc) \indt{imputs}\indt{outputs}. Para selecionar o diretório, basta seguir o caminho \emph{Session \textgreater{} Set Working Directory \textgreater{} Choosing diretory} ou utilizar as teclas de atalho \emph{Ctrl+Shift+H}.

\begin{figure}
\centering
\includegraphics{figures/Diretory.png}
\caption{Selecionando um diretório}
\end{figure}

Posteriormente, um \emph{R Script} é iniciado conforme a figura abaixo ou pelas teclas de atalho \emph{Ctrl+Shift+N}. No canto inferior direito, além de servir como \emph{output} para gráficos (\emph{Plots}), também é o local onde os pacotes utilizados nas análises (\emph{Packages}) são instalados e maiores informações sobre as funções podem ser encontradas (\emph{Help}).

\hypertarget{meu-primeiro-script}{%
\section{Meu primeiro script}\label{meu-primeiro-script}}

Se você realizou o download do software R pela primeira vez e achou um tanto quanto ``estranho'' o pequeno tamanho do arquivo (\textasciitilde80 Mb), provalemente deve ter se perguntado como um software estatistico tão poderoso pode ser comprimido em um arquivo tão pequeno (pequeno em comparação com os +20 GB do SAS). A resposta é simples, somente os pacote básicos do R são baixados com o arquivo de instalação. Na medida em que o usuário necessita realizar uma análise específica, a instalação de um pacote que contém uma função específica para realizar tal análise é necessária.

A instalação dos pacotes pode ser realizada conforme a figura abaixo, ou através da função \texttt{install.packages()}. Após a instalação do pacote, o usuário deve utilizar as funções \texttt{require()} ou \texttt{library()} \indt{require} \indt{library}para que o pacote seja carregado e as suas funções possam ser utilizadas. Quando o usuário tenta utilizar uma função pertencente a um determinado pacote e este pacote não está instalado (ou carregado), um erro é exibido.

\begin{figure}
\centering
\includegraphics{figures/Install.png}
\caption{Instalando pacotes}
\end{figure}

\begin{figure}
\centering
\includegraphics{figures/Help.png}
\caption{Ajuda para a função \texttt{nls()}}
\end{figure}

Como exemplo inicial, vamos tentar selecionar a variável \emph{Sepal.Length} do conjunto de dados base \texttt{iris} utilizando a função abaixo. \textbf{Cuidado, spoilers do pacote dplyr!} O primero passo é criar um novo script, seguindo os seguintes passos: \emph{File \textgreater{} New File \textgreater{} R script} ou utilizando o atalho \texttt{Ctrl+Shift+N}. Posteriormente, o seguinte código é digitado e executado ao se selecionar a linha do código e clicar no botão \emph{run} ou utilizando o atalho \texttt{Ctrl+Enter}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{SL \textless{}{-}}\StringTok{ }\KeywordTok{select}\NormalTok{(iris, Sepal.Length)}
\CommentTok{\# Error in select(iris, Sepal.Length): não foi possível encontrar a função "select"}
\end{Highlighting}
\end{Shaded}

Neste caso, um erro é exibido pois o pacote \textbf{dplyr} não está instalado ou carregado. Caso ele já estiver instalado, a mensagem de erro acima é superada ao carregar o pacote antes de executar a função.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\NormalTok{SL \textless{}{-}}\StringTok{ }\KeywordTok{select}\NormalTok{(iris, Sepal.Length)}
\end{Highlighting}
\end{Shaded}

Caso o pacote \textbf{dplyr} não esteja instalado, a maneira mais fácil de instalá-lo é instalando a coleção de pacotes \href{https://www.tidyverse.org/}{tidyverse}\footnote{\url{https://www.tidyverse.org/}} seguindo os passos da Figura 3 ou utilizando a seguinte função.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{, }\DataTypeTok{dependencies =} \OtherTok{TRUE}\NormalTok{)}
\KeywordTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

O \textbf{tidyverse} é uma coleção de pacotes R projetados para a ciência de dados, contendo, dentre outros, seguintes pacotes que serão utilizados neste material.

\begin{itemize}
\tightlist
\item
  \textbf{ggplot2}, para criação de gráficos.
\item
  \textbf{dplyr}, para manipulação de dados.
\item
  \textbf{tidyr}, para organização de dados.
\item
  \textbf{tibble}, para criação de tibbles.
\end{itemize}

Praticamente todas as rotinas realizadas no R são baseadas em bibliotecas de códigos. Com a manipulaçao de pacotes não seria diferente. O pacote \href{https://github.com/trinker/pacman}{pacman}\footnote{\url{https://github.com/trinker/pacman}} é uma ferramenta de gerenciamento de pacotes R que combina a funcionalidade das funções relacionadas à biblioteca base em funções intuitivamente nomeadas, reduzindo o código para executar simultaneamente várias ações. Uma das funções mais úteis do pacote pacman é a \texttt{p\_load()}\indf{p\_load} (\emph{package load}). Esta função checa se um pacote está instalado e em caso afirmativo, carrega-o como se a função \texttt{library()} tivesse sido usada. Caso o pacote não esteja instalado, ela primeiro o instala-rá antes de carregá-lo. Vamos, agora, instalar (para quem está utilizando o R pela primeira vez) ou carregar (para quem já tem instalado) os pacotes utilizados neste material.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\OperatorTok{!}\KeywordTok{require}\NormalTok{(}\StringTok{"pacman"}\NormalTok{))\{}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"pacman"}\NormalTok{)}
\NormalTok{\}}
\KeywordTok{library}\NormalTok{(pacman)}
\KeywordTok{p\_load}\NormalTok{(hnp, asbio, car, DT, dplyr, devtools, emmeans, effects, multcomp,}
\NormalTok{       lme4, rio, ExpDes.pt, qqplotr, manipulate, metan, MASS, olsrr,}
\NormalTok{       tidyverse, tibble, agricolae, psych, corrplot, pvclust, factoextra, ggfortify)}
\end{Highlighting}
\end{Shaded}

Os pacotes disponibilizados no software \emph{R} estão em constante atualização. Utilizando a função \texttt{packageStatus()} e \texttt{summary(packageStatus())} é possível verificar se os pacotes estão atualizados. Outra forma é ir em \emph{Packages \textgreater{} Update} que se encontra no canto inferior direito conforme demonstrado na Figura 5.

\begin{figure}
\centering
\includegraphics{figures/Update.png}
\caption{Verificando se há atualizações disponíveis}
\end{figure}

Por fim, para citar os pacotes \indt{pacotes}, recomenda-se verificar a referência através da função \texttt{citation()}. \indt{citação de pacotes} \indt{atualização} Para o pacote \texttt{metan}, por exemplo, a referência oficial é encontrada no artigo que descreve o pacote (Olivoto and Lúcio \protect\hyperlink{ref-Olivoto2020a}{2020})

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{citation}\NormalTok{(}\StringTok{"metan"}\NormalTok{)}
\CommentTok{\# }
\CommentTok{\# Please, support this project by citing it in your publications!}
\CommentTok{\# }
\CommentTok{\#   Olivoto, T., and Lúcio, A.D. (2020). metan: an R package for}
\CommentTok{\#   multi{-}environment trial analysis. Methods Ecol Evol. 11:783{-}789}
\CommentTok{\#   doi:10.1111/2041{-}210X.13384}
\CommentTok{\# }
\CommentTok{\# A BibTeX entry for LaTeX users is}
\CommentTok{\# }
\CommentTok{\#   @Article\{Olivoto2020,}
\CommentTok{\#     author = \{Tiago Olivoto and Alessandro Dal\textquotesingle{}Col L\{\textquotesingle{}\{u\}\}cio\},}
\CommentTok{\#     title = \{metan: an R package for multi{-}environment trial analysis\},}
\CommentTok{\#     journal = \{Methods in Ecology and Evolution\},}
\CommentTok{\#     volume = \{11\},}
\CommentTok{\#     number = \{6\},}
\CommentTok{\#     pages = \{783{-}789\},}
\CommentTok{\#     year = \{2020\},}
\CommentTok{\#     doi = \{10.1111/2041{-}210X.13384\},}
\CommentTok{\#     url = \{https://besjournals.onlinelibrary.wiley.com/doi/abs/10.1111/2041{-}210X.13384\},}
\CommentTok{\#     eprint = \{https://besjournals.onlinelibrary.wiley.com/doi/pdf/10.1111/2041{-}210X.13384\},}
\CommentTok{\#   \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{objects}{%
\chapter{Tipos de objetos}\label{objects}}

Os tipos de objeto mais utilizados na linguagem \emph{R} são: (i) vetores, (ii) matrizes, (iii) data frames, (iv) listas e (v) funções. Um enfoque maior será dado aos vetores, matrizes e data frames, pois estes são amplamen
te utilizados, inclusive nas análises mais simples.

\hypertarget{vetores}{%
\section{Vetores}\label{vetores}}

Existem quatro tipos principais de vetores: lógico, inteiro, duplo e caractere (que contém cadeias de caracteres). Vetores coletivamente inteiros e duplos são conhecidos como vetores numéricos. Cada um dos quatro tipos primários possui uma sintaxe especial para criar um valor individual, um escalar.

\begin{itemize}
\item
  Vetores lógicos podem ser escritos por extenso (\texttt{TRUE} ou \texttt{FASLSE}) ou abreviados (\texttt{T} ou \texttt{F}).
\item
  Vetores duplos podem ser especificadas em formato decimal (\texttt{0.1234}), científico (\texttt{1.23e4}).
\item
  Vetores inteiros são escritos de forma semelhante aos duplos, mas devem ser seguidos por L (1234L, 1e4L ou 0xcafeL) e não podem conter valores fracionados.
\item
  Caracteres são cercadas por " (\texttt{"dia"}) ou ' (\texttt{\textquotesingle{}noite\textquotesingle{}}).
\end{itemize}

A função \texttt{c()} \indt{vetores} \indf{c} combina valores que formam vetores\footnote{Vetores são uma estrutura de dados básica do R que permite armazenar um conjunto de valores numéricos ou de caracteres em um objeto nomeado}. Abaixo, é demonstrado como vetores podem ser criados utilizando \texttt{c()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{) }\CommentTok{\# Escalar }
\NormalTok{x2 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{) }\CommentTok{\# Vetor}
\NormalTok{x3 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{) }\CommentTok{\# Vetor}
\NormalTok{x3}
\CommentTok{\# [1] 1 2 3}
\NormalTok{x3}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"um"}\NormalTok{,}\StringTok{"dois"}\NormalTok{,}\StringTok{"três"}\NormalTok{) }\CommentTok{\# Vetor com caracteres}
\end{Highlighting}
\end{Shaded}

Os vetores foram armazenados em \emph{x1}, \emph{x2} e \emph{x3} e ficaram armazenados como valores na área de trabalho como valores (\emph{values}). Para que os valores sejam mostrados basta digitar no \emph{console} onde os vetores foram armazenados.

Vetores também podem ser criados utilizando as funções \texttt{rep()} e \texttt{seq()}, conforme mostrado abaixo. \indf{rep} \indf{seq}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rep}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\CommentTok{\#  [1] 5 5 5 5 5 5 5 5 5 5}
\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\CommentTok{\# [1] 1 2 3 4 5}
\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DataTypeTok{by =} \FloatTok{0.5}\NormalTok{)}
\CommentTok{\# [1] 1.0 1.5 2.0 2.5 3.0 3.5 4.0 4.5 5.0}
\KeywordTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DataTypeTok{by =} \DecValTok{2}\NormalTok{)}
\CommentTok{\#  [1]  2  4  6  8 10 12 14 16 18 20}
\end{Highlighting}
\end{Shaded}

A função \texttt{c()} também pode ser combinada com as funções \texttt{rep()} e \texttt{seq()} para criar vetores mais complexos, como mostrado abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x4 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{, }\DataTypeTok{each =} \DecValTok{4}\NormalTok{))}
\NormalTok{x5 \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\NormalTok{x6 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{), }\DataTypeTok{each =} \DecValTok{2}\NormalTok{))}
\NormalTok{x6}
\CommentTok{\#  [1] 1 1 2 2 3 3 4 4 5 5}
\end{Highlighting}
\end{Shaded}

Utilizando colchtes \texttt{{[}{]}} é possível selecionar um (ou um conjunto) de elementos de um vetor. Por exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x7 \textless{}{-}}\StringTok{ }\NormalTok{x6[}\DecValTok{1}\NormalTok{] }\CommentTok{\# Seleciona o primeiro elemento do vetor }
\NormalTok{x8 \textless{}{-}}\StringTok{ }\NormalTok{x6[}\DecValTok{4}\NormalTok{] }\CommentTok{\#  Seleciona o quarto elemento do vetor }
\NormalTok{x9 \textless{}{-}}\StringTok{ }\NormalTok{x6[}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{8}\NormalTok{)] }\CommentTok{\# Seleciona o primeiro, o quarto e o oitavo elemento}
\NormalTok{x9}
\CommentTok{\# [1] 1 2 4}
\NormalTok{x10 \textless{}{-}}\StringTok{ }\NormalTok{x6[}\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{] }\CommentTok{\# armazena uma sequência de elementos (primeiro ao quarto)}
\NormalTok{x \textless{}{-}}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\end{Highlighting}
\end{Shaded}

Em adição ao uso de \texttt{{[}{]}}, as funções \texttt{first()}, \texttt{last()} e \texttt{nth()}, \indf{nth}\indf{first}\indf{last} são utilizadas para selecionar o primeiro, o último e o i-ésimo elemento de um vetor. A principal vantagem é que você pode fornecer um vetor secundário opcional que define a ordem e fornecer um valor padrão a ser usado quando a entrada for menor que o esperado.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x \textless{}{-}}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{)}
\KeywordTok{first}\NormalTok{(x)}
\CommentTok{\# [1] 95.9229}
\KeywordTok{last}\NormalTok{(x)}
\CommentTok{\# [1] 12.299}
\KeywordTok{nth}\NormalTok{(x, }\DecValTok{23}\NormalTok{)}
\CommentTok{\# [1] 3.380112}
\end{Highlighting}
\end{Shaded}

\hypertarget{matrizes}{%
\section{Matrizes}\label{matrizes}}

As matrizes \indt{matrizes} são um conjunto de valores (ou variáveis) dispostos em linhas e colunas, e que formam um corpo delimitado por {[} {]}. As matrizes são geralmente representadas genericamente por \({{\boldsymbol{A}}_{{\boldsymbol{MxN}}}}\), onde \textbf{M} e \textbf{N} represetam os números de linhas e colunas da matriz, respectivamente. As matrizes podem ser facilmente construídas utilizando a função \texttt{matrix()}. Alternativamente, as funções \texttt{cbind()} e \texttt{rbind()} também podem ser utilizadas. A primeira função adiciona colunas as matrizes, enquanto que a segunda adiciona linhas. Veremos mais tarde que estas funções podem ser combinadas com outras funções para construção de data frames \indf{data.frame}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Usando cbind()}
\NormalTok{x10 \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{) }\CommentTok{\# ou x10 = cbind(1:5), 5 colunas com 1 elemento cada}
\NormalTok{x11 \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{)) }\CommentTok{\# ou x11 = cbind(c(1:5)), 1 coluna com 5 elementos cada }
\NormalTok{x12 \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{),}\KeywordTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{10}\NormalTok{)) }\CommentTok{\# 2 colunas de 5 elementos}
\NormalTok{x12}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(x11,}\KeywordTok{c}\NormalTok{(}\DecValTok{6}\OperatorTok{:}\DecValTok{10}\NormalTok{))}
\NormalTok{x13 \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{),}\KeywordTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{10}\NormalTok{),}\KeywordTok{c}\NormalTok{(}\DecValTok{11}\NormalTok{,}\DecValTok{12}\NormalTok{,}\DecValTok{13}\NormalTok{,}\DecValTok{14}\NormalTok{,}\DecValTok{15}\NormalTok{)) }\CommentTok{\# 3 colunas de 5 elementos}
\NormalTok{x13}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(x12}\FloatTok{.1}\NormalTok{,}\KeywordTok{c}\NormalTok{(}\DecValTok{11}\NormalTok{,}\DecValTok{12}\NormalTok{,}\DecValTok{13}\NormalTok{,}\DecValTok{14}\NormalTok{,}\DecValTok{15}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Usando rbind()}
\NormalTok{x14 \textless{}{-}}\StringTok{ }\KeywordTok{rbind}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{) }\CommentTok{\# x14 = x11, 5 linhas com 1 elemento cada }
\NormalTok{x15 \textless{}{-}}\StringTok{ }\KeywordTok{rbind}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{)) }\CommentTok{\# x15 = x10, 1 linha com 5 elementos cada}
\NormalTok{x16 \textless{}{-}}\StringTok{ }\KeywordTok{rbind}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{),}\KeywordTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{10}\NormalTok{)) }\CommentTok{\# 2 linhas com 5 elementos cada}
\NormalTok{x16}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{rbind}\NormalTok{(x15,}\KeywordTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{10}\NormalTok{))}
\NormalTok{x17 \textless{}{-}}\StringTok{ }\KeywordTok{rbind}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{6}\NormalTok{),}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{7}\NormalTok{),}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{8}\NormalTok{),}\KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{9}\NormalTok{),}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{10}\NormalTok{)) }\CommentTok{\# x16 = x12}
\end{Highlighting}
\end{Shaded}

As funções \texttt{cbind()} e \texttt{rbind()} \indf{cbind} \indf{rbind} podem ser utilizadas conjuntamente. Não queremos confundir a sua cabeça, mas se a lição anterior foi entendida, a próxima se torna fácil.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Usando rbind() e cbind()}
\NormalTok{x18 \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{),}\KeywordTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{10}\NormalTok{), }\KeywordTok{rbind}\NormalTok{(}\DecValTok{11}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{13}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{15}\NormalTok{))  }
\NormalTok{x18}
\CommentTok{\#      [,1] [,2] [,3]}
\CommentTok{\# [1,]    1    6   11}
\CommentTok{\# [2,]    2    7   12}
\CommentTok{\# [3,]    3    8   13}
\CommentTok{\# [4,]    4    9   14}
\CommentTok{\# [5,]    5   10   15}
\end{Highlighting}
\end{Shaded}

Com a função \texttt{matrix()} \indf{matrix} podemos ter o mesmo resultado que o obtido com o uso das funções \texttt{cbind()} e \texttt{rbind()}. Porém, para utilizar a função \texttt{matrix()}, alguns \emph{argumentos} devem ser declarados. Na função \texttt{matrix(data\ =\ NA,\ nrow\ =\ 1,\ ncol\ =\ 1,\ byrow\ =\ FALSE,dimnames\ =\ NULL)}, os argumentos que devemos inicialmente conhecer são o \texttt{nrow}, \texttt{ncol} e \texttt{byrow}. O primeiro indica o número de linhas da matriz, o segundo a número de colunas e o terceiro indica como a matriz é preenchida. Por \emph{default}, \texttt{byrow} é \texttt{FALSE}, indicando que as matrizes são preenchidas por colunas. Se \texttt{TRUE}, o preenchimento ocorre por linhas.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Usando matrix}
\NormalTok{x19 \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{15}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{5}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{)}
\NormalTok{x19}
\CommentTok{\#      [,1] [,2] [,3]}
\CommentTok{\# [1,]    1    6   11}
\CommentTok{\# [2,]    2    7   12}
\CommentTok{\# [3,]    3    8   13}
\CommentTok{\# [4,]    4    9   14}
\CommentTok{\# [5,]    5   10   15}
\NormalTok{x20 \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{15}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{5}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }\DataTypeTok{byrow =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{x20}
\CommentTok{\#      [,1] [,2] [,3]}
\CommentTok{\# [1,]    1    2    3}
\CommentTok{\# [2,]    4    5    6}
\CommentTok{\# [3,]    7    8    9}
\CommentTok{\# [4,]   10   11   12}
\CommentTok{\# [5,]   13   14   15}
\end{Highlighting}
\end{Shaded}

Para selecionar elementos, linhas e colunas da matriz com {[} {]} utiliza-se um sistema de coordenadas:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x19[}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{] }\CommentTok{\# seleciona o elemento que está na linha 2 e coluna 3}
\CommentTok{\# [1] 12}
\NormalTok{x19[, }\DecValTok{2}\NormalTok{] }\CommentTok{\# "," indica que todas as linhas serão selecionadas na coluna 2}
\CommentTok{\# [1]  6  7  8  9 10}
\NormalTok{x19[}\DecValTok{1}\NormalTok{, ] }\CommentTok{\# "," indica que todas as colunas serão selecionadas na linha 1}
\CommentTok{\# [1]  1  6 11}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-frame}{%
\section{Data Frame}\label{data-frame}}

A função \texttt{data.frame()} \indf{data.frame} cria estruturas cujas colunas podem ser valores numéricos ou caracteres. É uma estrutura muito utilizada em funções do \emph{software R}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x22 \textless{}{-}}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
      \KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{Ambiente =} \KeywordTok{c}\NormalTok{(}\StringTok{"A1"}\NormalTok{, }\StringTok{"A2"}\NormalTok{),}
                  \DataTypeTok{Genotipo =} \KeywordTok{c}\NormalTok{(}\StringTok{"G1"}\NormalTok{, }\StringTok{"G2"}\NormalTok{, }\StringTok{"G3"}\NormalTok{),}
                  \DataTypeTok{Rep =} \KeywordTok{c}\NormalTok{(}\StringTok{"I"}\NormalTok{, }\StringTok{"II"}\NormalTok{, }\StringTok{"III"}\NormalTok{)),}
                  \DataTypeTok{Y =} \KeywordTok{rnorm}\NormalTok{(}\DecValTok{18}\NormalTok{, }\DecValTok{50}\NormalTok{, }\DecValTok{15}\NormalTok{))}
\KeywordTok{str}\NormalTok{(x22)}
\CommentTok{\# \textquotesingle{}data.frame\textquotesingle{}: 18 obs. of  4 variables:}
\CommentTok{\#  $ Ambiente: Factor w/ 2 levels "A1","A2": 1 2 1 2 1 2 1 2 1 2 ...}
\CommentTok{\#  $ Genotipo: Factor w/ 3 levels "G1","G2","G3": 1 1 2 2 3 3 1 1 2 2 ...}
\CommentTok{\#  $ Rep     : Factor w/ 3 levels "I","II","III": 1 1 1 1 1 1 2 2 2 2 ...}
\CommentTok{\#  $ Y       : num  73.8 53.3 68.4 69.4 50.7 ...}
\end{Highlighting}
\end{Shaded}

Em \emph{x22} simulamos como muitos experimentos são organizados no momento de tabulação dos dados (fatores nas colunas e variáveis nas linhas).

\hypertarget{tibbles}{%
\section{Tibbles}\label{tibbles}}

Um \texttt{tibble}\indt{tibble}, ou \texttt{tbl\_df}, é uma versão moderna do \texttt{data.frame}. Tibbles são datas frames que não alteram nomes ou tipos de variáveis, possuindo um método \texttt{print()} aprimorado, que facilita o uso com grandes conjuntos de dados contendo objetos complexos. Você pode forçar um objeto de classe \texttt{data.frame} a um de classe \texttt{tibble} utilizando \texttt{as\_tibble()} \indt{tibble} ou criar um a partir de vetores individuais com \texttt{tibble()} \indf{tibble}. A função \texttt{tibble()}, diferente de \texttt{data.frame()}\indf{data.frame} permite que você se refira às variáveis que você acabou de criar. É possível, também, que um tibble tenha nomes de colunas que não sejam nomes de variáveis R válidos. Por exemplo, elas podem não começar com uma letra ou podem conter caracteres incomuns como um espaço. Para se referir a essas variáveis, você precisa cercá-las com `. Neste documento, a estrutura de dados padrão a ser utilizada será tibble.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convertendo um dataframe a um tibble}
\NormalTok{tbl\_x22 \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(x22)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tentando criar um dataframe}
\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x =} \DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{,}
           \DataTypeTok{y =} \DecValTok{1}\NormalTok{,}
           \DataTypeTok{z =}\NormalTok{ x }\OperatorTok{\^{}}\StringTok{ }\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Criando um tibble}
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x =} \DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{,}
       \DataTypeTok{y =}\NormalTok{ x }\OperatorTok{\^{}}\StringTok{ }\DecValTok{2}\NormalTok{,}
       \StringTok{\textasciigrave{}}\DataTypeTok{soma x + y}\StringTok{\textasciigrave{}}\NormalTok{ =}\StringTok{ }\NormalTok{x }\OperatorTok{+}\StringTok{ }\NormalTok{y)}
\CommentTok{\# \# A tibble: 5 x 3}
\CommentTok{\#       x     y \textasciigrave{}soma x + y\textasciigrave{}}
\CommentTok{\#   \textless{}int\textgreater{} \textless{}dbl\textgreater{}        \textless{}dbl\textgreater{}}
\CommentTok{\# 1     1     1            2}
\CommentTok{\# 2     2     4            6}
\CommentTok{\# 3     3     9           12}
\CommentTok{\# 4     4    16           20}
\CommentTok{\# 5     5    25           30}
\end{Highlighting}
\end{Shaded}

\hypertarget{lista}{%
\section{Lista}\label{lista}}

No exemplo abaixo, será armazenado em uma lista \indt{lista} dois data-frames e uma matriz. Posteriomente, \indt{lista}será selecionado a matriz que está armazenada na lista:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x23 \textless{}{-}}\StringTok{ }\KeywordTok{list}\NormalTok{(x19, x22)}
\NormalTok{x24 \textless{}{-}}\StringTok{ }\NormalTok{x23[[}\DecValTok{1}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\hypertarget{funuxe7uxf5es}{%
\section{Funções}\label{funuxe7uxf5es}}

As funções \indt{funções} são a base da linguagem \emph{R}. Através de \emph{argumentos} que são indicados em \texttt{funtion()}, uma expressão (ou série de expressões) é resolvida e um valor (ou um conjunto de valores) é retornado. \indt{function()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{F1 \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x)\{ }\CommentTok{\# x é o argumento da função}
\NormalTok{  a =}\StringTok{ }\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x }\OperatorTok{+}\StringTok{ }\DecValTok{1}
  \KeywordTok{return}\NormalTok{(a) }\CommentTok{\# retorna a}
\NormalTok{\}}

\NormalTok{F2 \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, y)\{ }\CommentTok{\# dois argumentos na função}
\NormalTok{  a =}\StringTok{ }\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x }\OperatorTok{+}\StringTok{ }\DecValTok{1}
\NormalTok{  b =}\StringTok{ }\NormalTok{y}
\NormalTok{  c =}\StringTok{ }\NormalTok{a }\OperatorTok{+}\StringTok{ }\NormalTok{b}
  \KeywordTok{return}\NormalTok{(c) }\CommentTok{\# retorna c}
\NormalTok{\}}

\NormalTok{F3 \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x)\{}
  \ControlFlowTok{if}\NormalTok{(x }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{10}\NormalTok{)\{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"O argumento x = "}\NormalTok{, x, }\StringTok{" é inválido. \textquotesingle{}x\textquotesingle{} precisa ser maior que 10"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  a =}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(x}\OperatorTok{\textless{}=}\StringTok{ }\DecValTok{5}\NormalTok{, }\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{, }\DecValTok{3} \OperatorTok{*}\StringTok{ }\NormalTok{x }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{)}
  \KeywordTok{return}\NormalTok{(a)}
\NormalTok{\}}

\NormalTok{elevar \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, }\DataTypeTok{eleva =} \StringTok{"quadrado"}\NormalTok{)\{}
  \ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\NormalTok{eleva }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"quadrado"}\NormalTok{, }\StringTok{"cubo"}\NormalTok{))\{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"O argumento eleva = "}\NormalTok{,eleva, }\StringTok{" deve ser ou \textquotesingle{}quadrado\textquotesingle{} ou \textquotesingle{}cubo\textquotesingle{}"}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(eleva }\OperatorTok{==}\StringTok{ "quadrado"}\NormalTok{)\{}
\NormalTok{  valor \textless{}{-}}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(x}\OperatorTok{\^{}}\DecValTok{2} \OperatorTok{\textgreater{}=}\StringTok{ }\DecValTok{1000}\NormalTok{,}
                 \KeywordTok{paste}\NormalTok{(}\StringTok{"O resultado ("}\NormalTok{,x}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\StringTok{") tem mais que 3 dígitos"}\NormalTok{),}
                 \KeywordTok{paste}\NormalTok{(}\StringTok{"O resultado ("}\NormalTok{,x}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\StringTok{") tem menos que 3 dígitos"}\NormalTok{))}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(eleva }\OperatorTok{==}\StringTok{ "cubo"}\NormalTok{)\{}
\NormalTok{  valor \textless{}{-}}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(x}\OperatorTok{\^{}}\DecValTok{3} \OperatorTok{\textgreater{}=}\StringTok{ }\DecValTok{1000}\NormalTok{,}
                 \KeywordTok{paste}\NormalTok{(}\StringTok{"O resultado ("}\NormalTok{,x}\OperatorTok{\^{}}\DecValTok{3}\NormalTok{,}\StringTok{") tem mais que 3 dígitos"}\NormalTok{),}
                 \KeywordTok{paste}\NormalTok{(}\StringTok{"O resultado ("}\NormalTok{,x}\OperatorTok{\^{}}\DecValTok{3}\NormalTok{,}\StringTok{") tem menos que 3 dígitos"}\NormalTok{))}
\NormalTok{  \}}
                 
  \KeywordTok{return}\NormalTok{(valor)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Quando uma função é armazenada no ambiente de trabalho, basta digitar o nome como o qual aquela função foi gravada. Os argumentos podem ser inseridos na ordem em que aparecem na função, sem especificar a qual argumento aquele valor pertence. No caso em que a inserção dos argumentos é diferente da ordem em que aparecem na função, é preciso identificar a qual argumento aquele valor pertente. Note que é possível combinar valores numéricos e texto como argumentos e/ou resultados de funções.

\begin{tarefa}
\textbf{Exercício 1}

\begin{itemize}
\tightlist
\item
  O resultado da função \texttt{F2(2,\ 3)} foi o mesmo da \texttt{F2(y\ =\ 3,\ x\ =2)}? Por quê?
\item
  Por quê ocorreu um erro quando a função \texttt{F3(20)} foi rodada?
\item
  O que tem de errado na execução da função \texttt{elevar(12,\ eleva\ =\ "cubico")}?
\item
  Crie uma função chamada \texttt{mega} que retorna os números a serem apostados em jogo da Mega Sena, tendo como argumentos \texttt{jogos}, que define quantos jogos e \texttt{numeros}, que define quantos numeros serão escolhidos em cada aposta (6-15). Para cada jogo ordene os números em ordem crescente.
\end{itemize}
\end{tarefa}

\protect\hyperlink{exerc1}{Resposta}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{F1}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\KeywordTok{F2}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\KeywordTok{F2}\NormalTok{(}\DataTypeTok{y =} \DecValTok{3}\NormalTok{, }\DataTypeTok{x =}\DecValTok{2}\NormalTok{)}
\KeywordTok{F3}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\KeywordTok{F3}\NormalTok{(}\DecValTok{6}\NormalTok{)}
\KeywordTok{F3}\NormalTok{(}\DecValTok{20}\NormalTok{)}
\KeywordTok{elevar}\NormalTok{(}\DecValTok{12}\NormalTok{)}
\KeywordTok{elevar}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DataTypeTok{eleva =} \StringTok{"cubico"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{identificando-as-classes-de-objetos}{%
\section{Identificando as classes de objetos}\label{identificando-as-classes-de-objetos}}

Conforme visto anteriormente, é possível construir várias classes de objetos em linguagem \emph{R}. Veremos mais adiante que muitas funções exigem classes específicas como \emph{argumento}, e por isso conhecê-los é muito importante. Funções genéricas como \texttt{class()} \indf{class} ou \emph{is.objeto} são importantes para identificar a qual tipo de classe tal objeto pertence.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{(x19)}
\CommentTok{\# [1] "matrix" "array"}
\KeywordTok{class}\NormalTok{(x22)}
\CommentTok{\# [1] "data.frame"}
\KeywordTok{class}\NormalTok{(x24)}
\CommentTok{\# [1] "matrix" "array"}
\KeywordTok{is.matrix}\NormalTok{(x19)}
\CommentTok{\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

Algumas funções permitem forçar objetos a uma classe específica, como por exemplo, transformar um objeto de classe \texttt{data.frame} em um objeto de classe \texttt{matrix}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x22 \textless{}{-}}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(x22)}
\NormalTok{x19 \textless{}{-}}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(x19)}
\end{Highlighting}
\end{Shaded}

\indf{as.factor} \indf{as.numeric}

\hypertarget{math}{%
\chapter{Operações matemáticas}\label{math}}

As operações matemáticas utilizam símbolos que são padrão em outros softwares estatísticos.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \CommentTok{\# Soma}
\DecValTok{2} \OperatorTok{{-}}\StringTok{ }\DecValTok{1} \CommentTok{\# Subtração}
\DecValTok{2} \OperatorTok{*}\StringTok{ }\DecValTok{2} \CommentTok{\# Multiplicação}
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{2} \OperatorTok{*}\StringTok{ }\DecValTok{2} \OperatorTok{\^{}}\StringTok{ }\DecValTok{2} \CommentTok{\# Primeiro eleva ao quadrado, depois multiplica e depois soma}
\NormalTok{((}\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{2}\NormalTok{) }\OperatorTok{*}\StringTok{ }\DecValTok{2}\NormalTok{) }\OperatorTok{\^{}}\StringTok{ }\DecValTok{2} \CommentTok{\# Primeiro soma e depois multiplica depois eleva ao quadrado}
\KeywordTok{sqrt}\NormalTok{(}\DecValTok{4}\NormalTok{) }\CommentTok{\# Raiz quadrada}
\DecValTok{4}\OperatorTok{\^{}}\DecValTok{2} \CommentTok{\# Potência}
\KeywordTok{log}\NormalTok{(}\DecValTok{10}\NormalTok{) }\CommentTok{\# Por default, o logarítimo é de base e (logarítimo natural)}
\KeywordTok{log}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{10}\NormalTok{) }\CommentTok{\# Logarítimo de base 10}
\KeywordTok{exp}\NormalTok{(}\DecValTok{100}\NormalTok{) }\CommentTok{\# exponencial}
\end{Highlighting}
\end{Shaded}

Para multiplicação de matrizes utiliza-se \texttt{\%*\%} ao envéz de \texttt{*}. Note a diferença no exemplo abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{))}
\CommentTok{\#      [,1] [,2]}
\CommentTok{\# [1,]    1    3}
\CommentTok{\# [2,]    2    4}
\NormalTok{(y \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{5}\OperatorTok{:}\DecValTok{8}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{))}
\CommentTok{\#      [,1] [,2]}
\CommentTok{\# [1,]    5    7}
\CommentTok{\# [2,]    6    8}
\end{Highlighting}
\end{Shaded}

O resultado da multiplicação da matriz \texttt{x} e \texttt{y} é dado por:

\[
    \left( {\begin{array}{*{20}{c}}{1 \cdot 5 + 3 \cdot 6}&{1 \cdot 7 + 3 \cdot 8}\\{2 \cdot 5 + 4 \cdot 6}&{2 \cdot 7 + 4 \cdot 8}\end{array}} \right) = \left( {\begin{array}{*{20}{c}}{23}&{31}\\{34}&{46}\end{array}} \right)
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OperatorTok{*}\StringTok{ }\NormalTok{y }\CommentTok{\# Errado}
\CommentTok{\#      [,1] [,2]}
\CommentTok{\# [1,]    5   21}
\CommentTok{\# [2,]   12   32}
\NormalTok{x }\OperatorTok{\%*\%}\StringTok{ }\NormalTok{y }\CommentTok{\# Certo}
\CommentTok{\#      [,1] [,2]}
\CommentTok{\# [1,]   23   31}
\CommentTok{\# [2,]   34   46}
\end{Highlighting}
\end{Shaded}

A função \texttt{t()} \indf{t} é utilizada para transposição de matrizes e \texttt{solve()} \indf{solve} para inversão de matrizes. Vamos resolver o seguinte sistema de equações retirado do livro de (Rencher and Schaalje \protect\hyperlink{ref-Rencher2008}{2008}) utilizando estes operadores.

\[
    \begin{array}{l}{x_1} + 2{x_2} = 4\\{x_1} - {x_2} = 1\\{x_1} + {x_2} = 3\end{array}
\]

Matricialmente o sistema acima é dado por:

\[\left[ {\begin{array}{*{20}{c}}{\begin{array}{*{20}{l}}1\\1\\1\end{array}}&{\begin{array}{*{20}{c}}2\\{ - 1}\\1\end{array}}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{x_1}}\\{{x_2}}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}4\\1\\3\end{array}} \right]\]

Esse sistema de equações é representado por \({\bf{AX}} = {\bf{c}}\) e tem como solução \({\bf{X = }}{{\bf{A}}^{{\bf{ - 1}}}}{\bf{c}}\)

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{(A \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{{-}1}\NormalTok{, }\DecValTok{1}\NormalTok{), }\DataTypeTok{nrow =} \DecValTok{3}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{))}
\CommentTok{\#      [,1] [,2]}
\CommentTok{\# [1,]    1    2}
\CommentTok{\# [2,]    1   {-}1}
\CommentTok{\# [3,]    1    1}
\NormalTok{A1 \textless{}{-}}\StringTok{ }\NormalTok{MASS}\OperatorTok{::}\KeywordTok{ginv}\NormalTok{(A) }\CommentTok{\# Obtém a inversa generalizada de A}
\NormalTok{c \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{) }\CommentTok{\# Vetor C}
\NormalTok{X \textless{}{-}}\StringTok{ }\NormalTok{A1 }\OperatorTok{\%*\%}\StringTok{ }\NormalTok{c}
\NormalTok{X}
\CommentTok{\#      [,1]}
\CommentTok{\# [1,]    2}
\CommentTok{\# [2,]    1}
\end{Highlighting}
\end{Shaded}

Considere um equação linear múltipla cuja variável dependente é \textbf{Y} e as variáveis independentes são \textbf{X1} e \textbf{X2} (dados obtidos em (Kutner et al. \protect\hyperlink{ref-Kutner2005}{2005})). O sistema de equações é representado matricialmente por \indt{sistema de equações}

\[
\boldsymbol{X'X{\beta = X'Y}}
\]

que tem como solução:

\[
\boldsymbol{\hat\beta = X'X^{-1}X'Y}
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X0 \textless{}{-}}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DataTypeTok{each =} \DecValTok{10}\NormalTok{)}
\NormalTok{X1 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{68.5}\NormalTok{, }\FloatTok{45.2}\NormalTok{, }\FloatTok{91.3}\NormalTok{, }\FloatTok{47.8}\NormalTok{, }\FloatTok{46.9}\NormalTok{, }\FloatTok{66.1}\NormalTok{, }\FloatTok{49.5}\NormalTok{, }\DecValTok{52}\NormalTok{, }\FloatTok{48.9}\NormalTok{, }\FloatTok{38.4}\NormalTok{)}
\NormalTok{X2 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{16.7}\NormalTok{, }\FloatTok{16.8}\NormalTok{, }\FloatTok{18.2}\NormalTok{, }\FloatTok{16.3}\NormalTok{, }\FloatTok{17.3}\NormalTok{, }\FloatTok{18.2}\NormalTok{, }\FloatTok{15.9}\NormalTok{, }\FloatTok{17.2}\NormalTok{, }\FloatTok{16.6}\NormalTok{, }\DecValTok{16}\NormalTok{)}
\NormalTok{Y \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{174.4}\NormalTok{,  }\FloatTok{164.4}\NormalTok{, }\FloatTok{244.2}\NormalTok{, }\FloatTok{154.6}\NormalTok{, }\FloatTok{181.6}\NormalTok{, }\FloatTok{207.5}\NormalTok{, }\FloatTok{152.8}\NormalTok{, }\FloatTok{163.2}\NormalTok{, }\FloatTok{145.4}\NormalTok{, }\FloatTok{137.2}\NormalTok{)}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{c}\NormalTok{(X0, X1, X2), }\DataTypeTok{nrow =} \DecValTok{10}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{)}
\NormalTok{X}
\CommentTok{\#       [,1] [,2] [,3]}
\CommentTok{\#  [1,]    1 68.5 16.7}
\CommentTok{\#  [2,]    1 45.2 16.8}
\CommentTok{\#  [3,]    1 91.3 18.2}
\CommentTok{\#  [4,]    1 47.8 16.3}
\CommentTok{\#  [5,]    1 46.9 17.3}
\CommentTok{\#  [6,]    1 66.1 18.2}
\CommentTok{\#  [7,]    1 49.5 15.9}
\CommentTok{\#  [8,]    1 52.0 17.2}
\CommentTok{\#  [9,]    1 48.9 16.6}
\CommentTok{\# [10,]    1 38.4 16.0}
\NormalTok{B \textless{}{-}}\StringTok{ }\NormalTok{(}\KeywordTok{solve}\NormalTok{(}\KeywordTok{t}\NormalTok{(X) }\OperatorTok{\%*\%}\StringTok{ }\NormalTok{X)) }\OperatorTok{\%*\%}\StringTok{  }\KeywordTok{t}\NormalTok{(X) }\OperatorTok{\%*\%}\StringTok{ }\NormalTok{Y}
\NormalTok{B}
\CommentTok{\#             [,1]}
\CommentTok{\# [1,] {-}234.698704}
\CommentTok{\# [2,]    1.074137}
\CommentTok{\# [3,]   20.547108}
\end{Highlighting}
\end{Shaded}

O modelo ajustado é dado por \(\hat Y = - 234.698704 + 1.074137{X_1} + 20.547108{X_2} + \varepsilon\). Combinando algumas funções vistas até agora, vamos criar um vetor de dados chamado \textbf{PRED} com os valores estimados pelo modelo acima. Em adição, um vetor de resíduos (\textbf{RESID}) será criado.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{PRED \textless{}{-}}\StringTok{ }\NormalTok{B[}\DecValTok{1}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{B[}\DecValTok{2}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{B[}\DecValTok{3}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{X2}
\NormalTok{RESID \textless{}{-}}\StringTok{ }\NormalTok{Y }\OperatorTok{{-}}\StringTok{ }\NormalTok{PRED}
\end{Highlighting}
\end{Shaded}

As funções \texttt{det()} \indf{det} para calcular o determinante de uma matriz. Já a função \texttt{eigen()} \indf{eigen} retorna uma lista com os autovalores e autovetores da matriz. A função \texttt{names()} \indf{names} indica o que contém no objeto \texttt{av}, e usando \texttt{\$} é possivel selecionar os autovalores ou os autovetores.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{), }\DataTypeTok{nrow =} \DecValTok{3}\NormalTok{)}
\NormalTok{detXX \textless{}{-}}\StringTok{ }\KeywordTok{det}\NormalTok{(mat)}
\NormalTok{av \textless{}{-}}\StringTok{ }\KeywordTok{eigen}\NormalTok{(mat)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(av)}
\CommentTok{\# [1] "values"  "vectors"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{av}\OperatorTok{$}\NormalTok{values }\CommentTok{\# Extrai os autovalores}
\CommentTok{\# [1]  8  2 {-}1}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{av}\OperatorTok{$}\NormalTok{vectors }\CommentTok{\# Extrai os autovetores}
\CommentTok{\#           [,1]       [,2]       [,3]}
\CommentTok{\# [1,] 0.4082483 {-}0.3333333  0.7715167}
\CommentTok{\# [2,] 0.8164966 {-}0.6666667  0.1543033}
\CommentTok{\# [3,] 0.4082483  0.6666667 {-}0.6172134}
\end{Highlighting}
\end{Shaded}

A função \texttt{diag()} \indf{diag} extrai a diagonal de uma matriz ou cria uma matriz onde a diagonal são os elementos declarados. Os próximos comandos extraem a diagonal de XX e criam uma matriz identidade, com 5 linhas e 5 colunas.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{diag}\NormalTok{(mat)}
\CommentTok{\# [1] 0 5 4}
\KeywordTok{diag}\NormalTok{(}\DataTypeTok{x =} \DecValTok{1}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{4}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{4}\NormalTok{)}
\CommentTok{\#      [,1] [,2] [,3] [,4]}
\CommentTok{\# [1,]    1    0    0    0}
\CommentTok{\# [2,]    0    1    0    0}
\CommentTok{\# [3,]    0    0    1    0}
\CommentTok{\# [4,]    0    0    0    1}
\end{Highlighting}
\end{Shaded}

\hypertarget{loops}{%
\chapter{Loops}\label{loops}}

\indt{loops}

Reescrever um código muitas vezes por necessidade de repetir um determinado procedimento seria bastante trabalhoso, além de precisarmos de mais tempo para isso. Por isso, o R tem algumas funções que fazem essas repetições para nós. Isso é muito comum e pode ser facilmente implementado pela função \texttt{for()}\indf{for}, \texttt{while()}\indf{while} e \texttt{repeat()}\indf{repeat}.
A função \texttt{for()} repete o código indicado dentro de \texttt{\{\}} \emph{n} vezes, sendo \emph{n} o comprimento da sequência dentro dos parênteses.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{j \textless{}{-}}\StringTok{ }\DecValTok{5}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{j)\{}
\NormalTok{  k \textless{}{-}}\StringTok{ }\NormalTok{i }\OperatorTok{*}\StringTok{ }\DecValTok{2}
  \KeywordTok{print}\NormalTok{(k)}
\NormalTok{\}}
\CommentTok{\# [1] 2}
\CommentTok{\# [1] 4}
\CommentTok{\# [1] 6}
\CommentTok{\# [1] 8}
\CommentTok{\# [1] 10}
\end{Highlighting}
\end{Shaded}

A função \texttt{while()} (que significa enquanto) repete o código dentro de \texttt{\{\}} enquanto alguma condição for verdadeira.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i \textless{}{-}}\StringTok{ }\DecValTok{1}
\ControlFlowTok{while}\NormalTok{ (i }\OperatorTok{\textless{}=}\StringTok{ }\DecValTok{5}\NormalTok{)\{}
  \KeywordTok{print}\NormalTok{(i }\OperatorTok{*}\StringTok{ }\DecValTok{2}\NormalTok{)}
\NormalTok{  i \textless{}{-}}\StringTok{ }\NormalTok{i }\OperatorTok{+}\StringTok{ }\DecValTok{1}
\NormalTok{\}}
\CommentTok{\# [1] 2}
\CommentTok{\# [1] 4}
\CommentTok{\# [1] 6}
\CommentTok{\# [1] 8}
\CommentTok{\# [1] 10}
\end{Highlighting}
\end{Shaded}

Note que os dois últimos exemplos apresentam o mesmo resultado: o R vai retornar uma sequência \texttt{i} sendo \texttt{i\ =\ 1:5}, onde cada número será o resultado da multiplicação \(i \times 2\). No caso \texttt{while()}, precisamos mudar o valor de \texttt{i} para que a sequência continue até que a condição \texttt{(i\ \textless{}=\ 5)} for verdadeira. Em adição, precisamos declarar a variável (\texttt{i\ =\ 1}) antes para que o R possa testar a condição expressa dentro dos parênteses. No caso do \texttt{for()}, a sequência progride sem precisarmos fazer isso manualmente.

No último exemplo, utilizando \texttt{repeat()}, o R repetirá o código dentro de \texttt{\{\}} sem condições. Com isso, precisamos utilizar a combinação das funções \texttt{if()} e \texttt{break()} para informar ao programa quando o código deve parar de ser repetido.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i \textless{}{-}}\StringTok{ }\DecValTok{1}
\ControlFlowTok{repeat}\NormalTok{ \{}
  \KeywordTok{print}\NormalTok{(i }\OperatorTok{*}\StringTok{ }\DecValTok{2}\NormalTok{)}
\NormalTok{  i \textless{}{-}}\StringTok{ }\NormalTok{i }\OperatorTok{+}\StringTok{ }\DecValTok{1}
  \ControlFlowTok{if}\NormalTok{(i }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{5}\NormalTok{)\{}
    \ControlFlowTok{break}\NormalTok{()}
\NormalTok{  \}}
\NormalTok{\}}
\CommentTok{\# [1] 2}
\CommentTok{\# [1] 4}
\CommentTok{\# [1] 6}
\CommentTok{\# [1] 8}
\CommentTok{\# [1] 10}
\end{Highlighting}
\end{Shaded}

Os Loops são importantes em estudos que utilizam reamostragens para realizar análises estatísticas. Através de reamostragnes é possível construir intervalos de confiança e testar hipóteses não paramétricas. Como exemplo, vamos demonstrar o teorema central do limite\footnote{O teorema central do limite define que as médias de amostras grandes e aleatórias são aproximadamente normais, independentemente da forma da distribuição da população}. Para isto, criamos uma função (\texttt{teor\_lim()}) \indf{teor\_lim} que tem 4 argumentos: \texttt{n} o tamanho da amostra a ser considerada, \texttt{namostra}, \texttt{min}, \texttt{max} são os parâmetros da distribuição uniforme (veja \texttt{?runif}). Para confecção dos dendrogramas, os pacotes \textbf{ggplot2} e \texttt{cowplot} serão utilizados. Veja a seção 1.6 para maiores informações sobre a confecção de gráficos com estes pacotes. \indt{ggplot2}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(cowplot)}
\NormalTok{teor\_lim \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(n, namostra, min, max)\{}
  \KeywordTok{set.seed}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\NormalTok{  media \textless{}{-}}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ n))}
  \KeywordTok{names}\NormalTok{(media) =}\StringTok{ "value"}
  \ControlFlowTok{for}\NormalTok{(j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{n)\{}
\NormalTok{    media[j, }\DecValTok{1}\NormalTok{] =}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{runif}\NormalTok{(namostra, min, max))}
\NormalTok{  \}}
  \KeywordTok{return}\NormalTok{(media)}
\NormalTok{\}}

\NormalTok{teorema\_limite \textless{}{-}}\StringTok{ }\KeywordTok{list}\NormalTok{(}
\NormalTok{  n20 \textless{}{-}}\StringTok{ }\KeywordTok{teor\_lim}\NormalTok{(}\DataTypeTok{n =} \DecValTok{20}\NormalTok{, }\DataTypeTok{namostra =} \DecValTok{100}\NormalTok{, }\DataTypeTok{min =} \DecValTok{0}\NormalTok{, }\DataTypeTok{max =} \DecValTok{10}\NormalTok{),}
\NormalTok{  n200 \textless{}{-}}\StringTok{ }\KeywordTok{teor\_lim}\NormalTok{(}\DataTypeTok{n =} \DecValTok{200}\NormalTok{, }\DataTypeTok{namostra =} \DecValTok{100}\NormalTok{, }\DataTypeTok{min =} \DecValTok{0}\NormalTok{, }\DataTypeTok{max =} \DecValTok{10}\NormalTok{),}
\NormalTok{  n2000 \textless{}{-}}\StringTok{ }\KeywordTok{teor\_lim}\NormalTok{(}\DataTypeTok{n =} \DecValTok{2000}\NormalTok{, }\DataTypeTok{namostra =} \DecValTok{100}\NormalTok{, }\DataTypeTok{min =} \DecValTok{0}\NormalTok{, }\DataTypeTok{max =} \DecValTok{10}\NormalTok{),}
\NormalTok{  n20000 \textless{}{-}}\StringTok{ }\KeywordTok{teor\_lim}\NormalTok{(}\DataTypeTok{n =} \DecValTok{20000}\NormalTok{, }\DataTypeTok{namostra =} \DecValTok{100}\NormalTok{, }\DataTypeTok{min =} \DecValTok{0}\NormalTok{, }\DataTypeTok{max =} \DecValTok{10}\NormalTok{)}
\NormalTok{)}

\NormalTok{p \textless{}{-}}\StringTok{ }\KeywordTok{lapply}\NormalTok{(teorema\_limite, }\ControlFlowTok{function}\NormalTok{(d)\{}
  \KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ d, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ value))}\OperatorTok{+}
\StringTok{    }\KeywordTok{geom\_histogram}\NormalTok{(}\DataTypeTok{bins =} \DecValTok{50}\NormalTok{,}
                   \DataTypeTok{col =} \StringTok{"black"}\NormalTok{,}
                   \DataTypeTok{size =} \FloatTok{0.3}\NormalTok{,}
                   \KeywordTok{aes}\NormalTok{(}\DataTypeTok{fill =}\NormalTok{ ..count..))}\OperatorTok{+}
\StringTok{    }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{)}\OperatorTok{+}
\StringTok{    }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Média"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Contagem"}\NormalTok{)}
  
\NormalTok{\})}
\KeywordTok{plot\_grid}\NormalTok{(}\DataTypeTok{plotlist =}\NormalTok{ p,}
          \DataTypeTok{labels =} \KeywordTok{names}\NormalTok{(teorema\_limite),}
          \DataTypeTok{vjust =} \FloatTok{2.5}\NormalTok{,}
          \DataTypeTok{hjust =} \KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\FloatTok{1.7}\NormalTok{, }\FloatTok{{-}1.5}\NormalTok{, }\DecValTok{{-}1}\NormalTok{, }\DecValTok{{-}1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-41-1} 

}

\caption{Demonstração do teorema central do limite}\label{fig:unnamed-chunk-41}
\end{figure}

\hypertarget{dataframe}{%
\chapter{Construindo uma tabela}\label{dataframe}}

Com o que foi visto até agora, é possível construir uma tabela para armazenar dados ou resultados gerados em uma análise. São inumeras as formas de fazer isso, porém vamos mostrar apenas uma (devido ao pouco tempo). Utilizaremos as funções \texttt{matrix()} \indf{matrix} e \texttt{data.frame()} \indf{data.frame} para a tabela, e a função \texttt{names()} para dar nomeas as colunas. A construção de tabelas é muito util para armazenar resultados na área de trabalho.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Ex.gen \textless{}{-}}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{20}\NormalTok{))}
\KeywordTok{names}\NormalTok{(Ex.gen) =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"G1"}\NormalTok{,}\StringTok{"G2"}\NormalTok{,}\StringTok{"G3"}\NormalTok{)}
\NormalTok{Yeld1 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{1}\NormalTok{) }
\CommentTok{\# gera 20 valores de uma distribuição normal com média 10 e desvio padrão 1}
\NormalTok{Yeld2 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{40}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\CommentTok{\# gera 20 valores de uma distribuição normal com média 40 e desvio padrão 3}
\NormalTok{Yeld3 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{25}\NormalTok{,}\FloatTok{2.5}\NormalTok{)}
\CommentTok{\# gera 20 valores de uma distribuição normal com média 25 e desvio padrão 2,5}
\NormalTok{Ex.gen}\OperatorTok{$}\NormalTok{G1 \textless{}{-}}\StringTok{ }\NormalTok{Yeld1}
\NormalTok{Ex.gen}\OperatorTok{$}\NormalTok{G2 \textless{}{-}}\StringTok{ }\NormalTok{Yeld2}
\NormalTok{Ex.gen}\OperatorTok{$}\NormalTok{G3 \textless{}{-}}\StringTok{ }\NormalTok{Yeld3}
\end{Highlighting}
\end{Shaded}

Vimos anteriormente, no entanto, que a utilização de \textbf{tibbles} \indt{tibble} é recomendada. O mesmo conjunto de dados pode ser criado mais ``elegantemente'' com a função abaixo

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Ex.gen2 \textless{}{-}}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{G1 =} \KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{1}\NormalTok{),}
                  \DataTypeTok{G2 =} \KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{40}\NormalTok{,}\DecValTok{3}\NormalTok{),}
                  \DataTypeTok{G3 =} \KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{25}\NormalTok{,}\FloatTok{2.5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{part-organizauxe7uxe3o-manipulauxe7uxe3o-e-apresentauxe7uxe3o-de-dados}{%
\part{Organização, manipulação e apresentação de dados}\label{part-organizauxe7uxe3o-manipulauxe7uxe3o-e-apresentauxe7uxe3o-de-dados}}

\hypertarget{entrada}{%
\chapter{Entrada de dados}\label{entrada}}

A entrada de dados pode ser feita de várias maneiras, e em vários formatos. Porém daremos destaque as formas mais comuns. A forma mais simples (e mais trabalhosa) é digitar os dados diretamente no \emph{console}, utilizando para isso a função \texttt{scan()}. \indf{scan} Para importar dados digitados em extensão \emph{.txt} utiliza-se a função \texttt{read.table()}. \indt{read.table} Por fim, para carregar arquivos em extensão \emph{.xlsx} a maneira mais simples é utilizar o \emph{Import Dataset} que encontra-se na área de trabalho.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data \textless{}{-}}\StringTok{ }\KeywordTok{scan}\NormalTok{() }\CommentTok{\#Enter}
\DecValTok{1}\OperatorTok{:}\StringTok{ }\DecValTok{10}
\DecValTok{2}\OperatorTok{:}\StringTok{ }\DecValTok{20}
\DecValTok{3}\OperatorTok{:}\StringTok{ }\DecValTok{30}
\DecValTok{4}\OperatorTok{:}\StringTok{ }\DecValTok{40}
\DecValTok{5}\OperatorTok{:}\StringTok{ }\CommentTok{\# Duplo enter}
\NormalTok{data}
\end{Highlighting}
\end{Shaded}

A função \texttt{scan()} é muito trabalhosa e pouco utilizada. Caso o usuário queira carregar dados salvos em extensão \emph{.txt} (bloco de notas), usando a função \texttt{read.table()}, deve-se ter o cuidado de mover o arquivo para o diretório previamente indicado. Como as colunas são identificadas por espaços, é importante que o usuário não utilize nomes compostos no cabeçalho ou no corpo da tabela. Quando isso ocorre, o \emph{R} identifica o erro no console através da mensagem \texttt{Error\ in\ read.table("Dados\_1.txt",\ header\ =\ TRUE)\ :\ more\ columns\ than\ column\ names}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados \textless{}{-}}\StringTok{ }\KeywordTok{read.table}\NormalTok{(}\StringTok{"data/Dados\_1.txt"}\NormalTok{, }\DataTypeTok{header =} \OtherTok{TRUE}\NormalTok{)}
\CommentTok{\# Argumento header = TRUE indica a existência de cabeçalho}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados \textless{}{-}}\StringTok{ }\KeywordTok{read.table}\NormalTok{(}\StringTok{"data/Dados\_2.txt"}\NormalTok{, }\DataTypeTok{header =} \OtherTok{TRUE}\NormalTok{)}
\CommentTok{\# Argumento header = TRUE indica a existência de cabeçalho}
\NormalTok{dados}
\CommentTok{\#           Trat Rep      Sta     num    peso}
\CommentTok{\# 1 bcco\_alb\_imp   1 1132.789 0.00000 0.00000}
\CommentTok{\# 2 bcco\_alb\_imp   2 1199.039 0.06250 0.61875}
\CommentTok{\# 3 bcco\_alb\_imp   3 1265.189 0.06250 0.61875}
\CommentTok{\# 4 bcco\_alb\_imp   4 1337.789 0.16525 1.48125}
\end{Highlighting}
\end{Shaded}

A forma mais comum do pesquisador digitar seus dados é através de planilhas eletrônicas do Excel. Para carregar esses dados, basta ir em \emph{Import Dataset} na área de trabalho. O passo a passo está descrito abaixo: \indt{importar planílias}

\begin{figure}
\centering
\includegraphics{figures/Import.png}
\caption{Importando dados de planilhas eletrônicas do Excel - Passo 1}
\end{figure}

\begin{figure}
\centering
\includegraphics{figures/Import1.png}
\caption{Importando dados de planilhas eletrônicas do Excel - Passo 2}
\end{figure}

\begin{figure}
\centering
\includegraphics{figures/Import2.png}
\caption{Importando dados de planilhas eletrônicas do Excel - Passo 3}
\end{figure}

Também é possível carregar dados já extistentes dentro do \emph{software R}. Geralmente, os pacotes contém dados que são utilizados como exemplo de aplicação das suas funções.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(iris) }\CommentTok{\# head() limita os valores que serão impressos no console}
\CommentTok{\#   Sepal.Length Sepal.Width Petal.Length Petal.Width Species}
\CommentTok{\# 1          5.1         3.5          1.4         0.2  setosa}
\CommentTok{\# 2          4.9         3.0          1.4         0.2  setosa}
\CommentTok{\# 3          4.7         3.2          1.3         0.2  setosa}
\CommentTok{\# 4          4.6         3.1          1.5         0.2  setosa}
\CommentTok{\# 5          5.0         3.6          1.4         0.2  setosa}
\CommentTok{\# 6          5.4         3.9          1.7         0.4  setosa}
\end{Highlighting}
\end{Shaded}

\hypertarget{manipula}{%
\chapter{Manipulação de dados}\label{manipula}}

Após seus dados estarem carregados no ambiente R, eles provavelmente necessitarão de alguma manimulação antes de serem utilizados em uma determinada análise. Esta manipulação pode envolver operações como exclusão de colunas, ordenamento de linhas com base em valores, criação de covariáveis (que serão resultado de operações com uma ou mais variáveis existentes), dentre muitas outras possibilidades. Felizmente, o pacote \textbf{dplyr} \indt{dplyr} permite que esta manimulação seja relativamente fácil, lógica (do ponto de vista de digitação de códigos) e rápida, pois ele integra a linguagem \texttt{C++} em suas funções.

O pacote \textbf{dplyr} é uma \emph{gramática} de manipulação de dados. Nos rerferimos à \emph{gramática} aqui porque ele fornece funções nomeadas como \emph{verbos} simples, relacionados às tarefas mais comuns de manipulação de dados, para ajudá-lo a traduzir seus pensamentos em código. Este será o pacote utilizado para manipulação dos dados no decorrer deste material. De fato, a maioria dos dados em R podem ser manipulados utilizando os seguintes ``verbos''.

\begin{itemize}
\tightlist
\item
  \texttt{filter()} para selecionar linhas com base em seus valores.
\item
  \texttt{arrange()} para reordenar as linhas.
\item
  \texttt{select()} e \texttt{rename()} para selecionar variáveis com base em seus nomes.
\item
  \texttt{mutate()} e \texttt{transmute()} para adicionar novas variáveis que são funções de variáveis existentes.
\item
  \texttt{summarise()} para resumir vários valores para um único valor.
\item
  \texttt{sample\_n()} e \texttt{sample\_frac()} para obter amostras aleatórias.
\end{itemize}

Anteriomente mencionamos que a manipulação dos dados com o pacote \textbf{dplyr} é lógica do ponto de vista da implementação do código. Isto só é possivel devido a utilização do operador \texttt{\%\textgreater{}\%} (\emph{forward-pipe operator}), importado do pacote \texttt{magrittr}. Basicamente, este operador capta o argumento resultante de uma função à sua esquerda e passa como \emph{input} à função à sua direita. Não é nossso objetivo aqui discutir os benefícios da utilização deste operador, mas uma pequena demonstração (com spoilers das funções do pacote dplyr) será apresentada. Considere as seguintes (e simples) operações. Crie um data frame com 100 linhas com as variáveis \emph{x} e \emph{y} contendo valores aleatórios. Adicione uma terceira variáveis (\emph{z}) que será uma função da multiplicação de \emph{x} e \emph{y}, selecione apenas os valores de \emph{z} menores que 10 e extraia a raiz quadrada destes valores. Finalmente, compute a média e armazene no object \texttt{mean\_sqrt}.

\begin{itemize}
\tightlist
\item
  Criando o conjunto de dados
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(metan)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{data \textless{}{-}}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{runif}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{),}
               \DataTypeTok{y =} \KeywordTok{runif}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Utilizando as funções bases do R (código massivo)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data}\OperatorTok{$}\NormalTok{z \textless{}{-}}\StringTok{ }\NormalTok{data}\OperatorTok{$}\NormalTok{x }\OperatorTok{*}\StringTok{ }\NormalTok{data}\OperatorTok{$}\NormalTok{y}
\NormalTok{df \textless{}{-}}\StringTok{ }\KeywordTok{subset}\NormalTok{(data, z }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{10}\NormalTok{)}
\NormalTok{df \textless{}{-}}\StringTok{ }\NormalTok{df[, }\DecValTok{3}\NormalTok{]}
\NormalTok{sqr\_dat \textless{}{-}}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(df}\OperatorTok{$}\NormalTok{z)}
\NormalTok{mean\_sqrt \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(sqr\_dat)}
\NormalTok{mean\_sqrt}
\CommentTok{\# [1] 1.977507}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Utilizando as funções bases do R (código mais limpo)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data}\OperatorTok{$}\NormalTok{z \textless{}{-}}\StringTok{ }\NormalTok{data}\OperatorTok{$}\NormalTok{x }\OperatorTok{*}\StringTok{ }\NormalTok{data}\OperatorTok{$}\NormalTok{y}
\NormalTok{mean\_sqrt \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{subset}\NormalTok{(data, z }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{10}\NormalTok{)}\OperatorTok{$}\NormalTok{z))}
\NormalTok{mean\_sqrt}
\CommentTok{\# [1] 1.977507}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Utilizando o operdor \texttt{\%\textgreater{}\%}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mean\_sqrt \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{data }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{z =}\NormalTok{ x }\OperatorTok{*}\StringTok{ }\NormalTok{y) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(z }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{pull}\NormalTok{(z) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{sqrt}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mean}\NormalTok{()}
\NormalTok{mean\_sqrt}
\CommentTok{\# [1] 1.977507}
\end{Highlighting}
\end{Shaded}

A utilização do operador \texttt{\%\textgreater{}\%} parece não trazer tantos benefícios neste exemplo, visto que objetivo aqui foi demonstrar como ele permite uma implementação lógica das operações realizadas, captando a saída da função diretamente à esquerda (acima neste caso) e passando para a próxima função. Em operações mais complexas, no entanto, o \texttt{\%\textgreater{}\%} se mostrará muito mais útil.

O pacote \href{https://tiagoolivoto.github.io/metan/}{\texttt{metan}} fornece funções úteis para manipulação de dados. Duas principais categorias de funções serão utilizadas neste material:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{Utilitários para lidar com linhas e colunas}
\end{enumerate}

\begin{itemize}
\tightlist
\item
  \texttt{add\_cols()}: adiciona uma ou mais colunas a um conjunto de dados existente. Se as colunas \texttt{.before} ou \texttt{.after} especificadas não existirem, as colunas serão anexadas no final dos dados. Retorna um conjunto de dados com todas as colunas originais em \texttt{.data} mais as colunas declaradas em \texttt{...}. Em \texttt{add\_cols()}, as colunas em \texttt{.data} estão disponíveis para as expressões. Portanto, é possível adicionar uma coluna com base nos dados existentes.
  \indf{add\_cols}
\item
  \texttt{add\_rows()}: adiciona uma ou mais linhas a um conjunto de dados existente. Se não houver linhas especificadas \texttt{.before} ou \texttt{.after}, as linhas serão anexadas no final dos dados. Retorna um conjunto de dados com todas as linhas originais em .data mais as linhas declaradas em \texttt{...}.
  \indf{add\_rows}
\item
  \texttt{all\_pairs()}: obtém todos os pares possíveis entre os níveis de um fator.
  \indf{all\_pairs}
\item
  \texttt{colnames\_to\_lower()}: converte todos os nomes de coluna para minúsculas.
  \indf{colnames\_to\_lower}
\item
  \texttt{colnames\_to\_upper()}: converte todos os nomes de coluna para maiúsculas.
  \indf{colnames\_to\_upper}
\item
  \texttt{colnames\_to\_title()}: converte todos os nomes de coluna em maiúsculas.
  \indf{colnames\_to\_title}
\item
  \texttt{column\_exists()}: verifica se existe uma coluna em um conjunto de dados. Retorne um valor lógico.
  \indf{column\_exists}
\item
  \texttt{columns\_to\_first()}: move as colunas para as primeiras posições em \texttt{.data}.
  \indf{columns\_to\_first}
\item
  \texttt{columns\_to\_last()}: move as colunas para as últimas posições em \texttt{.data}.
  \indf{columns\_to\_last}
\item
  \texttt{concatenate()}: concatena colunas de um conjunto de dados. Se \texttt{drop\ =\ TRUE}, as variáveis existentes são descartadas. Se \texttt{pull\ =\ TRUE}, a variável concatenada é extraída para um vetor. Isso é especialmente útil ao usar concatenar para adicionar colunas a um conjunto de dados com \texttt{add\_cols()}.
  \indf{concatenate}
\item
  \texttt{get\_levels()}: obtém os níveis de um fator.
  \indf{get\_levels}
\item
  \texttt{get\_level\_size()}: obtém o tamanho de cada nível de um fator.
  \indf{get\_level\_size}
\item
  \texttt{remove\_cols()}: remove uma ou mais colunas de um conjunto de dados.
  \indf{remove\_cols}
\item
  \texttt{remove\_rows()}: remove uma ou mais linhas de um conjunto de dados.
  \indf{remove\_rows}
\item
  \texttt{reorder\_cols()}: reordena colunas em um conjunto de dados.
  \indf{reorder\_cols}
\item
  \texttt{select\_cols()}: seleciona uma ou mais colunas de um conjunto de dados.
  \indf{select\_cols}
\item
  \texttt{select\_first\_col()}: seleciona a primeira variável, possivelmente com um deslocamento.
  \indf{select\_first\_col}
\item
  \texttt{select\_last\_col()}: seleciona a última variável, possivelmente com um deslocamento.
  \indf{select\_last\_col}
\item
  \texttt{select\_numeric\_cols()}: selecione todas as colunas numéricas de um conjunto de dados.
  \indf{select\_numeric\_cols}
\item
  \texttt{select\_non\_numeric\_cols()}: seleciona todas as colunas não numéricas de um conjunto de dados.
  \indf{select\_non\_numeric\_cols}
\item
  \texttt{select\_rows()}: seleciona uma ou mais linhas de um conjunto de dados.
  \indf{select\_rows}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  \href{https://tiagoolivoto.github.io/metan/reference/utils_num_str.html}{Utilitários para lidar com números e strings}
\end{enumerate}

\begin{itemize}
\tightlist
\item
  \texttt{all\_lower\_case()}: converte todas as seqüências não numéricas de um conjunto de dados para minúsculas (``Env'' para ``env''). \indf{all\_lower\_case}
\item
  \texttt{all\_upper\_case()}: converte todas as seqüências não numéricas de um conjunto de dados para maiúsculas (por exemplo, ``Env'' para ``ENV'').\indf{all\_upper\_case}
\item
  \texttt{all\_title\_case()}: converta todas as seqüências não numéricas de um conjunto de dados em maiúsculas e minúsculas (por exemplo, ``ENV'' para ``Env'').\indf{all\_title\_case}
\item
  \texttt{extract\_number()}: extrai o(s) número(s) de uma sequência de caracteres.\indf{extract\_number}
\item
  \texttt{extract\_string()}: Extrai todas letras de uma sequência de caracteres, ignorando maiúsculas e minúsculas.\indf{extract\_string}
\item
  \texttt{find\_text\_in\_num()}: encontra caracteres de texto em uma sequência numérica e retorna o índice de linha.\indf{find\_text\_in\_num}
\item
  \texttt{has\_text\_in\_num()}: inspeciona as colunas procurando por texto na sequência numérica e retorna um aviso se algum texto for encontrado.\indf{has\_text\_in\_num}
\item
  \texttt{remove\_strings()}: remove todas as strings de uma variável.\indf{remove\_strings}
\item
  \texttt{replace\_number()}: substitui os números por uma substituição.\indf{replace\_number}
\item
  \texttt{replace\_string()}: substitui todas as strings por uma substituição, ignorando a caixa.\indf{replace\_string}
\item
  \texttt{round\_cols()}: Arredonda uma coluna selecionada ou um conjunto de dados inteiro para números significativos.\indf{round\_cols}
\item
  \texttt{tidy\_strings()}: arruma seqüências de caracteres, colunas não numéricas ou quaisquer colunas selecionadas em um conjunto de dados colocando todas as palavras em maiúsculas, substituindo qualquer espaço, tabulação e caracteres de pontuação por \texttt{\textquotesingle{}\_\textquotesingle{}} e colocando \texttt{\textquotesingle{}\_\textquotesingle{}} entre letras maiúsculas e minúsculas. Suponha que \texttt{str\ =\ c("Env1",\ "env\ 1",\ "env.1")} (que por definição deve representar um nível único nos ensaios de melhoramento de plantas, por exemplo, ambiente 1) seja submetido a \texttt{tidy\_strings(str)}: o resultado será então \texttt{c("ENV\_1",\ "ENV\_1",\ "ENV\_1")}.\indf{tidy\_strings}
\end{itemize}

O conjunto de dados \textbf{maize} será utilizado como exemplo para as operações de manipulação de dados. Este arquivo em formato \texttt{.xlsx} está hospedado em \url{https://github.com/TiagoOlivoto/e-bookr/tree/master/data} e pode ser carregado no ambiente R com a função \texttt{import()} do pacote \href{https://cran.r-project.org/web/packages/rio/index.html}{rio}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(rio)}
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{maize \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url,}
                \DataTypeTok{sheet =} \StringTok{"maize"}\NormalTok{, }
                \DataTypeTok{setclass =} \StringTok{"tibble"}\NormalTok{)}
\KeywordTok{inspect}\NormalTok{(maize)}
\CommentTok{\# \# A tibble: 10 x 9}
\CommentTok{\#    Variable Class     Missing Levels Valid\_n   Min Median    Max Outlier}
\CommentTok{\#    \textless{}chr\textgreater{}    \textless{}chr\textgreater{}     \textless{}chr\textgreater{}   \textless{}chr\textgreater{}    \textless{}int\textgreater{} \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}}
\CommentTok{\#  1 AMB      character No      0          780  NA    NA     NA         NA}
\CommentTok{\#  2 HIB      character No      0          780  NA    NA     NA         NA}
\CommentTok{\#  3 REP      character No      0          780  NA    NA     NA         NA}
\CommentTok{\#  4 APLA     numeric   No      {-}          780   1     2.52   3.3        4}
\CommentTok{\#  5 AIES     numeric   No      {-}          780   0.5   1.38   2.39       1}
\CommentTok{\#  6 CESP     numeric   No      {-}          780   0.8  15.4   20.4       16}
\CommentTok{\#  7 DIES     numeric   No      {-}          780  36.4  50.0   59.7        1}
\CommentTok{\#  8 MGRA     numeric   No      {-}          780  58.5 174.   291.         0}
\CommentTok{\#  9 MMG      numeric   No      {-}          780 123.  344.   546.         6}
\CommentTok{\# 10 NGRA     numeric   No      {-}          780 147   517    903          9}
\end{Highlighting}
\end{Shaded}

\hypertarget{trabalhando-com-linhas-e-colunas}{%
\section{Trabalhando com linhas e colunas}\label{trabalhando-com-linhas-e-colunas}}

\hypertarget{selecionar-colunas}{%
\subsection{Selecionar colunas}\label{selecionar-colunas}}

A função \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{select\_cols()}} pode ser usada para selecionar colunas de um conjunto de dados.\indf{select\_cols}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(maize, AMB, HIB)}
\CommentTok{\# \# A tibble: 780 x 2}
\CommentTok{\#    AMB   HIB  }
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{}}
\CommentTok{\#  1 A1    H1   }
\CommentTok{\#  2 A1    H1   }
\CommentTok{\#  3 A1    H1   }
\CommentTok{\#  4 A1    H1   }
\CommentTok{\#  5 A1    H1   }
\CommentTok{\#  6 A1    H1   }
\CommentTok{\#  7 A1    H1   }
\CommentTok{\#  8 A1    H1   }
\CommentTok{\#  9 A1    H1   }
\CommentTok{\# 10 A1    H1   }
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

As colunas numéricas podem ser selecionadas rapidamente usando a função \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{select\_numeric\_cols()}}. As colunas não numéricas são selecionadas com \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{select\_non\_numeric\_cols()}}.\indf{select\_numeric\_cols}\indf{select\_non\_numeric\_cols}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_numeric\_cols}\NormalTok{(maize)}
\CommentTok{\# \# A tibble: 780 x 7}
\CommentTok{\#     APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1  2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2  2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3  2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4  2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5  2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6  2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7  3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8  2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9  3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10  3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\KeywordTok{select\_non\_numeric\_cols}\NormalTok{(maize)}
\CommentTok{\# \# A tibble: 780 x 3}
\CommentTok{\#    AMB   HIB   REP  }
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{}}
\CommentTok{\#  1 A1    H1    I    }
\CommentTok{\#  2 A1    H1    I    }
\CommentTok{\#  3 A1    H1    I    }
\CommentTok{\#  4 A1    H1    I    }
\CommentTok{\#  5 A1    H1    I    }
\CommentTok{\#  6 A1    H1    II   }
\CommentTok{\#  7 A1    H1    II   }
\CommentTok{\#  8 A1    H1    II   }
\CommentTok{\#  9 A1    H1    II   }
\CommentTok{\# 10 A1    H1    II   }
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

Podemos selecionar a primeira ou a última coluna rapidamente com \texttt{select\_first\_col()} e \texttt{select\_last\_col()}, respectivamente.\indf{select\_first\_cols}\indf{select\_last\_cols}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_first\_col}\NormalTok{(maize)}
\CommentTok{\# \# A tibble: 780 x 1}
\CommentTok{\#    AMB  }
\CommentTok{\#    \textless{}chr\textgreater{}}
\CommentTok{\#  1 A1   }
\CommentTok{\#  2 A1   }
\CommentTok{\#  3 A1   }
\CommentTok{\#  4 A1   }
\CommentTok{\#  5 A1   }
\CommentTok{\#  6 A1   }
\CommentTok{\#  7 A1   }
\CommentTok{\#  8 A1   }
\CommentTok{\#  9 A1   }
\CommentTok{\# 10 A1   }
\CommentTok{\# \# ... with 770 more rows}
\KeywordTok{select\_last\_col}\NormalTok{(maize)}
\CommentTok{\# \# A tibble: 780 x 1}
\CommentTok{\#     NGRA}
\CommentTok{\#    \textless{}dbl\textgreater{}}
\CommentTok{\#  1   609}
\CommentTok{\#  2   427}
\CommentTok{\#  3   497}
\CommentTok{\#  4   523}
\CommentTok{\#  5   551}
\CommentTok{\#  6   529}
\CommentTok{\#  7   294}
\CommentTok{\#  8   528}
\CommentTok{\#  9   538}
\CommentTok{\# 10   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\emph{Select helpers} podem ser usados para selecionar variáveis que correspondem a uma expressão. Isso significa que podemos usar uma função para selecionar variáveis em vez de digitar seus próprios nomes. O \texttt{metan} reexporta os \href{https://tidyselect.r-lib.org/reference/select_helpers.html}{tidy select helpers} e implementa os próprios \emph{select helpers} com base em operações com prefixos e sufixos (\href{https://tiagoolivoto.github.io/metan/reference/Select_helper.html}{\texttt{different\_var()}}, \href{https://tiagoolivoto.github.io/metan/reference/Select_helper.html}{\texttt{intersect\_var()}} e \href{https://tiagoolivoto.github.io/metan/reference/Select_helper.html}{\texttt{union\_var()}}), tamanho dos nomes das variáveis (\href{https://tiagoolivoto.github.io/metan/\%20reference\%20/\%20Select_helper.html}{\texttt{width\_of()}}, \href{https://tiagoolivoto.github.io/metan/reference/Select_helper.html}{\texttt{width\_gength\_than()}} e \href{https:\%20//tiagoolivoto.github\%20.io\%20/\%20metan\%20/\%20reference\%20/\%20Select_helper.html}{\texttt{width\_less\_than()}}) e no tipo de letra (\href{https://tiagoolivoto.github.io/metan/reference/Select_helper.html}{\texttt{lower\_case\_only()}}, \href{https://tiagoolivoto.github.io/metan/reference/Select_helper.html}{\texttt{upper\_case\_only()}} e \href{https:\%20//tiagoolivoto.github\%20.io\%20/\%20metan\%20/\%20reference\%20/\%20Select_helper.html}{\texttt{title\_case\_only()}}).

\begin{itemize}
\tightlist
\item
  \textbf{Selecionando variáveis que começam com um prefixo.}
\end{itemize}

Se quisermos selecionar as variáveis que começam com ``C'', podemos usar:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(maize, }\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"C"}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 1}
\CommentTok{\#     CESP}
\CommentTok{\#    \textless{}dbl\textgreater{}}
\CommentTok{\#  1  16.9}
\CommentTok{\#  2  14.4}
\CommentTok{\#  3  16.5}
\CommentTok{\#  4  16.8}
\CommentTok{\#  5  15.9}
\CommentTok{\#  6  15  }
\CommentTok{\#  7  10.9}
\CommentTok{\#  8  15  }
\CommentTok{\#  9  13.6}
\CommentTok{\# 10  16.3}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

mas se quisermos selecionar aqueles que não começam com ``C'', basta adicionar ``-'' logo antes de \href{https://tidyselect.r-lib.org/reference/select_helpers.html}{\texttt{starts\_with()}}\indf{start\_with}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(maize, }\OperatorTok{{-}}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"C"}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 9}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I      2.45  2.39  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H1    I      2.5   1.43  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1    I      2.69  1.52  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1    I      2.8   1.64  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H1    I      2.62  1.55  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H1    II     2.12  1.8   51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1    II     3.15  1.78  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1    II     2.97  1.84  53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1    II     3.1   1.78  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1    II     3.02  1.6   53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Selecionando variáveis que terminam com um sufixo.}
\end{itemize}

Da mesma forma, se quisermos selecionar as variáveis que terminam com ``S'', podemos usar:\indf{ends\_with}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(maize, }\KeywordTok{ends\_with}\NormalTok{(}\StringTok{"S"}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 2}
\CommentTok{\#     AIES  DIES}
\CommentTok{\#    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1  2.39  52.1}
\CommentTok{\#  2  1.43  50.7}
\CommentTok{\#  3  1.52  54.7}
\CommentTok{\#  4  1.64  52.0}
\CommentTok{\#  5  1.55  51.6}
\CommentTok{\#  6  1.8   51.4}
\CommentTok{\#  7  1.78  41.9}
\CommentTok{\#  8  1.84  53.4}
\CommentTok{\#  9  1.78  50.8}
\CommentTok{\# 10  1.6   53.9}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Selecionando variáveis que começam com um prefixo \emph{A} E terminam com um sufixo ``S''}
\end{itemize}

Agora, se quisermos selecionar variáveis que começam com ``A'' e terminam com ``S'', ou seja, a interseção entre a letra inicial ``A'' e a letra final ``S'', podemos:\indf{intersect\_var}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(maize, }\KeywordTok{intersect\_var}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"S"}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 1}
\CommentTok{\#     AIES}
\CommentTok{\#    \textless{}dbl\textgreater{}}
\CommentTok{\#  1  2.39}
\CommentTok{\#  2  1.43}
\CommentTok{\#  3  1.52}
\CommentTok{\#  4  1.64}
\CommentTok{\#  5  1.55}
\CommentTok{\#  6  1.8 }
\CommentTok{\#  7  1.78}
\CommentTok{\#  8  1.84}
\CommentTok{\#  9  1.78}
\CommentTok{\# 10  1.6 }
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Selecionando variáveis que começam com um prefixo \emph{OU} terminam com um sufixo.}
\end{itemize}

Também podemos obter a união entre a letra inicial ``A'' e a letra final ``S'', ou seja, variáveis que começam com ``A'' ou terminam com ``S''.\indf{union\_var}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(maize, }\KeywordTok{union\_var}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"S"}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 4}
\CommentTok{\#    AMB    APLA  AIES  DIES}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1     2.45  2.39  52.1}
\CommentTok{\#  2 A1     2.5   1.43  50.7}
\CommentTok{\#  3 A1     2.69  1.52  54.7}
\CommentTok{\#  4 A1     2.8   1.64  52.0}
\CommentTok{\#  5 A1     2.62  1.55  51.6}
\CommentTok{\#  6 A1     2.12  1.8   51.4}
\CommentTok{\#  7 A1     3.15  1.78  41.9}
\CommentTok{\#  8 A1     2.97  1.84  53.4}
\CommentTok{\#  9 A1     3.1   1.78  50.8}
\CommentTok{\# 10 A1     3.02  1.6   53.9}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  ** Selecionando variáveis que começam com um prefixo \emph{E NÃO} terminam com um sufixo.**
\end{itemize}

Também podemos obter a diferença entre a letra inicial ``A'' e a letra final ``S'', ou seja, variáveis que começam com ``C'' e não terminam com ``D''.\indf{difference\_var}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(maize, }\KeywordTok{difference\_var}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"S"}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 2}
\CommentTok{\#    AMB    APLA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1     2.45}
\CommentTok{\#  2 A1     2.5 }
\CommentTok{\#  3 A1     2.69}
\CommentTok{\#  4 A1     2.8 }
\CommentTok{\#  5 A1     2.62}
\CommentTok{\#  6 A1     2.12}
\CommentTok{\#  7 A1     3.15}
\CommentTok{\#  8 A1     2.97}
\CommentTok{\#  9 A1     3.1 }
\CommentTok{\# 10 A1     3.02}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Selecionando variáveis que contêm uma string literal.}
\end{itemize}

Se as variáveis no conjunto de dados tiverem um padrão com diferenças entre um grupo de variáveis, podemos usar o código a seguir para selecionar variáveis com um padrão. Primeiro, iremos alterar os nomes das variáveis \texttt{PH}, \texttt{EH}, \texttt{EP} e \texttt{EL} incluindo \texttt{\_PLANT} para indicar que são variáveis relacionadas à planta. Em seguida, selecionaremos essas variáveis com a função \href{https://tidyselect.r-lib.org/reference/select_helpers.html}{\texttt{contains()}}.\indf{contains}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_vars \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{APLA\_PLANT =}\NormalTok{ APLA,}
         \DataTypeTok{AIES\_PLANT =}\NormalTok{ AIES)}
\KeywordTok{names}\NormalTok{(data\_vars)}
\CommentTok{\#  [1] "AMB"        "HIB"        "REP"        "APLA\_PLANT" "AIES\_PLANT"}
\CommentTok{\#  [6] "CESP"       "DIES"       "MGRA"       "MMG"        "NGRA"}

\KeywordTok{select\_cols}\NormalTok{(data\_vars, }\KeywordTok{contains}\NormalTok{(}\StringTok{"PLANT"}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 2}
\CommentTok{\#    APLA\_PLANT AIES\_PLANT}
\CommentTok{\#         \textless{}dbl\textgreater{}      \textless{}dbl\textgreater{}}
\CommentTok{\#  1       2.45       2.39}
\CommentTok{\#  2       2.5        1.43}
\CommentTok{\#  3       2.69       1.52}
\CommentTok{\#  4       2.8        1.64}
\CommentTok{\#  5       2.62       1.55}
\CommentTok{\#  6       2.12       1.8 }
\CommentTok{\#  7       3.15       1.78}
\CommentTok{\#  8       2.97       1.84}
\CommentTok{\#  9       3.1        1.78}
\CommentTok{\# 10       3.02       1.6 }
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Selecionando variáveis que correspondem a uma expressão regular.}
\end{itemize}

Seleções mais sofisticadas podem ser feitas usando \href{https://tidyselect.r-lib.org/reference/select_helpers.html}{\texttt{matches()}}. Supondo que gostaríamos de selecionar as variáveis que começam com ``A'' e tem a segunda letra entre ``A'' e ``M'', usaríamos algo como:\indf{matches}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(maize, }\KeywordTok{matches}\NormalTok{(}\StringTok{"\^{}A[A{-}M]"}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 2}
\CommentTok{\#    AMB    AIES}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1     2.39}
\CommentTok{\#  2 A1     1.43}
\CommentTok{\#  3 A1     1.52}
\CommentTok{\#  4 A1     1.64}
\CommentTok{\#  5 A1     1.55}
\CommentTok{\#  6 A1     1.8 }
\CommentTok{\#  7 A1     1.78}
\CommentTok{\#  8 A1     1.84}
\CommentTok{\#  9 A1     1.78}
\CommentTok{\# 10 A1     1.6 }
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Selecionando a última ou a primeira variável, possivelmente com um deslocamento.}
\end{itemize}

Podemos selecionar a \emph{n}-ésima primeira ou a última coluna com \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{select\_last\_col()}} ou \href{https\%20:\%20//tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{select\_first\_col()}}.\indf{select\_first\_col}\indf{select\_last\_col}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_first\_col}\NormalTok{(data\_vars)}
\CommentTok{\# \# A tibble: 780 x 1}
\CommentTok{\#    AMB  }
\CommentTok{\#    \textless{}chr\textgreater{}}
\CommentTok{\#  1 A1   }
\CommentTok{\#  2 A1   }
\CommentTok{\#  3 A1   }
\CommentTok{\#  4 A1   }
\CommentTok{\#  5 A1   }
\CommentTok{\#  6 A1   }
\CommentTok{\#  7 A1   }
\CommentTok{\#  8 A1   }
\CommentTok{\#  9 A1   }
\CommentTok{\# 10 A1   }
\CommentTok{\# \# ... with 770 more rows}
\KeywordTok{select\_last\_col}\NormalTok{(data\_vars)}
\CommentTok{\# \# A tibble: 780 x 1}
\CommentTok{\#     NGRA}
\CommentTok{\#    \textless{}dbl\textgreater{}}
\CommentTok{\#  1   609}
\CommentTok{\#  2   427}
\CommentTok{\#  3   497}
\CommentTok{\#  4   523}
\CommentTok{\#  5   551}
\CommentTok{\#  6   529}
\CommentTok{\#  7   294}
\CommentTok{\#  8   528}
\CommentTok{\#  9   538}
\CommentTok{\# 10   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Selecione variáveis com um comprimento de nome específico (quatro letras)}
\end{itemize}

\indf{width\_of}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(data\_vars, }\KeywordTok{width\_of}\NormalTok{(}\DecValTok{4}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 4}
\CommentTok{\#     CESP  DIES  MGRA  NGRA}
\CommentTok{\#    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1  16.9  52.1 228.    609}
\CommentTok{\#  2  14.4  50.7 187.    427}
\CommentTok{\#  3  16.5  54.7 230.    497}
\CommentTok{\#  4  16.8  52.0 213.    523}
\CommentTok{\#  5  15.9  51.6 224.    551}
\CommentTok{\#  6  15    51.4 203.    529}
\CommentTok{\#  7  10.9  41.9  75.2   294}
\CommentTok{\#  8  15    53.4 204.    528}
\CommentTok{\#  9  13.6  50.8 187.    538}
\CommentTok{\# 10  16.3  53.9 250.    582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  **Selecione variáveis com largura menor que *n**.
\end{itemize}

\indf{width\_less\_than}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(data\_vars, }\KeywordTok{width\_less\_than}\NormalTok{(}\DecValTok{4}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 4}
\CommentTok{\#    AMB   HIB   REP     MMG}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I      375.}
\CommentTok{\#  2 A1    H1    I      437.}
\CommentTok{\#  3 A1    H1    I      464.}
\CommentTok{\#  4 A1    H1    I      408.}
\CommentTok{\#  5 A1    H1    I      406.}
\CommentTok{\#  6 A1    H1    II     383.}
\CommentTok{\#  7 A1    H1    II     256.}
\CommentTok{\#  8 A1    H1    II     387.}
\CommentTok{\#  9 A1    H1    II     348.}
\CommentTok{\# 10 A1    H1    II     430.}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Selecione variáveis com largura maior que * n }*.
\end{itemize}

\indf{width\_greater\_than}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{select\_cols}\NormalTok{(data\_vars, }\KeywordTok{width\_greater\_than}\NormalTok{(}\DecValTok{3}\NormalTok{))}
\CommentTok{\# \# A tibble: 780 x 6}
\CommentTok{\#    APLA\_PLANT AIES\_PLANT  CESP  DIES  MGRA  NGRA}
\CommentTok{\#         \textless{}dbl\textgreater{}      \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1       2.45       2.39  16.9  52.1 228.    609}
\CommentTok{\#  2       2.5        1.43  14.4  50.7 187.    427}
\CommentTok{\#  3       2.69       1.52  16.5  54.7 230.    497}
\CommentTok{\#  4       2.8        1.64  16.8  52.0 213.    523}
\CommentTok{\#  5       2.62       1.55  15.9  51.6 224.    551}
\CommentTok{\#  6       2.12       1.8   15    51.4 203.    529}
\CommentTok{\#  7       3.15       1.78  10.9  41.9  75.2   294}
\CommentTok{\#  8       2.97       1.84  15    53.4 204.    528}
\CommentTok{\#  9       3.1        1.78  13.6  50.8 187.    538}
\CommentTok{\# 10       3.02       1.6   16.3  53.9 250.    582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Selecione variáveis por tipo de letra}
\end{itemize}

Vamos criar um conjunto de dados com nomes de colunas \emph{bagunçados}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df \textless{}{-}}\StringTok{ }\KeywordTok{head}\NormalTok{(maize, }\DecValTok{3}\NormalTok{)}
\KeywordTok{colnames}\NormalTok{(df) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{ (}\StringTok{"Amg"}\NormalTok{, }\StringTok{"hib"}\NormalTok{, }\StringTok{"Rep"}\NormalTok{, }\StringTok{"APLA"}\NormalTok{, }\StringTok{"AIES"}\NormalTok{, }\StringTok{"CESp"}\NormalTok{, }\StringTok{"dies"}\NormalTok{, }\StringTok{"Mgra"}\NormalTok{, }\StringTok{"mmG"}\NormalTok{, }\StringTok{"ngra"}\NormalTok{)}
\KeywordTok{select\_cols}\NormalTok{(df, }\KeywordTok{lower\_case\_only}\NormalTok{())}
\CommentTok{\# \# A tibble: 3 x 3}
\CommentTok{\#   hib    dies  ngra}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 H1     52.1   609}
\CommentTok{\# 2 H1     50.7   427}
\CommentTok{\# 3 H1     54.7   497}
\KeywordTok{select\_cols}\NormalTok{(df, }\KeywordTok{upper\_case\_only}\NormalTok{())}
\CommentTok{\# \# A tibble: 3 x 2}
\CommentTok{\#    APLA  AIES}
\CommentTok{\#   \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1  2.45  2.39}
\CommentTok{\# 2  2.5   1.43}
\CommentTok{\# 3  2.69  1.52}
\KeywordTok{select\_cols}\NormalTok{(df, }\KeywordTok{title\_case\_only}\NormalTok{())}
\CommentTok{\# \# A tibble: 3 x 3}
\CommentTok{\#   Amg   Rep    Mgra}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    I      228.}
\CommentTok{\# 2 A1    I      187.}
\CommentTok{\# 3 A1    I      230.}
\end{Highlighting}
\end{Shaded}

\indf{lower\_case\_only}
\indf{upper\_case\_only}
\indf{title\_case\_only}

\hypertarget{remover-linhas-ou-colunas}{%
\subsection{Remover linhas ou colunas}\label{remover-linhas-ou-colunas}}

Podemos usar \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{remove\_cols()}} e \href{https://tiagoolivoto.github.io/metan/\%20reference\%20/\%20utils_rows_cols.html}{\texttt{remove\_rows()}} para remover colunas e linhas, respectivamente.\indf{remove\_cols}\indf{remove\_rows}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{remove\_cols}\NormalTok{(maize, AMB, HIB)}
\CommentTok{\# \# A tibble: 780 x 8}
\CommentTok{\#    REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 I      2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 I      2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 I      2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

As funções \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{remove\_rows\_na()}} e \href{https://tiagoolivoto.github.io/metan/reference\%20/utils_rows_cols.html}{\texttt{remove\_rows\_na()}} são usados para remover linhas e colunas com valores \texttt{NA}, respectivamente. \indf{remove\_rows\_na}\indf{remove\_cols\_na}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_with\_na \textless{}{-}}\StringTok{ }\NormalTok{maize}
\NormalTok{data\_with\_na[}\KeywordTok{c}\NormalTok{ (}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{10}\NormalTok{), }\KeywordTok{c}\NormalTok{ (}\DecValTok{3}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\DecValTok{9}\OperatorTok{:}\DecValTok{10}\NormalTok{)] \textless{}{-}}\StringTok{ }\OtherTok{NA}
\KeywordTok{remove\_cols\_na}\NormalTok{(data\_with\_na)}
\CommentTok{\# Warning: Column(s) REP, APLA, AIES, MMG, NGRA with NA values deleted.}
\CommentTok{\# \# A tibble: 780 x 5}
\CommentTok{\#    AMB   HIB    CESP  DIES  MGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1     16.9  52.1 228. }
\CommentTok{\#  2 A1    H1     14.4  50.7 187. }
\CommentTok{\#  3 A1    H1     16.5  54.7 230. }
\CommentTok{\#  4 A1    H1     16.8  52.0 213. }
\CommentTok{\#  5 A1    H1     15.9  51.6 224. }
\CommentTok{\#  6 A1    H1     15    51.4 203. }
\CommentTok{\#  7 A1    H1     10.9  41.9  75.2}
\CommentTok{\#  8 A1    H1     15    53.4 204. }
\CommentTok{\#  9 A1    H1     13.6  50.8 187. }
\CommentTok{\# 10 A1    H1     16.3  53.9 250. }
\CommentTok{\# \# ... with 770 more rows}
\KeywordTok{remove\_rows\_na}\NormalTok{(data\_with\_na)}
\CommentTok{\# Warning: Row(s) 1, 5, 10 with NA values deleted.}
\CommentTok{\# \# A tibble: 777 x 10}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  2 A1    H1    I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  3 A1    H1    I      2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  4 A1    H1    II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  5 A1    H1    II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  6 A1    H1    II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  7 A1    H1    II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\#  8 A1    H1    III    2.69  1.52  15.6  49.5 195.   369.   529}
\CommentTok{\#  9 A1    H1    III    2.6   1.68  14.3  48.9 172.   344.   500}
\CommentTok{\# 10 A1    H1    III    2.82  1.52  18.4  54.3 255.   371.   689}
\CommentTok{\# \# ... with 767 more rows}
\end{Highlighting}
\end{Shaded}

\hypertarget{ordenar-linhas}{%
\subsection{Ordenar linhas}\label{ordenar-linhas}}

A função \texttt{arrange()} \indf{arrange} é utilizada para ordenar as linhas de um tibble (ou data.frames) com base em uma expressão envolvendo suas variáveis. Considerando as funções que vimos até aqui, vamos computar a média para a MGRA, criar uma nova variável chamada \textbf{Rank}, qual corresponde ao ranqueamento dos híbridos para a variável em questão e ordenar a variável Rank em ordem crescente, onde o híbrido com a maior média ficará na primeira linha.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(HIB) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{MGRA\_mean =} \KeywordTok{mean}\NormalTok{(MGRA)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Rank =} \KeywordTok{rank}\NormalTok{(MGRA\_mean)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{{-}}\NormalTok{Rank)}
\CommentTok{\# \# A tibble: 13 x 3}
\CommentTok{\#    HIB   MGRA\_mean  Rank}
\CommentTok{\#    \textless{}chr\textgreater{}     \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 H6         188.    13}
\CommentTok{\#  2 H2         187.    12}
\CommentTok{\#  3 H4         184.    11}
\CommentTok{\#  4 H1         184.    10}
\CommentTok{\#  5 H5         184.     9}
\CommentTok{\#  6 H13        180.     8}
\CommentTok{\#  7 H7         171.     7}
\CommentTok{\#  8 H3         169.     6}
\CommentTok{\#  9 H11        167.     5}
\CommentTok{\# 10 H10        164.     4}
\CommentTok{\# 11 H8         160.     3}
\CommentTok{\# 12 H12        157.     2}
\CommentTok{\# 13 H9         153.     1}
\end{Highlighting}
\end{Shaded}

\indt{Exercícios}

\begin{tarefa}
\textbf{Exercício 3}

\begin{itemize}
\tightlist
\item
  Considerando o exemplo anterior, ordene a variável \textbf{Rank} em ordem decrescente.
\end{itemize}
\end{tarefa}

\protect\hyperlink{exerc3}{Resposta}

Ao combinar a função \texttt{group\_by()}\indf{group\_by} com \texttt{arrange()}\indf{arrange} é possível realizar o ordenamento para cada nível de um determinado fator. No exemplo abaixo, a variável \texttt{APLA} é ordenada de maneira crescente para cada híbrido.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(HIB) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(APLA, }\DataTypeTok{.by\_group =} \OtherTok{TRUE}\NormalTok{)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\# \# Groups:   HIB [13]}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A3    H1    II     1.93  0.93  13    50.0 120.   276.   433}
\CommentTok{\#  2 A3    H1    I      2     1.05  19.9  53.3 253.   444.   570}
\CommentTok{\#  3 A3    H1    I      2.07  1.05  13.2  47.9 110.   293.   377}
\CommentTok{\#  4 A3    H1    II     2.08  0.94  12    47.6 103.   334.   309}
\CommentTok{\#  5 A3    H1    III    2.1   0.97  17.5  50.8 222.   423.   524}
\CommentTok{\#  6 A1    H1    II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A3    H1    I      2.12  1.03  18.5  52.0 214.   382.   560}
\CommentTok{\#  8 A3    H1    III    2.12  0.96  15    56.8 174.   339.   512}
\CommentTok{\#  9 A3    H1    I      2.13  1.05  11.6  47.0  89.5  300.   298}
\CommentTok{\# 10 A4    H1    I      2.13  1.1   12.8  47.6 144.   280.   516}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\hypertarget{selecionar-top-n-linhas-baseado-em-valor}{%
\subsection{Selecionar top n linhas baseado em valor}\label{selecionar-top-n-linhas-baseado-em-valor}}

A função \texttt{top\_n()}\indf{top\_n} é usada para selecionar linhas superiores ou inferiores em cada grupo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# seleciona as duas linhas com o maior valor de MGRA}
\KeywordTok{top\_n}\NormalTok{(maize, }\DecValTok{2}\NormalTok{, MGRA)}
\CommentTok{\# \# A tibble: 2 x 10}
\CommentTok{\#   AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H6    I      2.92  1.64  18    56.0  289.  393.   734}
\CommentTok{\# 2 A1    H13   II     2.47  1.28  15.3  53.0  291.  417.   698}

\CommentTok{\# seleciona as duas linhas com o menor valor de MGRA}
\KeywordTok{top\_n}\NormalTok{(maize, }\DecValTok{2}\NormalTok{, }\OperatorTok{{-}}\NormalTok{MGRA)}
\CommentTok{\# \# A tibble: 2 x 10}
\CommentTok{\#   AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H9    III    2.72  1.54  11    42.8  58.5  295.   198}
\CommentTok{\# 2 A2    H8    I      1.92  0.63  12.1  39.7  59.5  243.   245}

\CommentTok{\# Maior produtividade em cada ambiente}
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(AMB) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{top\_n}\NormalTok{(}\DecValTok{1}\NormalTok{, MGRA)}
\CommentTok{\# \# A tibble: 4 x 10}
\CommentTok{\# \# Groups:   AMB [4]}
\CommentTok{\#   AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H13   II     2.47  1.28  15.3  53.0  291.  417.   698}
\CommentTok{\# 2 A2    H6    III    3.18  1.62  19.2  53.0  270.  382.   708}
\CommentTok{\# 3 A3    H1    I      2     1.05  19.9  53.3  253.  444.   570}
\CommentTok{\# 4 A4    H10   I      2.65  1.47  14    50.3  287.  275.   493}
\end{Highlighting}
\end{Shaded}

\hypertarget{adicionar-novas-variuxe1veis}{%
\subsection{Adicionar novas variáveis}\label{adicionar-novas-variuxe1veis}}

A função \texttt{mutate()} \indf{mutate} é utilizada quando se deseja adicionar novas variáveis no conjunto de dados. Estas variáveis são funções de variáveis existentes. Como exemplo, vamos criar uma nova variável chamada \texttt{PRE\_2} no conjunto de dados \texttt{maize}, qual será a razão entre AIES e APLA. Note que a função adiciona a nova variável após a última variável origina e mantém todas as demais. Digamos que queríamos adicionar a nova variável criada após a variável REP, a seguinte abordagem com o pacote \texttt{dplyr} deve ser usada.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{PRE\_2 =}\NormalTok{ AIES}\OperatorTok{/}\NormalTok{APLA) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(AMB, HIB, REP, PRE\_}\DecValTok{2}\NormalTok{, }\KeywordTok{everything}\NormalTok{())}
\CommentTok{\# \# A tibble: 780 x 11}
\CommentTok{\#    AMB   HIB   REP   PRE\_2  APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I     0.976  2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H1    I     0.572  2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1    I     0.565  2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1    I     0.586  2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H1    I     0.592  2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H1    II    0.849  2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1    II    0.565  3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1    II    0.620  2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1    II    0.574  3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1    II    0.530  3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

Com a função \texttt{add\_cols()},\indf{add\_cols} o mesmo resultado pode ser obtido com:

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{add\_cols}\NormalTok{(maize,}
         \DataTypeTok{PRE\_2 =}\NormalTok{ AIES}\OperatorTok{/}\NormalTok{APLA,}
         \DataTypeTok{.after =} \StringTok{"REP"}\NormalTok{)}
\CommentTok{\# \# A tibble: 780 x 11}
\CommentTok{\#    AMB   HIB   REP   PRE\_2  APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I     0.976  2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H1    I     0.572  2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1    I     0.565  2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1    I     0.586  2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H1    I     0.592  2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H1    II    0.849  2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1    II    0.565  3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1    II    0.620  2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1    II    0.574  3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1    II    0.530  3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 2}

\begin{itemize}
\item
  Crie uma variável chamada MGRA\_kg qual será o resultado em quilogramas da massa de grãos.
\item
  Selecione somente as colunas HIB, AMB, REP e MGRA\_Kg.
\item
  Selecione somente as cinco linhas com maior valor de MGRA\_Kg.
\end{itemize}
\end{tarefa}

\protect\hyperlink{exerc2}{Resposta}

\hypertarget{concatenar-colunas}{%
\subsection{Concatenar colunas}\label{concatenar-colunas}}

A função \texttt{concatenate()}\indf{concatenate} pode ser usada para concatenar várias colunas de um conjunto de dados. \texttt{concatenate()} retorna um quadro de dados com todas as colunas originais em \texttt{.data} mais a variável concatenada, após a última coluna. Para escolher a posição da nova variável, use o argumento \texttt{.after} ou\texttt{.before}, como a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{concatenate}\NormalTok{(maize, AMB}\OperatorTok{:}\NormalTok{REP, }\DataTypeTok{.after =} \StringTok{"REP"}\NormalTok{)}
\CommentTok{\# \# A tibble: 780 x 11}
\CommentTok{\#    AMB   HIB   REP   new\_var   APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{}    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I     A1\_H1\_I   2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H1    I     A1\_H1\_I   2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1    I     A1\_H1\_I   2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1    I     A1\_H1\_I   2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H1    I     A1\_H1\_I   2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H1    II    A1\_H1\_II  2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1    II    A1\_H1\_II  3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1    II    A1\_H1\_II  2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1    II    A1\_H1\_II  3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1    II    A1\_H1\_II  3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\indf{concatenate}

Para eliminar as variáveis existentes e manter apenas a coluna concatenada, use o argumento \texttt{drop\ =\ TRUE}. Para usar \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{concatenate()}} dentro de uma determinada função como \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{add\_cols()}} use o argumento \texttt{pull\ =\ TRUE} para extrair os resultados para um vetor.\indf{concatenate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{concatenate}\NormalTok{(maize, AMB}\OperatorTok{:}\NormalTok{REP, }\DataTypeTok{drop =} \OtherTok{TRUE}\NormalTok{)}
\CommentTok{\# \# A tibble: 780 x 1}
\CommentTok{\#    new\_var }
\CommentTok{\#    \textless{}chr\textgreater{}   }
\CommentTok{\#  1 A1\_H1\_I }
\CommentTok{\#  2 A1\_H1\_I }
\CommentTok{\#  3 A1\_H1\_I }
\CommentTok{\#  4 A1\_H1\_I }
\CommentTok{\#  5 A1\_H1\_I }
\CommentTok{\#  6 A1\_H1\_II}
\CommentTok{\#  7 A1\_H1\_II}
\CommentTok{\#  8 A1\_H1\_II}
\CommentTok{\#  9 A1\_H1\_II}
\CommentTok{\# 10 A1\_H1\_II}
\CommentTok{\# \# ... with 770 more rows}
\KeywordTok{concatenate}\NormalTok{(maize, AMB}\OperatorTok{:}\NormalTok{REP, }\DataTypeTok{pull =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{head}\NormalTok{()}
\CommentTok{\# [1] "A1\_H1\_I"  "A1\_H1\_I"  "A1\_H1\_I"  "A1\_H1\_I"  "A1\_H1\_I"  "A1\_H1\_II"}
\end{Highlighting}
\end{Shaded}

\hypertarget{formatar-nomes-de-coluna}{%
\subsection{Formatar nomes de coluna}\label{formatar-nomes-de-coluna}}

As funções \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{colnames\_to\_lower()}}, \href{https://tiagoolivoto.github.io/metan/reference\%20/utils_rows_cols.html}{\texttt{colnames\_to\_upper()}} e \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{colnames\_to\_title()}} podem ser usados para converter nomes de colunas em maiúsculas, minúsculas ou em formato de título, respectivamente .\indf{colnames\_to\_lower} \indf{colnames\_to\_upper} \indf{colnames\_to\_title}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{colnames\_to\_lower}\NormalTok{(maize)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    amb   hib   rep    apla  aies  cesp  dies  mgra   mmg  ngra}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I      2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H1    I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1    I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1    I      2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H1    I      2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H1    II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1    II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1    II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1    II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1    II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\KeywordTok{colnames\_to\_upper}\NormalTok{(maize)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I      2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H1    I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1    I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1    I      2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H1    I      2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H1    II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1    II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1    II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1    II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1    II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\KeywordTok{colnames\_to\_title}\NormalTok{(maize)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    Amb   Hib   Rep    Apla  Aies  Cesp  Dies  Mgra   Mmg  Ngra}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I      2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H1    I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1    I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1    I      2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H1    I      2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H1    II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1    II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1    II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1    II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1    II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\hypertarget{reordenando-colunas}{%
\subsection{Reordenando colunas}\label{reordenando-colunas}}

A função \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{reorder\_cols()}} pode ser usada para reordenar as colunas de um quadro de dados.\indf{reorder\_cols}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{reorder\_cols}\NormalTok{(data\_vars, }\KeywordTok{contains}\NormalTok{(}\StringTok{"PLANT"}\NormalTok{), }\DataTypeTok{.before =} \StringTok{"AMB"}\NormalTok{)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    APLA\_PLANT AIES\_PLANT AMB   HIB   REP    CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#         \textless{}dbl\textgreater{}      \textless{}dbl\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1       2.45       2.39 A1    H1    I      16.9  52.1 228.   375.   609}
\CommentTok{\#  2       2.5        1.43 A1    H1    I      14.4  50.7 187.   437.   427}
\CommentTok{\#  3       2.69       1.52 A1    H1    I      16.5  54.7 230.   464.   497}
\CommentTok{\#  4       2.8        1.64 A1    H1    I      16.8  52.0 213.   408.   523}
\CommentTok{\#  5       2.62       1.55 A1    H1    I      15.9  51.6 224.   406.   551}
\CommentTok{\#  6       2.12       1.8  A1    H1    II     15    51.4 203.   383.   529}
\CommentTok{\#  7       3.15       1.78 A1    H1    II     10.9  41.9  75.2  256.   294}
\CommentTok{\#  8       2.97       1.84 A1    H1    II     15    53.4 204.   387.   528}
\CommentTok{\#  9       3.1        1.78 A1    H1    II     13.6  50.8 187.   348.   538}
\CommentTok{\# 10       3.02       1.6  A1    H1    II     16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\KeywordTok{reorder\_cols}\NormalTok{(data\_vars, AMB, HIB, }\DataTypeTok{.after =} \StringTok{"REP"}\NormalTok{)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    REP   AMB   HIB   APLA\_PLANT AIES\_PLANT  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{}      \textless{}dbl\textgreater{}      \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 I     A1    H1          2.45       2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 I     A1    H1          2.5        1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 I     A1    H1          2.69       1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 I     A1    H1          2.8        1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 I     A1    H1          2.62       1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 II    A1    H1          2.12       1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 II    A1    H1          3.15       1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 II    A1    H1          2.97       1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 II    A1    H1          3.1        1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 II    A1    H1          3.02       1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

É possível colocar as colunas no primeiro e no último lugar rapidamente com \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{columns\_to\_first()}} e \href{https:\%20//tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{columns\_to\_last()}}, respectivamente.\indf{columns\_to\_first}\indf{columns\_to\_last}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{column\_to\_first}\NormalTok{(maize, CESP, DIES)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#     CESP  DIES AMB   HIB   REP    APLA  AIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1  16.9  52.1 A1    H1    I      2.45  2.39 228.   375.   609}
\CommentTok{\#  2  14.4  50.7 A1    H1    I      2.5   1.43 187.   437.   427}
\CommentTok{\#  3  16.5  54.7 A1    H1    I      2.69  1.52 230.   464.   497}
\CommentTok{\#  4  16.8  52.0 A1    H1    I      2.8   1.64 213.   408.   523}
\CommentTok{\#  5  15.9  51.6 A1    H1    I      2.62  1.55 224.   406.   551}
\CommentTok{\#  6  15    51.4 A1    H1    II     2.12  1.8  203.   383.   529}
\CommentTok{\#  7  10.9  41.9 A1    H1    II     3.15  1.78  75.2  256.   294}
\CommentTok{\#  8  15    53.4 A1    H1    II     2.97  1.84 204.   387.   528}
\CommentTok{\#  9  13.6  50.8 A1    H1    II     3.1   1.78 187.   348.   538}
\CommentTok{\# 10  16.3  53.9 A1    H1    II     3.02  1.6  250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\hypertarget{obtendo-nuxedveis-de-fatores}{%
\subsection{Obtendo níveis de fatores}\label{obtendo-nuxedveis-de-fatores}}

Para obter os níveis e o tamanho dos níveis de um fator, as funções \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{get\_levels()}} e \href{https://tiagoolivoto.github.io/metan/reference/utils_rows_cols.html}{\texttt{get\_level\_size()}} pode ser usado.
\indf{get\_levels}\indf{get\_levels\_size}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(metan)}
\KeywordTok{get\_levels}\NormalTok{(maize, AMB)}
\CommentTok{\# [1] "A1" "A2" "A3" "A4"}
\KeywordTok{get\_level\_size}\NormalTok{(maize, AMB)}
\CommentTok{\# \# A tibble: 4 x 10}
\CommentTok{\#   AMB     HIB   REP  APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}int\textgreater{} \textless{}int\textgreater{} \textless{}int\textgreater{} \textless{}int\textgreater{} \textless{}int\textgreater{} \textless{}int\textgreater{} \textless{}int\textgreater{} \textless{}int\textgreater{} \textless{}int\textgreater{}}
\CommentTok{\# 1 A1      195   195   195   195   195   195   195   195   195}
\CommentTok{\# 2 A2      195   195   195   195   195   195   195   195   195}
\CommentTok{\# 3 A3      195   195   195   195   195   195   195   195   195}
\CommentTok{\# 4 A4      195   195   195   195   195   195   195   195   195}
\end{Highlighting}
\end{Shaded}

Utilizando a função \texttt{case\_when()} \indf{case\_when} é possível criar uma variável baseado em um argumento \texttt{if()}\indf{if} vetorizado. \texttt{case\_when()} é particularmente útil dentro da função \texttt{mutate()}\indf{mutate} quando você quer criar uma nova variável que depende de uma combinação complexa de variáveis existentes. No exemplo abaixo, uma nova variável será criada, dependendo dos valores de APLA, AIES ou CESP

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
    \DataTypeTok{CASE =} \KeywordTok{case\_when}\NormalTok{(}
\NormalTok{      MGRA }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{280} \OperatorTok{|}\StringTok{ }\NormalTok{APLA }\OperatorTok{\textless{}}\StringTok{ }\FloatTok{1.3} \OperatorTok{|}\StringTok{ }\NormalTok{NGRA }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{820} \OperatorTok{\textasciitilde{}}\StringTok{  "Selecionar"}\NormalTok{,}
\NormalTok{      APLA }\OperatorTok{\textgreater{}}\StringTok{ }\FloatTok{2.3} \OperatorTok{\textasciitilde{}}\StringTok{ "Alto"}\NormalTok{,}
\NormalTok{      MGRA }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{130} \OperatorTok{\textasciitilde{}}\StringTok{ "Pouco produtivo"}\NormalTok{,}
      \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ "Outro"}
\NormalTok{    )}
\NormalTok{  ) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{select\_non\_numeric\_cols}\NormalTok{()}
\CommentTok{\# \# A tibble: 780 x 4}
\CommentTok{\#    AMB   HIB   REP   CASE }
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{}}
\CommentTok{\#  1 A1    H1    I     Alto }
\CommentTok{\#  2 A1    H1    I     Alto }
\CommentTok{\#  3 A1    H1    I     Alto }
\CommentTok{\#  4 A1    H1    I     Alto }
\CommentTok{\#  5 A1    H1    I     Alto }
\CommentTok{\#  6 A1    H1    II    Outro}
\CommentTok{\#  7 A1    H1    II    Alto }
\CommentTok{\#  8 A1    H1    II    Alto }
\CommentTok{\#  9 A1    H1    II    Alto }
\CommentTok{\# 10 A1    H1    II    Alto }
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\hypertarget{selecionar-linhas-com-base-em-seus-valores}{%
\subsection{Selecionar linhas com base em seus valores}\label{selecionar-linhas-com-base-em-seus-valores}}

Utilizando a função \texttt{filter()} \indf{filter} é possivel filtrar as linhas de um conjunto de dados com base no valor de suas variáveis. No primeiro exemplo, selecionaremos as linhas onde o valor da variável MGRA é maior que 280.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(MGRA }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{280}\NormalTok{)}
\CommentTok{\# \# A tibble: 4 x 10}
\CommentTok{\#   AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H6    I      2.92  1.64  18    56.0  289.  393.   734}
\CommentTok{\# 2 A1    H10   I      2.92  1.61  20.3  55.4  283.  441.   641}
\CommentTok{\# 3 A1    H13   II     2.47  1.28  15.3  53.0  291.  417.   698}
\CommentTok{\# 4 A4    H10   I      2.65  1.47  14    50.3  287.  275.   493}
\end{Highlighting}
\end{Shaded}

No segundo exemplo, selecionaremos apenas as linhas onde a MGRA é maior que 220 \textbf{OU} a APLA é menor que 1.3 \textbf{OU} o NGRA é maior que 820.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(MGRA }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{280} \OperatorTok{|}\StringTok{ }\NormalTok{APLA }\OperatorTok{\textless{}}\StringTok{ }\FloatTok{1.3} \OperatorTok{|}\StringTok{ }\NormalTok{NGRA }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{820}\NormalTok{)}
\CommentTok{\# \# A tibble: 10 x 10}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H6    I      2.92  1.64  18    56.0 289.   393.   734}
\CommentTok{\#  2 A1    H10   I      2.92  1.61  20.3  55.4 283.   441.   641}
\CommentTok{\#  3 A1    H13   II     2.47  1.28  15.3  53.0 291.   417.   698}
\CommentTok{\#  4 A2    H8    II     1.03  0.69  10.8  44.8  94.8  277.   342}
\CommentTok{\#  5 A2    H10   III    1.09  0.92  15    47.6 166.   299.   555}
\CommentTok{\#  6 A3    H10   I      1.04  0.71  14.8  45.5 112.   265.   423}
\CommentTok{\#  7 A3    H11   I      1     0.65  14.5  43.6 120.   210.   571}
\CommentTok{\#  8 A4    H8    I      2.65  1.67  18    50   277.   251.   903}
\CommentTok{\#  9 A4    H8    I      2.95  1.7   18.6  52.9 249.   302.   824}
\CommentTok{\# 10 A4    H10   I      2.65  1.47  14    50.3 287.   275.   493}
\end{Highlighting}
\end{Shaded}

No último exemplo, selecionaremos apenas as linhas onde MGRA é maior que é maior que 220 \textbf{E} a APLA é menor que 2.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(MGRA }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{220} \OperatorTok{\&}\StringTok{ }\NormalTok{APLA }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{2}\NormalTok{)}
\CommentTok{\# \# A tibble: 1 x 10}
\CommentTok{\#   AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H6    II     1.97  1.63  17.1  54.7  230.  375.   614}
\end{Highlighting}
\end{Shaded}

Isto é aproximadamente equivalente ao seguinte código R base.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize[maize}\OperatorTok{$}\NormalTok{MGRA }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{220} \OperatorTok{\&}\StringTok{ }\NormalTok{maize}\OperatorTok{$}\NormalTok{APLA }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{2}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\hypertarget{trabalhando-com-nuxfameros-e-sequxfcuxeancias-de-caracteres}{%
\section{Trabalhando com números e seqüências de caracteres}\label{trabalhando-com-nuxfameros-e-sequxfcuxeancias-de-caracteres}}

\hypertarget{arredondando}{%
\subsection{Arredondando}\label{arredondando}}

A função \href{https://tiagoolivoto.github.io/metan/reference/utils_num_str.html}{\texttt{round\_cols()}} arredonda uma coluna selecionada ou um quadro de dados inteiro para o número especificado de casas decimais (padrão 0). Se nenhuma variável for informada, todas as variáveis numéricas serão arredondadas.\indf{round\_cols}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{round\_cols}\NormalTok{(maize)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I      2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H1    I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1    I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1    I      2.8   1.64  16.8  52.0 214.   408.   523}
\CommentTok{\#  5 A1    H1    I      2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H1    II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1    II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1    II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1    II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1    II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

Como alternativa, selecione variáveis para arredondar.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{round\_cols}\NormalTok{(maize, MGRA, MMG, }\DataTypeTok{digits =} \DecValTok{1}\NormalTok{)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    I      2.45  2.39  16.9  52.1 228.   375    609}
\CommentTok{\#  2 A1    H1    I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1    I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1    I      2.8   1.64  16.8  52.0 214.   408.   523}
\CommentTok{\#  5 A1    H1    I      2.62  1.55  15.9  51.6 224.   406    551}
\CommentTok{\#  6 A1    H1    II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1    II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1    II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1    II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1    II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\hypertarget{extraindo-e-substituindo-nuxfameros}{%
\subsection{Extraindo e substituindo números}\label{extraindo-e-substituindo-nuxfameros}}

As funções \href{https://tiagoolivoto.github.io/metan/reference/utils_num_str.html}{\texttt{extract\_number()}} e \href{https://tiagoolivoto.github.io/metan/\%20reference\%20/\%20utils_num_str.html}{\texttt{replace\_number()}} pode ser usado para extrair ou substituir números. Como exemplo, extrairemos o número de cada genótipo em \texttt{maize} criando uma nova coluna, \texttt{HIB\_NUM}, inserindo após a coluna \texttt{HIB}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{add\_cols}\NormalTok{(}\DataTypeTok{HIB\_NUM =} \KeywordTok{extract\_number}\NormalTok{(HIB), }\DataTypeTok{.after =}\NormalTok{ HIB)}
\CommentTok{\# \# A tibble: 780 x 11}
\CommentTok{\#    AMB   HIB   HIB\_NUM REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{}   \textless{}dbl\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1          1 I      2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H1          1 I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1          1 I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1          1 I      2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H1          1 I      2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H1          1 II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1          1 II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1          1 II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1          1 II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1          1 II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

Para substituir números de uma determinada coluna por uma substituição especificada, use \href{https://tiagoolivoto.github.io/metan/reference/utils_num_str.html}{\texttt{replace\_number()}}. Por padrão, os números são substituídos por "". O argumento \texttt{drop} e\texttt{pull} também podem ser usados, como mostrado acima.\indf{replace\_number}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{replace\_number}\NormalTok{(maize, HIB)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H     I      2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H     I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H     I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H     I      2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H     I      2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H     II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H     II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H     II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H     II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H     II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\KeywordTok{replace\_number}\NormalTok{(maize,}
\NormalTok{               REP,}
               \DataTypeTok{pattern =} \StringTok{"\^{}I$"}\NormalTok{,}
               \DataTypeTok{replacement =} \StringTok{"REP\_1"}\NormalTok{)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    REP\_1  2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H1    REP\_1  2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H1    REP\_1  2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H1    REP\_1  2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H1    REP\_1  2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H1    II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H1    II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H1    II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H1    II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H1    II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\hypertarget{extraindo-substituindo-e-removendo-strings}{%
\subsection{Extraindo, substituindo e removendo strings}\label{extraindo-substituindo-e-removendo-strings}}

As funções \href{https://tiagoolivoto.github.io/metan/reference/utils_num_str.html}{\texttt{extract\_string()}} e \href{https://tiagoolivoto.github.io/metan/\%20reference\%20/\%20utils_num_str.html}{\texttt{replace\_string()}} são usados no mesmo contexto de \href{https://tiagoolivoto.github.io/metan/reference/utils_num_str.html}{\texttt{extract\_number()}} e \href{https\%20:\%20//tiagoolivoto.github.io/metan/reference/utils_num_str.html}{\texttt{replace\_number()}}, mas para lidar com seqüências de caracteres.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{extract\_string}\NormalTok{(maize, HIB)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H     I      2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    H     I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    H     I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    H     I      2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    H     I      2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    H     II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    H     II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    H     II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    H     II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    H     II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\indf{extract\_string}

Para substituir strings, podemos usar a função \href{https://tiagoolivoto.github.io/metan/reference/utils_num_str.html}{\texttt{replace\_strings()}}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{replace\_string}\NormalTok{(maize,}
\NormalTok{               HIB,}
               \DataTypeTok{replacement =} \StringTok{"HIB\_"}\NormalTok{)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#    AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    HIB\_1 I      2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2 A1    HIB\_1 I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3 A1    HIB\_1 I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4 A1    HIB\_1 I      2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5 A1    HIB\_1 I      2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6 A1    HIB\_1 II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7 A1    HIB\_1 II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8 A1    HIB\_1 II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9 A1    HIB\_1 II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10 A1    HIB\_1 II     3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

Para remover todas as seqüências de caracteres de um quadro de dados, use \href{https://tiagoolivoto.github.io/metan/reference/utils_num_str.html}{\texttt{remove\_strings()}}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{remove\_strings}\NormalTok{(maize)}
\CommentTok{\# \# A tibble: 780 x 10}
\CommentTok{\#      AMB   HIB   REP  APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1     1     1    NA  2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2     1     1    NA  2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3     1     1    NA  2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4     1     1    NA  2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5     1     1    NA  2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6     1     1    NA  2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7     1     1    NA  3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8     1     1    NA  2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9     1     1    NA  3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10     1     1    NA  3.02  1.6   16.3  53.9 250.   430.   582}
\CommentTok{\# \# ... with 770 more rows}
\end{Highlighting}
\end{Shaded}

\indf{remove\_strings}

\hypertarget{formatando-strings}{%
\subsection{Formatando strings}\label{formatando-strings}}

A função \href{https://tiagoolivoto.github.io/metan/reference/utils_num_str.html}{\texttt{tidy\_strings()}} organiza cadeias de caracteres, colunas não numéricas ou quaisquer colunas selecionadas em um quadro de dados, colocando todas as palavras em maiúsculas, substituindo qualquer espaço, tabulação e caracteres de pontuação por \texttt{\_} e colocando \texttt{\_} entre letras maiúsculas e minúsculas. Considere as seguintes cadeias de caracteres: \texttt{messy\_env} por definição deve representar um nível único do ambiente de fator (ambiente 1). \texttt{messy\_gen} mostra seis genótipos, e\texttt{messy\_int} representa a interação desses genótipos com o ambiente 1.\indf{tidy\_strings}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{messy\_env \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"ENV 1"}\NormalTok{, }\StringTok{"Env 1"}\NormalTok{, }\StringTok{"Env1"}\NormalTok{, }\StringTok{"env1"}\NormalTok{, }\StringTok{"Env.1"}\NormalTok{, }\StringTok{"Env\_1"}\NormalTok{)}
\NormalTok{messy\_gen \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"GEN1"}\NormalTok{, }\StringTok{"gen 2"}\NormalTok{, }\StringTok{"Gen.3"}\NormalTok{, }\StringTok{"gen{-}4"}\NormalTok{, }\StringTok{"Gen\_5"}\NormalTok{, }\StringTok{"GEN\_6"}\NormalTok{)}
\NormalTok{messy\_int \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Env1Gen1"}\NormalTok{, }\StringTok{"Env1\_Gen2"}\NormalTok{, }\StringTok{"env1 gen3"}\NormalTok{, }\StringTok{"Env1 Gen4"}\NormalTok{, }\StringTok{"ENV\_1GEN5"}\NormalTok{, }\StringTok{"ENV1GEN6"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Esses vetores de caracteres são visualmente confusos. Vamos arrumá-los.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy\_strings}\NormalTok{(messy\_env)}
\CommentTok{\# [1] "ENV\_1" "ENV\_1" "ENV\_1" "ENV\_1" "ENV\_1" "ENV\_1"}
\KeywordTok{tidy\_strings}\NormalTok{(messy\_gen)}
\CommentTok{\# [1] "GEN\_1" "GEN\_2" "GEN\_3" "GEN\_4" "GEN\_5" "GEN\_6"}
\KeywordTok{tidy\_strings}\NormalTok{(messy\_int)}
\CommentTok{\# [1] "ENV\_1\_GEN\_1" "ENV\_1\_GEN\_2" "ENV\_1\_GEN\_3" "ENV\_1\_GEN\_4" "ENV\_1\_GEN\_5"}
\CommentTok{\# [6] "ENV\_1\_GEN\_6"}
\end{Highlighting}
\end{Shaded}

O \texttt{tidy\_strings()} também funciona para arrumar um quadro de dados inteiro ou colunas específicas. Vamos criar um quadro de dados `bagunçado' no contexto de testes de melhoramento de plantas.\indf{tidy\_strings}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tibble)}
\NormalTok{df \textless{}{-}}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{Env =}\NormalTok{ messy\_env,}
             \DataTypeTok{gen =}\NormalTok{ messy\_gen,}
             \DataTypeTok{Env\_GEN =} \KeywordTok{interaction}\NormalTok{(Env, gen),}
             \DataTypeTok{y =} \KeywordTok{rnorm}\NormalTok{ (}\DecValTok{6}\NormalTok{, }\DecValTok{300}\NormalTok{, }\DecValTok{10}\NormalTok{))}
\NormalTok{df}
\CommentTok{\# \# A tibble: 6 x 4}
\CommentTok{\#   Env   gen   Env\_GEN         y}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}fct\textgreater{}       \textless{}dbl\textgreater{}}
\CommentTok{\# 1 ENV 1 GEN1  ENV 1.GEN1   294.}
\CommentTok{\# 2 Env 1 gen 2 Env 1.gen 2  300.}
\CommentTok{\# 3 Env1  Gen.3 Env1.Gen.3   291.}
\CommentTok{\# 4 env1  gen{-}4 env1.gen{-}4   302.}
\CommentTok{\# 5 Env.1 Gen\_5 Env.1.Gen\_5  293.}
\CommentTok{\# 6 Env\_1 GEN\_6 Env\_1.GEN\_6  318.}
\KeywordTok{tidy\_strings}\NormalTok{(df)}
\CommentTok{\# \# A tibble: 6 x 4}
\CommentTok{\#   Env   gen   Env\_GEN         y}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{}       \textless{}dbl\textgreater{}}
\CommentTok{\# 1 ENV\_1 GEN\_1 ENV\_1\_GEN\_1  294.}
\CommentTok{\# 2 ENV\_1 GEN\_2 ENV\_1\_GEN\_2  300.}
\CommentTok{\# 3 ENV\_1 GEN\_3 ENV\_1\_GEN\_3  291.}
\CommentTok{\# 4 ENV\_1 GEN\_4 ENV\_1\_GEN\_4  302.}
\CommentTok{\# 5 ENV\_1 GEN\_5 ENV\_1\_GEN\_5  293.}
\CommentTok{\# 6 ENV\_1 GEN\_6 ENV\_1\_GEN\_6  318.}
\KeywordTok{tidy\_strings}\NormalTok{(df, gen)}
\CommentTok{\# \# A tibble: 6 x 4}
\CommentTok{\#   Env   gen   Env\_GEN         y}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}fct\textgreater{}       \textless{}dbl\textgreater{}}
\CommentTok{\# 1 ENV 1 GEN\_1 ENV 1.GEN1   294.}
\CommentTok{\# 2 Env 1 GEN\_2 Env 1.gen 2  300.}
\CommentTok{\# 3 Env1  GEN\_3 Env1.Gen.3   291.}
\CommentTok{\# 4 env1  GEN\_4 env1.gen{-}4   302.}
\CommentTok{\# 5 Env.1 GEN\_5 Env.1.Gen\_5  293.}
\CommentTok{\# 6 Env\_1 GEN\_6 Env\_1.GEN\_6  318.}
\end{Highlighting}
\end{Shaded}

\hypertarget{selecionar-linhas-por-sua-posiuxe7uxe3o}{%
\section{Selecionar linhas por sua posição}\label{selecionar-linhas-por-sua-posiuxe7uxe3o}}

A função \texttt{slice()}\indf{slice} é usada para selecionar linhas por sua posição ordinal no tibble. Os tibbles agrupados usam a posição ordinal dentro do grupo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# seleciona as três primeiras linhas}
\KeywordTok{slice}\NormalTok{(maize, }\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{)}
\CommentTok{\# \# A tibble: 3 x 10}
\CommentTok{\#   AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H1    I      2.45  2.39  16.9  52.1  228.  375.   609}
\CommentTok{\# 2 A1    H1    I      2.5   1.43  14.4  50.7  187.  437.   427}
\CommentTok{\# 3 A1    H1    I      2.69  1.52  16.5  54.7  230.  464.   497}
\CommentTok{\# Seleciona as 3 últimas linhas}
\KeywordTok{slice}\NormalTok{(maize, }\DecValTok{778}\OperatorTok{:}\KeywordTok{n}\NormalTok{())}
\CommentTok{\# \# A tibble: 3 x 10}
\CommentTok{\#   AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A4    H13   III    2.2   0.9   12.1  40.9  92.8  322.   288}
\CommentTok{\# 2 A4    H13   III    2.15  1.07  10.6  46.0  91.4  300.   305}
\CommentTok{\# 3 A4    H13   III    2.19  1.12  14.5  51.9 144.   352.   408}
\CommentTok{\# seleciona as duas primeiras linhas de cada ambiente}
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(AMB) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{slice}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{)}
\CommentTok{\# \# A tibble: 8 x 10}
\CommentTok{\# \# Groups:   AMB [4]}
\CommentTok{\#   AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H1    I      2.45  2.39  16.9  52.1  228.  375.   609}
\CommentTok{\# 2 A1    H1    I      2.5   1.43  14.4  50.7  187.  437.   427}
\CommentTok{\# 3 A2    H1    I      3.06  1.89  18.2  54.4  244.  421.   581}
\CommentTok{\# 4 A2    H1    I      3.04  1.89  15.4  53.4  193.  369.   523}
\CommentTok{\# 5 A3    H1    I      2.12  1.03  18.5  52.0  214.  382.   560}
\CommentTok{\# 6 A3    H1    I      2     1.05  19.9  53.3  253.  444.   570}
\CommentTok{\# 7 A4    H1    I      2.13  1.1   12.8  47.6  144.  280.   516}
\CommentTok{\# 8 A4    H1    I      2.3   1.25  13.1  50.0  140.  230.   609}
\end{Highlighting}
\end{Shaded}

\hypertarget{combinando-os-verbos-para-manipulauxe7uxe3o}{%
\section{Combinando os verbos para manipulação}\label{combinando-os-verbos-para-manipulauxe7uxe3o}}

Esta sessão tem o objetivo de demonstrar como os \emph{verbos} \textbf{dplyr} em conjunto com as funções \texttt{pivot\_longer()} do pacote \href{https://tidyr.tidyverse.org/}{tidyr}\footnote{\url{https://tidyr.tidyverse.org/}} e \texttt{column\_to\_rownames()} \indf{column\_to\_rownames} do pacote \href{https://www.tidyverse.org/packages/}{tibble}\footnote{\url{https://www.tidyverse.org/packages/}} podem ser combinados para construir uma matriz dupla entrada onde as linhas correspondem aos genótipos e as colunas correspondem aos ambientes. Esta matriz será preenchida com o valor médio da MGRA considerando apenas as duas primeiras repetições de cada híbrido em cada ambiente.
\indf{filter}
\indf{group\_by}
\indf{summarise}
\indf{pivot\_wider}
\indf{make\_mat}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(REP }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"I"}\NormalTok{, }\StringTok{"II"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(AMB, HIB) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{MGRA\_me =} \KeywordTok{mean}\NormalTok{(MGRA)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{pivot\_wider}\NormalTok{(}\DataTypeTok{names\_from =}\NormalTok{ HIB, }\DataTypeTok{values\_from =}\NormalTok{ MGRA\_me) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{round\_cols}\NormalTok{(}\DataTypeTok{digits =} \DecValTok{1}\NormalTok{)}
\CommentTok{\# \# A tibble: 4 x 14}
\CommentTok{\# \# Groups:   AMB [4]}
\CommentTok{\#   AMB      H1   H10   H11   H12   H13    H2    H3    H4    H5    H6    H7    H8}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1     200.  185.  199.  174.  222.  205.  201.  204.  190.  238.  185.  198.}
\CommentTok{\# 2 A2     194.  151.  169.  136.  158.  219.  201.  193.  180.  204.  148.  116 }
\CommentTok{\# 3 A3     147.  117   127.  153.  186.  161.  146.  150   147.  127.  146.  149.}
\CommentTok{\# 4 A4     195.  180.  170.  191.  167   156.  148.  182.  209.  164.  195.  182.}
\CommentTok{\# \# ... with 1 more variable: H9 \textless{}dbl\textgreater{}}
\end{Highlighting}
\end{Shaded}

Note que a mesma tabela dupla entrada pode ser obtida com a função \texttt{make\_mat()} do pacote \texttt{metan}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(REP }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"I"}\NormalTok{, }\StringTok{"II"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{make\_mat}\NormalTok{(AMB, HIB, MGRA) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{round\_cols}\NormalTok{(}\DataTypeTok{digits =} \DecValTok{1}\NormalTok{)}
\CommentTok{\#       H1   H10   H11   H12   H13    H2    H3    H4    H5    H6    H7    H8}
\CommentTok{\# A1 200.2 185.1 199.3 174.5 221.9 204.9 201.3 204.4 189.5 238.2 184.8 198.2}
\CommentTok{\# A2 193.8 151.3 168.7 136.2 158.3 218.8 200.6 193.3 180.1 204.5 148.2 116.0}
\CommentTok{\# A3 147.2 117.0 127.1 153.1 186.5 160.6 146.4 150.0 147.1 127.4 146.4 148.7}
\CommentTok{\# A4 195.2 179.5 169.5 190.9 167.0 155.5 147.7 182.1 208.7 164.3 195.4 181.9}
\CommentTok{\#       H9}
\CommentTok{\# A1 203.4}
\CommentTok{\# A2 107.2}
\CommentTok{\# A3 117.3}
\CommentTok{\# A4 154.8}
\end{Highlighting}
\end{Shaded}

\hypertarget{trabalhando-com-duas-tabelas-ao-mesmo-tempo}{%
\section{Trabalhando com duas tabelas ao mesmo tempo}\label{trabalhando-com-duas-tabelas-ao-mesmo-tempo}}

\hypertarget{junuxe7uxf5es-com-mutauxe7uxe3o-de-dados}{%
\subsection{Junções com mutação de dados}\label{junuxe7uxf5es-com-mutauxe7uxe3o-de-dados}}

É raro que uma análise de dados envolva apenas uma única tabela de dados. Na prática, diversas tabela podem existir e ferramentas flexíveis para combiná-las são necessárias. No \textbf{dplyr}, existem três famílias de \textbf{verbos} que permitem trabalhar com duas tabelas ao mesmo tempo, permitindo: (i) juntar tabelas, (ii) Filtrar registros e (iii) realizar operações.

Os seguintes códigos criam três novos conjuntos de dados. \textbf{maize2} contém dados de duas repetições para os híbridos H1:H5 nos ambientes H1 e H2. \textbf{mean\_h} e \textbf{mean\_a} contém as médias para os híbridos e ambientes, respectivamente. \indf{ungroup}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize\_small \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(HIB }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"H1"}\NormalTok{, }\StringTok{"H2"}\NormalTok{, }\StringTok{"H3"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(AMB }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"A1"}\NormalTok{, }\StringTok{"A2"}\NormalTok{))}

\NormalTok{maize2 \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize\_small }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{means\_by}\NormalTok{(AMB, HIB) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(AMB}\OperatorTok{:}\NormalTok{APLA) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{round\_cols}\NormalTok{(}\DataTypeTok{digits =} \DecValTok{1}\NormalTok{)}
\NormalTok{maize2}
\CommentTok{\# \# A tibble: 6 x 3}
\CommentTok{\#   AMB   HIB    APLA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H1      2.7}
\CommentTok{\# 2 A1    H2      2.8}
\CommentTok{\# 3 A1    H3      2.9}
\CommentTok{\# 4 A2    H1      2.9}
\CommentTok{\# 5 A2    H2      2.9}
\CommentTok{\# 6 A2    H3      2.9}

\NormalTok{mean\_h \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize\_small }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{means\_by}\NormalTok{(HIB) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(HIB, }\KeywordTok{contains}\NormalTok{(}\StringTok{"A"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{round\_cols}\NormalTok{(}\DataTypeTok{digits =} \DecValTok{1}\NormalTok{)}
  
\NormalTok{mean\_a \textless{}{-}}
\StringTok{  }\NormalTok{maize\_small }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{means\_by}\NormalTok{(AMB) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(AMB, }\KeywordTok{contains}\NormalTok{(}\StringTok{"ES"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{round\_cols}\NormalTok{(}\DataTypeTok{digits =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Juntando a coluna \textbf{MGRA} e \textbf{NGRA} da tabela \textbf{mean\_h} na tabela \textbf{maize2} considerando as variáveis com mesmo nome nas duas tabelas (neste caso, HIB)
\end{itemize}

\indf{left\_join}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{left\_join}\NormalTok{(maize2, mean\_h }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(HIB, MGRA, NGRA), }\DataTypeTok{by =} \StringTok{"HIB"}\NormalTok{)}
\CommentTok{\# \# A tibble: 6 x 5}
\CommentTok{\#   AMB   HIB    APLA  MGRA  NGRA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H1      2.7  195.  506.}
\CommentTok{\# 2 A1    H2      2.8  211.  577.}
\CommentTok{\# 3 A1    H3      2.9  195.  542.}
\CommentTok{\# 4 A2    H1      2.9  195.  506.}
\CommentTok{\# 5 A2    H2      2.9  211.  577.}
\CommentTok{\# 6 A2    H3      2.9  195.  542.}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Juntando as colunas da tabela \textbf{mean\_a} na tabela \textbf{maize2}
\end{itemize}

\indf{full\_join}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{full\_join}\NormalTok{(maize2, mean\_a, }\DataTypeTok{by =} \StringTok{"AMB"}\NormalTok{)}
\CommentTok{\# \# A tibble: 6 x 6}
\CommentTok{\#   AMB   HIB    APLA  AIES  CESP  DIES}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H1      2.7   1.5  15.3  51.6}
\CommentTok{\# 2 A1    H2      2.8   1.5  15.3  51.6}
\CommentTok{\# 3 A1    H3      2.9   1.5  15.3  51.6}
\CommentTok{\# 4 A2    H1      2.9   1.8  15.4  51.8}
\CommentTok{\# 5 A2    H2      2.9   1.8  15.4  51.8}
\CommentTok{\# 6 A2    H3      2.9   1.8  15.4  51.8}
\end{Highlighting}
\end{Shaded}

\hypertarget{junuxe7uxf5es-com-filtragem-de-dados}{%
\subsection{Junções com filtragem de dados}\label{junuxe7uxf5es-com-filtragem-de-dados}}

\begin{itemize}
\tightlist
\item
  Filtrando as linhas da tabela \textbf{maize2} com base nas variáveis que combinam na tabela \textbf{mean\_h} (neste caso, a coluna HIB) \indf{semi\_join}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{semi\_join}\NormalTok{(maize2, mean\_h, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"HIB"}\NormalTok{, }\StringTok{"APLA"}\NormalTok{))}
\CommentTok{\# \# A tibble: 3 x 3}
\CommentTok{\#   AMB   HIB    APLA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H3      2.9}
\CommentTok{\# 2 A2    H2      2.9}
\CommentTok{\# 3 A2    H3      2.9}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Filtrando as linhas da tabela \textbf{maize2} com base nas variáveis que \textbf{NÃO} combinam na tabela \textbf{mean\_h} (neste caso, a coluna HIB) \indf{anti\_join}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{anti\_join}\NormalTok{(maize2, mean\_h, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"HIB"}\NormalTok{, }\StringTok{"APLA"}\NormalTok{))}
\CommentTok{\# \# A tibble: 3 x 3}
\CommentTok{\#   AMB   HIB    APLA}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    H1      2.7}
\CommentTok{\# 2 A1    H2      2.8}
\CommentTok{\# 3 A2    H1      2.9}
\end{Highlighting}
\end{Shaded}

\hypertarget{operauxe7uxf5es-com-conjuntos}{%
\subsection{Operações com conjuntos}\label{operauxe7uxf5es-com-conjuntos}}

Nesta seção será demonstrado como é possivel utilizar operações de cojuntos como interseção e união. É esperado que as entradas x e y tenham as mesmas variáveis. Para isto, vamos criar dois novos conjuntos de dados chamados \textbf{data\_1\_to\_5} e \textbf{data\_3\_to\_10}, quais contém, respectivamente as cinco primeiras linhas
e as linhas 3 a 10 de \textbf{maize}. Note que a função \texttt{slice()} \indf{slice} é utilizada para selecionar as linhas com base em sua posição.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_}\DecValTok{1}\NormalTok{\_to\_}\DecValTok{5}\NormalTok{ \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{slice}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{add\_cols}\NormalTok{(}\DataTypeTok{id =} \DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\DataTypeTok{.before =} \DecValTok{1}\NormalTok{)}
\NormalTok{data\_}\DecValTok{3}\NormalTok{\_to\_}\DecValTok{10}\NormalTok{ \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{slice}\NormalTok{(}\DecValTok{3}\OperatorTok{:}\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{add\_cols}\NormalTok{(}\DataTypeTok{id =} \DecValTok{3}\OperatorTok{:}\DecValTok{10}\NormalTok{, }\DataTypeTok{.before =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{interseuxe7uxe3o-de-conjuntos}{%
\subsubsection{Interseção de conjuntos}\label{interseuxe7uxe3o-de-conjuntos}}

A função \texttt{intersect()}\indf{intersect} (interseção de conjunto) retorna somente as linhas presentes nos dois conjuntos, neste caso, as linhas 3, 4 and 5 do conjunto \textbf{maize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{intersect}\NormalTok{(data\_}\DecValTok{1}\NormalTok{\_to\_}\DecValTok{5}\NormalTok{, data\_}\DecValTok{3}\NormalTok{\_to\_}\DecValTok{10}\NormalTok{)}
\CommentTok{\# \# A tibble: 3 x 11}
\CommentTok{\#      id AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}int\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1     3 A1    H1    I      2.69  1.52  16.5  54.7  230.  464.   497}
\CommentTok{\# 2     4 A1    H1    I      2.8   1.64  16.8  52.0  213.  408.   523}
\CommentTok{\# 3     5 A1    H1    I      2.62  1.55  15.9  51.6  224.  406.   551}
\end{Highlighting}
\end{Shaded}

\hypertarget{uniuxe3o-de-conjuntos}{%
\subsubsection{União de conjuntos}\label{uniuxe3o-de-conjuntos}}

A função \texttt{union()}\indf{union} (união de conjunto) junta os dois conjuntos sem que haja duplicação de registros.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{union}\NormalTok{(data\_}\DecValTok{1}\NormalTok{\_to\_}\DecValTok{5}\NormalTok{, data\_}\DecValTok{3}\NormalTok{\_to\_}\DecValTok{10}\NormalTok{)}
\CommentTok{\# \# A tibble: 10 x 11}
\CommentTok{\#       id AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}int\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1     1 A1    H1    I      2.45  2.39  16.9  52.1 228.   375.   609}
\CommentTok{\#  2     2 A1    H1    I      2.5   1.43  14.4  50.7 187.   437.   427}
\CommentTok{\#  3     3 A1    H1    I      2.69  1.52  16.5  54.7 230.   464.   497}
\CommentTok{\#  4     4 A1    H1    I      2.8   1.64  16.8  52.0 213.   408.   523}
\CommentTok{\#  5     5 A1    H1    I      2.62  1.55  15.9  51.6 224.   406.   551}
\CommentTok{\#  6     6 A1    H1    II     2.12  1.8   15    51.4 203.   383.   529}
\CommentTok{\#  7     7 A1    H1    II     3.15  1.78  10.9  41.9  75.2  256.   294}
\CommentTok{\#  8     8 A1    H1    II     2.97  1.84  15    53.4 204.   387.   528}
\CommentTok{\#  9     9 A1    H1    II     3.1   1.78  13.6  50.8 187.   348.   538}
\CommentTok{\# 10    10 A1    H1    II     3.02  1.6   16.3  53.9 250.   430.   582}
\end{Highlighting}
\end{Shaded}

\hypertarget{diferenuxe7a-de-conjuntos}{%
\subsubsection{Diferença de conjuntos}\label{diferenuxe7a-de-conjuntos}}

A função \texttt{setdiff()} \indf{setdiff} (diferença de conjunto, ou complementar) cria uma tabela somente com os registros em \textbf{data\_1\_to\_5} que não estão em \textbf{data\_3\_to\_10}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{setdiff}\NormalTok{(data\_}\DecValTok{1}\NormalTok{\_to\_}\DecValTok{5}\NormalTok{, data\_}\DecValTok{3}\NormalTok{\_to\_}\DecValTok{10}\NormalTok{)}
\CommentTok{\# \# A tibble: 2 x 11}
\CommentTok{\#      id AMB   HIB   REP    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}int\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1     1 A1    H1    I      2.45  2.39  16.9  52.1  228.  375.   609}
\CommentTok{\# 2     2 A1    H1    I      2.5   1.43  14.4  50.7  187.  437.   427}
\end{Highlighting}
\end{Shaded}

\hypertarget{graph}{%
\chapter{Gráficos com o pacote ggplot2}\label{graph}}

\begin{quote}
``O gráfico simples trouxe mais informações à mente do analista de dados
do que qualquer outro dispositivo.'' --- John Tukey
\end{quote}

\hypertarget{o-pacote-ggplot2}{%
\section{\texorpdfstring{O pacote \texttt{ggplot2}}{O pacote ggplot2}}\label{o-pacote-ggplot2}}

O \texttt{ggplot2} (\url{https://ggplot2.tidyverse.org/)/indt\%7Bggplot2\%7D} é um pacote R para produção de gráficos que diferentemente da maioria dos outros pacotes, apresenta uma profunda gramática baseada no livro \emph{The grammar of graphics} (Wilkinson \protect\hyperlink{ref-Wilkinson2005}{2005}). Os gráficos originados em \texttt{ggplot2} são baseados em camadas, e cada gráfico tem três componentes chave: \texttt{data}, os dados de onde o gráfico será criado; \texttt{aes()} (\emph{aesthetic mappings})\indf{aes}, que controla o mapeamento estético e as propriedades visuais do gráfico; e ao menos uma camada que irá descrever como cada observação será renderizada. Camadas são usualmente criadas utilizando uma função \texttt{geom\_()}.\indt{geom\_} A referência principal ao pacote é o livro \emph{Ggplot2 : elegant graphics for data analysis} (Wickham \protect\hyperlink{ref-Wickham2009}{2009}).

\hypertarget{meu-primeiro-gruxe1fico-em-ggplot2}{%
\section{\texorpdfstring{Meu primeiro gráfico em \texttt{ggplot2}}{Meu primeiro gráfico em ggplot2}}\label{meu-primeiro-gruxe1fico-em-ggplot2}}

A seguir, vamos discutir os aspcetos básicos para a construção de gráficos utilizando o pacote \texttt{ggplot2}. A função \texttt{plot\_grid()} \indf{plot\_grid}do pacote \href{https://github.com/wilkelab/cowplot}{cowplot}\footnote{\url{https://github.com/wilkelab/cowplot}} foi utilizado aqui para organizar os gráficos em forma de painéis. O pacote \href{https://github.com/aloy/qqplotr}{qqplotr}\footnote{\url{https://github.com/aloy/qqplotr}} também é utilizado como uma \href{http://www.ggplot2-exts.org/gallery/}{extensão do pacote ggplot2}\footnote{\url{http://www.ggplot2-exts.org/gallery/}} para confecção de gráficos do tipo Q-Q plots. Os dados contidos na aba \emph{gg} do arquivo \emph{data\_R.xlsx} serão utilizados. Estes dados podem ser carregados pelo seguinte comando.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{dados\_gg \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"gg"}\NormalTok{)}
\KeywordTok{str}\NormalTok{(dados\_gg)}
\CommentTok{\# \textquotesingle{}data.frame\textquotesingle{}: 120 obs. of  6 variables:}
\CommentTok{\#  $ AMB  : chr  "E1" "E1" "E1" "E1" ...}
\CommentTok{\#  $ GEN  : chr  "G1" "G1" "G1" "G2" ...}
\CommentTok{\#  $ BLOCO: num  1 2 3 1 2 3 1 2 3 1 ...}
\CommentTok{\#  $ RG   : num  2167 2503 2427 3208 2933 ...}
\CommentTok{\#  $ PH   : num  44.9 46.9 47.8 45.2 45.3 ...}
\CommentTok{\#  $ MMG  : num  31.3 32.9 32.3 29 30.5 ...}
\end{Highlighting}
\end{Shaded}

\hypertarget{as-camadas-de-um-gruxe1fico-ggplot2}{%
\section{\texorpdfstring{As camadas de um gráfico \texttt{ggplot2}}{As camadas de um gráfico ggplot2}}\label{as-camadas-de-um-gruxe1fico-ggplot2}}

No \texttt{ggplot2}, os gráficos são construídos camada por camada (ou, \emph{layers}, em inglês). Neste exemplo, vamos confecionar um gráfico onde o eixo \texttt{x} será representado pela variável \texttt{RG} e o eixo \texttt{y} pela variável \texttt{PH}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Este comando criou um gráfico e armazenou no objeto \texttt{p1}, que será plotado posteriormente. Observe que o primeiro argumento da função é o data frame onde nossos dados foram armazenados. A função \texttt{aes()} \indf{aes} descreve como as variáveis são mapeadas (neste caso \texttt{RG} no eixo \texttt{x} e \texttt{PH} no eixo \texttt{y}). A função \texttt{geom\_point()} \indf{geom\_point}definiu que a forma geométrica a ser utilizada é baseada em pontos, gerando, assim, um gráfico de dispersão. Isto é tudo que precisa ser feito para a confecção de um gráfico simples.

\hypertarget{aesthetics-estuxe9tica}{%
\section{Aesthetics (estética)}\label{aesthetics-estuxe9tica}}

\begin{quote}
``O maior valor de uma imagem é quando ela nos obriga a perceber
o que nunca esperamos ver.'' --- John Tukey
\end{quote}

Alterar a estética dos gráficos \texttt{ggplot2} é uma tarefa relativamente simples. No gráfico anterior, os valores do \texttt{PH} e \texttt{RG} foram plotados sem nenhum tipo de mapeamento estético. Digamos que marcadores com diferentes cores para cada ambiente poderia nos ajudar a compreender melhor o padrão presente em nossos dados. Vamos confecionar este gráfico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH, }\DataTypeTok{colour =}\NormalTok{ AMB)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Ao incluirmos \texttt{colour\ =\ AMB} dentro da função \texttt{aes}, dizemos ao \texttt{ggplot} que os pontos devem ser mapeados esteticamente (neste caso utilziando cores) para cada nível do fator \texttt{AMB} presente em nossos dados. Digamos que em vez de utilizar diferentes cores, os ambientes deveriam ser representados por diferentes tipos de marcadores (quadrados, triângulo, etc.) Neste caso, o argumento \texttt{colour\ =\ AMB} deveria ser substituído por \texttt{shape\ =\ AMB}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p3 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH, }\DataTypeTok{shape =}\NormalTok{ AMB)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{()}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2, p3,}
          \DataTypeTok{ncol =} \DecValTok{3}\NormalTok{,}
          \DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"p1"}\NormalTok{, }\StringTok{"p2"}\NormalTok{, }\StringTok{"p3"}\NormalTok{),}
          \DataTypeTok{rel\_widths =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{1.2}\NormalTok{, }\FloatTok{1.2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-114-1} 

}

\caption{Gráfico de dispersão padrão (p1) e com pontos mapeados por cores (p2) e marcadores (p3) para cada nível do fator 'AMB'.}\label{fig:unnamed-chunk-114}
\end{figure}

\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 4}

\begin{itemize}
\tightlist
\item
  Constua um gráfico semelhante ao anterior, onde o tamanho dos pontos deve ser baseado em uma terceira variável do nosso conjunto de dados, neste exemplo, MMG.
\end{itemize}
\end{tarefa}

\protect\hyperlink{exerc4}{Resposta}

\hypertarget{facet-facetas}{%
\section{Facet (facetas)}\label{facet-facetas}}

Mapeando os diferentes níveis de \texttt{AMB} para diferentes cores, incluímos em um único gráfico os dados de todos os ambientes. Mas, e se nosso objetivo fosse realizar um gráfico para cada ambiente? O \texttt{ggplot2} tem uma poderosa ferramenta para isto: as funções \texttt{facet\_}. Ao utilziar estas funções, o conjunto de dados é subdividido e um gráfico é construído para cada um destes subconjuntos. Vamos ver como elas podem nos ajudar em nossso problema. \indf{geom\_point}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fac1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH)) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_point}\NormalTok{()}\OperatorTok{+}
\StringTok{        }\KeywordTok{facet\_wrap}\NormalTok{(}\OperatorTok{\textasciitilde{}}\NormalTok{AMB)}
\end{Highlighting}
\end{Shaded}

Neste exemplo, um gráfico completamente diferente do anterior é gerado com apenas uma simples modificação: excluímos do mapeamento estético o argumento \texttt{colour\ =\ AMB} e incluímos uma nova função, \texttt{facet\_wrap(\textasciitilde{}AMB)}. Neste caso, informamos que um gráfico deveria ser realizado para cada ambiente. Simples, não? \indf{facet\_wrap}

\begin{dica}
No exemplo anterior, utilizamos a função \texttt{facet\_wrap()} para confeccionar um gráfico foi criado para cada nível do fator \textbf{AMB}.

\begin{itemize}
\tightlist
\item
  Substitua a função \texttt{facet\_wrap(\textasciitilde{}\ AMB)} por \texttt{facet\_grid(\textasciitilde{}\ AMB)} e compare os dois gráficos.
\end{itemize}
\end{dica}

\hypertarget{theme-temas}{%
\section{Theme (temas)}\label{theme-temas}}

Cada gráfico criado com a função \texttt{ggplot()} tem um tema padrão. \emph{Tema}, aqui, é toda propriedade relacionada ao aspecto visual do gráfico, que não foi definida na função \texttt{aes()} \indf{aes}e que pode ser modificada utilizando a função \texttt{theme()}\indf{theme\_bw()} (veja \texttt{?theme}). O \texttt{ggplot2} já conta com alguns temas personalizados para facilitar nosso trabalho. Considerando o exemplo anterior, vamos utilziar a função \texttt{theme\_bw()} (preto e branco) e a função \texttt{theme()} para modificar as propriedades visuais do gráfico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fac2 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH)) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_point}\NormalTok{() }\OperatorTok{+}
\StringTok{        }\KeywordTok{facet\_wrap}\NormalTok{(}\OperatorTok{\textasciitilde{}}\NormalTok{AMB) }\OperatorTok{+}
\StringTok{        }\KeywordTok{theme\_bw}\NormalTok{() }\OperatorTok{+}
\StringTok{        }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{panel.grid =} \KeywordTok{element\_blank}\NormalTok{(), }\CommentTok{\# remove as linhas do corpo do gráfico}
             \CommentTok{\# sem bordas entre os painéis}
              \DataTypeTok{panel.spacing =} \KeywordTok{unit}\NormalTok{(}\DecValTok{0}\NormalTok{, }\StringTok{"cm"}\NormalTok{),}
             \CommentTok{\# modifica o texto dos eixos}
              \DataTypeTok{axis.text =} \KeywordTok{element\_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{12}\NormalTok{, }\DataTypeTok{colour =} \StringTok{"black"}\NormalTok{),}
             \CommentTok{\# cor dos marcadores}
              \DataTypeTok{axis.ticks =} \KeywordTok{element\_line}\NormalTok{(}\DataTypeTok{colour =} \StringTok{"black"}\NormalTok{),}
             \CommentTok{\# tamanho dos marcadores}
              \DataTypeTok{axis.ticks.length =} \KeywordTok{unit}\NormalTok{(.}\DecValTok{2}\NormalTok{, }\StringTok{"cm"}\NormalTok{), }
             \CommentTok{\#cor da borda}
              \DataTypeTok{panel.border =} \KeywordTok{element\_rect}\NormalTok{(}\DataTypeTok{colour =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{fill =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{size =} \FloatTok{0.5}\NormalTok{))}\OperatorTok{+}
\StringTok{       }\CommentTok{\# título dos eixos}
\StringTok{       }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Rendimento de grãos"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Peso hectolitro"}\NormalTok{) }

\KeywordTok{plot\_grid}\NormalTok{(fac1, fac2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"f1"}\NormalTok{, }\StringTok{"f2"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-118-1} 

}

\caption{Gráfico de dispersão considerando a confecção de um gráfico para cada nível de um fator(f1) e modificações na propriedades do tema de um gráfico ggplot2 (f2) }\label{fig:unnamed-chunk-118}
\end{figure}

Os argumentos inseridos dentro das função \texttt{theme()} modificaram a aparência do nosso gráfico. Inúmeros outros argumentos são disponíveis, fazendo com que os gráficos originados sejam completamente personalizáveis. Digamos que precisamos confecionar diversos gráficos e gostaríamos de manter o mesmo tema do gráfico acima. Seria exaustivo e desinteressante informar cada vez estes argumentos para cada gráfico, não? Felizmente, outra poderosa ferramenta proporcionada pelo \texttt{ggplot2} é a possibilidade de confecionarmos nossos próprios temas. Para isto, vamos executar o seguinte comando para criar um tema personalizado (\texttt{my\_theme()}). Este tema pode então ser aplicado como uma camada adicional a cada gráfico que confecionarmos. Para evitar a necessidade da inclusão deste tema em cada gráfico gerado, iremos definir este tema como padrão utilizando a função \texttt{theme\_set()} \indf{theme\_set}.

\indf{my\_theme}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_theme \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{ () \{}
  \KeywordTok{theme\_bw}\NormalTok{() }\OperatorTok{\%+replace\%}\StringTok{ }\CommentTok{\# permite que os valores informados possam ser sobescritos}
\StringTok{    }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.ticks.length =} \KeywordTok{unit}\NormalTok{(.}\DecValTok{2}\NormalTok{, }\StringTok{"cm"}\NormalTok{),}
          \DataTypeTok{axis.text =} \KeywordTok{element\_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{12}\NormalTok{, }\DataTypeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \DataTypeTok{axis.title =} \KeywordTok{element\_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{12}\NormalTok{, }\DataTypeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \DataTypeTok{axis.ticks =} \KeywordTok{element\_line}\NormalTok{(}\DataTypeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \DataTypeTok{panel.border =} \KeywordTok{element\_rect}\NormalTok{(}\DataTypeTok{colour =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{fill =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{size =} \FloatTok{0.5}\NormalTok{),}
          \DataTypeTok{panel.grid =}  \KeywordTok{element\_blank}\NormalTok{())}
\NormalTok{\}}
\KeywordTok{theme\_set}\NormalTok{(}\KeywordTok{my\_theme}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 5}

\begin{itemize}
\tightlist
\item
  Constua um gráfico semelhante ao observado acima, onde diferentes cores devem ser atribuídas para cada genótipo. Em adição, aplique o tema personalizado que acabamos de criar ao gráfico.
\end{itemize}
\end{tarefa}

\protect\hyperlink{exerc5}{Resposta}

\hypertarget{geoms-geometria}{%
\section{Geoms (geometria)}\label{geoms-geometria}}

As funções \texttt{geom\_} definem qual forma geométrica será utilizada para a visualização dos dados no gráfico. Até agora, utilizamos a função \texttt{geom\_point()} \indf{geom\_point)} para construir gráficos de dispersão. Basicamente, qualquer outro tipo de gráfico pode ser criado dependendo da função \texttt{geom\_} utilizada. Dentre as diversas disponíveis no pacote \texttt{ggplot2} as funções \texttt{geom\_} mais utilizadas são:

\begin{itemize}
\tightlist
\item
  \texttt{geom\_abline()}: para retas definidas por um intercepto e uma inclinação;
\item
  \texttt{geom\_hline()}: para retas horizontais definidas por um intercept \texttt{y};
\item
  \texttt{geom\_vline()}: para retas verticais definidas por um intercept \texttt{x};
\item
  \texttt{geom\_boxplot()}: para boxplots;
\item
  \texttt{geom\_histogram()}: para histogramas de frequência;
\item
  \texttt{geom\_smooth()}: ajusta uma função para o conjunto de dados e mostra uma banda de confiança;
\item
  \texttt{geom\_density()}: para densidades;
\item
  \texttt{geom\_area()}: para áreas;
\item
  \texttt{geom\_bar()}: para barras;
\item
  \texttt{geom\_errorbar()} para barras de erro;
\end{itemize}

Deste ponto em diante, vamos confeccionar alguns exemplos utilziando algumas destas funções (ou combinações destas funções) incluindo argumentos de mapeamento de estética e temas vistos até agora. \indf{geom\_smoth}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{s1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{()}\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{se =}\NormalTok{ F)}\OperatorTok{+}\StringTok{ }\CommentTok{\# estima uma regressão linear}
\StringTok{      }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Rendimento de grãos"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Peso hectolitro"}\NormalTok{)}

\NormalTok{s2 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH, }\DataTypeTok{colour =}\NormalTok{ AMB)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{()}\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{se =}\NormalTok{ F)}\OperatorTok{+}
\StringTok{      }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Rendimento de grãos"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Peso hectolitro"}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(s1, s2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"s1"}\NormalTok{, }\StringTok{"s2"}\NormalTok{), }\DataTypeTok{rel\_widths  =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{1.2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-121-1} 

}

\caption{Gráfico de dispersão, combinando pontos e linhas de regressão.}\label{fig:unnamed-chunk-121}
\end{figure}

\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 6}
No gráfico s1, uma regressão linear foi ajustada quando incluímos a função \texttt{geom\_smooth(method\ =\ "lm",\ se\ =\ F)}.

\begin{itemize}
\item
  Como este gráfico pode nos ajudar a compreender a relação entre as variáveis RG e PH? Ao incluir o argumento \texttt{colour\ =\ AMB}, uma regressão para cada ambiente foi ajustada (s2).
\item
  Modifique o gráfico s2 para que os ambientes ainda continuem sendo mapeados por cores, mas uma única linha de regressão seja ajustada.
\end{itemize}
\end{tarefa}

\protect\hyperlink{exerc6}{Resposta}

\begin{itemize}
\tightlist
\item
  \textbf{Gráficos do tipo boxplot}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{mean\_rg \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(dados\_gg}\OperatorTok{$}\NormalTok{RG) }\CommentTok{\# calcula a média geral do RG}
\NormalTok{box1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ GEN, }\DataTypeTok{y =}\NormalTok{ RG)) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_boxplot}\NormalTok{()}

\NormalTok{box2 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ GEN, }\DataTypeTok{y =}\NormalTok{ RG)) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_boxplot}\NormalTok{(}\DataTypeTok{width =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"gray"}\NormalTok{)}\OperatorTok{+}\StringTok{ }\CommentTok{\# boxplot}
\StringTok{        }\CommentTok{\# mostra a média por um ponto}
\StringTok{        }\KeywordTok{stat\_summary}\NormalTok{(}\DataTypeTok{geom =} \StringTok{"point"}\NormalTok{, }\DataTypeTok{fun.y =}\NormalTok{ mean) }\OperatorTok{+}\StringTok{ }
\StringTok{        }\CommentTok{\# adiciona uma linha na média geral}
\StringTok{        }\KeywordTok{geom\_hline}\NormalTok{(}\DataTypeTok{yintercept =}\NormalTok{ mean\_rg, }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{)}\OperatorTok{+}\StringTok{ }
\StringTok{        }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Rendimento de grãos"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Peso hectolitro"}\NormalTok{)}

\KeywordTok{plot\_grid}\NormalTok{(box1, box2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"b1"}\NormalTok{, }\StringTok{"b2"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-123-1} 

}

\caption{Gráfico do tipo boxplot combinando mapeamentos estéticos e inclusão de linhas.}\label{fig:unnamed-chunk-123}
\end{figure}

\indf{geom\_boxplot}

A linha orizontal tracejada representa a média geral do GY. Seis estatísticas são mostradas neste boxplot. A mediana (linha horizontal), a média (ponto) as caixas inferior e superior correspondem ao primeiro e terceiro quartil (percentis 25 e 75, respectivamente). As linha vertical superior se estende da caixa até o maior valor, não maior que \(1,5 \times {IQR}\) (onde IQR é a amplitude interquartílica). A linha vertical inferior se estende da caixa até o menor valor, de no máximo, \(1,5 \times {IQR}\). Dados além das linhas horizontais podem ser considerados \emph{outliers}.

\(~\)

\begin{itemize}
\tightlist
\item
  \textbf{Gráficos do tipo histograma}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{h1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_histogram}\NormalTok{()}

\NormalTok{h2 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{200}\NormalTok{, }\DataTypeTok{colour =} \StringTok{"black"}\NormalTok{, }
                     \KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ ..density.., }\DataTypeTok{fill =}\NormalTok{ ..count..)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_density}\NormalTok{() }\OperatorTok{+}
\StringTok{      }\KeywordTok{stat\_function}\NormalTok{(}\DataTypeTok{fun =}\NormalTok{ dnorm,}
                    \DataTypeTok{color =} \StringTok{"red"}\NormalTok{,}
                    \DataTypeTok{size =} \DecValTok{1}\NormalTok{,}
                    \DataTypeTok{args =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{(dados\_gg}\OperatorTok{$}\NormalTok{RG),}
                                \DataTypeTok{sd =} \KeywordTok{sd}\NormalTok{(dados\_gg}\OperatorTok{$}\NormalTok{RG))) }\OperatorTok{+}
\StringTok{      }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"rendimento de grãos"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Densidade"}\NormalTok{)}

\KeywordTok{plot\_grid}\NormalTok{(h1, h2, }\DataTypeTok{rel\_widths =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{1.4}\NormalTok{), }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"h1"}\NormalTok{, }\StringTok{"h2"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-124-1} 

}

\caption{Gráfico do tipo histograma com estimativas de função de probabilidade kernel e normal.}\label{fig:unnamed-chunk-124}
\end{figure}

\indf{geom\_histogram}

No histograma (h1), a linha preta representa estimativa de densidade Kernel (Silverman \protect\hyperlink{ref-Silverman1998}{1998}). A linha vermelha representa a estimativa da função de probabilidade normal. Para isto, a escala do eixo \texttt{y} foi mudada de contagem para densidade.

\(~\)

\begin{itemize}
\tightlist
\item
  \textbf{Gráficos do tipo barra}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{bar1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ GEN, }\DataTypeTok{y =}\NormalTok{ RG)) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_bar}\NormalTok{(}\DataTypeTok{stat =} \StringTok{"summary"}\NormalTok{,}
                \DataTypeTok{fun =}\NormalTok{ mean,}
                \DataTypeTok{position =} \StringTok{"dodge"}\NormalTok{)}

\NormalTok{bar2 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ GEN, }\DataTypeTok{y =}\NormalTok{ RG, }\DataTypeTok{fill =}\NormalTok{ AMB)) }\OperatorTok{+}
\StringTok{        }\KeywordTok{stat\_summary}\NormalTok{(}\DataTypeTok{fun =}\NormalTok{ mean,}
                     \DataTypeTok{geom =} \StringTok{"bar"}\NormalTok{,}
                     \DataTypeTok{col =} \StringTok{"black"}\NormalTok{,}
                     \DataTypeTok{width =} \FloatTok{0.8}\NormalTok{,}
                     \DataTypeTok{position =} \KeywordTok{position\_dodge}\NormalTok{()) }\OperatorTok{+}\StringTok{ }
\StringTok{        }\KeywordTok{stat\_summary}\NormalTok{(}\DataTypeTok{fun.data =}\NormalTok{ mean\_se,}
                     \DataTypeTok{geom =} \StringTok{"errorbar"}\NormalTok{,}
                     \DataTypeTok{width =} \FloatTok{0.2}\NormalTok{,}
                     \DataTypeTok{position =} \KeywordTok{position\_dodge}\NormalTok{(}\FloatTok{0.8}\NormalTok{))}
 
\KeywordTok{plot\_grid}\NormalTok{(bar1, bar2, }\DataTypeTok{rel\_widths =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.8}\NormalTok{, }\FloatTok{1.2}\NormalTok{), }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"bar1"}\NormalTok{, }\StringTok{"bar2"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-125-1} 

}

\caption{Gráfico do tipo barras, com mapeamento estético e barras de erro.}\label{fig:unnamed-chunk-125}
\end{figure}

\indf{geom\_bar}

A afirmação de que um gráfico \texttt{ggplot2} é feito em camadas fica mais evidente aqui. No gráfico p1, as barras representam as médias geral dos híbridos em nosso conjunto de dados. No segundo gráfico, um novo argumento visto (\texttt{fill\ =\ AMB}). Isto informa que as barras devem ser coloridas para cada nível do fator \texttt{AMB}. A função \texttt{stat\_summary()}, \indf{stat\_summary} também vista pela primeira vez aqui, foi utilizada no segundo gráfico para substituir a função \texttt{geom\_bar()}. Com isto, foi possível incluir as médias (\texttt{fun\ =\ mean} e \texttt{geom\ =\ "bar}), bem como as barras de erro (\texttt{fun.data\ =\ mean\_se} e \texttt{geom\ =\ "errorbar"}). \indf{geom\_bar}

\begin{itemize}
\tightlist
\item
  \textbf{Gráficos de dispersão com linhas de valores preditos}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\#\# Polinômio de segundo grau}
\NormalTok{dado\_reg =}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{dose =} \KeywordTok{c}\NormalTok{(}\DecValTok{15}\NormalTok{,}\DecValTok{20}\NormalTok{,}\DecValTok{25}\NormalTok{,}\DecValTok{30}\NormalTok{,}\DecValTok{35}\NormalTok{,}\DecValTok{40}\NormalTok{),}
                  \DataTypeTok{prod =} \KeywordTok{c}\NormalTok{(}\DecValTok{65}\NormalTok{,}\DecValTok{70}\NormalTok{,}\DecValTok{73}\NormalTok{,}\DecValTok{75}\NormalTok{,}\DecValTok{69}\NormalTok{,}\DecValTok{62}\NormalTok{))}
\NormalTok{l1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dado\_reg, }\KeywordTok{aes}\NormalTok{(dose, prod))}\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{()}\OperatorTok{+}
\StringTok{      }\KeywordTok{stat\_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                  \DataTypeTok{formula =} \StringTok{"y \textasciitilde{} poly(x, 1)"}\NormalTok{,}
                  \DataTypeTok{se =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{l2 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dado\_reg, }\KeywordTok{aes}\NormalTok{(dose, prod))}\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{()}\OperatorTok{+}
\StringTok{      }\KeywordTok{stat\_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                  \DataTypeTok{formula =} \StringTok{"y \textasciitilde{} poly(x, 2)"}\NormalTok{,}
                  \DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{,}
                  \DataTypeTok{col =} \StringTok{"black"}\NormalTok{,}
                  \DataTypeTok{level =} \FloatTok{0.95}\NormalTok{)}

\KeywordTok{plot\_grid}\NormalTok{(l1, l2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"l1"}\NormalTok{, }\StringTok{"l2"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-126-1} 

}

\caption{Gráfico de dispersão combinado com inclusão de curvas ajustadas.}\label{fig:unnamed-chunk-126}
\end{figure}

\begin{itemize}
\tightlist
\item
  \textbf{Gráficos do tipo quantil-quantil (Q-Q plots)}
\end{itemize}

Esta função é muito util para verificar a normalidade dos resíduos da ANOVA e regressões lineares ou não lineares. A programação abaixo foi utilizada no artigo de Lúcio, Santos, and Olivoto (\protect\hyperlink{ref-Lucio2017}{2017}) para demonstrar a intepretação dos gráficos. As funções \texttt{stat\_qq\_band()}, \texttt{stat\_qq\_line()} e \texttt{stat\_qq\_point()} do pacote \href{https://github.com/aloy/qqplotr}{qqplotr}\footnote{\url{https://github.com/aloy/qqplotr}} serão utilizadas. Este é uma das inúmeras extensões do pacote \texttt{ggplot2} que podem ser encontradas \href{http://www.ggplot2-exts.org/gallery/}{aqui.}\footnote{\url{http://www.ggplot2-exts.org/gallery/}}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# simulando dados com diferentes assimetrias}
\NormalTok{assimetria \textless{}{-}}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{esquerda =} \KeywordTok{rbeta}\NormalTok{(}\DecValTok{5000}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{7}\NormalTok{),}
                     \DataTypeTok{direita =} \KeywordTok{rbeta}\NormalTok{(}\DecValTok{5000}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{1}\NormalTok{),}
                     \DataTypeTok{normal =} \KeywordTok{rnorm}\NormalTok{(}\DecValTok{5000}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{3}\NormalTok{))}

\NormalTok{assimetria\_graf \textless{}{-}}\StringTok{ }\KeywordTok{pivot\_longer}\NormalTok{(assimetria, }\KeywordTok{everything}\NormalTok{()) }\CommentTok{\# organiza os dados para usar facete\_wrap}
\KeywordTok{ggplot}\NormalTok{(assimetria\_graf, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample =}\NormalTok{ value))}\OperatorTok{+}
\StringTok{       }\KeywordTok{facet\_wrap}\NormalTok{(}\OperatorTok{\textasciitilde{}}\NormalTok{name, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{)}\OperatorTok{+}
\StringTok{       }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_band}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"gray"}\NormalTok{)}\OperatorTok{+}
\StringTok{       }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_line}\NormalTok{(}\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}\OperatorTok{+}
\StringTok{       }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_point}\NormalTok{()}\OperatorTok{+}
\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Theoretical quantiles"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Sample quantiles"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-127-1} 

}

\caption{Gráfico quantil-quantil de conjuntos de dados com assimetria à esquerda, direita e com distribuição normal.}\label{fig:unnamed-chunk-127}
\end{figure}

\indf{facet\_wrap} \indf{stat\_qq\_band} \indf{stat\_qq\_line} \indf{stat\_qq\_point}
Nestes exemplos vimoss alguns gráficos simples que podem ser originados pelo \texttt{ggplot2}. As potencialidades deste pacote, no entanto vão muito além. Uma galeria com diversos exemplos de gráficos \texttt{ggplot2} com códigos disponíveis pode ser vista \href{https://www.r-graph-gallery.com/}{aqui.}\footnote{\url{https://www.r-graph-gallery.com/}}

\indt{Dicas}
\begin{dica}
Note que no gráfico acima, as funções do pacote qqplotr foram carregadas utilizando \texttt{qqplotr::}. Neste caso, indicamos que a função desejada é uma função deste pacote. Isto é útil, principalmente quando dois pacotes tem funções com o mesmo nome. Utilizando \texttt{::} especificamos de qual pacote a função deve ser carregada.
\end{dica}

\hypertarget{exporta}{%
\chapter{Exportando dados}\label{exporta}}

Será demonstrado nessa seção como exportar dados e tabelas gerados dentro do \emph{software R}. Quanto a saída de resultados, será dado enfase a saídas com extensões \texttt{.csv}, \texttt{.txt} e \texttt{.xlsx}. Quanto aos gráficos, será mostrado como salvar figuras em alta resolução.

\hypertarget{exportando-com-diferentes-extensuxf5es}{%
\section{Exportando com diferentes extensões}\label{exportando-com-diferentes-extensuxf5es}}

A função \texttt{export()} d pacote \texttt{rio} (\url{https://cran.r-project.org/web/packages/rio/index.html}) pode ser utilizada para exportar objetos do R em arquivos dos mais diversos formatos.

Em arquivos \texttt{.csv}, os valores são separados por vírgula. No exemplo abaixo, é mostrado como o objeto \texttt{quantitativo} pode ser salvo em um arquivo \texttt{.csv} com nome \texttt{quanti\_exemplo}. Para salvar as saídas em extensão \texttt{.txt} ou \texttt{.xlsx}, basta substituir a extensão do arquivo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{quanti \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"QUANTI"}\NormalTok{)}
\KeywordTok{head}\NormalTok{(quanti)}
\CommentTok{\# exportar para o diretóri padrão (csv)}
\KeywordTok{export}\NormalTok{(quanti, }\DataTypeTok{file =} \StringTok{"quanti\_exemplo.csv"}\NormalTok{)}
\CommentTok{\# exportar para o diretóri padrão (txt)}
\KeywordTok{export}\NormalTok{(quanti, }\DataTypeTok{file =} \StringTok{"quanti\_exemplo.txt"}\NormalTok{)}
\CommentTok{\# exportar para o diretóri padrão (xslx)}
\KeywordTok{export}\NormalTok{(quanti, }\DataTypeTok{file =} \StringTok{"quanti\_exemplo.xlsx"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

No formato \texttt{.xlsx} é possível informar em qual planilha o objeto será salvo. Neste caso, as planilhas existentes não serão modificadas.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{export}\NormalTok{(quanti, }\DataTypeTok{file =} \StringTok{"quanti\_exemplo.xlsx"}\NormalTok{, }\DataTypeTok{which =} \StringTok{"quanti2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Também é possível salvar diferentes objetos em diferentes planilhas do mesmo arquivo. Vamos considerar que cada nível do fator \texttt{TIPO} do objeto \texttt{quanti} deve ser salvo em uma planilha diferente.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{linear \textless{}{-}}\StringTok{ }\KeywordTok{subset}\NormalTok{(quanti, TIPO }\OperatorTok{==}\StringTok{ "LINEAR"}\NormalTok{)}
\NormalTok{quadratico \textless{}{-}}\StringTok{ }\KeywordTok{subset}\NormalTok{(quanti, TIPO }\OperatorTok{==}\StringTok{ "QUADRÁTICA"}\NormalTok{)}
\NormalTok{cubico \textless{}{-}}\StringTok{ }\KeywordTok{subset}\NormalTok{(quanti, TIPO }\OperatorTok{==}\StringTok{ "CÚBICA"}\NormalTok{)}
\KeywordTok{export}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{linear =}\NormalTok{ linear,}
            \DataTypeTok{quadratico =}\NormalTok{ quadratico, }
            \DataTypeTok{cubico =}\NormalTok{ cubico),}
       \DataTypeTok{file =} \StringTok{"quanti\_exemplo\_plan.xlsx"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Neste caso, um arquivo chamado \texttt{quanti\_exemplo\_plan.xlsx} contendo as planilhas \texttt{linear}, \texttt{quadratico} e \texttt{cubico} foi criado no diretório padrão.

\hypertarget{exportanto-gruxe1ficos}{%
\section{Exportanto gráficos}\label{exportanto-gruxe1ficos}}

Os gráficos podem ser exportados clicando em \emph{Export} \indt{exportar imagens} no \emph{output} dos gráficos. Você pode escolher entre salvar como imagem ou como PDF. Os formatos de imagem disponíveis são: .PNG, .TIFF,\indt{.TIFF} .JPEG,\indt{.JPEG} .BMP \indt{.BMP}, .SVG \indt{.SGV} e .ESP \indt{.EPS}. A outra opção é salvar em um arquivo PDF \indt{.PDF}. A principal diferença entre estes formatos é o método de renderização utilizado na formação do gráfico. Existem basicamente dois métodos de renderização de imagens: \emph{raster images} e \emph{vector-based images}. Imagens rasterizadas usam muitos pixels coloridos ou blocos de construção individuais para formar uma imagem completa. JPEGs, GIFs e PNGs e TIFFs são tipos de imagem raster mais comuns. Como as imagens raster são criadas usando um número fixo de pixels coloridos, elas não podem ser redimensionadas drasticamente sem comprometer sua resolução. Quando esticados para caber em um espaço que eles não foram projetados para preencher, seus pixels ficam visivelmente granulados e a imagem é distorcida. É importante que você salve os arquivos \emph{raster} precisamente nas dimensões necessárias e com a devida resolução para uma boa apresentação. Para salvar estas imagens é necessário informar a \emph{Density of Pixels per Inch} (DPI) \indt{DPI}, ou seja, quantos pontos por polegada quadrada deverá conter a imagem. Quanto maior este valor, maior será a qualidade da imagem e também maior será seu tamanho (em Mb).

Imagens vetoriais (\emph{vector-based graphics}), por outro lado, permitem mais flexibilidade. Construídos usando fórmulas matemáticas em vez de blocos coloridos individuais, os tipos de arquivos vetoriais, como .PDF e .EPS *, são excelentes para criar gráficos de alta resolução sem que seu redimensionamento prejudique a qualidade do gráfico. A maioria das revistas cintíficas aceitam todos estes tipos de formatos. Na dúvida, escolha sempre o formato .PDF (ou .EPS)!

\begin{figure}
\centering
\includegraphics{figures/Figura.png}
\caption{Salvando figuras como imagens}
\end{figure}

\begin{figure}
\centering
\includegraphics{figures/Figura2.png}
\caption{Salvando figuras em PDF}
\end{figure}

Uma alternativa prática para salvar em pdf as imagens é através da função \texttt{pdf()}. Os argumentos \texttt{width} e \texttt{height} correspondem a dimensão da figura (em polegadas) e \texttt{pointsize} corresponde ao tamanho da fonte. \indf{pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pdf}\NormalTok{(}\StringTok{"Figura1.pdf"}\NormalTok{, }\DataTypeTok{width =} \DecValTok{5}\NormalTok{, }\DataTypeTok{height =} \DecValTok{4}\NormalTok{)}

\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(dados\_oat, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH, }\DataTypeTok{colour =}\NormalTok{ AMB)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{()}\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{se =}\NormalTok{ F)}\OperatorTok{+}
\StringTok{      }\KeywordTok{my\_theme}\NormalTok{()}\OperatorTok{+}
\StringTok{      }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Rendimento de grãos"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Peso hectolitro"}\NormalTok{)}
\NormalTok{p1}

\KeywordTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

A função \texttt{ggsave()} \indf{ggsave} também pode ser utilizada para salvar os gráficos para o diretório de trabalho. Por padrão, esta função salva o último gráfico mostrado. Para salvar-mos o gráfico p1, gerado anteriormente, basta executar o seguinte comando.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggsave}\NormalTok{(}\StringTok{"Figure\_ggsave.pdf"}\NormalTok{, p1)}
\end{Highlighting}
\end{Shaded}

\textbf{Exportando figuras como imagens em alta qualidade}

Com as funções \texttt{tiff()} \indf{tiff}, \texttt{png()} \indf{png}, \texttt{jpeg()} \indf{jpeg} e \texttt{bmp()} \indf{bmp} é possível salvar gráficos como imagem em alta resolução. Como na função \texttt{pdf()} \indf{pdf}, \texttt{width} e \texttt{height} correspondem a dimensão. Porém, nestas funções é possível escolher a unidade através do argumento \texttt{units} e a resolução através do argumento \texttt{res}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tiff}\NormalTok{(}\DataTypeTok{filename =} \StringTok{"Figura3.tiff"}\NormalTok{, }\DataTypeTok{width =} \DecValTok{10}\NormalTok{, }\DataTypeTok{height =} \DecValTok{8}\NormalTok{, }
     \DataTypeTok{units =} \StringTok{"cm"}\NormalTok{,}\DataTypeTok{pointsize =} \DecValTok{12}\NormalTok{, }\StringTok{"lzw"}\NormalTok{,}\DataTypeTok{res =} \DecValTok{1200}\NormalTok{)}
\NormalTok{p1}
\KeywordTok{dev.off}\NormalTok{()}

\KeywordTok{png}\NormalTok{(}\DataTypeTok{filename =} \StringTok{"Figura3.png"}\NormalTok{,}\DataTypeTok{width =} \DecValTok{10}\NormalTok{, }\DataTypeTok{height =} \DecValTok{8}\NormalTok{, }
     \DataTypeTok{units =} \StringTok{"cm"}\NormalTok{,}\DataTypeTok{pointsize =} \DecValTok{12}\NormalTok{, }\StringTok{"lzw"}\NormalTok{,}\DataTypeTok{res =} \DecValTok{1200}\NormalTok{)}
\NormalTok{p1}
\KeywordTok{dev.off}\NormalTok{()}

\KeywordTok{jpeg}\NormalTok{(}\DataTypeTok{filename =} \StringTok{"Figura3.jpeg"}\NormalTok{,}\DataTypeTok{width =} \DecValTok{10}\NormalTok{, }\DataTypeTok{height =} \DecValTok{8}\NormalTok{, }
     \DataTypeTok{units =} \StringTok{"cm"}\NormalTok{,}\DataTypeTok{pointsize =} \DecValTok{12}\NormalTok{, }\StringTok{"lzw"}\NormalTok{,}\DataTypeTok{res =} \DecValTok{1200}\NormalTok{)}
\NormalTok{p1}
\KeywordTok{dev.off}\NormalTok{()}

\KeywordTok{bmp}\NormalTok{(}\DataTypeTok{filename =} \StringTok{"Figura3.bmp"}\NormalTok{,}\DataTypeTok{width =} \DecValTok{10}\NormalTok{, }\DataTypeTok{height =} \DecValTok{8}\NormalTok{, }
     \DataTypeTok{units =} \StringTok{"cm"}\NormalTok{,}\DataTypeTok{pointsize =} \DecValTok{12}\NormalTok{, }\StringTok{"lzw"}\NormalTok{,}\DataTypeTok{res =} \DecValTok{1200}\NormalTok{)}
\NormalTok{p1}
\KeywordTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{part-anuxe1lise-de-dados}{%
\part{Análise de dados}\label{part-anuxe1lise-de-dados}}

\hypertarget{analdata}{%
\chapter{Análise de dados experimentais}\label{analdata}}

\begin{quote}
``Muito melhor uma resposta aproximada à pergunta certa, que muitas vezes é vaga, do que uma resposta exata à pergunta errada, que sempre pode ser feita com precisão.'' --- John Tukey
\end{quote}

Nesta seção será abordado aspectos relacionados a análise de experimentos agrícolas, com ênfase na utilização de testes paramétricos. Esta seção será dividida em três partes principais:

\begin{itemize}
\item
  \protect\hyperlink{ebasic}{Parte 1: estatistica básica}: Medidas de tendência central e de variabilidade. Intervalos de confiança para média. Testes de hipóteses para verificar a igualdade entre médias de uma ou duas amostras.
\item
  \protect\hyperlink{dbasic}{Parte 2: delineamentos básicos}: delineamentos experimentais inteiramente casualisado (DIC) e blocos ao acaso (DBC). Pressupostos \indt{pressupostos} dos modelos estatisticos. Testes complementares (média e regressão).
\item
  \protect\hyperlink{ancova}{Parte 3: análise de covariância}: Análise de covariância como uma ferramenta estatística para redução do erro experimental.
\item
  \protect\hyperlink{general}{Parte 4: modelos lineares generalizados}: Modelos Lineares Generalizados aplicados a análise de dados não gaussianos.
\item
  \protect\hyperlink{efat}{Parte 5: experimentos fatoriais}: experimentos fatorias e experimentos com parcelas subdivididas.
\end{itemize}

\hypertarget{ebasic}{%
\section{Estatistica básica}\label{ebasic}}

\hypertarget{medidas-de-tenduxeancia-central}{%
\subsection{Medidas de tendência central}\label{medidas-de-tenduxeancia-central}}

Nesta seção mostraremos como calular medidas de tendência central e medidas de variabilidade. As medidas de tendencia central são valores que representam um conjunto de dados. Entre as mais comuns podemos citar a média, mediana e moda.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{Amostra1 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{3}\NormalTok{) }\CommentTok{\# Gera uma amostra com distribuição normal}
\NormalTok{Amostra2 \textless{}{-}}\StringTok{ }\KeywordTok{rpois}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{12}\NormalTok{) }\CommentTok{\# Gera uma amostra com distribuição Poisson}
\KeywordTok{mean}\NormalTok{(Amostra1) }\CommentTok{\# média}
\CommentTok{\# [1] 12.32666}
\KeywordTok{median}\NormalTok{(Amostra1) }\CommentTok{\# mediana}
\CommentTok{\# [1] 12.34173}
\end{Highlighting}
\end{Shaded}

O \emph{R} calcula a média \indt{média} e mediana \indt{mediana} através das funções \texttt{mean()} \indf{mean} e \texttt{median()} \indf{median}, porém não calcula a moda. No blog \href{https://ridiculas.wordpress.com/2011/11/18/moda-de-uma-amostra-metodo-do-histograma-vs-metodo-kernel/}{Ridículas}, mantido pelo \href{http://www.leg.ufpr.br/doku.php/start}{LEG} da UFPR, dois métodos são dicutidos. Incentivamos a leitura do material.

\hypertarget{medidas-de-variabilidade}{%
\subsection{Medidas de variabilidade}\label{medidas-de-variabilidade}}

As seguintes medidas de variabilidade podem ser computadas, com suas respectivas funções:

\begin{itemize}
\tightlist
\item
  Desvio padrão \texttt{sd()}
\item
  Variância \texttt{var()}
\item
  Amplitude total \texttt{range()}
\item
  Amplitude interquartílica \texttt{IQR()}
\end{itemize}

O desvio padrão e a variância podem ser obtidas com as funções \texttt{sd()} \indf{sd} e \texttt{var()}, respectivamente. \indf{var}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sd}\NormalTok{(Amostra1)}
\CommentTok{\# [1] 2.694598}
\KeywordTok{var}\NormalTok{(Amostra1)}
\CommentTok{\# [1] 7.260859}
\KeywordTok{range}\NormalTok{(Amostra1)}
\CommentTok{\# [1]  5.35590 19.20485}
\KeywordTok{IQR}\NormalTok{(Amostra1)}
\CommentTok{\# [1] 3.557364}
\end{Highlighting}
\end{Shaded}

Não existe no R base uma função para computar o coeficiente de variação, então vamos criá-la utilizando a abordagem \texttt{function()}: \indf{function} \indt{CV}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{CV \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(dados)\{}
  \ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{class}\NormalTok{(dados) }\OperatorTok{==}\StringTok{ "numeric"}\NormalTok{)\{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"Os dados precisam ser numéricos"}\NormalTok{)}
\NormalTok{    \} }\CommentTok{\#Indica que os dados devem ser numéricos}
\NormalTok{  media \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(dados)}
\NormalTok{  sd \textless{}{-}}\StringTok{ }\KeywordTok{sd}\NormalTok{(dados)}
\NormalTok{  CV \textless{}{-}}\StringTok{ }\NormalTok{(sd}\OperatorTok{/}\NormalTok{media) }\OperatorTok{*}\StringTok{ }\DecValTok{100}
  \KeywordTok{return}\NormalTok{(CV) }\CommentTok{\# Valor que será retornado pela função}
\NormalTok{\}}

\KeywordTok{CV}\NormalTok{(Amostra1)}
\CommentTok{\# [1] 21.85992}
\end{Highlighting}
\end{Shaded}

A distribuição dos dados pode ser determinada utilizando histograma de frequências, QQ-Plos e Box-Plot (conforme visto anteriormente). Estatísticas como a amplitude, erro padrão da média, intervalo de confiança, entre outros, podem ser obtidas com a função \texttt{desc\_stat()} \indf{desc\_stat} do pacote \href{https://tiagoolivoto.github.io/metan/}{metan}\footnote{\url{https://tiagoolivoto.github.io/metan/}}. Esta função permite computar as estatisticas para uma ou mais variáveis de um data frame ou um vetor de dados numéricos. Para um exemplo numérico, consulte a \protect\hyperlink{dstat}{seção 7.3.1}.

\hypertarget{resumindo-dados-com-o-pacote-dplyr}{%
\subsection{\texorpdfstring{Resumindo dados com o pacote \texttt{dplyr}}{Resumindo dados com o pacote dplyr}}\label{resumindo-dados-com-o-pacote-dplyr}}

Diversos verbos do pacote \texttt{dplyr} podem ser utilizados para resumir conjuntos de dados. Iniciaremos
com a função \texttt{count()}\indf{count} para contar valores que se repetem em uma determinada variável. Por exemplo, é possível identificar qual é o valor de \texttt{APLA} que mais se repete utilizando

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(metan)}
\KeywordTok{count}\NormalTok{(maize, APLA, }\DataTypeTok{sort =} \OtherTok{TRUE}\NormalTok{)}
\CommentTok{\# \# A tibble: 143 x 2}
\CommentTok{\#     APLA     n}
\CommentTok{\#    \textless{}dbl\textgreater{} \textless{}int\textgreater{}}
\CommentTok{\#  1  2.6     20}
\CommentTok{\#  2  2.8     20}
\CommentTok{\#  3  2.5     16}
\CommentTok{\#  4  2       14}
\CommentTok{\#  5  2.92    14}
\CommentTok{\#  6  2.1     13}
\CommentTok{\#  7  2.3     12}
\CommentTok{\#  8  2.7     12}
\CommentTok{\#  9  1.92    11}
\CommentTok{\# 10  2.04    11}
\CommentTok{\# \# ... with 133 more rows}
\end{Highlighting}
\end{Shaded}

Para identificar quais os valores distintos de \texttt{APLA} foram observados a função \texttt{distinct()}\indf{distinct} é usada.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{distinct}\NormalTok{(maize, APLA)}
\CommentTok{\# \# A tibble: 143 x 1}
\CommentTok{\#     APLA}
\CommentTok{\#    \textless{}dbl\textgreater{}}
\CommentTok{\#  1  2.45}
\CommentTok{\#  2  2.5 }
\CommentTok{\#  3  2.69}
\CommentTok{\#  4  2.8 }
\CommentTok{\#  5  2.62}
\CommentTok{\#  6  2.12}
\CommentTok{\#  7  3.15}
\CommentTok{\#  8  2.97}
\CommentTok{\#  9  3.1 }
\CommentTok{\# 10  3.02}
\CommentTok{\# \# ... with 133 more rows}
\end{Highlighting}
\end{Shaded}

Utilizando a função \texttt{summarise()}\indf{summarise} é possível criar uma ou mais variáveis escalares resumindo as variáveis de um tibble existente. Como resultado, uma linha é retornada. O seguinte código calcula a média global da MGRA e retorna o \emph{n} utilizado na estimativa.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{MGRA\_mean =} \KeywordTok{mean}\NormalTok{(MGRA),}
            \DataTypeTok{n =} \KeywordTok{n}\NormalTok{())}
\CommentTok{\# \# A tibble: 1 x 2}
\CommentTok{\#   MGRA\_mean     n}
\CommentTok{\#       \textless{}dbl\textgreater{} \textless{}int\textgreater{}}
\CommentTok{\# 1      173.   780}
\end{Highlighting}
\end{Shaded}

Muitas vezes é necessário computar uma determinada função (como a média) para cada nível de uma variável categórica. Felizmente, o pacote \textbf{dplyr} possibilita que isto seja realizado facilmente. Continuamos no mesmo exemplo anterior. Neste caso, no entanto, o objetivo é calcular a média da MGRA para cada híbrido. Utilizando a função \texttt{group\_by()} \indf{group\_by} antes da função \texttt{summarise()} \indf{summarise} uma linha de resultado para cada nível do fator híbrido é retornado.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(HIB) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{MGRA\_mean =} \KeywordTok{mean}\NormalTok{(MGRA),}
            \DataTypeTok{n =} \KeywordTok{n}\NormalTok{())}
\CommentTok{\# \# A tibble: 13 x 3}
\CommentTok{\#    HIB   MGRA\_mean     n}
\CommentTok{\#    \textless{}chr\textgreater{}     \textless{}dbl\textgreater{} \textless{}int\textgreater{}}
\CommentTok{\#  1 H1         184.    60}
\CommentTok{\#  2 H10        164.    60}
\CommentTok{\#  3 H11        167.    60}
\CommentTok{\#  4 H12        157.    60}
\CommentTok{\#  5 H13        180.    60}
\CommentTok{\#  6 H2         187.    60}
\CommentTok{\#  7 H3         169.    60}
\CommentTok{\#  8 H4         184.    60}
\CommentTok{\#  9 H5         184.    60}
\CommentTok{\# 10 H6         188.    60}
\CommentTok{\# 11 H7         171.    60}
\CommentTok{\# 12 H8         160.    60}
\CommentTok{\# 13 H9         153.    60}
\end{Highlighting}
\end{Shaded}

Até aqui vimos como a média (global ou para cada híbrido) da MGRA pode ser calculada. Quase sempre, no entanto, quando calculamos a média (ou qualquer outra medida) em um conjunto de dados, queremos fazê-la para todas as variáveis numéricas. Implementar isto com \textbf{dplyr} é relativamente fácil. Existem basicamente três opções para isto, utilizando as variantes \texttt{summarise\_all()}, \texttt{summarise\_if()}, ou \texttt{summarise\_at()}. Todos os \emph{verbos} principais do pacote \textbf{dplyr} apresentam estas variantes, o que torna fácil aplicar a mesma função para múltiplas variáveis. Estas três variantes proporcionam: \indf{summarise\_at}

\begin{itemize}
\tightlist
\item
  \texttt{\_all()} aplicar a função a todas as variáveis;
\item
  \texttt{\_at()} aplicar a função a variáveis selecionadas com vetores de caracteres ou utilizando \texttt{vars()}
\item
  \texttt{\_if()} aplicar a função a variáveis selecionadas com uma função, por exemplo \texttt{is.numeric()}.
\end{itemize}

Veremos como estas variantes funcionam, calculando a média para as variáveis do conjunto de dados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise\_all}\NormalTok{(mean)}
\CommentTok{\# \# A tibble: 1 x 10}
\CommentTok{\#     AMB   HIB   REP  APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1    NA    NA    NA  2.48  1.34  15.2  49.5  173.  339.  512.}
\end{Highlighting}
\end{Shaded}

Note que utilizando a função \texttt{summarise\_all()}\indf{summarise\_all} a média para todas as variáveis numéricas foi calculada e um valor \texttt{NA} foi retornado para as variáveis categóricas. Se o objetivo é computar a média somente para as variáveis numéricas (o que é o mais lógico), a função \texttt{summarise\_if()} \indf{summarise\_if}é a melhor escolha.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise\_if}\NormalTok{(is.numeric, mean)}
\CommentTok{\# \# A tibble: 1 x 7}
\CommentTok{\#    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#   \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1  2.48  1.34  15.2  49.5  173.  339.  512.}
\end{Highlighting}
\end{Shaded}

Funções próprias podem ser aplicadas dentro da função summarise para computar uma estatística personalizada. Como exemplo, vamos criar uma função chamada \texttt{mse} que retornará o valor da média e o erro padrão da média e aplicá-la para cada nível do fator AMB.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mse \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{  me =}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{mean}\NormalTok{(x), }\DecValTok{3}\NormalTok{)}
\NormalTok{  se =}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{sd}\NormalTok{(x)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{n}\NormalTok{()), }\DecValTok{3}\NormalTok{)}
  \KeywordTok{return}\NormalTok{(}\KeywordTok{paste}\NormalTok{(me, }\StringTok{"+{-}"}\NormalTok{, se))}
\NormalTok{\}}
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(AMB) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{MGRA\_mean\_se =} \KeywordTok{mse}\NormalTok{(MGRA))}
\CommentTok{\# \# A tibble: 4 x 2}
\CommentTok{\#   AMB   MGRA\_mean\_se    }
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{}           }
\CommentTok{\# 1 A1    199.437 +{-} 3.232}
\CommentTok{\# 2 A2    168.436 +{-} 3.381}
\CommentTok{\# 3 A3    146.811 +{-} 2.787}
\CommentTok{\# 4 A4    177.072 +{-} 3.118}
\end{Highlighting}
\end{Shaded}

Se desejamos computar mais de uma função para variáveis específicas, então o próximo código nos ajudará. Note que para aplicar mais de uma função é necessário declarar o argumento \texttt{.funs} e criar um vetor com o nome das funções. Neste caso, os sufixos \texttt{\_m} e \texttt{\_sd} representam a média e o desvio padrão, respectivamente.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(AMB) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{summarise\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"M"}\NormalTok{),}
                    \KeywordTok{ends\_with}\NormalTok{(}\StringTok{"S"}\NormalTok{),}
                    \KeywordTok{contains}\NormalTok{(}\StringTok{"GR"}\NormalTok{)),}
               \DataTypeTok{.funs =} \KeywordTok{c}\NormalTok{(}\DataTypeTok{m =}\NormalTok{ mean, }\DataTypeTok{sd =}\NormalTok{ sd))}
\CommentTok{\# \# A tibble: 4 x 11}
\CommentTok{\#   AMB   MGRA\_m MMG\_m AIES\_m DIES\_m NGRA\_m MGRA\_sd MMG\_sd AIES\_sd DIES\_sd NGRA\_sd}
\CommentTok{\#   \textless{}chr\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1      199.  360.   1.58   51.6   558.    45.1   58.1   0.187    3.23    117.}
\CommentTok{\# 2 A2      168.  334.   1.31   48.7   505.    47.2   67.9   0.369    3.53    103.}
\CommentTok{\# 3 A3      147.  318.   1.08   47.9   468.    38.9   61.7   0.225    3.57    110.}
\CommentTok{\# 4 A4      177.  343.   1.41   49.9   516.    43.5   58.6   0.212    3.35    106.}
\end{Highlighting}
\end{Shaded}

\hypertarget{dstat}{%
\subsection{Estatística descritiva com pacote metan}\label{dstat}}

O pacote \texttt{metan} fornece uma estrutura simples e intuitiva para o cálculo de estatísticas descritivas. Um \href{https://tiagoolivoto.github.io/metan/reference/utils_stats.html}{conjunto de funções} pode ser usado para calcular rapidamente as estatísticas descritivas mais usadas.

Para calcular os valores médios para cada nível de um fator, por exemplo para cada nível do fator \texttt{HIB} do conjunto de dados \texttt{maize}, usamos a função\texttt{means\_by()}.\indf{means\_by}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{means\_by}\NormalTok{(maize, HIB)}
\CommentTok{\# \# A tibble: 13 x 8}
\CommentTok{\#    HIB    APLA  AIES  CESP  DIES  MGRA   MMG  NGRA}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 H1     2.62  1.50  15.1  51.2  184.  365.  507.}
\CommentTok{\#  2 H10    2.31  1.26  15.1  48.4  164.  320.  504.}
\CommentTok{\#  3 H11    2.39  1.27  15.2  48.8  167.  333.  501.}
\CommentTok{\#  4 H12    2.44  1.28  14.3  48.6  157.  316.  502.}
\CommentTok{\#  5 H13    2.54  1.35  15.0  50.6  180.  340.  538.}
\CommentTok{\#  6 H2     2.60  1.38  15.3  50.9  187.  356.  527.}
\CommentTok{\#  7 H3     2.59  1.41  14.5  49.4  169.  346.  491.}
\CommentTok{\#  8 H4     2.58  1.43  15.7  49.2  184.  346.  535.}
\CommentTok{\#  9 H5     2.57  1.37  15.6  49.9  184.  341.  542.}
\CommentTok{\# 10 H6     2.56  1.41  15.8  51.5  188.  363.  516.}
\CommentTok{\# 11 H7     2.40  1.32  15.4  49.5  171.  345.  498.}
\CommentTok{\# 12 H8     2.33  1.21  15.0  48.4  160.  322.  496.}
\CommentTok{\# 13 H9     2.36  1.27  15.0  47.6  153.  311.  496.}
\end{Highlighting}
\end{Shaded}

As seguintes funções \texttt{\_by()} estão disponíveis para calcular as principais estatísticas descritivas por níveis de um fator.

\begin{itemize}
\tightlist
\item
  \texttt{cv\_by\ ()} Para cálculo do coeficiente de variação.\indf{cv\_by}
\item
  \texttt{max\_by\ ()} Para calcular valores máximos.\indf{max\_by}
\item
  \texttt{means\_by\ ()} Para calcular meios aritméticos.\indf{means\_by}
\item
  \texttt{min\_by\ ()} Para compilar valores mínimos.\indf{min\_by}
\item
  \texttt{n\_by\ ()} Para obter o comprimento.\indf{n\_by}
\item
  \texttt{sd\_by\ ()} Para calcular o desvio padrão amostral.\indf{sd\_by}
\item
  \texttt{sem\_by\ ()} Para calcular o erro padrão da média.\indf{sem\_by}
\end{itemize}

\hypertarget{funuxe7uxf5es-uxfateis}{%
\subsubsection{Funções úteis}\label{funuxe7uxf5es-uxfateis}}

Outras funções úteis também são implementadas. Todos eles funcionam naturalmente com \texttt{\%\textgreater{}\%}, lidam com dados agrupados com \texttt{group\_by()} e várias variáveis (todas as variáveis numéricas de \texttt{.data} por padrão).\indf{group\_by}

\begin{itemize}
\tightlist
\item
  \texttt{av\_dev\ ()} calcula o desvio médio absoluto.\indf{av\_dev}
\item
  \texttt{ci\_mean\ ()} calcula o intervalo de confiança para a média.\indf{ci\_mean}
\item
  \texttt{cv\ ()} calcula o coeficiente de variação.\indf{cv}
\item
  \texttt{freq\_table\ ()} Calcula a fábula de frequência.\indf{freq\_table}
\item
  \texttt{hm\_mean\ ()}, \texttt{gm\_mean\ ()} calcula as médias harmônica e geométrica, respectivamente. A média harmônica é o recíproco da média aritmética dos recíprocos. A média geométrica é a enésima raiz de n produtos.\indf{hm\_mean}\indf{gm\_mean}
\item
  \texttt{kurt\ ()} calcula a curtose como usada no SAS e no SPSS.\indf{kurt}
\item
  \texttt{range\_data\ ()} Calcula o intervalo dos valores.\indf{range\_data}
\item
  \texttt{sd\_amo\ ()}, \texttt{sd\_pop\ ()} Calcula amostra e desvio padrão populacional, respectivamente.\indf{sd\_amo}\indf{sd\_pop}
\item
  \texttt{sem\ ()} calcula o erro padrão da média.\indf{sem}
\item
  \texttt{skew\ ()} calcula a assimetria usada no SAS e no SPSS.\indf{skew}
\item
  \texttt{sum\_dev\ ()} calcula a soma dos desvios absolutos.\indf{sum\_dev}
\item
  \texttt{sum\_sq\_dev\ ()} calcula a soma dos desvios ao quadrado.\indf{sum\_sq\_dev}
\item
  \texttt{var\_amo\ ()}, \texttt{var\_pop\ ()} calcula amostra e variação populacional.\indf{var\_amo}\indf{var\_pop}
\item
  \texttt{valid\_n\ ()} Retorna o comprimento válido (não NA) de um dado.\indf{valid\_n}
\end{itemize}

\hypertarget{a-funuxe7uxe3o-desc_stat}{%
\subsubsection{\texorpdfstring{A função \texttt{desc\_stat()}}{A função desc\_stat()}}\label{a-funuxe7uxe3o-desc_stat}}

Para calcular todas as estatísticas de uma só vez, podemos usar \texttt{desc\_stat()}\indf{desc\_stat}. Esta função pode ser usada para calcular medidas de tendência central, posição e dispersão. Por padrão (\texttt{stats\ =\ "main"}), sete estatísticas (coeficiente de variação, máximo, média, mediana, mínimo, desvio padrão da amostra, erro padrão e intervalo de confiança da média) são calculadas. Outros valores permitidos são \texttt{"all"} para mostrar todas as estatísticas, \texttt{"robust"} para mostrar estatísticas robustas, \texttt{"quantile"} para mostrar estatísticas quantílicas ou escolher uma (ou mais) estatísticas usando um vetor separado por vírgula com os nomes das estatísticas, por exemplo, \texttt{stats\ =\ c("mean,\ cv")}. Também podemos usar \texttt{hist\ =\ TRUE} para criar um histograma para cada variável. Aqui, auxiliares selecionados também podem ser usados no argumento \texttt{...}.

\begin{itemize}
\tightlist
\item
  \textbf{Todas as estatísticas para todas as variáveis numéricas}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{desc\_stat}\NormalTok{(maize, }\DataTypeTok{stats =} \StringTok{"all"}\NormalTok{)}
\CommentTok{\# \# A tibble: 7 x 32}
\CommentTok{\#   variable av.dev     ci    cv  gmean  hmean     iqr    kurt     mad    max}
\CommentTok{\#   \textless{}chr\textgreater{}     \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}}
\CommentTok{\# 1 AIES      0.268 0.0221 23.4    1.30   1.26   0.502 {-}0.729    0.363   2.39}
\CommentTok{\# 2 APLA      0.322 0.0264 15.1    2.45   2.42   0.64  {-}0.292    0.474   3.3 }
\CommentTok{\# 3 CESP      1.65  0.152  14.3   15.0   14.5    2.6    2.83     1.93   20.4 }
\CommentTok{\# 4 DIES      3.02  0.260   7.46  49.4   49.3    5.29  {-}0.285    3.82   59.7 }
\CommentTok{\# 5 MGRA     39.0   3.35   27.5  166.   157.    69.0   {-}0.56    51.0   291.  }
\CommentTok{\# 6 MMG      51.5   4.46   18.7  332.   325.    87.8   {-}0.0484  66.2   546.  }
\CommentTok{\# 7 NGRA     88.4   7.98   22.2  498.   482.   148.     0.321  110.    903   }
\CommentTok{\# \# ... with 22 more variables: mean \textless{}dbl\textgreater{}, median \textless{}dbl\textgreater{}, min \textless{}dbl\textgreater{}, n \textless{}dbl\textgreater{},}
\CommentTok{\# \#   n.valid \textless{}dbl\textgreater{}, n.missing \textless{}dbl\textgreater{}, n.unique \textless{}dbl\textgreater{}, ps \textless{}dbl\textgreater{}, q2.5 \textless{}dbl\textgreater{},}
\CommentTok{\# \#   q25 \textless{}dbl\textgreater{}, q75 \textless{}dbl\textgreater{}, q97.5 \textless{}dbl\textgreater{}, range \textless{}dbl\textgreater{}, sd.amo \textless{}dbl\textgreater{}, sd.pop \textless{}dbl\textgreater{},}
\CommentTok{\# \#   se \textless{}dbl\textgreater{}, skew \textless{}dbl\textgreater{}, sum \textless{}dbl\textgreater{}, sum.dev \textless{}dbl\textgreater{}, sum.sq.dev \textless{}dbl\textgreater{},}
\CommentTok{\# \#   var.amo \textless{}dbl\textgreater{}, var.pop \textless{}dbl\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Estatísticas robustas usando select helpers}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
  \KeywordTok{desc\_stat}\NormalTok{(}\KeywordTok{contains}\NormalTok{(}\StringTok{"N"}\NormalTok{),}
            \DataTypeTok{stats =} \StringTok{"robust"}\NormalTok{)}
\CommentTok{\# \# A tibble: 1 x 5}
\CommentTok{\#   variable     n median   iqr    ps}
\CommentTok{\#   \textless{}chr\textgreater{}    \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 NGRA       780    517  148.  110.}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Funções quantílicas escolhendo nomes de variáveis}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
  \KeywordTok{desc\_stat}\NormalTok{(APLA, AIES, CESP,}
            \DataTypeTok{stats =} \StringTok{"quantile"}\NormalTok{)}
\CommentTok{\# \# A tibble: 3 x 7}
\CommentTok{\#   variable     n   min   q25 median   q75   max}
\CommentTok{\#   \textless{}chr\textgreater{}    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 AIES       780   0.5  1.09   1.38  1.59  2.39}
\CommentTok{\# 2 APLA       780   1    2.16   2.52  2.8   3.3 }
\CommentTok{\# 3 CESP       780   0.8 14     15.4  16.6  20.4}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Crie um histograma para cada variável}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
  \KeywordTok{desc\_stat}\NormalTok{(APLA, AIES, CESP,}
            \DataTypeTok{hist =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{html_r_files/figure-latex/unnamed-chunk-150-1}

\begin{verbatim}
# # A tibble: 3 x 9
#   variable    cv   max  mean median   min sd.amo     se     ci
#   <chr>    <dbl> <dbl> <dbl>  <dbl> <dbl>  <dbl>  <dbl>  <dbl>
# 1 AIES      23.4  2.39  1.34   1.38   0.5  0.314 0.0113 0.0221
# 2 APLA      15.1  3.3   2.48   2.52   1    0.375 0.0134 0.0264
# 3 CESP      14.3 20.4  15.2   15.4    0.8  2.16  0.0774 0.152
\end{verbatim}

\hypertarget{estatuxedsticas-por-nuxedveis-de-fatores}{%
\subsubsection{Estatísticas por níveis de fatores}\label{estatuxedsticas-por-nuxedveis-de-fatores}}

Para calcular as estatísticas para cada nível de um fator, use o argumento \texttt{by}. Além disso, é possível selecionar as estatísticas a serem computadas usando o argumento \texttt{stats}, que é um único nome estatístico, por exemplo,\texttt{"mean"}ou um vetor de nomes separados por vírgula com \texttt{"} no início e apenas o final do vetor. Tenha em atenção que os nomes das estatísticas \textbf{NÃO} diferenciam maiúsculas de minúsculas, por exemplo, são reconhecidos \texttt{"mean"}, \texttt{"Mean"} ou \texttt{"MEAN"}. Vírgula ou espaços podem ser usados para separar os nomes das estatísticas.

\begin{itemize}
\item
  Todas as opções abaixo funcionarão:

  \begin{itemize}
  \tightlist
  \item
    \texttt{stats\ =\ c\ ("mean,\ se,\ cv,\ max,\ min")}
  \item
    \texttt{stats\ =\ c\ ("mean\ se\ cv\ max\ min")}
  \item
    \texttt{stats\ =\ c\ ("MEAN,\ Se,\ CV\ max\ MIN")}
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{desc\_stat}\NormalTok{ (maize,}
          \KeywordTok{contains}\NormalTok{(}\StringTok{"C"}\NormalTok{),}
          \DataTypeTok{stats =}\NormalTok{ (}\StringTok{"mean, se, cv, max, min"}\NormalTok{),}
          \DataTypeTok{by =}\NormalTok{ AMB)}
\CommentTok{\# \# A tibble: 4 x 7}
\CommentTok{\#   AMB   variable  mean    se    cv   max   min}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{}    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 A1    CESP      15.6 0.171  15.3  20.3   0.8}
\CommentTok{\# 2 A2    CESP      15.2 0.148  13.6  19.2   8.7}
\CommentTok{\# 3 A3    CESP      14.7 0.145  13.8  19.9   7.5}
\CommentTok{\# 4 A4    CESP      15.1 0.148  13.7  20.4   8.2}
\end{Highlighting}
\end{Shaded}

\indf{desc\_stat}

Para calcular as estatísticas descritivas por mais de uma variável de agrupamento, precisamos passar dados agrupados para o argumento \texttt{.data} com a função\texttt{group\_by()}. Vamos calcular a média, o erro padrão da média e o tamanho da amostra para as variáveis \texttt{EP} e\texttt{EL} para todas as combinações dos fatores \texttt{AMB} e\texttt{HIB}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stats \textless{}{-}}\StringTok{ }
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(AMB, HIB) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{desc\_stat}\NormalTok{(APLA, AIES, CESP,}
            \DataTypeTok{stats =} \KeywordTok{c}\NormalTok{(}\StringTok{"mean, se, n"}\NormalTok{))}
\NormalTok{stats}
\CommentTok{\# \# A tibble: 156 x 6}
\CommentTok{\#    AMB   HIB   variable  mean     se     n}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{}    \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    AIES      1.68 0.0599    15}
\CommentTok{\#  2 A1    H1    APLA      2.72 0.0695    15}
\CommentTok{\#  3 A1    H1    CESP     15.4  0.451     15}
\CommentTok{\#  4 A1    H10   AIES      1.62 0.0506    15}
\CommentTok{\#  5 A1    H10   APLA      2.78 0.0716    15}
\CommentTok{\#  6 A1    H10   CESP     16.1  0.662     15}
\CommentTok{\#  7 A1    H11   AIES      1.58 0.0302    15}
\CommentTok{\#  8 A1    H11   APLA      2.75 0.0236    15}
\CommentTok{\#  9 A1    H11   CESP     16.6  0.332     15}
\CommentTok{\# 10 A1    H12   AIES      1.54 0.0456    15}
\CommentTok{\# \# ... with 146 more rows}
\end{Highlighting}
\end{Shaded}

Quando as estatísticas são calculadas para níveis de um fator, a função \texttt{desc\_wider()} pode ser utilizada para converter uma estatística calculada em um conjunto de dados em formato \emph{wide}, ou seja, variáveis nas colunas, fatores nas linhas com o valor da estatística escolhida preenchendo a tabela.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{desc\_wider}\NormalTok{(stats, se)}
\CommentTok{\# \# A tibble: 52 x 5}
\CommentTok{\#    AMB   HIB     AIES   APLA  CESP}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{}  \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 A1    H1    0.0599 0.0695 0.451}
\CommentTok{\#  2 A1    H10   0.0506 0.0716 0.662}
\CommentTok{\#  3 A1    H11   0.0302 0.0236 0.332}
\CommentTok{\#  4 A1    H12   0.0456 0.0582 0.498}
\CommentTok{\#  5 A1    H13   0.0562 0.05   0.295}
\CommentTok{\#  6 A1    H2    0.0327 0.0507 0.637}
\CommentTok{\#  7 A1    H3    0.0383 0.0323 0.543}
\CommentTok{\#  8 A1    H4    0.0448 0.043  0.437}
\CommentTok{\#  9 A1    H5    0.0315 0.0442 0.618}
\CommentTok{\# 10 A1    H6    0.0447 0.0704 0.347}
\CommentTok{\# \# ... with 42 more rows}
\end{Highlighting}
\end{Shaded}

\hypertarget{testes-de-aderuxeancia}{%
\subsection{Testes de aderência}\label{testes-de-aderuxeancia}}

Testes de aderência a distribuições teóricas também são de grande utilizada para as ciências agrárias. O teste de Shapiro-Wilk, realizado pela função \texttt{shapiro.test()} \indt{shapiro.test}, é amplamente utilizada para realizar o teste de normalidade dos dados. Para testar a aderência a outras distribuições teóricas, o teste de Kolmolgorov-Smirnov (função \texttt{ks.test()}) \indt{ks.test()} é uma alternativa.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Teste de Shapiro{-}Wilk}
\KeywordTok{shapiro.test}\NormalTok{(Amostra1)}
\CommentTok{\# }
\CommentTok{\#   Shapiro{-}Wilk normality test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1}
\CommentTok{\# W = 0.9956, p{-}value = 0.9876}
\KeywordTok{shapiro.test}\NormalTok{(Amostra2)}
\CommentTok{\# }
\CommentTok{\#   Shapiro{-}Wilk normality test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra2}
\CommentTok{\# W = 0.95815, p{-}value = 0.002976}

\CommentTok{\# Kolmogorov–Smirnov}
\CommentTok{\# Amostra1 e Amostra2 provém da mesma distribuição?}
\KeywordTok{ks.test}\NormalTok{(Amostra1, Amostra2)}
\CommentTok{\# }
\CommentTok{\#   Two{-}sample Kolmogorov{-}Smirnov test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1 and Amostra2}
\CommentTok{\# D = 0.29, p{-}value = 0.0004453}
\CommentTok{\# alternative hypothesis: two{-}sided}

\CommentTok{\# Amostra1 \textasciitilde{} N(12, 3)?}
\KeywordTok{ks.test}\NormalTok{(Amostra1, }\StringTok{"pnorm"}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\CommentTok{\# }
\CommentTok{\#   One{-}sample Kolmogorov{-}Smirnov test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1}
\CommentTok{\# D = 0.094659, p{-}value = 0.3317}
\CommentTok{\# alternative hypothesis: two{-}sided}
\end{Highlighting}
\end{Shaded}

\hypertarget{intervalos-de-confianuxe7a}{%
\subsection{Intervalos de confiança}\label{intervalos-de-confianuxe7a}}

A estimação por intervalo não fornece idéia da margem de erro cometida ao estimar um determinado parâmetro (Ferreira \protect\hyperlink{ref-Ferreira2009}{2009}). Por isso, para verificar se uma dada hipótese \(H_0\) (de igualdade) é ou não verdadeira, deve-se utilizar intervalos de confiança ou testes de hipóteses. A construção destes intervalos, e as particularidades dos testes de hipóteses, serão discutidos a seguir. Recomendamos como literatura o livro \href{http://www.editoraufv.com.br/produto/1595058/estatistica-basica}{Estatística Básica}\footnote{\url{http://www.editoraufv.com.br/produto/1595058/estatistica-basica}} escrito pelo Prof.~Daniel Furtado Ferreira da UFV.
Para verificar a normalidade dos dados, as funções \texttt{shapiro.test()} e \texttt{ks.test()} e os gráficos QQ-Plot são de grande utilidade. \indf{shapiro.test} \indf{ks.test}

Será demostrado como testar hióteses para uma e duas médias pelo teste \emph{t} de Student, o que exiege que os dados tenham distribuição normal univariada (já discutido anteriormente) ou bivariada (dados emparelhados). Para testar a normalidade bivariada, basta testar a normalidade da diferença entre as variáveis: \indt{distribuição normal}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Amostra3 \textless{}{-}}\StringTok{ }\NormalTok{Amostra1 }\OperatorTok{{-}}\StringTok{ }\NormalTok{Amostra2}
\KeywordTok{shapiro.test}\NormalTok{(Amostra3)}
\CommentTok{\# }
\CommentTok{\#   Shapiro{-}Wilk normality test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra3}
\CommentTok{\# W = 0.97923, p{-}value = 0.1158}
\end{Highlighting}
\end{Shaded}

A partir de um intervalo \indt{intervalo de confiança} que tenha alta probabilidade de conter o valor paramétrico, é possível diferenciar duas estimativas (Ferreira \protect\hyperlink{ref-Ferreira2009}{2009}). O intervalo de confiança de uma média amostral de 95\% é dado por:

\[
P\left[ {\bar X - {t_{\alpha /2}}\frac{S}{{\sqrt n }} \le \mu  \le \bar X + {t_{\alpha /2}}\frac{S}{{\sqrt n }}} \right] = 1 - \alpha 
\]

Na expressão acima, \(\bar X\) é a média, \(S\) é o desvio padrão e \(-t_{\alpha /2}\) e \(+t_{\alpha /2}\) são os quantis inferior e superior, respectivamente, da distribuição \emph{t} de Student. O intervalo acima indica que o valor do parâmetro (\(\mu\)) tem 95\% de chance de estar contido no intervalo. Ressalta-se que a expressão acima está relacionada com a precisão e não com a acurácia da estimativa. Para calcular esse intervalo, podemos utilizar a função \texttt{t.teste()} \indf{t.test}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{result \textless{}{-}}\StringTok{ }\KeywordTok{t.test}\NormalTok{(Amostra1)}
\NormalTok{result}\OperatorTok{$}\NormalTok{conf.int }\CommentTok{\# Intervalo de confiança}
\CommentTok{\# [1] 11.79200 12.86133}
\CommentTok{\# attr(,"conf.level")}
\CommentTok{\# [1] 0.95}
\NormalTok{result}\OperatorTok{$}\NormalTok{estimate }\CommentTok{\# média}
\CommentTok{\# mean of x }
\CommentTok{\#  12.32666}
\end{Highlighting}
\end{Shaded}

O intervalo de confiança é, por \emph{default}, de 95\%. Poém, pode-se modificar através do argumento \texttt{conf.level}. \indf{conf.level}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{result \textless{}{-}}\StringTok{ }\KeywordTok{t.test}\NormalTok{(Amostra1, }\DataTypeTok{conf.level =} \FloatTok{0.99}\NormalTok{)}
\NormalTok{result1 \textless{}{-}}\StringTok{ }\KeywordTok{t.test}\NormalTok{(Amostra1, }\DataTypeTok{conf.level =} \FloatTok{0.90}\NormalTok{)}
\NormalTok{result}\OperatorTok{$}\NormalTok{conf.int }\CommentTok{\# Intervalo de confiança}
\CommentTok{\# [1] 11.61895 13.03437}
\CommentTok{\# attr(,"conf.level")}
\CommentTok{\# [1] 0.99}
\NormalTok{result1}\OperatorTok{$}\NormalTok{conf.int }\CommentTok{\# Intervalo de confiança}
\CommentTok{\# [1] 11.87925 12.77407}
\CommentTok{\# attr(,"conf.level")}
\CommentTok{\# [1] 0.9}
\end{Highlighting}
\end{Shaded}

Para gerar os gráficos de intervalo de confiança será utilizada a função \texttt{ggplot()} do pacote \textbf{ggplot2}. \indf{ggplot}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{100}\NormalTok{) }\CommentTok{\#Ajusta a semente para reprodução dos números}
\NormalTok{Amostra1 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{10}\NormalTok{)}
\NormalTok{Amostra2 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{24}\NormalTok{)}
\NormalTok{Amostra3 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{,}\DecValTok{25}\NormalTok{,}\DecValTok{15}\NormalTok{)}
\NormalTok{Amostra4 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{,}\DecValTok{20}\NormalTok{,}\DecValTok{30}\NormalTok{)}

\NormalTok{dados\_IC \textless{}{-}}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}
    \DataTypeTok{Factor =} \KeywordTok{c}\NormalTok{(}\StringTok{"Amostra 1"}\NormalTok{,}\StringTok{"Amostra 2"}\NormalTok{, }\StringTok{"Amostra 3"}\NormalTok{, }\StringTok{"Amostra 4"}\NormalTok{),}
    \DataTypeTok{LL =} \KeywordTok{c}\NormalTok{(}\KeywordTok{t.test}\NormalTok{(Amostra1)}\OperatorTok{$}\NormalTok{conf.int[}\DecValTok{1}\NormalTok{],}
           \KeywordTok{t.test}\NormalTok{(Amostra2)}\OperatorTok{$}\NormalTok{conf.int[}\DecValTok{1}\NormalTok{],}
           \KeywordTok{t.test}\NormalTok{(Amostra3)}\OperatorTok{$}\NormalTok{conf.int[}\DecValTok{1}\NormalTok{],}
           \KeywordTok{t.test}\NormalTok{(Amostra4)}\OperatorTok{$}\NormalTok{conf.int[}\DecValTok{1}\NormalTok{]),}
    \DataTypeTok{Mean =} \KeywordTok{c}\NormalTok{(}\KeywordTok{t.test}\NormalTok{(Amostra1)}\OperatorTok{$}\NormalTok{estimate,}
             \KeywordTok{t.test}\NormalTok{(Amostra2)}\OperatorTok{$}\NormalTok{estimate,}
             \KeywordTok{t.test}\NormalTok{(Amostra3)}\OperatorTok{$}\NormalTok{estimate,}
             \KeywordTok{t.test}\NormalTok{(Amostra4)}\OperatorTok{$}\NormalTok{estimate),}
    \DataTypeTok{UL =} \KeywordTok{c}\NormalTok{(}\KeywordTok{t.test}\NormalTok{(Amostra1)}\OperatorTok{$}\NormalTok{conf.int[}\DecValTok{2}\NormalTok{],}
           \KeywordTok{t.test}\NormalTok{(Amostra2)}\OperatorTok{$}\NormalTok{conf.int[}\DecValTok{2}\NormalTok{],}
           \KeywordTok{t.test}\NormalTok{(Amostra3)}\OperatorTok{$}\NormalTok{conf.int[}\DecValTok{2}\NormalTok{],}
           \KeywordTok{t.test}\NormalTok{(Amostra4)}\OperatorTok{$}\NormalTok{conf.int[}\DecValTok{2}\NormalTok{]))}

\CommentTok{\# Gráfico com barras de erros}
\NormalTok{cbPalette =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"blue"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"pink"}\NormalTok{) }\CommentTok{\# armazenando as cores}
\NormalTok{err1 =}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ dados\_IC, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ Mean, }\DataTypeTok{x =}\NormalTok{ Factor, }\DataTypeTok{colour =}\NormalTok{ Factor)) }\OperatorTok{+}\StringTok{ }
\StringTok{              }\KeywordTok{geom\_point}\NormalTok{(}\DataTypeTok{size =} \FloatTok{2.5}\NormalTok{)}\OperatorTok{+}\StringTok{ }\CommentTok{\# adiciona um ponto ao gráfico}
\StringTok{              }\KeywordTok{geom\_errorbar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{ymax =}\NormalTok{ UL, }\DataTypeTok{ymin =}\NormalTok{ LL), }\DataTypeTok{width =} \FloatTok{0.1}\NormalTok{)}\OperatorTok{+}
\StringTok{              }\KeywordTok{scale\_color\_manual}\NormalTok{(}\DataTypeTok{values =}\NormalTok{ cbPalette)}\OperatorTok{+}\StringTok{ }
\StringTok{              }\KeywordTok{coord\_flip}\NormalTok{()}\OperatorTok{+}\StringTok{ }\CommentTok{\# "inverte" o "x" e o "y" }
\StringTok{              }\KeywordTok{expand\_limits}\NormalTok{(}\DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.4}\NormalTok{,}\FloatTok{0.6}\NormalTok{))}\OperatorTok{+}
\StringTok{              }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\CommentTok{\# Gráfico de barras com barras de erros }
\NormalTok{err2 =}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ dados\_IC, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ Mean, }\DataTypeTok{x =}\NormalTok{ Factor)) }\OperatorTok{+}\StringTok{ }
\StringTok{              }\KeywordTok{geom\_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{fill =}\NormalTok{ Factor), }\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{, }\DataTypeTok{position =} \StringTok{"dodge"}\NormalTok{)}\OperatorTok{+}
\StringTok{              }\KeywordTok{geom\_errorbar}\NormalTok{(}\KeywordTok{aes}\NormalTok{( }\DataTypeTok{ymax =}\NormalTok{ UL, }\DataTypeTok{ymin =}\NormalTok{ LL), }\DataTypeTok{width =} \FloatTok{0.2}\NormalTok{)}\OperatorTok{+}
\StringTok{              }\KeywordTok{expand\_limits}\NormalTok{(}\DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{30}\NormalTok{)) }\OperatorTok{+}
\StringTok{              }\KeywordTok{scale\_fill\_manual}\NormalTok{(}\DataTypeTok{values =}\NormalTok{ cbPalette)}\OperatorTok{+}
\StringTok{              }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\KeywordTok{plot\_grid}\NormalTok{(err1, err2)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-158-1} 

}

\caption{Gráficos de intervalo de confiança (mais de uma variável)}\label{fig:unnamed-chunk-158}
\end{figure}

\hypertarget{teste-de-hipuxf3teses-para-amostras-independentes}{%
\subsection{Teste de hipóteses para amostras independentes}\label{teste-de-hipuxf3teses-para-amostras-independentes}}

Os testes de hipóteses \indt{testes de hipótese} aqui demonstrados tem como objetivo \textbf{(i)} verificar se determianda amostra difrere ou não de zero (\({H_0}:\mu = 0\)) e \textbf{(ii)} se duas amostras são ou não iguais (\({H_0}:{\mu _1} = {\mu _2}\)). Para testar as hipóteses pode-se utilizar a função \texttt{t.teste()}. Utilizaremos como amostras os dados da variável MGRA do conjunto \textbf{maize}. A primeira amostra corresponde contém os valores de \textbf{A1} e a segunda os valores de \textbf{A2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Amostra1 \textless{}{-}}\StringTok{ }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{filter}\NormalTok{(AMB }\OperatorTok{==}\StringTok{ "A1"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(MGRA) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{pull}\NormalTok{()}
\NormalTok{Amostra2 \textless{}{-}}\StringTok{ }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{filter}\NormalTok{(AMB }\OperatorTok{==}\StringTok{ "A2"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(MGRA) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{pull}\NormalTok{()}

\KeywordTok{t.test}\NormalTok{(Amostra1) }\CommentTok{\# testa se a amostra difere de zero}
\CommentTok{\# }
\CommentTok{\#   One Sample t{-}test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1}
\CommentTok{\# t = 61.71, df = 194, p{-}value \textless{} 2.2e{-}16}
\CommentTok{\# alternative hypothesis: true mean is not equal to 0}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#  193.0630 205.8111}
\CommentTok{\# sample estimates:}
\CommentTok{\# mean of x }
\CommentTok{\#   199.437}
\KeywordTok{t.test}\NormalTok{(Amostra1, Amostra2) }\CommentTok{\# testa se as amostras difrem entre si}
\CommentTok{\# }
\CommentTok{\#   Welch Two Sample t{-}test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1 and Amostra2}
\CommentTok{\# t = 6.6279, df = 387.21, p{-}value = 1.144e{-}10}
\CommentTok{\# alternative hypothesis: true difference in means is not equal to 0}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#  21.80515 40.19763}
\CommentTok{\# sample estimates:}
\CommentTok{\# mean of x mean of y }
\CommentTok{\#  199.4370  168.4356}
\end{Highlighting}
\end{Shaded}

Alternativamente, o pacote \href{https://indrajeetpatil.github.io/ggstatsplot/index.html}{ggstatplot}\footnote{\url{https://indrajeetpatil.github.io/ggstatsplot/index.html}} pode ser utilizado para confecionar gráficos que incluem teste de hipóteses.

O teste \emph{t} pode ser utilizado para testar tanto hipóteses do tipo \({H_A}:\mu > 0\) ou \({H_A}:\mu < 0\). Porém, para isso, devemos utilizar o argumento \texttt{alternative} para indicar que o teste utilizado é unilateral.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(Amostra1, }\DataTypeTok{alternative =} \StringTok{"greater"}\NormalTok{) }\CommentTok{\# unilateral a direita}
\CommentTok{\# }
\CommentTok{\#   One Sample t{-}test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1}
\CommentTok{\# t = 61.71, df = 194, p{-}value \textless{} 2.2e{-}16}
\CommentTok{\# alternative hypothesis: true mean is greater than 0}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#  194.0956      Inf}
\CommentTok{\# sample estimates:}
\CommentTok{\# mean of x }
\CommentTok{\#   199.437}
\KeywordTok{t.test}\NormalTok{(Amostra1, }\DataTypeTok{alternative =} \StringTok{"less"}\NormalTok{) }\CommentTok{\# unilateral a esquerda}
\CommentTok{\# }
\CommentTok{\#   One Sample t{-}test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1}
\CommentTok{\# t = 61.71, df = 194, p{-}value = 1}
\CommentTok{\# alternative hypothesis: true mean is less than 0}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#      {-}Inf 204.7784}
\CommentTok{\# sample estimates:}
\CommentTok{\# mean of x }
\CommentTok{\#   199.437}
\end{Highlighting}
\end{Shaded}

\indf{t.test}

Outro pressuposto para realizar o teste \emph{t} é a homogeneidade das variâncias. Quando as variâncias são heterogêneas, o grau de liberdade utilizado é calculado pela aproximação de Welch-Satterthwaite: \indt{Welch-Satterthwaite}

\[
\nu  \cong \frac{{{{\left( {\frac{{S_1^2}}{{{n_1}}} + \frac{{S_2^2}}{{{n_2}}}} \right)}^2}}}{{\frac{{{{\left( {\frac{{S_1^2}}{{{n_1}}}} \right)}^2}}}{{{n_1} - 1}} + \frac{{{{\left( {\frac{{S_2^2}}{{{n_2}}}} \right)}^2}}}{{{n_2} - 1}}}}
\]

\indf{var.test}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{var.test}\NormalTok{(Amostra1, Amostra2) }\CommentTok{\# Teste F para variâncias}
\CommentTok{\# }
\CommentTok{\#   F test to compare two variances}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1 and Amostra2}
\CommentTok{\# F = 0.91355, num df = 194, denom df = 194, p{-}value = 0.5295}
\CommentTok{\# alternative hypothesis: true ratio of variances is not equal to 1}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#  0.688888 1.211488}
\CommentTok{\# sample estimates:}
\CommentTok{\# ratio of variances }
\CommentTok{\#          0.9135534}
\KeywordTok{t.test}\NormalTok{(Amostra1, Amostra2, }\DataTypeTok{var.equal =} \OtherTok{FALSE}\NormalTok{) }\CommentTok{\# Por default, usa Welch{-}Satterthwaite}
\CommentTok{\# }
\CommentTok{\#   Welch Two Sample t{-}test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1 and Amostra2}
\CommentTok{\# t = 6.6279, df = 387.21, p{-}value = 1.144e{-}10}
\CommentTok{\# alternative hypothesis: true difference in means is not equal to 0}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#  21.80515 40.19763}
\CommentTok{\# sample estimates:}
\CommentTok{\# mean of x mean of y }
\CommentTok{\#  199.4370  168.4356}

\NormalTok{Amostra3 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{30}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{Amostra4 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{30}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\KeywordTok{var.test}\NormalTok{(Amostra3, Amostra4)}
\CommentTok{\# }
\CommentTok{\#   F test to compare two variances}
\CommentTok{\# }
\CommentTok{\# data:  Amostra3 and Amostra4}
\CommentTok{\# F = 0.65152, num df = 29, denom df = 29, p{-}value = 0.2545}
\CommentTok{\# alternative hypothesis: true ratio of variances is not equal to 1}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#  0.3101021 1.3688474}
\CommentTok{\# sample estimates:}
\CommentTok{\# ratio of variances }
\CommentTok{\#          0.6515231}
\KeywordTok{t.test}\NormalTok{(Amostra1, Amostra2, }\DataTypeTok{var.equal =} \OtherTok{TRUE}\NormalTok{) }\CommentTok{\# Quando variâncias são iguais}
\CommentTok{\# }
\CommentTok{\#   Two Sample t{-}test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1 and Amostra2}
\CommentTok{\# t = 6.6279, df = 388, p{-}value = 1.142e{-}10}
\CommentTok{\# alternative hypothesis: true difference in means is not equal to 0}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#  21.80520 40.19757}
\CommentTok{\# sample estimates:}
\CommentTok{\# mean of x mean of y }
\CommentTok{\#  199.4370  168.4356}
\end{Highlighting}
\end{Shaded}

\hypertarget{teste-de-hipuxf3teses-para-amostras-dependentes}{%
\subsection{Teste de hipóteses para amostras dependentes}\label{teste-de-hipuxf3teses-para-amostras-dependentes}}

As formas de comparação discutidas acima consideram as amostras como sendo independentes entre si. Para dados emparelhados, deve-se utiliza o argumento \texttt{paired\ =\ \ TRUE}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Amostra1 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{30}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{5}\NormalTok{)}
\NormalTok{Amostra2 \textless{}{-}}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{30}\NormalTok{,}\DecValTok{15}\NormalTok{,}\DecValTok{5}\NormalTok{)}

\KeywordTok{var.test}\NormalTok{(Amostra1, Amostra2) }\CommentTok{\# Teste F para variâncias}
\CommentTok{\# }
\CommentTok{\#   F test to compare two variances}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1 and Amostra2}
\CommentTok{\# F = 0.74981, num df = 29, denom df = 29, p{-}value = 0.4429}
\CommentTok{\# alternative hypothesis: true ratio of variances is not equal to 1}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#  0.3568811 1.5753388}
\CommentTok{\# sample estimates:}
\CommentTok{\# ratio of variances }
\CommentTok{\#          0.7498058}

\KeywordTok{t.test}\NormalTok{(Amostra1, Amostra2, }\DataTypeTok{var.equal =} \OtherTok{TRUE}\NormalTok{) }\CommentTok{\# Independentes}
\CommentTok{\# }
\CommentTok{\#   Two Sample t{-}test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1 and Amostra2}
\CommentTok{\# t = {-}3.2434, df = 58, p{-}value = 0.001961}
\CommentTok{\# alternative hypothesis: true difference in means is not equal to 0}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#  {-}7.208743 {-}1.706572}
\CommentTok{\# sample estimates:}
\CommentTok{\# mean of x mean of y }
\CommentTok{\#  9.873579 14.331237}
\KeywordTok{t.test}\NormalTok{(Amostra1, Amostra2, }\DataTypeTok{var.equal =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{paired =} \OtherTok{TRUE}\NormalTok{) }\CommentTok{\# Emparelhadas}
\CommentTok{\# }
\CommentTok{\#   Paired t{-}test}
\CommentTok{\# }
\CommentTok{\# data:  Amostra1 and Amostra2}
\CommentTok{\# t = {-}3.6981, df = 29, p{-}value = 0.000902}
\CommentTok{\# alternative hypothesis: true difference in means is not equal to 0}
\CommentTok{\# 95 percent confidence interval:}
\CommentTok{\#  {-}6.922951 {-}1.992364}
\CommentTok{\# sample estimates:}
\CommentTok{\# mean of the differences }
\CommentTok{\#               {-}4.457658}
\end{Highlighting}
\end{Shaded}

\indf{rnorm}

Observa-se que existe uma diferença no valor da estatistica teste, nos graus de liberdade, no valor tabelado e, consequentemente, no \emph{p}-valor. Para duas amostras independentes, o teste para a diferença é dado por

\[
{t_c} = \frac{{{{\bar X}_1} - {{\bar X}_2}}}{{S\sqrt {\frac{1}{{{n_1}}} + \frac{1}{{{n_2}}}} }} \sim {t_{\left( {\alpha ,\nu } \right)}}
\]

Onde \(\alpha\) é a probabilidade de erro, \(\nu\) é o grau de liberdade (nº total de obervações-2), \(S\) é a média ponderada do desvio padrão, \({\bar X}_1\) e \({\bar X}_2\) são a média das amostras 1 e 2, respectivamente, e \(n_1\) e \(n_1\) e \(n_2\) são os tamanhos de amostra da amostra 1 e 2, respectivamente. No resultado acima, obervamos que \(\nu = 58\).

No caso de amostras pareadas (dependentes), a estatística teste é dada por \indt{amostras pareadas}

\[
{t_c} = \frac{{\bar d - {\mu _0}}}{{\frac{{{S_d}}}{{\sqrt n }}}} \sim {t_{\left( {\alpha ,\nu } \right)}} 
\]

Onde \(\alpha\) é a probabilidade de erro, \(\nu\) é o grau de liberdade (nº de diferenças-1), \(\bar d\) é a média das diferenças, \(S_d\) é o desvio padrão das diferenças e \(n\) é o número de diferenças. No resultado acima,obervamos que \(\nu = 29\).

\hypertarget{dbasic}{%
\section{Delineamentos básicos}\label{dbasic}}

As análises realizadas até agora tinham como objetivo verificar a existência de diferenças entre as médias de duas amostras. Porém, quando deseja-se estudar o efeito de ``grupos de fatores'' sobre determinado fenômeno, a análise da variância (ANOVA) é indicada. A ANOVA atribui a diversos fatores partes da variabilidade dos dados (Casella \protect\hyperlink{ref-Casella2008}{2008}). \indt{ANOVA}

Os delineamentos experimentais também são parte importante da ANOVA. Será dado mais destaque aos mais comuns: o delineamento inteiramente casualisado (DIC) \indt{DIC} e o blocos ao acaso (DBC) \indt{DBC}. O bloqueamento tem como objetivo remover parte da variabilidade. Como não se deseja encotrar diferença entre os blocos, análises complementares não são realizadas para este fator.

Nessa seção será demostrado como analisar dados experimentais utilizando estes dois delineamentos. Em um primeiro momento, serão demonstrados experimentos unifatorias e, posteriormente, experimentos bifatoriais com e sem parcelas subdivididas. Formas de como verificar se os pressupostos \indt{pressupostos} do modelo estatistico estão sendo cumpridos, e formas de contornar este problema caso estejam sendo violados, também serão demonstrados. Por fim, após a análise da variância, serão mostrados os testes complementares utilizados para tratamentos quali e quantitativos.

\hypertarget{princuxedpios-buxe1sicos}{%
\subsection{Princípios básicos}\label{princuxedpios-buxe1sicos}}

Os principios básicos da experimentação são a \emph{casualisação} e a \emph{repetição}. A repetição possibilita que o erro seja estimado, e a casualisação que eles sejam independentes.

\hypertarget{pressupostos}{%
\subsection{Pressupostos}\label{pressupostos}}

Independente do delineamento, os pressupostos \indt{pressupostos} do modelo estatístico são que os erros são independentes, homocedásticos e normais:

\[
{\boldsymbol{\varepsilon }} \sim {\textrm N}\left( {0,{\boldsymbol{I}}{\sigma ^2}} \right)
\]

As formas de realizar esse diagnóstico é através de testes estatísticos e gráficos de diagnósticos. Uma ferramente para contornar o problema de violação dos pressupostos é a transformação dos dados. Existem várias formas de transformar os dados (cada uma adequada a um caso específico), mas será dado enfase à transformação Box-Cox.

\hypertarget{estimauxe7uxe3o}{%
\subsection{Estimação}\label{estimauxe7uxe3o}}

A estimativa dos parâmetros \indt{parâmetros}é realizado pelo método dos minimos quadrados. Devido a matriz delineamento ser de posto incompleto (modelo superparametrizado), uma restrição deve ser imposta ao fator tratamentos para que a estimativa do efeito dos fatores seja única (\(\sum {{t_i}} = 0\)). Reparametrizações ou combinações lineares também podem ser utilizados para garantir a unicidade dos parâmetros (Rencher and Schaalje \protect\hyperlink{ref-Rencher2008}{2008}).

\hypertarget{reparametrizauxe7uxe3o-condiuxe7uxf5es-marginais-ou-combinauxe7uxf5es-lineares}{%
\subsection{Reparametrização, condições marginais ou combinações lineares?}\label{reparametrizauxe7uxe3o-condiuxe7uxf5es-marginais-ou-combinauxe7uxf5es-lineares}}

As funções \texttt{lm()} \indf{lm} e \texttt{aov()} \indf{aov} são usualmente utilizadas para realizar a análise da variância. Ambas utilizam a reparametrização o modelo para estimar os parâmetros. Vamos ver isso no exemplo abaixo utilizando o conjunto de dados \texttt{QUALI}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{dados \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"QUALI"}\NormalTok{)}

\CommentTok{\#\# Usando a função aov()}
\NormalTok{mod1 \textless{}{-}}\StringTok{ }\KeywordTok{aov}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{HIBRIDO, }\DataTypeTok{data =}\NormalTok{ dados)}
\KeywordTok{coef}\NormalTok{(mod1)}
\CommentTok{\#  (Intercept) HIBRIDONP\_10  HIBRIDONP\_2  HIBRIDONP\_3  HIBRIDONP\_4  HIBRIDONP\_5 }
\CommentTok{\#     10.27750     {-}3.99450     {-}1.44550     {-}0.79750     {-}0.79675     {-}1.52675 }
\CommentTok{\#  HIBRIDONP\_6  HIBRIDONP\_7  HIBRIDONP\_8  HIBRIDONP\_9 }
\CommentTok{\#     {-}2.94125     {-}3.23250     {-}3.03250     {-}3.28525}

\NormalTok{mod2 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{HIBRIDO, }\DataTypeTok{data =}\NormalTok{ dados)}
\KeywordTok{coef}\NormalTok{(mod2)}
\CommentTok{\#  (Intercept) HIBRIDONP\_10  HIBRIDONP\_2  HIBRIDONP\_3  HIBRIDONP\_4  HIBRIDONP\_5 }
\CommentTok{\#     10.27750     {-}3.99450     {-}1.44550     {-}0.79750     {-}0.79675     {-}1.52675 }
\CommentTok{\#  HIBRIDONP\_6  HIBRIDONP\_7  HIBRIDONP\_8  HIBRIDONP\_9 }
\CommentTok{\#     {-}2.94125     {-}3.23250     {-}3.03250     {-}3.28525}

\CommentTok{\#\# Abordagem matricial}
\NormalTok{y \textless{}{-}}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(dados}\OperatorTok{$}\NormalTok{RG)}
\NormalTok{x \textless{}{-}}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(}\OperatorTok{\textasciitilde{}}\NormalTok{HIBRIDO, }\DataTypeTok{data =}\NormalTok{ dados)}
\NormalTok{beta \textless{}{-}}\StringTok{ }\KeywordTok{solve}\NormalTok{(}\KeywordTok{t}\NormalTok{(x) }\OperatorTok{\%*\%}\StringTok{ }\NormalTok{x) }\OperatorTok{\%*\%}\StringTok{ }\KeywordTok{t}\NormalTok{(x) }\OperatorTok{\%*\%}\StringTok{ }\NormalTok{y}
\NormalTok{beta}
\CommentTok{\#                  [,1]}
\CommentTok{\# (Intercept)  10.27750}
\CommentTok{\# HIBRIDONP\_10 {-}3.99450}
\CommentTok{\# HIBRIDONP\_2  {-}1.44550}
\CommentTok{\# HIBRIDONP\_3  {-}0.79750}
\CommentTok{\# HIBRIDONP\_4  {-}0.79675}
\CommentTok{\# HIBRIDONP\_5  {-}1.52675}
\CommentTok{\# HIBRIDONP\_6  {-}2.94125}
\CommentTok{\# HIBRIDONP\_7  {-}3.23250}
\CommentTok{\# HIBRIDONP\_8  {-}3.03250}
\CommentTok{\# HIBRIDONP\_9  {-}3.28525}
\end{Highlighting}
\end{Shaded}

Abaixo é apresentado o calculo da ANOVA de \texttt{mod1} através de uma aboragem matricial. Portanto verifica-se que a reparametrização é o método utilizado pelas funções \texttt{aov()} e \texttt{lm()}.\indf{lm} \indf{aov}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Anova com uma abrodagem matricial}
\NormalTok{SQtrat \textless{}{-}}\StringTok{ }\KeywordTok{t}\NormalTok{(beta) }\OperatorTok{\%*\%}\StringTok{ }\KeywordTok{t}\NormalTok{(x) }\OperatorTok{\%*\%}\StringTok{ }\NormalTok{y }\OperatorTok{{-}}\StringTok{ }\NormalTok{((}\KeywordTok{sum}\NormalTok{(y))}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\DecValTok{40}
\NormalTok{SQtotal \textless{}{-}}\StringTok{ }\KeywordTok{t}\NormalTok{(y) }\OperatorTok{\%*\%}\StringTok{ }\NormalTok{y }\OperatorTok{{-}}\StringTok{ }\NormalTok{((}\KeywordTok{sum}\NormalTok{(y))}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\DecValTok{40}
\NormalTok{SQres \textless{}{-}}\StringTok{ }\NormalTok{SQtotal }\OperatorTok{{-}}\StringTok{ }\NormalTok{SQtrat}
\NormalTok{Fc \textless{}{-}}\StringTok{ }\NormalTok{(SQtrat }\OperatorTok{/}\StringTok{ }\DecValTok{9}\NormalTok{) }\OperatorTok{/}\StringTok{ }\NormalTok{(SQres }\OperatorTok{/}\StringTok{ }\DecValTok{30}\NormalTok{)}
\NormalTok{p\_val \textless{}{-}}\StringTok{ }\KeywordTok{pf}\NormalTok{(Fc, }\DecValTok{9}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DataTypeTok{lower.tail =} \OtherTok{FALSE}\NormalTok{)}
\KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{SQtrat = "}\NormalTok{, SQtrat)}
\CommentTok{\# }
\CommentTok{\# SQtrat =  65.66176}
\KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{SQtotal = "}\NormalTok{, SQtotal)}
\CommentTok{\# }
\CommentTok{\# SQtotal =  171.8282}
\KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{SQres = "}\NormalTok{, SQres)}
\CommentTok{\# }
\CommentTok{\# SQres =  106.1664}
\KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Fc = "}\NormalTok{, Fc)}
\CommentTok{\# }
\CommentTok{\# Fc =  2.061599}
\KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{p\_val = "}\NormalTok{, p\_val, }\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\CommentTok{\# }
\CommentTok{\# p\_val =  0.06654502}

\KeywordTok{anova}\NormalTok{(mod1)}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Response: RG}
\CommentTok{\#           Df  Sum Sq Mean Sq F value  Pr(\textgreater{}F)  }
\CommentTok{\# HIBRIDO    9  65.662  7.2958  2.0616 0.06655 .}
\CommentTok{\# Residuals 30 106.166  3.5389                  }
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\end{Highlighting}
\end{Shaded}

Demonstrar como o procedimento de estimação e cálculo da ANOVA serviu apenas para verificar de maneira didática como as funções no \emph{R} contornam o problema da singularidade da matriz delineamento. Conforme já relatado acima, as funções \texttt{aov()} e \texttt{lm()} podem ser utilizadas para realizar a ANOVA. Porém, nesta seção será dado enfase as funções do pacote \textbf{ExpDes.pt}, \indt{ExpDes} cujas funções possibilitam analisar dados uni e bifatoriais; este último com e sem parcelas subdivididas.

\hypertarget{delineamento-inteiramente-casualizado-dic}{%
\subsection{Delineamento inteiramente casualizado (DIC)}\label{delineamento-inteiramente-casualizado-dic}}

\hypertarget{modelo-estatuxedstico}{%
\subsubsection{Modelo estatístico}\label{modelo-estatuxedstico}}

O delineamento inteiramente casualizado (DIC) é um delineamento adequado para áreas uniformes (parcelas são uniformes), onde não há necessidade de controle local (bloqueamento). Neste delineamento, os tratamentos devem ser distribuidos aleatoriamente nas parcelas.

O modelo do DIC é dado por \indt{DIC}

\[
{Y_{ij}} = m + {t_i} + {\varepsilon _{ij}}
\]

Onde \(m\) é a média geral do experimento, \(t_i\) é o efeito de tratamentos, sendo estimado por \(\hat t_i = \bar Y_{i.} - \bar Y_{..}\) com a seguinte restrição: \(\sum_i \hat t_i = 0 ~~~~\forall_i\) (leia-se, o somatório dos efeitos de tratamento é zero para todo tratamento \emph{i}). \(\epsilon_{ij}\) é o erro experimental estimado por (\(\hat e_{ij} = Y_{ij} - m - \hat t_i\)) onde \({e_{ij}}\sim NID(0,{\sigma ^2})\).

Experimentos em DIC serão analisados utilizando da função \texttt{dic()} \indt{dic()} do pacote \emph{ExpDes.pt}. Os argumentos desta função são:

\begin{longtable}[]{@{}ll@{}}
\toprule
Argumento & Descrição\tabularnewline
\midrule
\endhead
\texttt{trat} & Objeto contendo os tratamentos\tabularnewline
\texttt{resp} & Objeto contendo a variável resposta\tabularnewline
\texttt{quali} & Se TRUE, o tratamento é qualitativo (\emph{default})\tabularnewline
\texttt{mcomp} & Indicar o teste complementar (Tukey é \emph{default})\tabularnewline
\texttt{nl} & Indica se uma regressão deve ser ajustada (FALSE é o \emph{default})\tabularnewline
\texttt{hvar} & Teste de homogeneidade da variância (Bartlett é o \emph{default})\tabularnewline
\texttt{sigT} & Significância da comparação múltipla\tabularnewline
\texttt{sigF} & Significância do teste F\tabularnewline
\bottomrule
\end{longtable}

Para maiores detalhes, ver o \href{https://cran.r-project.org/web/packages/ExpDes.pt/ExpDes.pt.pdf}{pdf do pacote}\footnote{\url{https://cran.r-project.org/web/packages/ExpDes.pt/ExpDes.pt.pdf}} ou ir em ajuda (digitar \texttt{?ExpDes.pt} no console).

\hypertarget{dic-com-fatores-qualitativos}{%
\subsubsection{DIC com fatores qualitativos}\label{dic-com-fatores-qualitativos}}

\indt{fatores qualitativos}

Os dados utilizados neste exemplo estão na planilha \texttt{QUALI} do conjunto de dados \texttt{data\_R.xlsx}. Os próximos códigos carregam o conjunto de dados e criam um gráfico do tipo boxplot para explorar o padrão dos dados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{qualitativo \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"QUALI"}\NormalTok{)}
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(qualitativo, }\KeywordTok{aes}\NormalTok{(HIBRIDO, RG))}\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_hline}\NormalTok{(}\DataTypeTok{yintercept =} \KeywordTok{mean}\NormalTok{(qualitativo}\OperatorTok{$}\NormalTok{RG), }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{)}\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_boxplot}\NormalTok{()}\OperatorTok{+}
\StringTok{      }\KeywordTok{stat\_summary}\NormalTok{(}\DataTypeTok{geom =} \StringTok{"point"}\NormalTok{, }\DataTypeTok{fun =}\NormalTok{ mean, }\DataTypeTok{shape =} \DecValTok{23}\NormalTok{)}\OperatorTok{+}
\StringTok{      }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element\_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{45}\NormalTok{, }\DataTypeTok{vjust =} \DecValTok{1}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{1}\NormalTok{))}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(qualitativo, }\KeywordTok{aes}\NormalTok{(}\KeywordTok{factor}\NormalTok{(BLOCO), RG))}\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_hline}\NormalTok{(}\DataTypeTok{yintercept =} \KeywordTok{mean}\NormalTok{(qualitativo}\OperatorTok{$}\NormalTok{RG), }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{)}\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_boxplot}\NormalTok{()}\OperatorTok{+}
\StringTok{      }\KeywordTok{stat\_summary}\NormalTok{(}\DataTypeTok{geom =} \StringTok{"point"}\NormalTok{, }\DataTypeTok{fun =}\NormalTok{ mean, }\DataTypeTok{shape =} \DecValTok{23}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-165-1} \end{center}

\indf{dic} \indf{geom\_boxplot}

Analizando o boxplot acima é razoável dizer que as médias dos tratamentos são diferentes, principalmente comparando o NUPEC\_10 com NUPEC\_1. Esta suspeita de diferença, no entanto, deve ser suportada com a realização da análise de variância. No pacote \textbf{ExpDes.pt}, quando os fatores são qualitativos, a análise complementar aplicada é a comparção de médias. A função \texttt{dic()} do pacote retorna a tabela da ANOVA, a análise de pressupostos \indt{pressupostos} (normalidade e homogeneidade) e o teste de comparação de médias.

\indt{Dicas}

\begin{dica}
As funções do pacote \textbf{ExpDes.pt} utilizam os dados ``anexados'' ao ambiente de trabalho, ou seja, um argumento \texttt{data\ =\ .} não existe para suas funções. Note que no exemplo abaixo foi utilizado a função \texttt{with(qualitativo,\ dic(...))}. Isto permite acessar variáveis presentes no data frame. Uma outra maneira de realizar esta mesma análise é utilizando a função \texttt{attach(qualitativo)}, qual carregará o data frame no ambiente R, assim é possível utilizar a função \texttt{dic(...)}. Após realizada a análise, é recomendado executar o comando \texttt{detach(qualitativo)} para ``limpar'' os dados do ambiente de trabalho.
\end{dica}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{mod3 \textless{}{-}}\StringTok{ }\KeywordTok{with}\NormalTok{(qualitativo, }\KeywordTok{dic}\NormalTok{(HIBRIDO, RG))}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Quadro da analise de variancia}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#            GL      SQ QM     Fc    Pr\textgreater{}Fc}
\CommentTok{\# Tratamento  9  65.662  3 2.0616 0.066545}
\CommentTok{\# Residuo    30 106.166  2                }
\CommentTok{\# Total      39 171.828  1                }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# CV = 23.02 \%}
\CommentTok{\# }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Teste de normalidade dos residuos }
\CommentTok{\# Valor{-}p:  3.544449e{-}05 }
\CommentTok{\# ATENCAO: a 5\% de significancia, os residuos nao podem ser considerados normais!}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Teste de homogeneidade de variancia }
\CommentTok{\# valor{-}p:  0.0006414681 }
\CommentTok{\# ATENCAO: a 5\% de significancia, as variancias nao podem ser consideradas homogeneas!}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# De acordo com o teste F, as medias nao podem ser consideradas diferentes.}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#    Niveis   Medias}
\CommentTok{\# 1    NP\_1 10.27750}
\CommentTok{\# 2   NP\_10  6.28300}
\CommentTok{\# 3    NP\_2  8.83200}
\CommentTok{\# 4    NP\_3  9.48000}
\CommentTok{\# 5    NP\_4  9.48075}
\CommentTok{\# 6    NP\_5  8.75075}
\CommentTok{\# 7    NP\_6  7.33625}
\CommentTok{\# 8    NP\_7  7.04500}
\CommentTok{\# 9    NP\_8  7.24500}
\CommentTok{\# 10   NP\_9  6.99225}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

\indf{crd}

A interpretação da significância, ou seja, se as médias de produtividade dos híbridos foram significativamente diferentes a uma determinada probabilidade de erro é feita verificando-se o valor de ``Pr\textgreater fc'' na ANOVA. A figura abaixo mostra a distribuição \emph{F} considerando os graus de liberdade de tratamento e erro \(F_{9, 30}\) e nos ajuda a compreender um pouco melhor isto. O valor de \emph{F} calculado em nosso exemplo foi de 2.0616, o que resulta em uma probabilidade de erro acumulada de 0.066545 (6,654\%). Na figura abaixo, esta probabilidade de erro acumulada está representada pela cor vermelha. Para que uma diferença significativa a 5\% de probabilidade de erro tivesse sido observada, o valor de \emph{F} calculado deveria ter sido 2.2107 {[}\texttt{qf(0.05,\ 9,\ 30,\ lower.tail\ =\ FALSE)}{]}, representado neste caso pela cor verde no gráfico.

\begin{verbatim}
# Warning: `expand_scale()` is deprecated; use `expansion()` instead.
\end{verbatim}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-168-1} \end{center}

Em sequência a ANOVA, a função retorna o resultado da análise complementar solicitada. Neste exemplo, o teste de Tukey (5\% de erro) é utilizado. Este teste realiza todas as combinações possíveis entre as médias (por isso o nome comparação múltipla de medias), comparando se a diferença entre duas médias é maior ou menor que uma diferença mínima significativa (DMS). Esta DMS é calculada pela seguinte fórmula \(DMS = q \times \sqrt{QME/r}\), onde \emph{q} é um valor tabelado, considerando o número de tratamentos e o GL do erro; \emph{QME} é o quadrado médio do erro; e \emph{r} é o número de repetições (ou blocos). O valor de \emph{q} pode ser encontrado no apêndice 1. Para este caso, considerando 10 e 30 como o número de tratamentos e o GL do erro, respectivamente, o valor de q é 5,76, que aplicado na fórmula resulta em \(DMS = 5,76 \times \sqrt{3.5389/4}=5.417\). Logo, a diferença mínima entre duas médias para que estas sejam significativamente diferentes (5\% de erro), deve ser de 5,417 toneladas. Como a diferença entre a maior média (NUPEC\_01) e a menor média (NUPEC\_10), foi de 3,994 toneladas, a média de todos os tratamentos foram consideradas iguais.

Considerando nosso exemplo, parece razoável dizer que 10,27 t é uma produção maior que 6,28 t. Então, é justo perguntar: O que pode ter acontecido para que as médias não tenham sido consideradas diferentes considerando a probabilidade de erro, mesmo tendo fortes indícios de que elas seriam? A primeira opção que nos vem a mente --e que na maioria das vezes é encontrada em artigos científicos-- é que as alterações no rendimento de grão observadas fora resultado do acaso; ou seja, neste caso, há a probabilidade de 6,65\% de que uma diferença pelo menos tão grande quanto a observada no estudo possa ser gerada a partir de amostras aleatórias se os tratamentos não aferatem a variável resposta. Logo, a \textbf{recomendação estatística} neste caso, seria por optar por qualquer um dos tratamentos. Do ponto de vista prático, sabemos que esta recomendação está totalmente equivocada. Neste ponto surge uma importante (e polêmica) questão: a interpretação do \emph{p}-valor. Um \emph{p}-valor de 0,05 não significa que há uma chance de 95\% de que determinada hipótese esteja correta. Em vez disso, significa que se a hipótese nula for verdadeira e todas as outras suposições feitas forem válidas, haverá 5\% de chance que diferenças ao menos tão grandes quanto as observadas podem ser obtidas de amostras aleatórias. É preciso ter em mente que o \emph{p}-valor relatado pelos testes é um significado probabilístico, não biológico. Assim, em experimentos biológicos a interpretação desta estatística deve ser cautelosa, pois um \emph{p}-valor não pode indicar a importância de uma descoberta. Por exemplo, um medicamento pode ter um efeito estatisticamente significativo nos níveis de glicose no sangue dos pacientes sem ter um efeito terapêutico. Sugerimos a leitura de cinco interessantes artigos relacionados a este assunto (Altman and Krzywinski \protect\hyperlink{ref-Altman2017}{2017}; Baker \protect\hyperlink{ref-Baker2016}{2016}; Chawla \protect\hyperlink{ref-Chawla2017}{2017}; Krzywinski and Altman \protect\hyperlink{ref-Krzywinski2013}{2013}; Nuzzo \protect\hyperlink{ref-Nuzzo2014}{2014}).

\indt{Curiosidade}
\begin{vcsabia}
A fórmula da DMS descrita acima é utilizada apenas se (e somente se) o número de repetições de todos os tratamentos é igual. Caso algum tratamento apresente um número inferir de repetições, fato comumente observado em experimentos de campo devido a presença de parcelas perdidas, a DMS deste par de médias em específico deve ser corrigida. Geralmente, as análises complementares são realizadas quando a ANOVA indica significância para um determinado fator de variação, no entanto, o teste Tukey pode revelar diferença entre as médias, mesmo quando o teste F não indicar essa diferença. Isto pode ser observado, principalmente quando a probabilidade de erro for muito próxima de 5\%, por exemplo, Pr\textgreater Fc = 0.0502. A recíproca também é verdadeira. O teste Tukey pode indicar que as médias não diferem, se Pr\textgreater Fc = 0.0492, por exemplo.
\end{vcsabia}

Em adição à justificativa anterior (as alterações no rendimento de grão observadas fora resultado do acaso), existem pelo menos mais três razões potenciais para a não regeição da hipótese \(H_0\) em nosso exemplo: (i) um experimento mal projetado com poder insuficiente para detectar uma diferença (à 5\% de erro) entre as médias; (ii) os tratamentos foram mal escolhidos e não refletiram adequadamente a hipótese inicial do estudo; ou (iii) o experimento foi indevidamente instalado e conduzido sem supervisão adequada, com baixo controle de qualidade sobre os protocolos de tratamento, coleta e análise de dados. Esta última opção parece ser a mais razoável aqui. É possivel observar no boxplot para o fator bloco que o bloco 4 parece ter uma média superior aos outros blocos. Sabe-ser que no DIC, toda diferença entre as repetições de um mesmo tratamento comporão o erro experimental. Logo, neste exemplo, a área experimental não era homogênea como se pressupunha na instalação do experimento. Isto ficará claro, posteriormente, ao analisarmos o mesmo conjunto de dados, no entanto considerando um \hypertarget{DICQUALI}{\hyperlink{DBCQUALI}{delineamento de blocos casualizados}}.

É possível extrair os erros através de \texttt{mod3\$residuos}. Também é possível fazer diagnóstico dos pressupostos do modelo estatístico através de gráficos utilizando a função \texttt{plotres()}: \indf{plotres}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plotres}\NormalTok{(mod3)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-170-1} 

}

\caption{Gráfico de resíduos gerado pela função plotres()}\label{fig:unnamed-chunk-170}
\end{figure}

O \emph{p}-valor do teste de Shapiro-Wilk indicou que os resíduos \indt{resíduos} não seguem uma seguem uma distribuição normal, o que pode ser confirmado pelo QQ-Plot. O argumento \texttt{hvar\ =\ "levene"} na função é utilizado para testar a homogeneidade dos resíduos. De acordo com o resultado do teste, os resíduos podem ser considerados homogêneos.

\indf{crd}
\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 7}

\begin{itemize}
\tightlist
\item
  Utilize os pacotes \textbf{dplyr} e \textbf{ggplot2} para confeccionar um gráfico de barras onde o eixo y é representado pelos híbridos e o eixo x pelo rendimento de grãos.
\item
  Adicione uma linha vertical tracejada mostrando a média global do experimento.
\item
  Adicione a letra ``a'' em todas as barras para identificar a não diferença entre as médias.
\end{itemize}
\end{tarefa}

\protect\hyperlink{exerc7}{Resposta}

\hypertarget{dic-com-fatores-quantitativos}{%
\subsubsection{DIC com fatores quantitativos}\label{dic-com-fatores-quantitativos}}

\indt{fatores quantitativos}

Vimos anteriormente que os fatores qualitativos são comparados através de comparações de médias. No caso de fatores quantitativos, o comum é utilizar regressões como análise complementar. Neste tipo de análise a \(SQ_{Trat}\) é decomposta, e cada polinômio explicará parte desta soma de quadrados. O maior grau significativo do polinômio determinará qual a regressão escolhida. Para implementar essa análise, utilizando a função \texttt{dic()}, basta indicar como \texttt{FALSE} no argumentos \texttt{quali}. O arquivo de dados ``QUALITATIVO.xlsx'' contém três exemplos, com comportamento linear, quadrático e cúbico. Utilizando o que aprendemos no \texttt{ggplot2} até agora, vamos criar um gráfico para visualisar estes dados. \indf{ggplot} \indf{geom\_point} \indf{geom\_smooth}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{quantitativo\_todos \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"QUANTI"}\NormalTok{)}
\KeywordTok{ggplot}\NormalTok{(quantitativo\_todos, }\KeywordTok{aes}\NormalTok{(DOSEN, RG, }\DataTypeTok{col =}\NormalTok{ TIPO)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_smooth}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-172-1} 

}

\caption{Exemplo de regressão com comportamento linear, quadrático e cúbico}\label{fig:unnamed-chunk-172}
\end{figure}

Como exemplo didático, vamos analisar os dados que parecem ter comportamento quadrático para ver se, estatisticamente, isto é confirmado. Para isto, utilizamos a função \texttt{subset()} \indf{subset} para criar um novo conjunto de dados que contenha somente o nível ``QUADRÁTICA'' dos nosso dados originais. Para evitar uma longa saída, os resultados desta seção em específico não foram mostrados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quantitativo \textless{}{-}}\StringTok{ }\KeywordTok{filter}\NormalTok{(quantitativo\_todos, TIPO  }\OperatorTok{==}\StringTok{  "QUADRÁTICA"}\NormalTok{)}
\NormalTok{crd\_Reg \textless{}{-}}\StringTok{ }\KeywordTok{with}\NormalTok{(quantitativo, }\KeywordTok{dic}\NormalTok{(DOSEN, RG, }\DataTypeTok{quali =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{hvar =} \StringTok{"levene"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Abaixo vamos reproduzir o exemplo para os usuários das funções \texttt{aov()} ou \texttt{lm()}.
\indf{aov} \indf{lm}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Reg \textless{}{-}}\StringTok{ }\NormalTok{quantitativo}
\NormalTok{Total \textless{}{-}}\StringTok{ }\KeywordTok{aov}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }\DataTypeTok{data =}\NormalTok{ Reg)}
\NormalTok{Saturado \textless{}{-}}\StringTok{ }\KeywordTok{aov}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{ }\KeywordTok{factor}\NormalTok{(DOSEN), }\DataTypeTok{data =}\NormalTok{ Reg)}
\NormalTok{Linear \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{DOSEN, }\DataTypeTok{data =}\NormalTok{ Reg)}
\NormalTok{Quadratica \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{ }\KeywordTok{poly}\NormalTok{(DOSEN, }\DecValTok{2}\NormalTok{, }\DataTypeTok{raw =} \OtherTok{TRUE}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ Reg)}
\NormalTok{Cubica \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{ }\KeywordTok{poly}\NormalTok{(DOSEN, }\DecValTok{3}\NormalTok{, }\DataTypeTok{raw =} \OtherTok{TRUE}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ Reg)}
\KeywordTok{anova}\NormalTok{(Total, Linear, Quadratica, Cubica, Saturado) }
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: RG \textasciitilde{} 1}
\CommentTok{\# Model 2: RG \textasciitilde{} DOSEN}
\CommentTok{\# Model 3: RG \textasciitilde{} poly(DOSEN, 2, raw = TRUE)}
\CommentTok{\# Model 4: RG \textasciitilde{} poly(DOSEN, 3, raw = TRUE)}
\CommentTok{\# Model 5: RG \textasciitilde{} factor(DOSEN)}
\CommentTok{\#   Res.Df    RSS Df Sum of Sq       F    Pr(\textgreater{}F)    }
\CommentTok{\# 1     19 3.4242                                   }
\CommentTok{\# 2     18 2.7430  1   0.68121 20.3242 0.0004164 ***}
\CommentTok{\# 3     17 0.5862  1   2.15679 64.3488 8.327e{-}07 ***}
\CommentTok{\# 4     16 0.5861  1   0.00009  0.0027 0.9593568    }
\CommentTok{\# 5     15 0.5028  1   0.08332  2.4858 0.1357289    }
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\end{Highlighting}
\end{Shaded}

O polinômio \indt{polinômio} de segundo grau deve ser o escolhido, pois ele foi o maior grau significativo (\emph{p}-valor menor que 0,05). Os desvios da regressão nada mais são do que a \emph{FALTA DE AJUSTE} \indt{falta de ajuste} dos modelos. Porém, como é comum em ciências agrárias, ajusta-se apenas polinômios até a terceira ordem, devido a dificuldade de interpretção de polinômios com ordens superiores. É importante ressaltar que aqui estamos falando de \textbf{regressões polinomiais}. Como será visto posteriormente, a falta de ajuste é inaceitável para modelos de regressão múltipla. O valor de \(R^2\) é dado pela razão entre a \(SQ_{Regressão}\) e a \(SQ_{Tratamento}\). No exemplo acima, o \(R^2\) da regressão quadrática (selecionada) é:

\[
{R^2} = \frac{{S{Q_{{\rm{Regressão}}}}}}{{S{Q_{{\rm{Tratamento}}}}}} = \frac{{2,4900 + 1,5465}}{{4,0505}} = 0.9965
\]

Percebe-se claramente pelos resultados acima que a significância do grau do polinômio está diretamente relacionado com quanto ele ``contribui'' para explicar a \(SQ_{Trat}\).
A forma mais prática de analisar uma regressão é através de gráficos. A função \texttt{dic()} fornece essa alternativa, através da função \texttt{graphics()}.\indt{graphics()} Nesta função existe dois argumentos obrigatórios: \texttt{a}, onde indicamos o objeto que contém a saída da análise do experimento e \texttt{grau}, onde indicamos o grau do polinômio.

\textbf{Gráfico de resultados: uma proposta}

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{ggplot}\NormalTok{(quantitativo, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ DOSEN, }\DataTypeTok{y =}\NormalTok{ RG))}\OperatorTok{+}\StringTok{ }\CommentTok{\# Indicar dados e variáveis}
\KeywordTok{geom\_point}\NormalTok{(}\DataTypeTok{color =} \StringTok{"blue"}\NormalTok{, }\DataTypeTok{size =} \DecValTok{2}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{\# Adiociona e edita os pontos}
\KeywordTok{geom\_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
            \DataTypeTok{formula =}\NormalTok{ y }\OperatorTok{\textasciitilde{}}\StringTok{ }\KeywordTok{poly}\NormalTok{(x, }\DecValTok{2}\NormalTok{, }\DataTypeTok{raw =} \OtherTok{TRUE}\NormalTok{),}
            \DataTypeTok{color =} \StringTok{"red"}\NormalTok{,}
            \DataTypeTok{fill =} \StringTok{"grey"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-175-1} 

}

\caption{Gráfico de linhas gerado pela função ggplot()}\label{fig:unnamed-chunk-175}
\end{figure}

\indf{ggplot} \indf{geom\_point} \indf{geom\_smooth}
Este é um exemplo simples de uso da função \texttt{ggplot()}. Porém, como visto até aqui, esta função (mesmo em aplicações simples) tem suas complexidades. Pensando nisso, o pacote \href{https://tiagoolivoto.github.io/metan/}{metan}\footnote{\url{https://tiagoolivoto.github.io/metan/}} foi desenvolvido e contém funções úteis que facilitam a confeção de gráficos. A partir dos experimentos fatoriais, apenas as funções deste pacote serão utilizados para a confecção dos gráficos.

\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 8}

\begin{itemize}
\tightlist
\item
  Utilize a função \texttt{plot\_lines()} do pacote \texttt{metan}** para confeccionar um gráfico semelhante ao anterior. Para maiores detalhes veja \texttt{?metan::plot\_lines}.
\end{itemize}
\end{tarefa}

\protect\hyperlink{exerc8}{Resposta}

\indf{plot\_lines}

\hypertarget{delineamento-blocos-ao-acaso-dbc}{%
\subsection{Delineamento blocos ao acaso (DBC)}\label{delineamento-blocos-ao-acaso-dbc}}

\indt{DBC}

No delineamento de blocos ao acaso uma restrição \indt{restrição} na casualisação é imposta visando agrupar unidades experimentais uniformes dentro de um bloco, de maneira que a heterogeneidade da área experimental fique entre os blocos. O bloquemento tem como objetivo reduzir o erro experimental, \emph{``transferindo''} parte do erro experimental para efeito de bloco. O modelo do DBC é dado por

\[
{Y_{ij}} = m + {b_j} + {t_i} + {\varepsilon _{ij}}
\]

Onde \(m\) é a média geral do experimento, \(b_j\) é o efeito de bloco, \(t_i\) é o efeito de tratamentos e \(\epsilon_{ij}\) é o erro experimental. No pacote \emph{ExpDes.pt}, este delineamento é executado pela função \texttt{dbc()}. Os argumentos desta função são:

\begin{longtable}[]{@{}ll@{}}
\toprule
Argumento & Descrição\tabularnewline
\midrule
\endhead
\texttt{trat} & Objeto contendo os tratamentos\tabularnewline
\texttt{bloco} & Objeto contendo os blocos\tabularnewline
\texttt{resp} & Objeto contendo a variável resposta\tabularnewline
\texttt{quali} & Se TRUE, o tratamento é qualitativo (\emph{default})\tabularnewline
\texttt{mcomp} & Indicar o teste complementar (Tukey é \emph{default})\tabularnewline
\texttt{nl} & Indica se uma regressão deve ser ajustada (FALSE é o \emph{default})\tabularnewline
\texttt{hvar} & Teste de homogeneidade da variância (ONeill e Mathews é o \emph{default})\tabularnewline
\texttt{sigT} & Significância da comparação múltipla (\emph{default} 0,05)\tabularnewline
\texttt{sigF} & Significância do teste F (\emph{default} 0,05)\tabularnewline
\bottomrule
\end{longtable}

Percebe-se que apenas um argumento foi adicionado a função: \texttt{bloco}.

\hypertarget{dbc-com-fatores-qualitativos}{%
\subsubsection{DBC com fatores qualitativos}\label{dbc-com-fatores-qualitativos}}

Neste exemplo, vamos realizar a ANOVA com os mesmos dados do exemplo \hypertarget{DBCQUALI}{\hyperlink{DICQUALI}{DIC com fatores qualitativos}}, agrupando as médias pelo teste Scott-Knott utilizando o argumento \texttt{mcomp\ =\ "sk"}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod4 \textless{}{-}}\StringTok{ }\KeywordTok{with}\NormalTok{(qualitativo, }\KeywordTok{dbc}\NormalTok{(HIBRIDO, BLOCO, RG, }\DataTypeTok{mcomp =} \StringTok{"sk"}\NormalTok{))}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Quadro da analise de variancia}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#            GL      SQ QM     Fc      Pr\textgreater{}Fc}
\CommentTok{\# Tratamento  9  65.662  4 18.716 2.0298e{-}09}
\CommentTok{\# Bloco       3  95.642  3 81.785 1.1000e{-}13}
\CommentTok{\# Residuo    27  10.525  2                  }
\CommentTok{\# Total      39 171.828  1                  }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# CV = 7.64 \%}
\CommentTok{\# }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Teste de normalidade dos residuos }
\CommentTok{\# valor{-}p:  0.6834664 }
\CommentTok{\# De acordo com o teste de Shapiro{-}Wilk a 5\% de significancia, os residuos podem ser considerados normais.}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Teste de homogeneidade de variancia }
\CommentTok{\# valor{-}p:  0.2599294 }
\CommentTok{\# De acordo com o teste de oneillmathews a 5\% de significancia, as variancias podem ser consideradas homogeneas.}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# Teste de Scott{-}Knott}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#    Grupos Tratamentos   Medias}
\CommentTok{\# 1       a        NP\_1 10.27750}
\CommentTok{\# 2       a        NP\_4  9.48075}
\CommentTok{\# 3       a        NP\_3  9.48000}
\CommentTok{\# 4       b        NP\_2  8.83200}
\CommentTok{\# 5       b        NP\_5  8.75075}
\CommentTok{\# 6       c        NP\_6  7.33625}
\CommentTok{\# 7       c        NP\_8  7.24500}
\CommentTok{\# 8       c        NP\_7  7.04500}
\CommentTok{\# 9       c        NP\_9  6.99225}
\CommentTok{\# 10      c       NP\_10  6.28300}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

\indf{dbc}

Considerando o bloco como um fator de variação no experimento, pode-se afirmar que a média de produtividade difere entre os híbridos testados. Como o efeito de bloco foi significativo Pr\textgreater Fc \textless{} 0.05, conclui-se que a escolha pelo delineamento em blocos casualizados foi correta, e, principalmente, que a disposição dos blocos na área experimental possibilitou lograr a heterogeneidade entre os blocos, deixando a homogeneidade dentro de cada bloco. O Fc para o fator de tratamento ``HÍBRIDOS'' foi de 18.716, qual acumula uma probabilidade de erro de somente 0.0000002029.

Incluindo o bloco como fonte de variação nota-se que 3 graus de liberdade (GL) que antes compunham o erro ``saíram'' e passaram a compor o GL do bloco. Assim, neste exemplo, o GL do erro foi de 27. No entanto, uma grande parte da soma de quadrados do erro (aproximadamente 90\%) observada no delineamento DIC era oriunda do efeito de bloco. Com isto, a soma de quadrado do erro considerando o delineamento DBC foi de apenas 10.525 e, mesmo com a ``perda'' de 3 GL para compor o bloco, o quadrado médio do erro foi de somente 0.390 (89\% menor quando comparado com o delineamento DIC). Consequentemente o valor do F calculado para o fator HÍBRIDO foi significativo. Cabe ressaltar que a soma de quadrados para o fator de variação HÍBRIDO não muda se o delineamento for DIC ou DBC.

Uma sugestão para apresentação dos dados é a confecção de um gráfico de barras. Para isto, utilizaremos a função \texttt{plot\_bars()} do pacote \texttt{metan}. Utilizando o argumento \texttt{lab.bars} é possível adicionar as letras do teste SK. Por padrão, barras de erro mostrando o erro padrão da média são adicionadas. Para suprimir estas barras use \texttt{errorbar\ =\ FALSE}. É possível também adicionar os valores às barras usando \texttt{values\ =\ TRUE}, ordenar em ordem crescente ou decrescente, bem como modificar a cor e preenchimento das barras facilmente

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{plot\_bars}\NormalTok{(qualitativo, }\DataTypeTok{x =}\NormalTok{ HIBRIDO, }\DataTypeTok{y =}\NormalTok{ RG)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{plot\_bars}\NormalTok{(qualitativo,}
                \DataTypeTok{x =}\NormalTok{ HIBRIDO,}
                \DataTypeTok{y =}\NormalTok{ RG,}
                \DataTypeTok{lab.bar =} \KeywordTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"c"}\NormalTok{),}
                \DataTypeTok{order =} \StringTok{"desc"}\NormalTok{,}
                \DataTypeTok{errorbar =} \OtherTok{FALSE}\NormalTok{,}
                \DataTypeTok{values =} \OtherTok{TRUE}\NormalTok{,}
                \DataTypeTok{n.dodge =} \DecValTok{2}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"p1"}\NormalTok{, }\StringTok{"p2"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-178-1} \end{center}

\hypertarget{dbc-com-fatores-quantitativos}{%
\subsubsection{DBC com fatores quantitativos}\label{dbc-com-fatores-quantitativos}}

Para realizar a análise de regressão considerando um delineamento DBC basta utilizar a função \texttt{dbc()} \indf{rbd} incluindo o seguinte argumento \texttt{quali\ =\ FALSE}.

\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 9}

\begin{itemize}
\item
  Rode a programação para os dados quantitativos considerando o delineamento DBC e compare os resultados com aquela obtida pela função \texttt{dic()} para os mesmos dados.
\item
  As estimativas dos parâmetros da regressão são as mesmas?
\item
  O \emph{p}-valor para o testes de hipótese para efeito de tratamento é o mesmo?
\end{itemize}
\end{tarefa}

\protect\hyperlink{exerc9}{Resposta}

\hypertarget{anuxe1lise-de-experimentos-utilizando-modelos-mistos}{%
\subsubsection{Análise de experimentos utilizando modelos mistos}\label{anuxe1lise-de-experimentos-utilizando-modelos-mistos}}

A função \texttt{gamem()} do pacote \texttt{metan} pode ser utilizada para analizar dados de experimentos unifatoriais utilizando um modelo misto de acordo com a seguinte equação:

\[
y_{ij}= \mu  + \alpha_i + \tau_j + \varepsilon_{ij}
\]

onde \(y_ {ij}\) é o valor observado para o \emph{i}-ésimo genótipo na \emph{j}-ésima repetição (\emph{i} = 1, 2, \ldots{} \emph{g}; \emph{j} = 1, 2,. ., \emph{r}); sendo \emph{g} e \emph{r} o número de genótipos e repetições, respectivamente; \(\alpha_i\) é o efeito aleatório do \emph{i}-ésimo genótipo; \(\tau_j\) é o efeito fixo da \emph{j}-ésima repetição; e \(\varepsilon_ {ij}\) é o erro aleatório associado a \(y_{ij}\). Neste exemplo, usaremos os dados de exemplo \texttt{data\_g} do pacote metan.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gen\_mod \textless{}{-}}\StringTok{ }\KeywordTok{gamem}\NormalTok{(data\_g, GEN, REP,}
                 \DataTypeTok{resp =} \KeywordTok{c}\NormalTok{(ED, CL, CD, KW, TKW, NKR))}
\CommentTok{\# Method: REML/BLUP}
\CommentTok{\# Random effects: GEN}
\CommentTok{\# Fixed effects: REP}
\CommentTok{\# Denominador DF: Satterthwaite\textquotesingle{}s method}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# P{-}values for Likelihood Ratio Test of the analyzed traits}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#     model       ED       CL    CD     KW     TKW   NKR}
\CommentTok{\#  Complete       NA       NA    NA     NA      NA    NA}
\CommentTok{\#  Genotype 2.73e{-}05 2.25e{-}06 0.118 0.0253 0.00955 0.216}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Variables with nonsignificant Genotype effect}
\CommentTok{\# CD NKR }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

A maneira mais fácil de obter os resultados do modelo acima é usando a função \texttt{get\_model\_data()}. Vamos fazer isso.

\begin{itemize}
\tightlist
\item
  Teste de razão de máxima verossimilhança
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{get\_model\_data}\NormalTok{(gen\_mod, }\StringTok{"lrt"}\NormalTok{)}
\CommentTok{\# Class of the model: gamem}
\CommentTok{\# Variable extracted: lrt}
\CommentTok{\# \# A tibble: 6 x 8}
\CommentTok{\#   VAR   model     npar logLik   AIC   LRT    Df \textasciigrave{}Pr(\textgreater{}Chisq)\textasciigrave{}}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{}    \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}        \textless{}dbl\textgreater{}}
\CommentTok{\# 1 ED    Genotype     4  {-}91.9  192. 17.6      1   0.0000273 }
\CommentTok{\# 2 CL    Genotype     4  {-}86.2  180. 22.4      1   0.00000225}
\CommentTok{\# 3 CD    Genotype     4  {-}52.5  113.  2.45     1   0.118     }
\CommentTok{\# 4 KW    Genotype     4 {-}165.   339.  5.00     1   0.0253    }
\CommentTok{\# 5 TKW   Genotype     4 {-}190.   389.  6.72     1   0.00955   }
\CommentTok{\# 6 NKR   Genotype     4  {-}96.3  201.  1.53     1   0.216}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Componentes de variância
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{get\_model\_data}\NormalTok{(gen\_mod, }\StringTok{"genpar"}\NormalTok{)}
\CommentTok{\# Class of the model: gamem}
\CommentTok{\# Variable extracted: genpar}
\CommentTok{\# \# A tibble: 11 x 7}
\CommentTok{\#    Parameters     ED     CL     CD      KW      TKW    NKR}
\CommentTok{\#    \textless{}chr\textgreater{}       \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}    \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}}
\CommentTok{\#  1 Gen\_var     5.37   4.27   0.240 181.     841.     2.15 }
\CommentTok{\#  2 Gen (\%)    68.8   75.1   27.4    39.2     45.2   21.6  }
\CommentTok{\#  3 Res\_var     2.43   1.41   0.634 280.    1018.     7.80 }
\CommentTok{\#  4 Res (\%)    31.2   24.9   72.6    60.8     54.8   78.4  }
\CommentTok{\#  5 Phen\_var    7.80   5.68   0.873 461.    1859.     9.94 }
\CommentTok{\#  6 H2          0.688  0.751  0.274   0.392    0.452  0.216}
\CommentTok{\#  7 h2mg        0.869  0.901  0.532   0.659    0.712  0.452}
\CommentTok{\#  8 Accuracy    0.932  0.949  0.729   0.812    0.844  0.673}
\CommentTok{\#  9 CVg         4.84   7.26   3.10    9.16     9.13   4.82 }
\CommentTok{\# 10 CVr         3.26   4.18   5.05   11.4     10.0    9.19 }
\CommentTok{\# 11 CV ratio    1.49   1.74   0.615   0.803    0.909  0.525}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Médias preditas
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{get\_model\_data}\NormalTok{(gen\_mod, }\StringTok{"blupg"}\NormalTok{)}
\CommentTok{\# Class of the model: gamem}
\CommentTok{\# Variable extracted: blupg}
\CommentTok{\# \# A tibble: 13 x 7}
\CommentTok{\#    GEN      ED    CL    CD    KW   TKW   NKR}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 H1     50.2  30.7  15.8  153.  354.  29.5}
\CommentTok{\#  2 H10    44.4  25.1  15.5  129.  268.  31.7}
\CommentTok{\#  3 H11    47.2  26.6  15.6  143.  297.  31.3}
\CommentTok{\#  4 H12    47.8  26.1  15.2  148.  293.  30.0}
\CommentTok{\#  5 H13    50.3  27.4  15.9  170.  319.  31.2}
\CommentTok{\#  6 H2     50.3  30.0  16.3  156.  338.  29.6}
\CommentTok{\#  7 H3     47.2  28.6  16.1  142.  331.  30.2}
\CommentTok{\#  8 H4     46.1  27.8  16.2  145.  310.  31.8}
\CommentTok{\#  9 H5     49.8  30.1  16.2  156.  309.  31.3}
\CommentTok{\# 10 H6     49.7  31.6  15.2  140.  325.  28.6}
\CommentTok{\# 11 H7     48.7  30.0  15.5  153.  346.  30.0}
\CommentTok{\# 12 H8     46.3  29.0  15.8  143.  339.  29.5}
\CommentTok{\# 13 H9     44.4  27.0  15.8  131.  301.  30.4}
\end{Highlighting}
\end{Shaded}

No exemplo acima, o design experimental foi o de blocos completos casualizados. Também é possível analisar um experimento conduzido em alfa-lattice com a função \texttt{gamem()}, baseado na seguinte equação:

\begin{gather}
y_{ijk}= \mu  + \alpha_i + \gamma_j + (\gamma \tau)_{jk} + \varepsilon_{ijk}
\end{gather}

onde \(y_ {ijk}\) é o valor observado do \emph{i}-ésimo genótipo no \emph{k}-ésimo bloco da \emph{j}- ésima repetição (\emph{i} = 1, 2, \ldots{} \emph{g}; \emph{j} = 1, 2, .., \emph{r}; \emph{k} = 1, 2, .., \emph{b}); respectivamente; \(\alpha_i\) é o efeito aleatório do \emph{i}-ésimo genótipo; \(\gamma_j\) é o efeito fixo da \emph{j}-ésima repetição; \((\gamma \tau)_{jk}\) é o efeito aleatório do \emph{k}-ésimo bloco incompleto aninhado na repetição \emph{j}; e \(\varepsilon_{ijk}\) é o erro aleatório associado a \(y_{ijk}\). Neste exemplo, usaremos os dados de exemplo \texttt{data\_alpha} do pacote metan.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gen\_alpha \textless{}{-}}\StringTok{ }\KeywordTok{gamem}\NormalTok{(data\_alpha, GEN, REP, YIELD, }\DataTypeTok{block =}\NormalTok{ BLOCK)}
\CommentTok{\# Method: REML/BLUP}
\CommentTok{\# Random effects: GEN, BLOCK(REP)}
\CommentTok{\# Fixed effects: REP}
\CommentTok{\# Denominador DF: Satterthwaite\textquotesingle{}s method}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# P{-}values for Likelihood Ratio Test of the analyzed traits}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#      model    YIELD}
\CommentTok{\#   Complete       NA}
\CommentTok{\#   Genotype 1.18e{-}06}
\CommentTok{\#  rep:block 3.35e{-}03}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# All variables with significant (p \textless{} 0.05) genotype effect}
\KeywordTok{get\_model\_data}\NormalTok{(gen\_alpha, }\StringTok{"lrt"}\NormalTok{)}
\CommentTok{\# Class of the model: gamem}
\CommentTok{\# Variable extracted: lrt}
\CommentTok{\# \# A tibble: 2 x 8}
\CommentTok{\#   VAR   model      npar logLik   AIC   LRT    Df \textasciigrave{}Pr(\textgreater{}Chisq)\textasciigrave{}}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{}     \textless{}int\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}        \textless{}dbl\textgreater{}}
\CommentTok{\# 1 YIELD Genotype      5  {-}58.4  127. 23.6      1   0.00000118}
\CommentTok{\# 2 YIELD rep:block     5  {-}50.9  112.  8.61     1   0.00335}
\KeywordTok{get\_model\_data}\NormalTok{(gen\_alpha, }\StringTok{"details"}\NormalTok{)}
\CommentTok{\# Class of the model: gamem}
\CommentTok{\# Variable extracted: details}
\CommentTok{\# \# A tibble: 6 x 2}
\CommentTok{\#   Parameters YIELD                   }
\CommentTok{\#   \textless{}chr\textgreater{}      \textless{}chr\textgreater{}                   }
\CommentTok{\# 1 Ngen       24                      }
\CommentTok{\# 2 OVmean     4.4795                  }
\CommentTok{\# 3 Min        2.8873 (G03 in B6 of R3)}
\CommentTok{\# 4 Max        5.8757 (G05 in B1 of R1)}
\CommentTok{\# 5 MinGEN     3.3431 (G03)            }
\CommentTok{\# 6 MaxGEN     5.1625 (G01)}
\KeywordTok{get\_model\_data}\NormalTok{(gen\_alpha, }\StringTok{"genpar"}\NormalTok{)}
\CommentTok{\# Class of the model: gamem}
\CommentTok{\# Variable extracted: genpar}
\CommentTok{\# \# A tibble: 13 x 2}
\CommentTok{\#    Parameters      YIELD}
\CommentTok{\#    \textless{}chr\textgreater{}           \textless{}dbl\textgreater{}}
\CommentTok{\#  1 Gen\_var        0.143 }
\CommentTok{\#  2 Gen (\%)       48.5   }
\CommentTok{\#  3 rep:block\_var  0.0702}
\CommentTok{\#  4 rep:block (\%) 23.8   }
\CommentTok{\#  5 Res\_var        0.0816}
\CommentTok{\#  6 Res (\%)       27.7   }
\CommentTok{\#  7 Phen\_var       0.295 }
\CommentTok{\#  8 H2             0.485 }
\CommentTok{\#  9 h2mg           0.798 }
\CommentTok{\# 10 Accuracy       0.893 }
\CommentTok{\# 11 CVg            8.44  }
\CommentTok{\# 12 CVr            6.38  }
\CommentTok{\# 13 CV ratio       1.32}
\end{Highlighting}
\end{Shaded}

\hypertarget{transformauxe7uxe3o-de-dados}{%
\section{Transformação de dados}\label{transformauxe7uxe3o-de-dados}}

\indt{transformação de dados}

Em todos os exemplos apresentados até aqui, os resíduos \indt{resíduos} devem cumprir os seguintes pressupsotos: normalidade, homocedasticidade e independência:

\[
{\boldsymbol{\varepsilon }} \sim {\rm N}\left( {0,{\boldsymbol{I}}{\sigma ^2}} \right)
\]

Esses pressupostos \indt{pressupostos} são necessários para que o teste F seja utilizado na análise de variância. Sob normalidade \indt{normalidade} dos resíduos e hipótese nula \(H_0\), a razão entre as somas de quadrado de tratamento e resíduo tem distribuição F (Rencher and Schaalje \protect\hyperlink{ref-Rencher2008}{2008}). Já em condições de não normalidade dos resíduos, o poder do teste \indt{poder do teste} (probabilidade de rejeitar \(H_0\)) é reduzido. Apesar disso, não há grandes mudanças no erro tipo I quando a pressuposição de normalidade é violada (Senoglu and Tiku \protect\hyperlink{ref-Senoglu2001}{2001}), e por isso ele é considerado robusto.

Apesar do teste F de ser robusto a desvios da normalidade, é comum que ela seja cumprida para que o teste seja aplicado. Quando as pressuposições \indt{pressuposições} não são cumpridas, um dos procedimentos mais comum é transformar os dados. A transformação Box-Cox (Box and Cox \protect\hyperlink{ref-Box1964}{1964}) \indt{Box-Cox} é uma das mais comuns. Ela consiste em transformar os valores de \(Y_i\) por \(Y_i(\lambda)\), sendo o valor de \(\lambda\) estimado por máxima verossimilhança. Após a transformação de \(Y_i\) por \(Y_i(\lambda)\) os dados seguem distribuição normal com variância constante.

A função \texttt{boxcox()} \indf{boxcox}, do pacote \emph{MASS}, pode ser utilizada para estimar o valor de \(\lambda\). Uma sequência de valores de \(\lambda\) são estimados, e o escolhido é aquele que maximiza a função de log-verossimilhança. No modelo considerando o delineamento inteiramente casualizado (qualitativo), o pressuposto \indt{pressupostos} de normalidade foi violado. O próximo passo é encontrar o valor de \(\lambda\) para transformar a variáveis, utilizando para isso a função \texttt{boxcox()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MASS}\OperatorTok{::}\KeywordTok{boxcox}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{HIBRIDO, }\DataTypeTok{data =}\NormalTok{ qualitativo,}
             \DataTypeTok{lambda =} \KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length =} \DecValTok{20}\NormalTok{)) }\CommentTok{\# Indica os valores de lambda }
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-185-1} 

}

\caption{Gráfico gerado pela função boxcox() para identificar o valor de lambda}\label{fig:unnamed-chunk-185}
\end{figure}
\indf{boxcox}

Percebe-se que o intervalo de \(\lambda\) cruza pelo valor zero, indicando que a transformação \emph{log} é a mais adequada. Uma forma mais prática de encontrar o valor de \(\lambda\) que maximiza a função de log-verossimilhança \indt{log-verossimilhança} é utilizar a função \texttt{locator()} \indf{locator}. Após executar a função abaixo, basta clicar com o cursor sobre o ponto que maximiza a função para que as coordenadas sejam mostradas no console.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{locator}\NormalTok{(}\DataTypeTok{n =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{mod5}\FloatTok{.1}\NormalTok{  =}\StringTok{ }\KeywordTok{with}\NormalTok{(qualitativo, }\KeywordTok{dic}\NormalTok{(HIBRIDO, }\KeywordTok{log}\NormalTok{(RG)))}
\KeywordTok{plotres}\NormalTok{(mod5}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-187-1} \end{center}

Utilizando a transformação \texttt{log()}, os resíduos ainda continuaram sendo não normais, apesar de se aproximaram mais da distribuição normal neste caso. Quando a transformação não for eficiente, recomenda-se a utilização de testes não paramétricos, por exemplo, no caso de um delineamento inteiramente casualizado, o teste de Kruskal-Wallis ou de um delineamento de blocos completos casualisados, o teste de Friedman.

\hypertarget{ancova}{%
\section{Análise de covariância (ANCOVA)}\label{ancova}}

\hypertarget{introduuxe7uxe3o}{%
\subsection{Introdução}\label{introduuxe7uxe3o}}

Neta seção, veremos alguns conceitos estatísticos e uma aplicação numérica de uma técnica interessante que pode ser útil, se corretamente utilizada, para reduzir o erro experimental em experimentos agronômicos: a análise de covariância (ANCOVA). A ANCOVA\indt{ANCOVA} é um modelo linear geral que combina princípios de ANOVA\indt{ANOVA} e regressão para avaliar se as médias de uma variável dependente são iguais entre níveis de uma variável independente categórica (tratamento), controlando estatisticamente os efeitos de outras variáveis contínuas que não são de interesse primário. Tais variáveis contínuas são medidas em cada unidade experimental e são chamadas \emph{covariáveis}. Idealmente, estas variáveis devem ser determinadas antes que os tratamentos tenham sido atribuídos às unidades experimentais ou, no mínimo, que os valores das covariáveis não sejam afetados pelos tratamentos aplicados (Snedecor and Cochran \protect\hyperlink{ref-Snedecor1967}{1967}). A ANCOVA\indt{ANCOVA} tem várias aplicações. No contexto da experimentação agronômica, ela é frequentemente utilizada reduzir a variabilidade no experimento pela contabilização da variabilidade nas unidades experimentais que não puderam ser controladas pelo design experimental.

Considere um experimento conduzido em uma área em que as unidades experimentais exibem considerável variabilidade que não pode ser controlada utilizando estratégias de bloqueio. O pesquisador acredita, digamos, baseado em experiências passadas, que uma ou mais características das unidades experimentais podem ajudar a descrever parte da variabilidade entre as unidades experimentais. Nesta condição, o pesquisador pode utilizar resultados de experimentos passados observados nas mesmas unidades experimentais --excluido o efeito de tratamento-- como uma covariável. Outra estratégia --embora um pouco distante em tempos de recursos financeiros limitados-- poderia ser a realização de uma análise de solo em cada unidade experimental e utilizar os resultados obtidos como covariáveis. Neste sentido, ao utilizar informações relacionadas as características fisico-químicas do solo como uma covariável, o pesquisador tenta explicar a variabilidade nas unidades experimentais que não podem ser convenientemente controladas por outra técnica experimental.

\hypertarget{modelo-estatuxedstico-1}{%
\subsection{Modelo estatístico}\label{modelo-estatuxedstico-1}}

Em uma estrura de tratamentos fixos, unifatorial, conduzidos em delineamento inteiramente casualizado, o modelo da ANOVA\indt{ANOVA} tradicional visto anteriormente pode ser escrito da seguinte forma quando uma covariável numérica (\(X\)) também foi mensurada em cada unidade experimental.

\[
Y_{ij} = \mu + \tau_i + \beta(X_{ij} - \bar X_{..}) + \varepsilon_{ij}
\]

onde \(Y_{ij}\) é a o valor observado do \emph{i}-ésimo tratamento na \emph{j}-ésima repetição; \(\mu\) é a média geral; \(\tau_i\) é o efeito do \emph{i}-ésimo tratamento; \(\beta\) é o coeficiente de regressão de \emph{Y} em \emph{X} e \(\varepsilon_{ij}\) é o erro aleatório.

As pressuposições do modelo da ANCOVA\indt{ANCOVA} são as mesmas que a ANOVA, ou seja, aditividade dos efeitos de bloco e tratamento (em DBC), normalidade, homogeneidade e independêcia dos resíduos, em adição à duas importantes considerações adicionais: (i) independência entre a covariável e o efeito do tratamento; e (ii) homogeneidade dos coeficientes angulares da regressão, que serão tratados à partir daqui como \emph{slopes}. Considerando que os pressupostos da ANOVA\indt{ANOVA} já são conhecidos, veremos com mais detalhes estes dois últimos à seguir.

\hypertarget{independuxeancia-entre-a-covariuxe1vel-e-os-efeitos-de-tratamento}{%
\subsection{Independência entre a covariável e os efeitos de tratamento}\label{independuxeancia-entre-a-covariuxe1vel-e-os-efeitos-de-tratamento}}

Vimos anteriormente que covariável deve ser independente do efeito do tratamento. A figura 6 mostra três diferentes cenários. No primeiro (a) a represetação esquemática de um delineamento unifatorial conduzido em DIC é mostrada. Neste exemplo, a variância da variável resposta (RG) pode ser dividida em duas partes. Uma correspondente aos efeitos dos tratamentos e a outra devido ao erro experimental, ou variância não explicada pelos tratamentos. Aqui, vimos novamente que toda variância não explicada pelos termos do modelo irá compor o erro experimental. No segundo exemplo (b) um cenário ideal para ANCOVA\indt{ANCOVA} é representado. Nesta condição, a covariável compartilha sua variância apenas com o pouco da variância do RG que é atualmente inexplicado pelos efeitos dos tratamentos . Em outras palavras, é completamente independente dos tratamentos. Este cenário é o único em que a ANCOVA\indt{ANCOVA} tradicional é apropriada.

\begin{figure}
\centering
\includegraphics{figures/covariavel.png}
\caption{Regra para análise de covariância}
\end{figure}

O terceiro exemplo, (c) representa uma situação em que as pessoas costumam usar a ANCOVA\indt{ANCOVA} quando não deveriam. Nesta situação, o efeito da covariável se sobrepõe ao efeito do tratamento. Em outras palavras, o efeito do tratamento é confundido com o efeito da covariável. Em situções como esta, a covariável reduzirá (estatisticamente falando) o efeito do tratamento, pois explica uma parte da variação que seria atribuída ao efeito de tratamento. Assim, efeitos espúrios de tratamento podem surgir, comprometendo a interpretação da ANCOVA\indt{ANCOVA} (Stevens \protect\hyperlink{ref-Stevens2009}{2009}).

A ANCOVA\indt{ANCOVA} nem sempre é uma solução magica. O problema do compartilhamento da variância da covariável com a variância de tratamento é comum e muitas vezes é ignorado ou incompreendido pelos pesquisadores (Miller and Chapman \protect\hyperlink{ref-Miller2001}{2001}). Em uma ampla revisão, Miller e Chapman citam muitas situações em que as pessoas aplicam a ANCOVA\indt{ANCOVA} de maneira incorreta. Recomendamos a leitura deste artigo. Felizmente, modelos generalizados de ANCOVA\indt{ANCOVA} que permitem tratar esta interação tratamento-covariável têm sido desenvolvidos (Mayer et al. \protect\hyperlink{ref-Mayer2014}{2014}), mas isto está além do objetivo deste material.

\hypertarget{homogeneidade-dos-slopes-da-regressuxe3o}{%
\subsection{\texorpdfstring{Homogeneidade dos \emph{slopes} da regressão}{Homogeneidade dos slopes da regressão}}\label{homogeneidade-dos-slopes-da-regressuxe3o}}

Baseado no modelo estatístico apresentado, percebe-se que quando uma ANCOVA\indt{ANCOVA} é realizada, buscamos uma relação geral entre a variável dependente e a covariável; ou seja, uma regressão global é ajustada aos dados, ignorando à que nível do tratamento uma determinada obsevação pertence. Ao ajustar esse modelo geral, supomos, portanto, que essa relação geral seja verdadeira para todos os níveis do fator tratamento. Por exemplo, se houver uma relação positiva (\emph{slope} positivo) entre a covariável e a variável dependente no primeiro nível (\(T_1\)), presumimos que há uma relação positiva (\emph{slope} positivo) em todos os outros níveis também. Vamos tentar tornar esse conceito um pouco mais concreto. A figura 7 mostra um gráfico de dispersão que exibe uma relação hipotética entre a covariável e a variável dependente em duas condições: heterogeneidade de \emph{slope} (esquerda) e homogeneidade de \emph{slope} (direita). Na primeira condição, a relação entre a variável dependente e covariável é positiva para os tratamentos \(T_1\) e \(T_2\), mas para o \(T_3\), esta relação parece ser negativa. Esta é uma condição em que a utilização da ANCOVA\indt{ANCOVA} não é indicada. Na segunda condição, a relação entre a variável dependente e a covariável é muito semelhante entre os tratamentos.

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-188-1} 

}

\caption{Gráfico de dispersão e linhas de regressão entre a variável dependente e a covariável. As diferentes cores represetam três tratamentos hipotéticos.}\label{fig:unnamed-chunk-188}
\end{figure}

\indf{ggplot} \indf{geom\_point} \indf{geom\_smooth} \indf{facet\_wrap}

\hypertarget{um-exemplo-numuxe9rico}{%
\subsection{Um exemplo numérico}\label{um-exemplo-numuxe9rico}}

Até aqui, passamos por uma breve introdução abordando o modelo mais simples de ANCOVA. Esta técnica, no entanto, pode ser utilizada em qualquer delineamento experimental. Para maiores informações, recomendamos a leitura de três bons materiais: Rutherford (\protect\hyperlink{ref-Rutherford2001}{2001}), um livro específico para ANCOVA; Field, Miles, and Field (\protect\hyperlink{ref-Field2012}{2012}), pp.~462, com aplicação em R; e Scheiner and Gurevitch (\protect\hyperlink{ref-Scheiner2001}{2001}), pp.~77, com aplicação em SAS.

Vamos agora, utilizando um exemplo numérico, demonstrar como esta análise pode ser realizada no software R e identificar como ela pode ser útil na análise de experimentos agronônicos. Os dados são apresentados em Snedecor and Cochran (\protect\hyperlink{ref-Snedecor1967}{1967}), pp.~428 e são resultantes de um experimento com 6 tratamentos (cultivares), conduzido em DBC com 4 blocos. A variável resposta mensurada em cada unidade experimental foi gramas de espigas (GE) em adição a uma covariável, número de plantas por unidade experimental (NPLA). Para realizar uma ANCOVA, recomendamos que as seguintes etapas sejam seguidas:

\indt{Dicas}
\begin{dica}
\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Assumindo que o R será utilizado, insira os dados e instale os pacotes necessários.
\item
  Explore os seus dados: Faça uso de gráficos para explorar o padrão encontrado nos dados. A sugestão aqui é utilizar gráficos do tipo boxplot, visto a riqueza de informações proporcionada por este tipo de gráficos.
\item
  Verifique se a covariável e os tratamentos são independentes: Execute uma ANOVA\indt{ANOVA} com a covariável como o variável dependente para verificar se a covariável não difere significativamente entre os níveis da variável independente (tratamento). Se um resultado significativo for observado, interrompa a análise aqui.
\item
  A ANCOVA: assumindo que tudo estava bem nas etapas 2 e 3, execute a análise principal de covariância.
\item
  Verifique a homogeneidade dos \emph{slopes} da regressão: execute novamente a ANCOVA, incluindo, agora, a interação entre a variável independente e a covariável. Se esta interação é significativa, então você não pode assumir a homogeneidade dos \emph{slopes} da regressão.
\item
  Compute as análises complementares: encontrada diferença significativa para tratamento na etapa 4 e assumindo que a etapa 5 indicou homogeneidade dos \emph{slopes} da regressão, as análises complementares --como comparações múltiplas de médias-- podem então ser realizadas.
\end{enumerate}
\end{dica}

Vamos agora ver cada uma destas etapas detalhadamente.

\textbf{1. Download dos dados e pacotes necessários}

O seguinte código é utilizado para instalar/carregar os pacotes necessários bem como para fazer o upload dos dados e armazenar no dataframe \texttt{covar} \indf{p\_load}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\CommentTok{\# dados}
\NormalTok{covar \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"COVAR"}\NormalTok{)}
\CommentTok{\# duas primeiras colunas como fator}
\NormalTok{covar \textless{}{-}}\StringTok{ }\KeywordTok{as\_factor}\NormalTok{(covar, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{)}

\NormalTok{covar\_ggplot \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{covar }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{pivot\_longer}\NormalTok{(}\DataTypeTok{names\_to =} \StringTok{"variable"}\NormalTok{, }\DataTypeTok{values\_to =} \StringTok{"val"}\NormalTok{, }\DataTypeTok{cols =} \KeywordTok{c}\NormalTok{(NPUE, GE))}
\CommentTok{\# Estrutura dos dados}
\NormalTok{covar\_ggplot}
\CommentTok{\# \# A tibble: 48 x 4}
\CommentTok{\#    TRAT  BLOCO variable   val}
\CommentTok{\#    \textless{}fct\textgreater{} \textless{}fct\textgreater{} \textless{}chr\textgreater{}    \textless{}dbl\textgreater{}}
\CommentTok{\#  1 T1    1     NPUE        28}
\CommentTok{\#  2 T1    1     GE         202}
\CommentTok{\#  3 T1    2     NPUE        22}
\CommentTok{\#  4 T1    2     GE         165}
\CommentTok{\#  5 T1    3     NPUE        27}
\CommentTok{\#  6 T1    3     GE         191}
\CommentTok{\#  7 T1    4     NPUE        19}
\CommentTok{\#  8 T1    4     GE         134}
\CommentTok{\#  9 T2    1     NPUE        23}
\CommentTok{\# 10 T2    1     GE         145}
\CommentTok{\# \# ... with 38 more rows}
\end{Highlighting}
\end{Shaded}

\indf{mutate\_at} \indf{gather} \indf{gather}
\textbf{2. Explorando os dados}

A construção de gráficos do tipo boxplot para a variável resposta e a covariável são importantes, pois permitem identificar a presença de possíveis \emph{outliers} nos dados além de facilitar a visualização de padrões de associação entre as variáveis.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mean\_var \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{covar\_ggplot }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(variable) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{(val))}

\KeywordTok{ggplot}\NormalTok{(covar\_ggplot, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ TRAT, }\DataTypeTok{y =}\NormalTok{ val)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_boxplot}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"gray75"}\NormalTok{, }\DataTypeTok{width =} \FloatTok{0.6}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet\_wrap}\NormalTok{(}\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{variable, }\DataTypeTok{scales =} \StringTok{"free\_y"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_hline}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ mean\_var, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{yintercept =}\NormalTok{ mean), }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{stat\_summary}\NormalTok{(}\DataTypeTok{fun =}\NormalTok{ mean,}
               \DataTypeTok{geom =} \StringTok{"point"}\NormalTok{,}
               \DataTypeTok{shape =} \DecValTok{23}\NormalTok{,}
               \DataTypeTok{fill =} \StringTok{"red"}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Tratamentos"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"valores observados"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-191-1} 

}

\caption{Gráfico boxplot da variável independente (GE) e da covariável (NPUE) em cada nível do tratamento (T).}\label{fig:unnamed-chunk-191}
\end{figure}

\indf{summarise} \indf{geom\_hline} \indf{geom\_boxplot} \indf{stat\_summary}
A linha tracejada horizontal representa a média geral de cada variável. Seis estatísticas são mostradas neste boxplot. A mediana (linha horizontal); a média (losango vermelho); as caixas inferior e superior correspondem ao primeiro e terceiro quartis (percentis 25 e 75, respectivamente); as linha vertical superior se estende da caixa até o maior valor, não maior que \(1,5 \times {IQR}\) (onde IQR é a amplitude interquartílica). A linha vertical inferior se estende da caixa até o menor valor, de no máximo, \(1,5 \times {IQR}\). Dados além destas linhas podem ser considerados \emph{outliers}.

\textbf{3. Identificando a independência entre a covariável e os tratamentos}

A independência entre a covariavel e os efeitos de tratamento, demostrada graficamente na figura 6 é um importante pressuposto da ANCOVA. Esta independência é checada realizando uma ANOVA\indt{ANOVA} considerando a covariável como variável dependente. A função \texttt{aov()} é utilizada para o ajuste do modelo. O primeiro argumento, \texttt{NPUE}, é a variável resposta (neste caso a covariável) que queremos analisar. O operador \texttt{\textasciitilde{}} informa que os seguintes argumentos irão ser considerados como as fontes de variação no modelo. Neste caso, \texttt{TRAT} e \texttt{BLOCO} são incluídos.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# modelo ANOVA convencional para a covariável}
\NormalTok{convencional \textless{}{-}}\StringTok{ }\KeywordTok{aov}\NormalTok{(NPUE }\OperatorTok{\textasciitilde{}}\StringTok{  }\NormalTok{TRAT }\OperatorTok{+}\StringTok{ }\NormalTok{BLOCO, }\DataTypeTok{data =}\NormalTok{ covar)}
\CommentTok{\# Análise de variância}
\KeywordTok{anova}\NormalTok{(convencional) }
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Response: NPUE}
\CommentTok{\#           Df  Sum Sq Mean Sq F value Pr(\textgreater{}F)}
\CommentTok{\# TRAT       5  45.833  9.1667  1.2079 0.3524}
\CommentTok{\# BLOCO      3  21.667  7.2222  0.9517 0.4407}
\CommentTok{\# Residuals 15 113.833  7.5889}
\end{Highlighting}
\end{Shaded}

\indf{aov}

O resultado da ANOVA\indt{ANOVA} acima indica que a covariável é independente dos efeitos de tratamento. Neste caso, prosseguimos para o próximo passo. Se um resultado significativo for encontrado nesta etapa, a realização da ANCOVA\indt{ANCOVA} não é recomendada.

\textbf{4. O modelo da ANCOVA}

Para realizar a ANCOVA, utilizaremos a mesma função \texttt{aov()}. Agora, no entanto, a variável dependente (do lado esquerdo do operador \texttt{\textasciitilde{}}) será a \texttt{GE} e a covariável \texttt{NPUE} será incluída no modelo. Aqui, a função \texttt{anova()} é substituída pela função \texttt{Anova()} do pacote \texttt{car} para que a soma de quadrado tipo III (em linguagem SAS) seja computada. Este tipo de soma de quadrados é utilizada, pois cada efeito é ajustado para todos os outros termos do modelo, diferentemente do tipo I (padrão na função \texttt{anova()}), onde a adição de cada efeito é feita sequencialmente e depende de como os termos do modelo são ordenados (Langsrud \protect\hyperlink{ref-Langsrud2003}{2003}).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# modelo ANOVA convencional}
\NormalTok{ancova \textless{}{-}}\StringTok{ }\KeywordTok{aov}\NormalTok{(GE }\OperatorTok{\textasciitilde{}}\StringTok{  }\NormalTok{TRAT }\OperatorTok{+}\StringTok{ }\NormalTok{NPUE }\OperatorTok{+}\StringTok{ }\NormalTok{BLOCO, }\DataTypeTok{data =}\NormalTok{ covar)}
\CommentTok{\# Análise de variância}
\KeywordTok{Anova}\NormalTok{(ancova, }\DataTypeTok{type =} \DecValTok{3}\NormalTok{)}
\CommentTok{\# Anova Table (Type III tests)}
\CommentTok{\# }
\CommentTok{\# Response: GE}
\CommentTok{\#             Sum Sq Df F value    Pr(\textgreater{}F)    }
\CommentTok{\# (Intercept)  169.9  1  1.7476  0.207376    }
\CommentTok{\# TRAT        3227.3  5  6.6381  0.002296 ** }
\CommentTok{\# NPUE        7391.0  1 76.0124 4.963e{-}07 ***}
\CommentTok{\# BLOCO       1502.4  3  5.1504  0.013158 *  }
\CommentTok{\# Residuals   1361.3 14                      }
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\end{Highlighting}
\end{Shaded}

Analisando primeiro os valores de significância, fica claro que a covariável prediz significativamente a variável dependente (\emph{p}-valor \textless{} 0,01). Portanto, a variável gramas de espiga por parcela é influenciada pelo número de plantas por parcela. Da mesma forma, o efeito de tratamento também foi significativo.

\indf{leveneTest} \indf{tukey.add.test} \indf{shapiro.test} \indf{autoplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{residuals \textless{}{-}}\StringTok{ }\KeywordTok{residuals}\NormalTok{(ancova)}
\CommentTok{\# normalidade dos resíduos}
\KeywordTok{shapiro.test}\NormalTok{(residuals)}
\CommentTok{\# }
\CommentTok{\#   Shapiro{-}Wilk normality test}
\CommentTok{\# }
\CommentTok{\# data:  residuals}
\CommentTok{\# W = 0.97894, p{-}value = 0.8755}

\CommentTok{\# Homogeneidade das variâncias}
\KeywordTok{leveneTest}\NormalTok{(residuals }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{TRAT, }\DataTypeTok{data =}\NormalTok{ covar)}
\CommentTok{\# Levene\textquotesingle{}s Test for Homogeneity of Variance (center = median)}
\CommentTok{\#       Df F value Pr(\textgreater{}F)}
\CommentTok{\# group  5  1.1686 0.3624}
\CommentTok{\#       18}

\CommentTok{\# Teste de aditividade de Tukey}
\KeywordTok{tukey.add.test}\NormalTok{(covar}\OperatorTok{$}\NormalTok{GE, covar}\OperatorTok{$}\NormalTok{BLOCO, covar}\OperatorTok{$}\NormalTok{TRAT)}
\CommentTok{\# }
\CommentTok{\# Tukey\textquotesingle{}s one df test for additivity }
\CommentTok{\# F = 1.0000419   Denom df = 14    p{-}value = 0.3342722}

\CommentTok{\# interpretação gráfica}
\KeywordTok{autoplot}\NormalTok{(ancova) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_point}\NormalTok{(}\DataTypeTok{col =} \StringTok{"black"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{text =} \KeywordTok{element\_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{8}\NormalTok{),}
        \DataTypeTok{axis.title =} \KeywordTok{element\_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{8}\NormalTok{),}
        \DataTypeTok{axis.text =} \KeywordTok{element\_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{8}\NormalTok{),}
        \DataTypeTok{aspect.ratio =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-194-1} 

}

\caption{Gráfico residual do modelo ANCOVA obtido pela função autoplot().}\label{fig:unnamed-chunk-194}
\end{figure}

A Figura abaixo obtida com a função \texttt{autoplot()}, mostra 4 gráficos. Os dois primeiros são os mais importantes para nós aqui. O primeiro (\emph{Residual vs fitted}) pode ser utilizado para identificar a homogeneidade das variâncias. Uma distribuição aleatória dos pontos no gráfico deve ser observada. Quando um padrão de distibuição é observado --como, por exemplo, a distribuição dos pontos em forma de funil-- uma investigação deve ser realizada, pois este padrão indica a possiblidade de heterogeneidade das variâncias. O segundo gráfico (\emph{Normal Q-Q}) nos informa quanto a normalidade dos resíduos, ou seja, é desejado que os pontos sejam distribuídos ao redor da linha diagonal. Em nosso caso, os pontos foram uniformemente distribuídos, o que confirma o resultado do teste estatístico observado anteriormente.

\indt{Curiosidade}
\begin{vcsabia}
A utilização de gráficos residuais para identificar os pressupostos de modelos ainda não é muito difundida. No entanto, estes gráficos apresentam muitas vantagens em relação aos métodos estatísticos, principalmente quando os testes são aplicados em conjuntos de dados com um alto tamanho de amostra. Uma ampla discussão comparando métodos estatísticos e gráficos na verificação de pressupostos dos modelos é apresentada por Kozak and Piepho (\protect\hyperlink{ref-Kozak2017}{2017}).
\end{vcsabia}

\textbf{5. Homogeneidade dos \emph{slopes} da regressão}

Vimos anteriormente que homogeneidade dos \emph{slopes} é um pressuposto importante na ANCOVA. Para identificarmos isto em nosso exemplo, vamos criar um gráfico semelhate ao apresentado na figura 7.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(covar, }\KeywordTok{aes}\NormalTok{(NPUE, GE, }\DataTypeTok{col =}\NormalTok{ TRAT)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{col =}\NormalTok{ TRAT)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_smooth}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{col =}\NormalTok{ TRAT), }\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{se =}\NormalTok{ F) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_smooth}\NormalTok{(}\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{se =}\NormalTok{ F)}\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
        \DataTypeTok{aspect.ratio =} \DecValTok{1}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{guides}\NormalTok{(}\DataTypeTok{col =} \KeywordTok{guide\_legend}\NormalTok{(}\DataTypeTok{nrow =} \DecValTok{1}\NormalTok{, }\DataTypeTok{byrow =} \OtherTok{TRUE}\NormalTok{))}\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =}\StringTok{"Número de plantas por parcela"}\NormalTok{,}
       \DataTypeTok{y =} \StringTok{"Gramas de espigas por parcela"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-196-1} 

}

\caption{Regressões ajustadas para cada tratamento entre a variável dependente e a covariável. A linha preta tracejada representa a regressão geral. O slope desta regressão é utilizado para a obtenção das médias ajustadas.}\label{fig:unnamed-chunk-196}
\end{figure}

O gráfico acima mostra uma regressão linear ajustada para cada tratamento (linhas coloridas) e uma regerssão linear geral (linha pontilhada) entre a covariável e a variável resposta. Observando cada reta ajustada, é razoável dizer que os \emph{slopes} podem ser considerados homogêneos, ou seja, todos eles apresentam valor positivo. Um teste de hipótese pode ser utilizado para testarmos se os \emph{slopes} podem ou não ser considerados homogêneos. Para isto, basta incluirmos o termo de interação entre a covariável e o tratamento no modelo \texttt{ancova} ajustado anterioremente. A função \texttt{update()} pode ser utilizada para este fim, como segue:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Incluindo o termo de interação}
\NormalTok{ancova\_int =}\StringTok{ }\KeywordTok{update}\NormalTok{(ancova, .}\OperatorTok{\textasciitilde{}}\NormalTok{. }\OperatorTok{+}\StringTok{ }\NormalTok{NPUE}\OperatorTok{:}\NormalTok{TRAT)}
\CommentTok{\# Análise de variância}
\KeywordTok{Anova}\NormalTok{(ancova\_int, }\DataTypeTok{type =} \DecValTok{3}\NormalTok{) }
\CommentTok{\# Anova Table (Type III tests)}
\CommentTok{\# }
\CommentTok{\# Response: GE}
\CommentTok{\#             Sum Sq Df F value    Pr(\textgreater{}F)    }
\CommentTok{\# (Intercept)  300.0  1  2.8462 0.1258641    }
\CommentTok{\# TRAT         597.9  5  1.1344 0.4084810    }
\CommentTok{\# NPUE        3906.0  1 37.0530 0.0001821 ***}
\CommentTok{\# BLOCO       1311.4  3  4.1467 0.0421214 *  }
\CommentTok{\# TRAT:NPUE    412.5  5  0.7827 0.5867580    }
\CommentTok{\# Residuals    948.7  9                      }
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\end{Highlighting}
\end{Shaded}

Como já suspeitávamos, a interação covariável \(\times\) tratamento não foi significativa, indicando homogeneidade dos \emph{slopes}.

\indt{Dicas}
\begin{dica}
Na função \texttt{update()} acima, o operador \texttt{.\textasciitilde{}.} significa ``manter a mesma variável resposta e preditores do objeto ancova'' e \texttt{+\ NPUE:TRAT} significa ``adicionar o termo de interação ao modelo ancova''.
\end{dica}

\textbf{6. Análises complementares}

Nos últimos cinco tópicos, vimos em detalhe os principais passos para o cálculo da ANCOVA. Conseguimos identificar que a covariável influencia a variável resposta, que ela é idependente dos nossos tratamentos e os \emph{slopes} das regressões de cada tratamento são homogêneos. Duas etapas restam para nós agora: (i) identificar o quanto ganhamos --em termos de sucesso preditivo-- considerando a inclusão da covariável do modelo; e (ii) quais são as médias ajustadas apra cada tratamento. Uma maneira simples de identificar se a inclusão da covariável melhorou a predição do modelo, é por meio da criação de um gráfico de dispersão com uma linha de referência 1:1 (valores preditos \emph{vs} observados). Testes estatísticos de seleção de modelos --como, por exemplo, o AIC-- também podem serem utilizados. Nesta etapa, vamos criar um novo dataframe chamado \texttt{covar\_pred}, qual conterá, além dos dados originais, os valores preditos pela ANOVA\indt{ANOVA} e ANCOVA.

\indf{mutate} \indf{geom\_abline} \indf{guides}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anovaa =}\StringTok{ }\KeywordTok{aov}\NormalTok{(GE }\OperatorTok{\textasciitilde{}}\StringTok{  }\NormalTok{TRAT }\OperatorTok{+}\StringTok{ }\NormalTok{BLOCO, }\DataTypeTok{data =}\NormalTok{ covar)}

\NormalTok{ancova\_pred =}\StringTok{ }\NormalTok{covar }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{pred =} \KeywordTok{predict}\NormalTok{(ancova), }\DataTypeTok{metodo =} \StringTok{"ANCOVA"}\NormalTok{)}
\NormalTok{anova\_pred =}\StringTok{  }\NormalTok{covar }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{pred =} \KeywordTok{predict}\NormalTok{(anovaa), }\DataTypeTok{metodo =} \StringTok{"ANOVA"}\NormalTok{)}
\NormalTok{preditos =}\StringTok{ }\KeywordTok{rbind}\NormalTok{(ancova\_pred, anova\_pred)}
\KeywordTok{AIC}\NormalTok{(anovaa, ancova)}
\CommentTok{\#        df      AIC}
\CommentTok{\# anovaa 10 229.6856}
\CommentTok{\# ancova 11 187.0242}
\CommentTok{\# gráfico 1:1}
\KeywordTok{ggplot}\NormalTok{(preditos, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ pred, }\DataTypeTok{y =}\NormalTok{ GE))}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{col =}\NormalTok{ TRAT)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_abline}\NormalTok{(}\DataTypeTok{intercept =} \DecValTok{0}\NormalTok{, }\DataTypeTok{slope =} \DecValTok{1}\NormalTok{, }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{xlim}\NormalTok{(}\DecValTok{130}\NormalTok{, }\DecValTok{270}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ylim}\NormalTok{(}\DecValTok{130}\NormalTok{, }\DecValTok{270}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{aspect.ratio =} \DecValTok{1}\NormalTok{,}
        \DataTypeTok{panel.spacing =} \KeywordTok{unit}\NormalTok{(}\DecValTok{0}\NormalTok{,}\StringTok{"cm"}\NormalTok{)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{guides}\NormalTok{(}\DataTypeTok{col =} \KeywordTok{guide\_legend}\NormalTok{(}\DataTypeTok{nrow =} \DecValTok{1}\NormalTok{, }\DataTypeTok{byrow =} \OtherTok{TRUE}\NormalTok{))}\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"bottom"}\NormalTok{, }\DataTypeTok{legend.title =} \KeywordTok{element\_blank}\NormalTok{())}\OperatorTok{+}
\StringTok{    }\KeywordTok{facet\_wrap}\NormalTok{(}\OperatorTok{\textasciitilde{}}\NormalTok{metodo)}\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Gramas de espigas estimado"}\NormalTok{,}
       \DataTypeTok{y =} \StringTok{"Gramas de espiga observada "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-199-1} \end{center}

Neste gráfico, a linha pontilhada representa a linha de referência 1:1. Fica evidente ao observar o gráfico acima que a utilização da covariável melhorou a capacidade preditiva do modelo, pois os valores preditos estavam mais próximos da linha de referência. Os valores de AIC também indicaram que o modelo ANCOVA\indt{ANCOVA} foi mais preciso.

\indt{Dicas}
\begin{dica}
Gráficos do tipo 1:1 são úteis para identificar a capacidade preditiva de modelos. Dois cuidados, no entanto, precisam ser tomados. Primeiro, por ser um gráfico gráfico de dispersão com uma linha de referência 1:1, os eixos x e y devem estar na mesma escala. Segundo, é assumido que a linha diagonal tem intercepto igual a zero e \emph{slope} igual a um. Assim, um teste de hipotese para estes parâmetros pode ser útil.
\end{dica}

O próximo passo é obtermos as médias de GE para cada tratamento ajustadas para um mesmo valor de NPUE. Considerando estas variáveis como Y e X, respectivamente, este valor é dado pela expressão:

\[
\hat m_i = \bar{Y}_{i.}- \hat \beta(\bar{X}_{i.}- \bar X_{..})
\]

Onde \(\bar{Y}_{i.}\) é a média ajustada de Y do \emph{i}-ésimo tratamento; \(\hat \beta\) é o \emph{slope} da regressão linear estimada entre a variável dependente e a covariável; \(\bar{X}_{i.}\) é a média da covariável para o \emph{i}-ésimo tratamento; e \(\bar{X}_{..}\) é a média geral da covariável. No software R, as médias ajustadas bem como os testes \emph{post hocs} podem ser obtidos pelos seguintes códigos.

\indf{emmeans}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{med\_anova =}\StringTok{ }\KeywordTok{emmeans}\NormalTok{(anovaa, }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{TRAT) }\CommentTok{\# Média não ajustada}
\NormalTok{med\_ancoova =}\StringTok{ }\KeywordTok{emmeans}\NormalTok{(ancova, }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{TRAT) }\CommentTok{\# Média ajustada para NPUE}
\NormalTok{xlab =}\StringTok{ "Gramas de espiga por parcela"}
\NormalTok{ylab =}\StringTok{ "Tratamento"}
\NormalTok{scale\_x =}\StringTok{ }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{limits =} \KeywordTok{c}\NormalTok{(}\DecValTok{140}\NormalTok{, }\DecValTok{260}\NormalTok{))}
\NormalTok{p1 =}\StringTok{ }\KeywordTok{plot}\NormalTok{(med\_anova, }\DataTypeTok{comparisons =}\NormalTok{ T, }\DataTypeTok{xlab =}\NormalTok{ xlab, }\DataTypeTok{ylab =}\NormalTok{ ylab) }\OperatorTok{+}\StringTok{ }\NormalTok{scale\_x}
\NormalTok{p2 =}\StringTok{ }\KeywordTok{plot}\NormalTok{(med\_ancoova, }\DataTypeTok{comparisons =}\NormalTok{ T, }\DataTypeTok{xlab =}\NormalTok{ xlab, }\DataTypeTok{ylab =}\NormalTok{ ylab) }\OperatorTok{+}\StringTok{ }\NormalTok{scale\_x}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"ANOVA"}\NormalTok{, }\StringTok{"ANCOVA"}\NormalTok{),}
          \DataTypeTok{hjust =} \FloatTok{{-}1.5}\NormalTok{, }\DataTypeTok{vjust =} \FloatTok{2.5}\NormalTok{, }\DataTypeTok{label\_size =} \DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-201-1} \end{center}

A figura acima mostra as médias ajustadas para os dois métodos. As barras azuis representam o intervalo de confiança 95\% da média predita enquanto que as setas vermelhas indicam comparação das médias pelo teste de Tukey. Cultivares com setas que não se sobrepõe apresentam médias significativamente diferentes. Note que a amplitude do intervalo de confiança é menor para o modelo da ANCOVA. Assim, vimos como este método pode ser útil na redução do erro em análise de dados experimentais. Seguindo este exemplo, a ANCOVA\indt{ANCOVA} pode ser aplicada em experimentos onde uma potencial covariável está disponível, como por exemplo, a severidade de ferrugem na folha observada em cada unidade experimental antes da aplicação de fungicida.

\hypertarget{general}{%
\section{Análise de dados não gaussianos}\label{general}}

Dados com distribuições não normal são mais comuns do que podemos imaginar. Na área agrícola, exemplos incluem a percentagem de sementes que germinam (Binomial), a contagem de ervas daninhas por parcela (Poisson), a proporção de área foliar necrosada por uma determinada doença (Beta), a escala de sintomas de uma determinada doença (Multinominal). Para todas as distribuições, exceto a normal, a variância é dependente da média. Logo, assumindo efeito significativo dos tratamentos, o pressuposto da homogeneidade das variâncias será violado quando dados não normais são analizados (Stroup \protect\hyperlink{ref-Stroup2015}{2015}). Neste momento, a questão que surge é: como estes dados deveriam ser analizados? Antes de responder esta questão, vamos passar por uma breve história.

\hypertarget{da-anuxe1lise-de-variauxe7uxe3o-aos-modelos-lineares-mistos-generalizados}{%
\subsection{Da análise de variação aos modelos lineares mistos generalizados}\label{da-anuxe1lise-de-variauxe7uxe3o-aos-modelos-lineares-mistos-generalizados}}

Fisher and Mackenzie (\protect\hyperlink{ref-Fisher1923}{1923}), estudando a variação de diferentes cultivares de batata, publicaram o primeiro trabalho demonstrando o uso da ANOVA\indt{ANOVA} para a avaliação de experimentos agrícolas. O método da ANOVA\indt{ANOVA} se tornaria popular e amplamente utilizado após Fisher estabelecer as bases teóricas e os pressupostos desta técnica (Fisher \protect\hyperlink{ref-Fisher1925}{1925}, \protect\hyperlink{ref-Fisher1935}{1935}). As ideias de Fisher foram extendidas para experimentos mais complexos, mais tarde, por Yates (\protect\hyperlink{ref-Yates1940}{1940}). Até então, a questão da ANOVA\indt{ANOVA} de dados não gaussianos parecia estar resolvida. O teorema central do limite dava suporte a tal análise. Mais tarde, Bartlett (\protect\hyperlink{ref-Bartlett1947}{1947}) demonstrou como as transformações de dados não normais poderiam ser úteis para realização da ANOVA. Esta técnica permanece sendo utilizada até hoje.

Nesta mesma época, a terminologia ``Modelos Mistos'' \indt{Modelos Mistos} foi introduzida por Eisenhart (\protect\hyperlink{ref-Eisenhart1947}{1947}). Mais tarde, Henderson (\protect\hyperlink{ref-Henderson1949}{1949}); Henderson (\protect\hyperlink{ref-Henderson1950}{1950}) propos as equações do modelo misto, das quais os BLUPs\indt{BLUP} são as soluções. Em 1953, este mesmo autor demonstrou os diferentes tipos de somas de quadrados (vistos na seção da análise de covariância) e descreveu alguns métodos para estimação dos componentes de variância em dados não ortogonais (Henderson \protect\hyperlink{ref-Henderson1953}{1953}). Mais tarde (1971), a estimação da Máxima Verossimilhança Restrita (REML)\indt{REML} como um método para estimativa dos componentes de variância em um modelo com dados desbalanceados foi apresentada por Patterson and Thompson (\protect\hyperlink{ref-Patterson1971}{1971}).

\begin{note}
\textbf{Um resumo até aqui}

\begin{itemize}
\tightlist
\item
  O uso da ANOVA\indt{ANOVA} para análise de experimentos já estava consolidada;
\item
  A utilização de transformação de variáveis era uma técnica aceita para realização da ANOVA\indt{ANOVA} com dados não normais;
\item
  A teoria por tráz dos modelos mistos já era compreendida, no entanto seu uso não era disseminado devido, principalmente, devido a necessidade de operações matriciais complexas.
\end{itemize}
\end{note}

Nelder and Wedderburn (\protect\hyperlink{ref-Nelder1972}{1972}) extenderam a base do modelo linear da ANOVA\indt{ANOVA} e regressão para acomodar suposições de probabilidade mais plausíveis aos dados observados, resultando nos conhecidos modelos lineares generalizados (\emph{GLM, generalized linear models}).\indt{Modelos Generalizados} A essência dessa generalização proporciona duas importantes mudanças nos pressupostos dos modelos: A primeira é que os dados não necessariamente precisam ser normalmente distribuídos mas podem assumir qualquer distribuição da família exponencial de distribuições a qual inclui, entre outras, a distribuição Normal, Poisson e Binomial (Koopman \protect\hyperlink{ref-Koopman1936}{1936}). A segunda é que a média não é necessariamente tomada como uma combinação linear de parâmetros, mas que alguma função da média é. Esta função é conhecida como função de ligação e nos GLMs\indt{GLMs} relaciona a média da variável resposta à combinação linear das variáveis explicativas (Nelder and Wedderburn \protect\hyperlink{ref-Nelder1972}{1972}). Semelhante a evolução dos LMs para GLMs, os LMMs foram extendidos para modelos lineares mistos generalizados (\emph{GLMM, generalized linear mixed-effect model}) por Wolfinger and O'connell (\protect\hyperlink{ref-Wolfinger1993}{1993}) e Breslow and Clayton (\protect\hyperlink{ref-Breslow1993}{1993}).

\hypertarget{estratuxe9gias-para-anuxe1lise-de-dados-nuxe3o-gaussianos}{%
\subsection{Estratégias para análise de dados não gaussianos}\label{estratuxe9gias-para-anuxe1lise-de-dados-nuxe3o-gaussianos}}

Quando confrontados com dados não normais, a maioria dos pesquisadores opta por uma das três opções a seguir: \textbf{(i)} confiar na robustez da ANOVA\indt{ANOVA} clássica à pequenos desvios de normalidade em ensaios balanceados (Blanca et al. \protect\hyperlink{ref-Blanca2017}{2017}) e realizá-la sem nenhum peso na consciência; \textbf{(ii)} realizar alguma transformação na variável e realizar a ANOVA\indt{ANOVA} com dados transformados; \textbf{(iii)} utilizar algum teste não paramétrico. A segunda opção parece ser a mais utilizada. Variáveis são transformadas para que os pressupostos de normalidade e homogeneidade das variâncias seja cuprido --ou ao menos aproximado-- (Bartlett \protect\hyperlink{ref-Bartlett1947}{1947}).

O uso de testes não paramétricos também pode ser uma alternativa para a análise de dados não normais. Os testes de Friedman (Friedman \protect\hyperlink{ref-Friedman1937}{1937}) e de Kruskal \& Wallis (Kruskal and Wallis \protect\hyperlink{ref-Kruskal1952}{1952}) são as alternativas não paramétricas para a análise de variância nos delineamentos DBC e DIC (unifatoriais), respectivamente. A aplicação destes testes não será o foco aqui, principalmente devido a limitação com relação a complexidade do design experimental suportada por estes testes. Uma excelente aplicação prática, no entanto, pode ser vista em Field, Miles, and Field (\protect\hyperlink{ref-Field2012}{2012}), pp.~653.

Vale ressaltar que a escolha por estes ``atalhos'', no entanto, nem sempre é a solução definitiva. Dados de contagem com muitos valores zero não podem ser normalizados por transformação. Os testes não paramétricos, ao contrário de como muitos pensam, requerem, sim, alguns pressupostos. Por exemplo, o teste de Freedman é flexivel quando a não normalidade mas só é valido se a distribuição da variável resposta entre os grupos for a mesma em todos os outros aspectos (variância, assimetria, curtose). Quando estes pressupostos não são cumpridos, o poder do teste é reduzido (Laurent and Turk \protect\hyperlink{ref-Laurent2013}{2013}). Assim, ao vez de encaixar os dados em estatísticas clássicas, os pesquisadores devem utilizar abordagens estatísticas que correspondam aos seus dados (Mora et al. \protect\hyperlink{ref-Mora2008}{2008}). Em casos de variáveis não normais, as mais indicadas são os GLMs\indt{GLMs} (Nelder and Wedderburn \protect\hyperlink{ref-Nelder1972}{1972}) ou GLMMs\indt{GLMMs} (Wolfinger and O'connell \protect\hyperlink{ref-Wolfinger1993}{1993}).

Hábitos de aprendizado de que a ANOVA\indt{ANOVA} pode ser aplicada diretamente a dados transformados não ajudam --e muitas vezes impedem-- a rápida expansão do uso de modelos mais sofisticados como os GLM(M)s. O uso de GLM(M)s, no entanto, requer um aprendizado considerável. Dependendo da aplicação, a subida pode ser íngreme. Apresentar uma introdução ao uso dos GLM(M)s\indt{GLM(M)s} em R para análise de dados não gaussianos e compará-los com os procedimentos tradicionais é nosso principal objetivo aqui.

\hypertarget{introduuxe7uxe3o-aos-modelos-lineares-generalizados}{%
\subsection{Introdução aos modelos lineares generalizados}\label{introduuxe7uxe3o-aos-modelos-lineares-generalizados}}

Vamos considerar um simples experimento que comparou a eficiência de um herbicida pré-emergente no controle de uma determinada erva daninha em comparação com um tratamento controle. O ensaio foi realizado em um delineamento DIC com oito repetições, sendo cada repetição caracterizada por um vaso. Logo, o ensaio foi composto por 16 vasos. Em cada vaso foram semeadas 50 sementes da determinada erva daninha e após um período previamente especificado, o número de sementes germinadas foi observado. Assumindo que a germinação de cada semente é um processo independente, a variável resposta em cada unidade experimental (\(Y_{ij}\)) tem uma distribuição binomial com \emph{N} = 50 e probabilidade de germinação de \(\pi_{ij}\) para o \emph{i}-ésimo tratamento na \emph{j}-ésima repetição.

Intuitivamente, a primeira opção de muitos pesquisadores para analisar estes dados seria iniciar com uma aproximação normal. Com \emph{N} = 50 --e considerando \emph{p} = 0,5-- mesmo dados binomiais apresentam boa aproximação normal. O modelo com aproximação normal seria:

\begin{quote}
\begin{itemize}
\item
  Variavel resposta: \(p_{ij} = y_{ij}/50\), onde \(y_{ij}\) é o número de sementes germinadas do \emph{i}-ésimo tratamento na \emph{j}-ésima repetição
\item
  O modelo tradicional é então \(p_{ij} = \mu + \tau_i + \varepsilon_{ij}\) onde \(\mu\) é a média geral; \(\tau_i\) é o efeito do \emph{i}-ésimo tratamento e \(\varepsilon_{ij}\) é o erro aleatório assumido \(i.i.d \sim N(0, \sigma^2 )\).
\end{itemize}
\end{quote}

Diferentemente do modelo da ANOVA\indt{ANOVA} tradicional apresentado acima onde uma única equação é considerada, os GLMs\indt{GLMs} são montados basicamente em três etapas (Stroup \protect\hyperlink{ref-Stroup2013}{2013}):

\begin{quote}
\begin{itemize}
\item
  A \textbf{distribuição} das observações: Em nosso exemplo, assumimos que \(y_{ij} \sim B(50, \pi_i)\);
\item
  O \textbf{preditor linear}: Em nosso exemplo \(\eta_{ij} = \eta + \tau_{i}\). Aqui, \(\eta\) é a média geral e \(\tau_{i}\) é o efeito do tratamento. Uma sutil mas importante diferença é que aqui o residual (\(\varepsilon_{ij}\)) não é considerado.
\item
  A \textbf{função de ligação}: Foi mensionado anteriormente que nos GLMs\indt{GLMs} a média não é necessariamente tomada como uma combinação linear de parâmetros, mas que alguma função da média é. Dados de distribuição binomial são geralmente melhor ajustados utilizando o parâmetro canônico \(log[\pi/(1-\pi)]\) (função da média) do que a média em si. Esta função é a função de ligação que relaciona a distribuição das observações com o preditor linear. em nosso caso, \(\eta_{ij} = log[\pi_{i}/(1-\pi_{i})]\). Assim, quando os parâmetros do modelo são ajustados não é a média que é estimada, mas a função de ligação. Neste caso, estamos interessados em estimar a probabilidade de sucesso (germinação) para cada tratamento, então \(\hat \pi_{i} = 1/(1 + e ^ {-\hat \eta_{i}})\).
\end{itemize}
\end{quote}

Dois exemplos numéricos serão implementados. O primeiro, considera a análise de dados de proporção discreta. O segundo é voltado para a análise de dados de contagem. Os dados utilizados são oriundos de um ensaio com nove cultivares de soja conduzidas em um delineamento DBC com quatro blocos. Em cada bloco, diversas variáveis foram mensuradas em 10 plantas aleatoriamente selecionadas. Para fins didáticos, somente as variáveis de interesse serão utilizadas aqui. (i) proporção de legumes viáveis, obtido pela razão entre o número de legumes viáveis (com ao menos um grão) e o número de legumes total das 10 plantas. (ii) o número total de legumes das 10 plantas que continha quatro grãos. Para cada exemplo, a análise será realizada considerando uma ANOVA\indt{ANOVA} normal, utilizando uma transformação indicada e utilizando um modelo misto generalizado.

\hypertarget{dados-de-proporuxe7uxe3o}{%
\subsection{Dados de proporção}\label{dados-de-proporuxe7uxe3o}}

Por definição, a proporção de legumes viáveis observado na \emph{j}-ésima repetição do \emph{i}-ésimo tratamento (\(p_{ij}\)) tem uma distribuição binomial onde \(p_{ij} \sim B(N, \pi_{ij})\), onde \(\pi_{ij}\) denota a probabilidade de uma observação aleatória do tratamento \emph{i} no bloco \emph{j} apresentar a característica de interesse -- neste caso do legume ser viável. Neste caso, o objetivo é estimar a probabilidade de cada tratamento e utilizando testes de hipóteses compará-las. O valor esperado para o tratamento \emph{i} é dado então por \(N\pi_i\) com variância \(N\pi_i(1-\pi_i)\).

Mesmo em experimentos com tamanho de amostra grande, diferenças significativas no \(\pi_i\) resultarão em variãncias heterogêneas, violando o pressuposto da ANOVA. Dados oriundo de proporções (\(p_{ij}\)) são frequentemente transformados para a escala \(P^*_{ij} = sen^{-1} \sqrt{P_{ij}}\) (Rodrigues-Soares et al. \protect\hyperlink{ref-Rodrigues-Soares2018}{2018}).

\begin{itemize}
\tightlist
\item
  \textbf{Exemplo numérico}
\end{itemize}

Para o exemplo, os dados de proporção de legumes viáveis descrito anteriormente serão utilizados. A figura 25 mostra a proporção de legumes viáveis para cada tratamento bem como a distribuição dos pontos em torno de uma linha de probabilidade normal esperada.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{SOJA \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"SOJA"}\NormalTok{)}
\NormalTok{medlvia \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(SOJA}\OperatorTok{$}\NormalTok{NLV }\OperatorTok{/}\StringTok{ }\NormalTok{SOJA}\OperatorTok{$}\NormalTok{NLT) }\CommentTok{\# Média de legumes viáveis}

\CommentTok{\# Explorando os dados}
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(SOJA, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ CULTIVAR, }\DataTypeTok{y =}\NormalTok{ NLV}\OperatorTok{/}\NormalTok{NLT)) }\OperatorTok{+}\StringTok{ }
\StringTok{             }\KeywordTok{geom\_boxplot}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"gray"}\NormalTok{) }\OperatorTok{+}
\StringTok{             }\KeywordTok{geom\_hline}\NormalTok{(}\DataTypeTok{yintercept =}\NormalTok{ medlvia, }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{)}\OperatorTok{+}
\StringTok{             }\KeywordTok{stat\_summary}\NormalTok{(}\DataTypeTok{fun =}\NormalTok{ mean, }\DataTypeTok{geom =} \StringTok{"point"}\NormalTok{, }\DataTypeTok{shape =} \DecValTok{23}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"red"}\NormalTok{) }\OperatorTok{+}
\StringTok{             }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Cultivares"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Taxa de legumes viáveis"}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(SOJA, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample =}\NormalTok{ NLV}\OperatorTok{/}\NormalTok{NLT))}\OperatorTok{+}
\StringTok{             }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_line}\NormalTok{(}\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}\OperatorTok{+}
\StringTok{             }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_point}\NormalTok{()}\OperatorTok{+}
\StringTok{             }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_band}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{0.2}\NormalTok{)}\OperatorTok{+}
\StringTok{             }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Theoretical quantiles"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Sample quantiles"}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"(a)"}\NormalTok{, }\StringTok{"(b)"}\NormalTok{),}
          \DataTypeTok{label\_size =} \DecValTok{10}\NormalTok{, }\DataTypeTok{vjust =} \DecValTok{3}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{{-}5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-203-1} 

}

\caption{Proporção de legumes viáveis em nove cultivares de soja (a) e gráfico Q-Q plot (b).}\label{fig:unnamed-chunk-203}
\end{figure}

A média do número de legumes viáveis observado foi de 0.89 (89\%). A cultivar C1 apresenta um valor ligeiramente menor que as outras cultivares. Em adição, a distribuição desta variável parece seguir uma distribuição normal; no entanto, este gráfico só deve ser utilizado para fins de exploração dos dados. \textbf{A inferência quanto a normalidade deve ser realizada nos resíduos}.

Os códigos seguintes são utilizados para realizar a análise considerando os três métodos. O primeiro modelo armazenado no objeto \texttt{convencional} é ajustado sem nenhuma transformação, onde a variável respota \texttt{(NLV/NLT)} é dada em função \texttt{\textasciitilde{}} do fator tratamento \texttt{(CULTIVAR)} + bloco \texttt{(REP)}. O segundo modelo armazenado no objeto \texttt{transform} é ajustado com a variável resposta transformada para o arcoseno da raiz quadrada da proporção (\texttt{asin(sqrt(NLV/NLT))}). O terceiro modelo armazenado no objeto \texttt{general} é ajustado considerando um modelo linear misto generalizado considerando o fator bloco aleatório. Para a implementação deste modelo considerou-se o seguinte:

\begin{quote}
\begin{itemize}
\item
  A \textbf{distribuição} das observações: \(y_{ij}|\beta_j \sim B(N, \pi_{ij})\), onde \emph{N} é o número de legumes total em cada bloco, e \(\pi_{ij}\) é a probabilidade da ocorrência de legumes viáveis para o \emph{i}-ésimo tratamento no \emph{j}-ésimo bloco.
\item
  O \textbf{preditor linear}: \(\eta_{ij} = \eta + \tau_{i} + \beta_j\), onde \(\beta_j \sim N(0, \sigma^2_b)\). Note que a adição do efeito de bloco como aleatório torna nosso modelo um modelo linear misto generalizado. Este efeito foi considerado aleatório, principalmente pela ocorrência de diferentes números de legumes observado em cada bloco. Stroup (\protect\hyperlink{ref-Stroup2015}{2015}) sugere fortemente considerar o efeito de bloco aleatório nestas condições.
\item
  A \textbf{função de ligação}: \(\eta_{ij}\) = Logit(\(\pi_{ij}\)) = \(log[\pi_{ij}/(1-\pi_{ij})]\)
\end{itemize}
\end{quote}

\indf{glmer} \indf{lm}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{convencional =}\StringTok{ }\KeywordTok{lm}\NormalTok{(NLV}\OperatorTok{/}\NormalTok{NLT }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR }\OperatorTok{+}\StringTok{ }\NormalTok{REP, }\DataTypeTok{data =}\NormalTok{ SOJA)}
\NormalTok{transform =}\StringTok{ }\KeywordTok{lm}\NormalTok{(}\KeywordTok{asin}\NormalTok{(}\KeywordTok{sqrt}\NormalTok{(NLV}\OperatorTok{/}\NormalTok{NLT)) }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR }\OperatorTok{+}\StringTok{ }\NormalTok{REP, }\DataTypeTok{data =}\NormalTok{ SOJA)}
\NormalTok{general =}\StringTok{ }\KeywordTok{glmer}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(NLV, NLT}\OperatorTok{{-}}\NormalTok{NLV) }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR }\OperatorTok{+}\StringTok{ }\NormalTok{(}\DecValTok{1}\OperatorTok{|}\NormalTok{REP),}
                \DataTypeTok{family =}\NormalTok{ binomial,}
                \DataTypeTok{data =}\NormalTok{ SOJA)}
\end{Highlighting}
\end{Shaded}

Os modelos ajustados foram salvos em seus respectivos objetos. Neste momento, uma investigação quanto aos pressuposstos destes modelos é necessária. As funções \texttt{shapiro.test()} e \texttt{leveneTest()} são utilizadas para a análise de normalidade e homogeneidade dos resíduos, respectivamente.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{shapiro.test}\NormalTok{(}\KeywordTok{residuals}\NormalTok{(convencional))}
\CommentTok{\# }
\CommentTok{\#   Shapiro{-}Wilk normality test}
\CommentTok{\# }
\CommentTok{\# data:  residuals(convencional)}
\CommentTok{\# W = 0.93971, p{-}value = 0.1198}
\KeywordTok{shapiro.test}\NormalTok{(}\KeywordTok{residuals}\NormalTok{(transform))}
\CommentTok{\# }
\CommentTok{\#   Shapiro{-}Wilk normality test}
\CommentTok{\# }
\CommentTok{\# data:  residuals(transform)}
\CommentTok{\# W = 0.95492, p{-}value = 0.2814}
\KeywordTok{shapiro.test}\NormalTok{(}\KeywordTok{residuals}\NormalTok{(general, }\DataTypeTok{type =} \StringTok{"deviance"}\NormalTok{))}
\CommentTok{\# }
\CommentTok{\#   Shapiro{-}Wilk normality test}
\CommentTok{\# }
\CommentTok{\# data:  residuals(general, type = "deviance")}
\CommentTok{\# W = 0.95317, p{-}value = 0.2557}
\KeywordTok{leveneTest}\NormalTok{(convencional}\OperatorTok{$}\NormalTok{residuals }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{SOJA}\OperatorTok{$}\NormalTok{CULTIVAR)}
\CommentTok{\# Levene\textquotesingle{}s Test for Homogeneity of Variance (center = median)}
\CommentTok{\#       Df F value Pr(\textgreater{}F)}
\CommentTok{\# group  8  0.0925 0.9991}
\CommentTok{\#       18}
\KeywordTok{leveneTest}\NormalTok{(transform}\OperatorTok{$}\NormalTok{residuals }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{SOJA}\OperatorTok{$}\NormalTok{CULTIVAR)}
\CommentTok{\# Levene\textquotesingle{}s Test for Homogeneity of Variance (center = median)}
\CommentTok{\#       Df F value Pr(\textgreater{}F)}
\CommentTok{\# group  8  0.1512 0.9948}
\CommentTok{\#       18}
\end{Highlighting}
\end{Shaded}

Nada parece haver de errado com nossos modelos até aqui. De fato, à 5\% de erro, tanto os resíduais do modelo \texttt{convencional} quanto \texttt{transform} são considerados homocedásticos e normalmente distribuídos. Vamos, agora, a uma abordagem gráfica.

\indt{Curiosidade}
\begin{vcsabia}
Testes de hipótese -incluíndo os testes de normalidade e homogeneidade- são sensíveis ao tamanho da amostra. Assim, quanto menor o tamanho da amostra (em nosso caso 27), menor é a probabilidae de rejeição da hipótese \(h_o\) (resíduos normais). Por outro lado, em tamanhos de amostra grande, a probabilidade de rejeição da hipótese \(h_o\) é maior. Este assunto é bem discutido por Kozak and Piepho (\protect\hyperlink{ref-Kozak2017}{2017}), quais demonstraram que gráficos residuais são melhores do que os testes estatísticos para verificar as pressuposições da ANOVA\indt{ANOVA}.
\end{vcsabia}

\indf{stat\_qq\_line} \indf{stat\_qq\_point} \indf{stat\_qq\_band}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res \textless{}{-}}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{Convencional =} \KeywordTok{residuals}\NormalTok{(convencional),}
              \DataTypeTok{Transformado =} \KeywordTok{residuals}\NormalTok{(transform),}
              \DataTypeTok{Generalizado =} \KeywordTok{residuals}\NormalTok{(general, }\DataTypeTok{type =} \StringTok{"deviance"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{       }\KeywordTok{gather}\NormalTok{()}
\KeywordTok{ggplot}\NormalTok{(res, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample =}\NormalTok{ value)) }\OperatorTok{+}
\StringTok{       }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_line}\NormalTok{(}\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}\OperatorTok{+}
\StringTok{       }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_point}\NormalTok{()}\OperatorTok{+}
\StringTok{       }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_band}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{0.2}\NormalTok{)}\OperatorTok{+}
\StringTok{       }\KeywordTok{facet\_wrap}\NormalTok{(}\OperatorTok{\textasciitilde{}}\NormalTok{key, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{)}\OperatorTok{+}
\StringTok{       }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Quantis teóricos"}\NormalTok{, }\DataTypeTok{y =}  \StringTok{"Quantis observados"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-207-1} 

}

\caption{Gráficos Q-Q plot dos resíduos obtidos na análise da proporção de legumes viáveis.}\label{fig:unnamed-chunk-207}
\end{figure}

\begin{note}
\textbf{Conclusão até aqui:} baseado em testes de aderência à normalidade e na interpretação gráfica, os pressupostos do modelo da ANOVA\indt{ANOVA} convencional foram cumpridos. Então, é justo perguntar: Por que utilizar um modelo mais ``complicado'' se há evidências de que a ANOVA\indt{ANOVA} nos dados transformados (ou mesmo nos dados originais) não trará maiores problemas? Antes de qualquer conclusão vamos observar os resultados dos três modelos.
\end{note}

O código abaixo é utilizado para obter as médias marginais dos modelos ajustados. Na ANOVA\indt{ANOVA} com os dados transformados e no modelo generalizado, todas as inferências são realizadas na escala transfromada mas as médias são apresentadas na escala original.
\indf{emmeans}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{med\_conv \textless{}{-}}\StringTok{ }\KeywordTok{emmeans}\NormalTok{(convencional, }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR,  }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{med\_trans \textless{}{-}}\StringTok{ }\KeywordTok{emmeans}\NormalTok{(transform, }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\CommentTok{\# Warning in (function (object, at, cov.reduce = mean, cov.keep = get\_emm\_option("cov.keep"), : There are unevaluated constants in the response formula}
\CommentTok{\# Auto{-}detection of the response transformation may be incorrect}
\NormalTok{med\_gene \textless{}{-}}\StringTok{ }\KeywordTok{emmeans}\NormalTok{(general, }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\CommentTok{\# gráficos para as médias}
\NormalTok{scale\_x \textless{}{-}}\StringTok{ }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{limits =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.75}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\NormalTok{xlab \textless{}{-}}\StringTok{ "Proporção de legumes viáveis"}
\NormalTok{p3 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(med\_conv, }\DataTypeTok{comparisons =}\NormalTok{ T, }\DataTypeTok{xlab =}\NormalTok{ xlab) }\OperatorTok{+}\StringTok{ }\NormalTok{scale\_x}
\NormalTok{p4 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(med\_trans, }\DataTypeTok{comparisons =}\NormalTok{ T, }\DataTypeTok{xlab =}\NormalTok{ xlab) }\OperatorTok{+}\StringTok{ }\NormalTok{scale\_x}
\CommentTok{\# Note: Use \textquotesingle{}contrast(regrid(object), ...)\textquotesingle{} to obtain contrasts of back{-}transformed estimates}
\NormalTok{p5 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(med\_gene, }\DataTypeTok{comparisons =}\NormalTok{ T, }\DataTypeTok{xlab =}\NormalTok{ xlab) }\OperatorTok{+}\StringTok{ }\NormalTok{scale\_x}
\KeywordTok{plot\_grid}\NormalTok{(p3, p4, p5, }\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }
          \DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"(a)"}\NormalTok{, }\StringTok{"(b)"}\NormalTok{, }\StringTok{"(c)"}\NormalTok{), }\DataTypeTok{hjust =} \FloatTok{{-}2.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-209-1} 

}

\caption{Médias estimadas, intervalos de confiança e comparação de médias para os modelos da ANOVA tradicional (a), com dados transformados (b) e generalizado (c) para a proporção de legumes viáveis.}\label{fig:unnamed-chunk-209}
\end{figure}

Comparando os resultados dos três modelos na mesma escala, fica fácil observar que o modelo generalizado apresentou um intervalo de confiança das médias (barra azul) menor quando comparado com os procedimentos tradicionais. A seta vermelha representa a comparação das médias pelo teste de Tukey a 5\% de erro. Tratamentos com setas que não se sobrepõe diferem estatisticamente considerando a probabilidade de erro.

Neste ponto identificamos as limitações do modelo convencional da ANOVA. A transformação indicada não ajudou muito. Todos os indícios levavam a acreditar que não teríamos maiores problemas realizando a ANOVA\indt{ANOVA} com os dados transformados --ou mesmo originais-- devido a boa aproximação normal dos erros. Estes modelos, no entanto, indicaram que as diferenças observadas entre as médias fora resultado do acaso, o que parece não fazer muito sentido quando observamos a figura 30. Neste caso, o pesquisador reportaria estes resultados em seu artigo/relatório e apresentaria alguma justificativa para este ``fracasso''. O que precisamos compreender, no entanto, é que \textbf{mesmo com uma boa aproximação normal} dos erros, \textbf{os dados ainda continuam sendo dados binomias!} Se observarmos no conjunto de dados veremos que cada bloco possui um número diferente de legumes totais. Ao considerar a proporção de legumes viáveis e análisar essa variável, ignoramos completamente o \emph{N} em nossa amostra. Poucos se dão conta, mas a proporção de 0.5 de legumes viáveis é a mesma considerando 5 legumes viáveis de um total de 10 legumes e 500 legumes viáveis de um total de 1000 legumes. A precisão, no entanto é diferente. O modelo generalizado aplicado neste exemplo considera esta diferença.

\hypertarget{dados-de-contagem}{%
\subsection{Dados de contagem}\label{dados-de-contagem}}

Dados de contagem são muito comuns em experimentos agronômicos, tendo a propriedade de serem não negativos e inteiros. Em probabilidade, estes tipos de dados seguem uma distribuição Poisson (Cochran \protect\hyperlink{ref-Cochran1940}{1940}). A exemplo de Zoz et al. (\protect\hyperlink{ref-Zoz2018}{2018}), dados discretos (\(D_{ij}\)) são frequentemente transformados para a escala \(D^*_{ij} = \sqrt{D_{ij}}\) ou para \(D^*_{ij} = \sqrt{D_{ij}+0,5}\) quando há um elevado número de zeros presente.

\begin{itemize}
\tightlist
\item
  \textbf{Exemplo numérico}
\end{itemize}

Para este exemplo, utilizaremos a variável número de legumes com quatro grãos (NL4G) do conjunto de dados \texttt{SOJA}. Os códigos abaixo são utilizado para a exploração dos dados.

\indf{ggplot} \indf{stat\_qq\_line} \indf{stat\_qq\_point}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{mednl4g \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(SOJA}\OperatorTok{$}\NormalTok{NL4G)}
\CommentTok{\# Explorando os dados}
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(SOJA, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ CULTIVAR, }\DataTypeTok{y =}\NormalTok{ NL4G)) }\OperatorTok{+}\StringTok{ }
\StringTok{             }\KeywordTok{geom\_boxplot}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"gray"}\NormalTok{) }\OperatorTok{+}
\StringTok{             }\KeywordTok{geom\_hline}\NormalTok{(}\DataTypeTok{yintercept =}\NormalTok{ mednl4g, }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{) }\OperatorTok{+}
\StringTok{             }\KeywordTok{stat\_summary}\NormalTok{(}\DataTypeTok{fun =}\NormalTok{ mean, }\DataTypeTok{geom =} \StringTok{"point"}\NormalTok{,}
                         \DataTypeTok{shape =} \DecValTok{23}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"red"}\NormalTok{) }\OperatorTok{+}
\StringTok{     }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Cultivares"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Número de legumes com quatro grãos"}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(SOJA, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample =}\NormalTok{ NL4G)) }\OperatorTok{+}
\StringTok{             }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_line}\NormalTok{(}\DataTypeTok{col =} \StringTok{"red"}\NormalTok{) }\OperatorTok{+}
\StringTok{             }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_point}\NormalTok{() }\OperatorTok{+}
\StringTok{             }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_band}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{0.2}\NormalTok{)}\OperatorTok{+}
\StringTok{      }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Quantis teóricos"}\NormalTok{, }\DataTypeTok{y =}  \StringTok{"Quantis observados"}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"(a)"}\NormalTok{, }\StringTok{"(b)"}\NormalTok{),}
                   \DataTypeTok{label\_size =} \DecValTok{10}\NormalTok{, }\DataTypeTok{vjust =} \DecValTok{3}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{{-}5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-210-1} 

}

\caption{Número de legumes com quatro grãos em nove cultivares de soja (a) e gráfico Q-Q plot (b)}\label{fig:unnamed-chunk-210}
\end{figure}

A média do número de legumes viáveis observado foi aproximadamente três legumes. O gráfico Q-Q nos ajuda a compreender que a distribuição desta variável claramente não é normal. Uma grande quantidade de zero é observada, o que é lógico, pois existem cultivares com a característica de não apresentar legumes com quatro grãos.

Os códigos seguintes são utilizados para realizar a análise considerando os três modelos. O primeiro modelo armazenado no objeto \texttt{convencional\_count} é ajustado sem nenhuma transformação, onde a variável respota \texttt{NL4G} é dada em função (\texttt{\textasciitilde{}}) do fator tratamento (\texttt{CULTIVAR}) \(+\) bloco (\texttt{REP}). O segundo modelo armazenado no objeto \texttt{transform\_count} é ajustado com a variável resposta transformada para a raiz quadrada do número de legumes com quatro grãos (\texttt{sqrt(NL4G)}). O terceiro modelo armazenado no objeto \texttt{general\_count} é ajustado considerando um modelo linear misto generalizado com blocos aleatórios e considerando que os dados seguem uma distribuição Poisson. Para a implementação deste modelo considerou-se o seguinte:

\begin{quote}
A \textbf{distribuição} das observações: \(y_{ij}|\beta_j \sim P(\lambda_{ij})\).

O \textbf{preditor linear}: \(\eta_{ij} = \eta + \tau_{i} + \beta_j\), onde \(\beta_j \sim N(0, \sigma^2_b)\).

A \textbf{função de ligação}: \(\eta_{ij}\) = Log(\(\lambda_{ij}\))
\end{quote}

\indf{lm} \indf{glmer}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{convencional\_cont \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(NL4G }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR }\OperatorTok{+}\StringTok{ }\NormalTok{REP, }\DataTypeTok{data =}\NormalTok{ SOJA)}
\NormalTok{transform\_cont \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(}\KeywordTok{sqrt}\NormalTok{(NL4G) }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR }\OperatorTok{+}\StringTok{ }\NormalTok{REP, }\DataTypeTok{data =}\NormalTok{ SOJA)}
\NormalTok{general\_cont \textless{}{-}}\StringTok{ }\KeywordTok{glmer}\NormalTok{(NL4G }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR }\OperatorTok{+}\StringTok{ }\NormalTok{(}\DecValTok{1}\OperatorTok{|}\NormalTok{REP),}
                     \DataTypeTok{family =}\NormalTok{ poisson,}
                     \DataTypeTok{data =}\NormalTok{ SOJA)}
\end{Highlighting}
\end{Shaded}

Conforme o primeiro exemplo, vamos realizar um diagóstico gráfico dos resíduos para os modelos ajustados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res \textless{}{-}}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{Convencional =} \KeywordTok{residuals}\NormalTok{(convencional\_cont),}
              \DataTypeTok{Transformado =} \KeywordTok{residuals}\NormalTok{(transform\_cont),}
              \DataTypeTok{Generalizado =} \KeywordTok{residuals}\NormalTok{(general\_cont, }\DataTypeTok{type =} \StringTok{"deviance"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{       }\KeywordTok{gather}\NormalTok{()}

\KeywordTok{ggplot}\NormalTok{(res, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample =}\NormalTok{ value)) }\OperatorTok{+}
\StringTok{       }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_line}\NormalTok{(}\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}\OperatorTok{+}
\StringTok{       }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_point}\NormalTok{()}\OperatorTok{+}
\StringTok{       }\NormalTok{qqplotr}\OperatorTok{::}\KeywordTok{stat\_qq\_band}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{0.2}\NormalTok{)}\OperatorTok{+}
\StringTok{       }\KeywordTok{facet\_wrap}\NormalTok{(}\OperatorTok{\textasciitilde{}}\NormalTok{key, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-212-1} 

}

\caption{Gráficos Q-Q plot dos resíduos }\label{fig:unnamed-chunk-212}
\end{figure}

O gráfico Q-Q para estes modelos indicou que os resíduos são distribuídos normalmente, considerando o intervalo de confiança. A transformação novamente não ajudou muito aqui. Embora não faça lógica testar a normalidade dos resíduos do modelo generalizado (visto que assumimos uma distribuição Poisson para os dados), o gráfico Q-Q mostra que os resíduos deste modelo se aproximou mais de uma distribuição normal comparado com os outros dois métodos.

\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 10}
Utilize o teste de Shapiro-Wilk para testar a hipótese de normalidade dos resíduos dos modelos ajustados anteriormente.
\end{tarefa}

\protect\hyperlink{exerc10}{Resposta}

Todos os três modelos indicaram diferenças significativas (5\% de erro) para as médias das cultivares. Para a ANOVA\indt{ANOVA} convencional, o erro padrão para todos os tratamentos foi 0.94, o que não pode ser verdade porque a variância e, portanto, os erros padrão, devem ser uma função da média em dados de contagem.

\begin{Shaded}
\begin{Highlighting}[]

\CommentTok{\# Médias ajustadas do número de grãos}
\NormalTok{med\_conv\_cont \textless{}{-}}\StringTok{ }\KeywordTok{emmeans}\NormalTok{(convencional\_cont, }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{med\_trans\_cont \textless{}{-}}\StringTok{ }\KeywordTok{emmeans}\NormalTok{(transform\_cont, }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{med\_gene\_cont \textless{}{-}}\StringTok{ }\KeywordTok{emmeans}\NormalTok{(general\_cont, }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{CULTIVAR, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{scale\_x \textless{}{-}}\StringTok{ }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{limits =} \KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{15}\NormalTok{))}
\NormalTok{xlab \textless{}{-}}\StringTok{ "Número de legumes com 4 grãos"}
\NormalTok{p7 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(med\_conv\_cont, }\DataTypeTok{comparisons =}\NormalTok{ T, }\DataTypeTok{xlab =}\NormalTok{ xlab) }\OperatorTok{+}\StringTok{ }\NormalTok{scale\_x}
\NormalTok{p8 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(med\_trans\_cont, }\DataTypeTok{comparisons =}\NormalTok{ T, }\DataTypeTok{xlab =}\NormalTok{ xlab) }\OperatorTok{+}\StringTok{ }\NormalTok{scale\_x}
\CommentTok{\# Note: Use \textquotesingle{}contrast(regrid(object), ...)\textquotesingle{} to obtain contrasts of back{-}transformed estimates}
\NormalTok{p9 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(med\_gene\_cont, }\DataTypeTok{comparisons =}\NormalTok{ T, }\DataTypeTok{xlab =}\NormalTok{ xlab) }\OperatorTok{+}\StringTok{ }\NormalTok{scale\_x}
\KeywordTok{plot\_grid}\NormalTok{(p7, p8, p9, }\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }
          \DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"(a)"}\NormalTok{, }\StringTok{"(b)"}\NormalTok{, }\StringTok{"(c)"}\NormalTok{),}
          \DataTypeTok{hjust =} \FloatTok{{-}2.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-214-1} 

}

\caption{Médias estimadas, intervalos de confiança e comparação de médias para os modelos da ANOVA tradicional (a), com dados transformados (b) e generalizado (c) para o número de legumes com 4 grãos.}\label{fig:unnamed-chunk-214}
\end{figure}

Para a ANOVA convencional e com dados transformados, o intervalo de confiança de 95\% para a média dos tratamentos apresentou limite inferior negativo para as cultivares C1 e C9. Isto é ilógico, pois não podemos observar número de legumes com quatro grãos negativo. Para o modelo generalizado isto não foi observado. Novamente aqui identificamos a limitação das técnicas convencional para análise de dados não normais. Stroup (\protect\hyperlink{ref-Stroup2013}{2013}) demonstrou que em alguns casos, o uso de transformações pode ser mais impreciso do que a ANOVA aplicada diretamente aos dados não transformados. Observamos o mesmo aqui.

A utilização dos modelos generalizados requer certos cuidados, tais como a definição da distribuição da variável à nível de observação e a função de ligação ideal a ser utilizada. Um resumo com as principais funções utilizadas pode ser visto em Stroup (\protect\hyperlink{ref-Stroup2015}{2015}). A extensão dos modelos lineares generalizados para os modelo lineares mistos generalizados permite ainda contemplar importantes aspectos na avaliação de ensaios multi-ambientes \indt{EMA}, tais como a modelagem da matriz de variância-covariância. O uso de modelos mistos também é fortemente recomendado em ensaios com delineamentos mais complexos, tais como parcelas sub-divididas ou sub-sub-divididas (Piepho and Edmondson \protect\hyperlink{ref-Piepho2018}{2018}).

Procedimentos que contemplam a análise considerando GLMs\indt{GLMs} e GLMMs\indt{GLMMs} estão disponíveis nos principais softwares estatísticos. O \href{https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm\#statug_glimmix_a0000001394.htm}{PROC GLIMMIX} e \href{https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm\#statug_genmod_sect001.htm}{PROC GENMOD} do SAS, e a função \texttt{glmer()} do pacotes \href{https://cran.r-project.org/web/packages/lme4/index.html}{lme4} no R podem ser utilizadas para a implementação destes modelos.

\hypertarget{efat}{%
\section{Experimentos bifatoriais}\label{efat}}

Experimentos fatoriais são muito comuns nas ciências agrárias, pois permitem o estudo de dois ou mais fatores em um mesmo experimento. Diversas são as vantagens em se conduzir um experimento deste tipo. Dentre elas, podemos citar a redução de custos, quando comparado à realizar um experimento para cada fator, a otimização da área experimental e dos tratos culturais, bem como a possibilidade de identificar o efeito de dois ou mais fatores sobre a magnitude da variável resposta. Esta é, talvez, a principal vantagem destes experimentos. Ao memo tempo, no entanto, é a fonte de um dos maiores desafios encontrados no meio acadêmico. O surgimento de uma terceira fonte de variação, conhecida por interação. \indt{interação}

Vamos considerar como exemplo, um experimento que avaliou a influencia de dois fatores, digamos \(\alpha\) e \(\tau\), em uma determinada variável resposta. O modelo estatístico considerado neste tipo de experimento é:

\[
{y_{ijk}} = {\rm{ }}\mu {\rm{ }} + {\rm{ }}\mathop \beta \nolimits_{k}  + \mathop \alpha \nolimits_i  + \mathop \tau \nolimits_j  + \mathop {(\alpha \tau )}\nolimits_{ij}  + {\rm{ }}\mathop \varepsilon \nolimits_{ijk}
\]

onde \({y_{ijk}}\) é o valor observado da combinação do \emph{i}-ésimo nível do fator \(\alpha\) com o \emph{j}-ésimo nível do fator \(\tau\) no \emph{k}-ésimo bloco; \(\mu\) é a média geral; \(\mathop \beta \nolimits_{k}\) é o efeito do bloco \emph{k}; \(\mathop \alpha \nolimits_i\) é o efeito do \emph{i}-ésimo nível de \(\alpha\) ; \(\mathop \tau \nolimits_j\) é o efeito do \emph{j}-ésimo nível de \(\tau\) ; \(\mathop {(\alpha \tau )}\nolimits_{ij}\) é o efeito da interação do \emph{i}-ésimo nível de \(\alpha\) com o \emph{j}-ésimo nível de \(\tau\); e \(\mathop \varepsilon \nolimits_{ijk}\) é o erro aleatório associado a \({y_{ijk}}\), assumindo \(\mathop \varepsilon \nolimits_{ijk} \mathop \cap \limits^{iid} N(0,\mathop \sigma \nolimits^2 )\).

Basicamente, estes fatores podem ser divididos em dois tipos: qualitativos \indt{qualitativo} e quantitativos \indt{quantitativo}. Um fator qualitativo é, como o nome já diz, relacionado a \emph{qualidade}, ou seja, diferentes em tipo mas não em quantidade. Como exemplo, podemos citar cultivares, defensivos agrícolas, práticas de manejo, etc. Um fator quantitativo, por outro lado, é caracterizado pela \emph{quantidade} utilizada no experimento. Podemos citar, por exemplo, doses de adubação. Cabe ressaltar que o termo \emph{fatorial} não indica um delineamento experimental, mas uma forma de arranjo de tratamentos na área parcela. Estes experimentos podem ser conduzidos tanto em DIC \indt{DIC} quanto DBC \indt{DBC}. Assim, em cada repetição/bloco, o tratamento a ser aplicado é a combinação dos níveis dos dois fatores. A combinação de diferentes tipos de fatores não influenciará a análise de variância dos dados, no entanto resultará em algumas particularidades nas análises complementares, como será visto ao longo desta seção.

\hypertarget{download-dos-dados}{%
\subsection{Download dos dados}\label{download-dos-dados}}

Nesta seção, serão analisados dados de experimentos bifatoriais com diferentes combinações de fatores qualitativos e quantitativos na presença de interação significativa e não significativa. Em todos os exemplos, será considerado o delineamento de blocos completos casualizados, tendo como variável resposta, o rendimento de grãos (RG). Para isto, utilizaremos cinco conjuntos de dados que serão detalhados a seguir.

\begin{longtable}[]{@{}ll@{}}
\toprule
\begin{minipage}[b]{0.10\columnwidth}\raggedright
Acrônimo\strut
\end{minipage} & \begin{minipage}[b]{0.84\columnwidth}\raggedright
Descrição\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.10\columnwidth}\raggedright
FAT1\_SI\strut
\end{minipage} & \begin{minipage}[t]{0.84\columnwidth}\raggedright
Fator 1 \textbf{qualitativo} (fontes de N), com três níveis; Fator 2 \textbf{qualitativo} (híbridos), com três níveis, \textbf{sem interação significativa}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\raggedright
FAT1\_CI\strut
\end{minipage} & \begin{minipage}[t]{0.84\columnwidth}\raggedright
Fator 1 \textbf{qualitativo} (fontes de N), com quatro níveis; Fator 2 \textbf{qualitativo} (híbridos), com três níveis, \textbf{com interação significativa}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\raggedright
FAT2\_SI\strut
\end{minipage} & \begin{minipage}[t]{0.84\columnwidth}\raggedright
Fator 1 \textbf{qualitativo} (híbridos), com dois níveis; Fator 2 \textbf{quantitativo} (doses de N), com cinco níveis, \textbf{sem interação significativa}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\raggedright
FAT2\_CI\strut
\end{minipage} & \begin{minipage}[t]{0.84\columnwidth}\raggedright
Fator 1 \textbf{qualitativo} (híbridos), com dois níveis; Fator 2 \textbf{quantitativo} (doses de N), com cinco níveis, \textbf{com interação significativa}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\raggedright
FAT3\strut
\end{minipage} & \begin{minipage}[t]{0.84\columnwidth}\raggedright
Fator 1 \textbf{quantitativo} (doses de N), com quatro níveis; Fator 2 \textbf{quantitativo} (doses de K), com cinco níveis, \textbf{com interação significativa}\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{FAT1\_CI \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"FAT1\_CI"}\NormalTok{)}
\NormalTok{FAT1\_SI \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"FAT1\_SI"}\NormalTok{)}
\NormalTok{FAT2\_CI \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"FAT2\_CI"}\NormalTok{)}
\NormalTok{FAT2\_SI \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"FAT2\_SI"}\NormalTok{)}
\NormalTok{FAT3 \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"FAT3"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Nesta seção, utilizaremos funções dos pacotes \href{https://tiagoolivoto.github.io/metan/}{metan}\footnote{\url{https://tiagoolivoto.github.io/metan/}} e \textbf{ExpDes.pt} \indt{ExpDes} (Ferreira, Cavalcanti, and Nogueira \protect\hyperlink{ref-Ferreira2018}{2018}) para análise estatistica dos dados. O pacote \emph{ExpDes.pt} contém funções úteis para análise de variância de experimentos nos delineamentos experimentais e arranjo de tratamentos mais conhecidos. A função do pacote \textbf{ExpDes.pt} utilizada neste exemplo será \texttt{fat2.dbc()} \indf{fat2.dbc} a qual analisa dados de experimentos bifatoriais em delineamento de blocos completos casualizados. Uma explicação detalhada será dada agora ao passo em que nos outros experimentos serão apresentadas apenas as linhas de comandos e uma breve discussão.

A delcaração dos argumentos na função \texttt{fat2.dbc()} é simples. Basta informarmos o nome das colunas do nosso arquivo correspondentes aos argumentos requeridos pela função. Por exemplo \texttt{fator1} e \texttt{fator2}, represetam os fatores em em estudo, que, neste caso, são híbridos e fontes de nitrogênio. No argumento \texttt{bloco} informamos o nome da coluna de nossos dados correspondente aos blocos. O mesmo para o argumento \texttt{resp} que é a variável resposta, no caso, o rendimento de grãos.

Definidos a entrada de dados, precisamos declarar quais as análises complementares a serem realizadas, em caso de significancia estatística. no argumento \texttt{quali}, informamos qual o tipo de fator em estudo. A declaração é um vetor lógico de comprimento 2. Em nosso caso, ao declararmos \texttt{quali\ =\ c(TRUE,\ TRUE)} (padrão) estamos informando que o ambos os fatores HÍBRIDO e FONTEN são qualitativos. O argumento \texttt{mcomp} é utilizado para informar o teste de comparação (ou agrupamento \indt{agrupamento}) de médias utilizado. Em nosso exemplo, vamos utilizar o teste Tukey (padrão). No argumento \texttt{fac.names} é possivel informar nomes específicos para os fatores. Os argumentos \texttt{sigF} e \texttt{sigT} são utilizados para informar a probabilidade de erro assumida na análise de variância e nas analises de comparação de médias, respectivamente. Ambos tem padrão 5\%.

O resultado da função \texttt{fat2.dbc()} irá depender da significância das fontes de variação do experimento. Em caso de interação não significativa \indt{interação} a função realiza uma comparação de médias para efeitos qualitativos e ajusta modelos de regressão polinomial para fatores quantitativos (quando significativos). Em experimentos com dois fatores qualitativos, em caso de interação significativa, a função realiza o desdobramento das médias dos fatores. Em caso de um fator qualitativo e outro quantitativo, em caso de interação significativa a função realiza a comparação das médias do fator qualitativo para cada nível do fator quantitativo, bem como ajusta uma regressão para cada nível do fator qualitativo.

\hypertarget{qualitativo-vs-qualitativo}{%
\subsection{Qualitativo vs qualitativo}\label{qualitativo-vs-qualitativo}}

\hypertarget{sem-interauxe7uxe3o-significativa}{%
\subsubsection{Sem interação significativa}\label{sem-interauxe7uxe3o-significativa}}

Como exemplo de análise de um experimento bifatorial com dois fatores qualitativos sem interação \indt{interação} significativa, utilizaremos o conjunto de dados \textbf{FAT1\_SI}. Já sabemos que a interação não será significativa neste exemplo. Os dois próximos gráficos nos ajudam a compreender porque.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hf3 \textless{}{-}}\StringTok{ }\KeywordTok{plot\_factbars}\NormalTok{(FAT1\_SI,}
\NormalTok{                     FONTEN,}
\NormalTok{                     HIBRIDO,}
                     \DataTypeTok{resp =}\NormalTok{ RG)}
\NormalTok{hf4 \textless{}{-}}\StringTok{ }\KeywordTok{plot\_factbars}\NormalTok{(FAT1\_SI,}
\NormalTok{                     FONTEN,}
\NormalTok{                     HIBRIDO,}
                     \DataTypeTok{resp =}\NormalTok{ RG,}
                     \DataTypeTok{invert =} \OtherTok{TRUE}\NormalTok{)}

\KeywordTok{plot\_grid}\NormalTok{(hf3, hf4, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"hf3"}\NormalTok{, }\StringTok{"hf4"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-216-1} 

}

\caption{Característica da produção em um experimento bifatorial sem interação significativa}\label{fig:unnamed-chunk-216}
\end{figure}

É possível identificar que o a magnitude da variável resposta de um fator não é alterada pelo nível do outro fator. Por exemplo, nota-se que o híbrido \emph{NUPEC\_2} parece ter uma média maior que os outros híbridos, independentemente da fonte de nitrogênio utilizada. Do mesmo modo, a fonte de nitrogênio \emph{AmonioA} parece proporcionar maior produtividade, independentemente do híbrido testado. Estas afirmações, no entanto, só poderão ser confirmadas pela análise de variância e posterior comparação de médias.

\indt{Dicas}
\begin{dica}
Gráficos iterativos podem ser obtidos utilizando a função \texttt{ggplotly()} do pacote \href{https://plot.ly/ggplot2/}{plotly}. Este pacote converte um objeto \textbf{ggplot2} em um gráfico iterativo que é apresentado na aba \emph{viewer} do ambiente de trabalho RStudio.
\end{dica}

\begin{itemize}
\tightlist
\item
  \textbf{Análise de variância}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{with}\NormalTok{(FAT1\_SI,}
     \KeywordTok{fat2.dbc}\NormalTok{(}\DataTypeTok{fator1 =}\NormalTok{  HIBRIDO,}
              \DataTypeTok{fator2 =}\NormalTok{  FONTEN,}
              \DataTypeTok{bloco =}\NormalTok{ BLOCO,}
              \DataTypeTok{resp =}\NormalTok{  RG,}
              \DataTypeTok{fac.names =} \KeywordTok{c}\NormalTok{(}\StringTok{"HIBRIDO"}\NormalTok{, }\StringTok{"FONTEN"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Plotagem das médias considerando os efeitos principais}
\end{itemize}

Conforme já sabido, a interação HIBRIDO x FONTEN não foi significativa a 5\% de probabilidade de erro. Assim, o procedimento a ser realizado é a comparação das médias para os fatores principais apenas. Os dois gráficos abaixo mostram as médias dos fatores principais.
\indf{fat2.dbc}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hf5 \textless{}{-}}\StringTok{ }\KeywordTok{plot\_bars}\NormalTok{(FAT1\_SI, HIBRIDO, RG, }\DataTypeTok{lab.bar =} \KeywordTok{c}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{), }\DataTypeTok{values =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{hf6 \textless{}{-}}\StringTok{ }\KeywordTok{plot\_bars}\NormalTok{(FAT1\_SI, FONTEN, RG, }\DataTypeTok{lab.bar =} \KeywordTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"b"}\NormalTok{), }\DataTypeTok{values =} \OtherTok{TRUE}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(hf5, hf6, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"hf5"}\NormalTok{, }\StringTok{"hf6"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-219-1} \end{center}

\indt{Dicas}
\begin{dica}
A função \texttt{plot\_bars()} utilizada para confeccionar os gráficos desta seção retorna a análise descritiva para os fatores considerados se o argumento \texttt{verbose\ =\ \ TRUE} for adicionado na função.
\end{dica}

\hypertarget{com-interauxe7uxe3o-significativa}{%
\subsubsection{Com interação significativa}\label{com-interauxe7uxe3o-significativa}}

\indt{interação}

O conjunto de dados utilizado neste exemplo será o \textbf{FAT1\_CI}. A análise de variância é realizada utilizando a mesma função anterior.

\begin{itemize}
\tightlist
\item
  \textbf{Análise de variância}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{with}\NormalTok{(FAT1\_CI,}
     \KeywordTok{fat2.dbc}\NormalTok{(}\DataTypeTok{fator1 =}\NormalTok{  HIBRIDO,}
              \DataTypeTok{fator2 =}\NormalTok{  FONTEN,}
              \DataTypeTok{bloco =}\NormalTok{ BLOCO,}
              \DataTypeTok{resp =}\NormalTok{  RG,}
              \DataTypeTok{fac.names =} \KeywordTok{c}\NormalTok{(}\StringTok{"HIBRIDO"}\NormalTok{, }\StringTok{"FONTEN"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

Como a interação \indt{interação} foi significativa, o próximo passo é a comparação das médias considerando os efeitos da interação. Os valores das médias fixando os níveis de cada fator são, por padrão, calculados pela função \texttt{fat2.dbc()}\indt{fat2.dbc()}. A apresentação destas médias em um trabalho científico, por exemplo, pode ser por meio de tabelas, ou gráficos. A função \texttt{plot\_factbars()} é usada aqui para confeccionar um gráfico de barras mostrando a interação entre os fatores.

\begin{itemize}
\tightlist
\item
  \textbf{Plotagem das médias considerando a interação}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{plot\_factbars}\NormalTok{(FAT1\_CI, FONTEN, HIBRIDO, }\DataTypeTok{resp =}\NormalTok{ RG,}
              \DataTypeTok{values =} \OtherTok{TRUE}\NormalTok{,}
              \DataTypeTok{lab.bar =} \KeywordTok{c}\NormalTok{(}\StringTok{"bB"}\NormalTok{, }\StringTok{"cC"}\NormalTok{, }\StringTok{"aB"}\NormalTok{, }\CommentTok{\# AmonioA}
                          \StringTok{"bC"}\NormalTok{, }\StringTok{"bD"}\NormalTok{, }\StringTok{"aC"}\NormalTok{, }\CommentTok{\# NitratoA}
                          \StringTok{"aA"}\NormalTok{, }\StringTok{"aA"}\NormalTok{, }\StringTok{"aA"}\NormalTok{, }\CommentTok{\# SulfatoA}
                          \StringTok{"cC"}\NormalTok{, }\StringTok{"aB"}\NormalTok{, }\StringTok{"bC"}\NormalTok{)) }\CommentTok{\# Ureia}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-222-1} \end{center}

\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 11}
- Confeccione um gráfico semelhante ao acima considerando o fator FONTEN mapeado em escala de cinza.
\end{tarefa}

\protect\hyperlink{exerc11}{Resposta}

\hypertarget{qualitativo-vs-quantitativo}{%
\subsection{Qualitativo vs quantitativo}\label{qualitativo-vs-quantitativo}}

\hypertarget{sem-interauxe7uxe3o-significativa-1}{%
\subsubsection{Sem interação significativa}\label{sem-interauxe7uxe3o-significativa-1}}

O conjunto de dados utilizado neste exemplo será o \textbf{FAT2\_SI}. Do mesmo modo do exemplo anterior, iremos confeccionar um gráfico prévio para visualização dos dados.

\begin{itemize}
\tightlist
\item
  \textbf{Visualização dos dados}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(FAT2\_SI, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ DOSEN, }\DataTypeTok{y =}\NormalTok{ RG)) }\OperatorTok{+}
\StringTok{       }\KeywordTok{geom\_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =} \KeywordTok{factor}\NormalTok{(HIBRIDO)), }\DataTypeTok{size =} \FloatTok{1.5}\NormalTok{) }\OperatorTok{+}
\StringTok{       }\KeywordTok{geom\_smooth}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =} \KeywordTok{factor}\NormalTok{(HIBRIDO)), }\DataTypeTok{method =} \StringTok{"loess"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-224-1} 

}

\caption{Característica de produção em um experimento bifatorial sem interação significativa}\label{fig:unnamed-chunk-224}
\end{figure}

\indf{ggplot}

\begin{itemize}
\tightlist
\item
  \textbf{análise estatistica dos dados}
\end{itemize}

A função \texttt{fat2.rdb()} \indf{fat2.rbd} será novamente utilizada neste exemplo. A declaração dos argumentos é idêntica ao exemplo anterior. O que mudará aqui, é que será necessário informar que o fator DOSEN é quantitativo. Para isso, usa-se o argumento \texttt{quali}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{with}\NormalTok{(FAT2\_SI, }
     \KeywordTok{fat2.dbc}\NormalTok{(}\DataTypeTok{fator1 =}\NormalTok{  HIBRIDO,}
              \DataTypeTok{fator2 =}\NormalTok{  DOSEN,}
              \DataTypeTok{bloco =}\NormalTok{ BLOCO,}
              \DataTypeTok{resp =}\NormalTok{  RG,}
              \DataTypeTok{quali =} \KeywordTok{c}\NormalTok{(}\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{),}
              \DataTypeTok{fac.names =} \KeywordTok{c}\NormalTok{(}\StringTok{"HIBRIDO"}\NormalTok{, }\StringTok{"DOSE"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\indf{fat2.rbd}

Como a interação não foi significativa, proceder-se-a a comparação de médias dos dois híbridos considerando a média de todas as doses de nitrogênio, e o ajuste de apenas uma regressão para os dois híbridos. Como o grau do polinômio significativo foi quadrático, declararmos \texttt{fit\ =\ 2} na função \texttt{plot\_lines()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{h \textless{}{-}}\StringTok{ }\KeywordTok{plot\_bars}\NormalTok{(FAT2\_SI, HIBRIDO, RG,}
                 \DataTypeTok{width.bar =} \FloatTok{0.5}\NormalTok{,}
                 \DataTypeTok{lab.bar =} \KeywordTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{))}
\NormalTok{d \textless{}{-}}\StringTok{ }\KeywordTok{plot\_lines}\NormalTok{(FAT2\_SI, DOSEN, RG,}
                \DataTypeTok{fit =} \DecValTok{2}\NormalTok{,}
                \DataTypeTok{col =} \OtherTok{FALSE}\NormalTok{,}
                \DataTypeTok{xlab =} \StringTok{"Doses de nitrogênio"}\NormalTok{,}
                \DataTypeTok{ylab =} \StringTok{"Rendimento de grãos (Mg/ha)"}\NormalTok{) }\OperatorTok{+}
\StringTok{     }\KeywordTok{geom\_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{6.5}\NormalTok{, }\DataTypeTok{label=}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\KeywordTok{expression}\NormalTok{(}\StringTok{"y = 6,8326 + 0,0012x {-} 0,0003x"}\OperatorTok{\^{}}\DecValTok{2}\OperatorTok{*}\StringTok{"  R"} \OperatorTok{\^{}}\DecValTok{2}\OperatorTok{*}\StringTok{" = 0,99 "}\NormalTok{)))),}
               \DataTypeTok{hjust =} \DecValTok{0}\NormalTok{,}
               \DataTypeTok{col =} \StringTok{"black"}\NormalTok{,}
               \DataTypeTok{parse =} \OtherTok{TRUE}\NormalTok{) }
\KeywordTok{plot\_grid}\NormalTok{(h, d, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"h"}\NormalTok{, }\StringTok{"d"}\NormalTok{), }\DataTypeTok{rel\_widths =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-226-1} \end{center}
\indf{coord\_flip}
\indf{plot\_factbars}

\hypertarget{com-interauxe7uxe3o-significativa-1}{%
\subsubsection{Com interação significativa}\label{com-interauxe7uxe3o-significativa-1}}

O conjunto de dados utilizado neste exemplo será o \textbf{FAT2\_CI}. Por se tratar de um experimento fatorial com um fator qualitativo (hibrido) e outro quantitativo (dose), convém confeccionar um gráfico com o rendimento observado de cada híbrido em cada dose. Este gráfico, além de servir como ferramenta para identificar possíveis \emph{outliers}, também nos permite identificar a resposta de cada híbrido. Cabe salientar que este é um gráfico meramente ilustrativo. A análise estatistica dos dados será realizada posteriormente.

\begin{itemize}
\tightlist
\item
  \textbf{Visualização dos dados}
  \indf{ggplot}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(FAT2\_CI, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ DOSEN, }\DataTypeTok{y =}\NormalTok{ RG)) }\OperatorTok{+}\StringTok{ }\CommentTok{\# cria um objeto ggplot}
\StringTok{       }\KeywordTok{geom\_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =} \KeywordTok{factor}\NormalTok{(HIBRIDO)), }\DataTypeTok{size =} \FloatTok{1.5}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{\# adiciona pontos}
\StringTok{       }\KeywordTok{geom\_smooth}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =} \KeywordTok{factor}\NormalTok{(HIBRIDO)), }\DataTypeTok{method =} \StringTok{"loess"}\NormalTok{) }\CommentTok{\# adiciona banda}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-227-1} 

}

\caption{Rendimento observado de cada híbrido em cada dose de nitrogênio}\label{fig:unnamed-chunk-227}
\end{figure}

\begin{importante}
Para evitar uma longa saída neste documento devido a interação significativa, a impressão dos resultados foi suprimida. Rode a programação em seu console para observar os resultados.
\end{importante}

\%in\%

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{with}\NormalTok{(FAT2\_CI, }
     \KeywordTok{fat2.dbc}\NormalTok{(}\DataTypeTok{fator1 =}\NormalTok{  HIBRIDO,}
     \DataTypeTok{fator2 =}\NormalTok{  DOSEN,}
     \DataTypeTok{bloco =}\NormalTok{ BLOCO,}
     \DataTypeTok{resp =}\NormalTok{  RG,}
     \DataTypeTok{quali =} \KeywordTok{c}\NormalTok{(}\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{),}
     \DataTypeTok{fac.names =} \KeywordTok{c}\NormalTok{(}\StringTok{"HIBRIDO"}\NormalTok{, }\StringTok{"DOSE"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

A análise de indicou efeitos significativos tanto para os efeitos principais, quanto para a interação. Assim, as análises complementares realizadas foram (i) a comparação das médias pelo teste Tukey em cada nível da dose de N; e (ii) uma regressão polinomial ajustada para cada híbrido. Por padrão, o máximo grau do polinômio ajustado é 3 (modelo cúbico).

\begin{itemize}
\tightlist
\item
  Comparação das médias dos híbridos em cada dose de nitrogênio.
\end{itemize}

As comparações de médias são apresentadas como saída da função \texttt{fat2.dbc()} após a análise de variância. Neste momento, utilizaremos a função \texttt{plot\_factbars()} \indf{plot\_factbars} do pacote \texttt{metan}** para plotar as médias dos híbridos em cada dose de nitrogênio. A apresentação gráfica de resultados, mesmo considerando médias, é uma alternativa interessante à tabela, pois permite uma interpretação mais clara e intuitiva dos resultados.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot\_factbars}\NormalTok{(FAT2\_CI, DOSEN, HIBRIDO,}
              \DataTypeTok{resp =}\NormalTok{ RG,}
              \DataTypeTok{xlab =} \StringTok{"Doses de nitrogênio"}\NormalTok{,}
              \DataTypeTok{ylab =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Rendimento de grãos (Mg ha"}\OperatorTok{\^{}{-}}\DecValTok{1}\NormalTok{,}\StringTok{")"}\NormalTok{)),}
              \DataTypeTok{palette =} \StringTok{"Greys"}\NormalTok{,}
              \DataTypeTok{lab.bar =} \KeywordTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\CommentTok{\# 0}
                          \StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\CommentTok{\# 25}
                          \StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\CommentTok{\# 50}
                          \StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\CommentTok{\# 75}
                          \StringTok{"a"}\NormalTok{, }\StringTok{"a"}\NormalTok{)) }\CommentTok{\# 100}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-230-1} 

}

\caption{Gráfico das médias dos híbridos em cada dose de nitrogênio.}\label{fig:unnamed-chunk-230}
\end{figure}

\begin{itemize}
\tightlist
\item
  Ajuste de regressão para cada híbrido
\end{itemize}

No exemplo anterior, apresentamos as médias dos híbridos em cada dose de nitrogênio. Agora, criaremos um gráfico com o grau do polinômio significativo ajustado de cada híbrido. O grau a ser ajustado deve ser identificado na saída da ANOVA \indt{ANOVA}. Para fins didáticos um resumo é fornecido.

\begin{longtable}[]{@{}lll@{}}
\toprule
\begin{minipage}[b]{0.11\columnwidth}\raggedright
Hibrido\strut
\end{minipage} & \begin{minipage}[b]{0.16\columnwidth}\raggedright
Polinômio\strut
\end{minipage} & \begin{minipage}[b]{0.65\columnwidth}\raggedright
Equação\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.11\columnwidth}\raggedright
NUPEC\_1\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\raggedright
Quadrático\strut
\end{minipage} & \begin{minipage}[t]{0.65\columnwidth}\raggedright
\(y = 11,555 + 0,05575\times x -0,0005574\times x^2, R^2 = 0.999\)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\raggedright
NUPEC\_2\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\raggedright
Linear\strut
\end{minipage} & \begin{minipage}[t]{0.65\columnwidth}\raggedright
\(y = 9,2054 + 0,0209\times x, R^2 = 0.986\)\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

Utilizando uma equação, é possível estimar a produtividade para uma dose de nitrogênio específica não testada, desde que ela esteja dentro do intervalo estudado. Para isto, basta substituir o \emph{x} na equação pela dose a ser testada. Por exemplo, para estimar qual seria a produtividade do híbrido \emph{NUPEC\_1} se tivéssemos aplicado 60 kg de N ha\(^{-1}\) basta resolver: \(y = 9,2054 + 0,0209\times 60\), resultando em \(y \approx 10.5\) Mg ha\(^{-1}\). A interpretação deste resultado, no entanto, deve ser cautelosa. Inconscientemente, concluiríamos que a produtividade do híbrido aumentaria 0,0209 Mg ha\(^{-1}\) a cada kg de nitrogênio aplicado por hectare. Este fato, no entanto, não é observado na prática. Por exemplo, a produtividade não irá aumentar infinitamente a medida em que se aumenta a dose de nitrogênio aplicado. A única conclusão válida, neste caso, é que a produtividade aumenta linearmente até 100 kg de N ha\(^{-1}\). Este resultado se deu em virtude de as doses testadas não terem sido o suficiente para identificar um outro comportamento na variável testada. Nestes casos, indica-se para estudos futuros aumentar o número de doses. Quando não se conhece o intervalo de dose em que a variável em estudo apresenta uma resposta explicável, estudos pilotos podem ser realizados. Neste caso, testar-se-iam o mesmo número de tratamentos (número de doses), no entanto com um intervalo maior entre as doses (por exemplo, 0, 100, 200, 300 e 400 kg de N ha\(^{-1}\). Possivelmente, nesta amplitude, o comportamento da produtividade não seria linear, pois em uma determinada dose, a produtividade estabilizaria.

Semelhante ao exemplo das médias nas doses de nitrogênio, utilizaremos a função \texttt{plot\_factlines()} \indf{plot\_factlines} para plotar, agora, uma regressão \indt{regressão} ajustada para cada híbrido. Os argumentos a serem informados são os seguintes: \texttt{.data}, o conjunto de dados (neste caso \emph{FAT2\_CI}); \texttt{x} e \texttt{y}, as colunas dos dados correspondentes aos eixos x e y do gráfico, respectivamente; \texttt{group} a coluna que contém os níveis dos fatores em que as regressões serão ajustadas; \texttt{fit} um vetor de comprimento igual ao número de níveis da coluna informada em \texttt{group}. O número indicado em cada posição do vetor, corresponde ao grau do polinômio ajustado (máximo grau ajustado = 4). Em nosso exemplo, utilizaremos \texttt{fit\ =\ c(2,\ 1)} para ajustar uma regressão quadrática para o híbrido \emph{NUPEC\_1} e uma regressão linear para o híbrido \emph{NUPEC\_2}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot\_factlines}\NormalTok{(FAT2\_CI, DOSEN, RG,}
               \DataTypeTok{group =}\NormalTok{ HIBRIDO,}
               \DataTypeTok{fit =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-231-1} \end{center}

Observando-se a figura acima, é possível identificar o comportamento quadrático da variável resposta do híbrido \emph{NUPEC\_1}. Para estes híbridos, houve um incremento positivo na produtividade até um ponto, posteriormente observa-se que a produtividade tendeu a reduzir. Uma explicação biológica para esta redução seria que o excesso de nitrogênio aplicado proporcionou um alto vigor vegetativo as plantas, podendo ter ocorrido competição entre as plantas por água, luz e outros nutrientes, ou até mesmo tombamento das plantas. O ponto em X (dose) em que a produtividade é máxima é chamado de máxima eficiência técnica (MET) e pode ser estimado por: \indt{Máxima eficiência técnica}

\[
MET = \frac{{ - {\beta _1}}}{{2 \times {\beta _2}}}
\]

Substituindo com os parâmetros estimados, temos:
\[
MET = \frac{{ - 0,05575}}{{2 \times  -0,0005574}} = 50
\]

Logo, a dose que proporciona a máxima produtividade para o híbrido \emph{NUPEC\_1} é aproximadamente 50 kg de N ha\(^{-1}\). Assim para sabermos qual é esta produtividade estimada, basta substituir o \emph{x} da equação por 50, resultando em \(y_{máx}\) = 12,949 Mg ha\(^{-1}\).

Outro ponto importante que é possível de estimar utilizando uma equação de segundo grau, é a máxima eficiência econômica (MEE)\indt{Máxima eficiência econômica}, ou seja, a dose máxima, neste caso de nitrogênio, em que é possível aplicar obtendo-se lucro. Este ponto é importante, pois a partir de uma certa dose, os incrementos em produtividade não compensariam o preço pago pelo nitrogênio aplicado. Este ponto pode ser facilmente estimado por:

\[
MEE = MET + \frac{u}{{2 \times \beta_2 \times m}}
\]

onde \emph{u} e \emph{m} são os preços do nitrogênio e do milho em grão, respectivamente, na mesma unidade utilizada para a estimativa da equação (neste caso, preço do nitrogênio por kg e preço do milho por tonelada). Considerando o preço de custo do nitrogênio como R 1,35 por kg e o preço de venda do milho a 600,00 por tonelada, substituindo-se na formula obtém-se:

\[
MEE = 50 + \frac{{1.35}}{{2 \times (-0,0005574) \times 600}} \approx 48
\]

Assim, a dose máxima de nitrogênio que em que os incrementos de produtividade são lucrativos é de \(\approx 48\) Kg ha\(^{-1}\).

\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 12}

\begin{itemize}
\item
  Utilize as funções do pacote \textbf{dplyr} para selecionar apenas o híbrido \emph{NUPEC\_1} do exemplo anterior.
\item
  Confeccione um gráfico com uma linha ajustada considerando um modelo polinomial de segundo grau.
\item
  Insira uma linha vertical tracejada e cinza que intercepta o eixo x na dose de máxima eficiência técnica.
\item
  Insira uma linha vertical sólida e cinza que intercepta o eixo x na dose de máxima eficiência econômica.
\end{itemize}
\end{tarefa}

\protect\hyperlink{exerc12}{Resposta}

\hypertarget{quantitativo-vs-quantitativo}{%
\subsection{Quantitativo vs quantitativo}\label{quantitativo-vs-quantitativo}}

Neste exemplo, iremos avaliar dados de um experimento que testou dois fatores quantitativos. O conjunto de dados utilizado é o \textbf{FAT3}. A análise de variância, neste caso, é realizada da mesma maneira que os exemplos anteriores, o que muda agora é que a análise complementar, em caso de interação significativa será diferente. Por se tratar de dois fatores quantitativos, neste caso, doses de nitrogênio e de potássio na cultura do milho, é de se esperar que, em caso de interação \indt{interação} significativa, haja uma combinação de doses ótimas que proporcione a maior magnitude da variável resposta (rendimento de grãos). Assim, uma análise de superfície de resposta é a mais indicada para este tipo de experimento.

Para a análise neste exemplo, utilizaremos a função \texttt{resp\_surf()}\indf{resp\_surf}. Nesta função estão implementadas as seguintes rotinas: análise de variância, ajuste da equação de superfície de resposta, determinação dos pontos críticos, estatisticas de ajuste e análise residual. O procedimento para a análise é simples. Os seguintes argumentos precisam ser declarados: \texttt{.data}, o conjunto de dados; \texttt{fator1} o nome da coluna com o primeiro fator; \texttt{fator2} o nome da coluna com o segundo fator; \texttt{rep} o nome da coluna com os blocos; e \texttt{resp} o nome da coluna com a variável resposta que se deseja analizar. Neste exemplo, vamos armazenar os resultados no objeto \texttt{sresp}.

\begin{itemize}
\tightlist
\item
  \textbf{Análise estatística}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{srmod =}\StringTok{  }\KeywordTok{resp\_surf}\NormalTok{(FAT3,}
                   \DataTypeTok{factor1 =}\NormalTok{ DOSEN,}
                   \DataTypeTok{factor2 =}\NormalTok{ DOSEK,}
                   \DataTypeTok{rep =}\NormalTok{ BLOCO,}
                   \DataTypeTok{resp =}\NormalTok{ RG)}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Result for the analysis of variance }
\CommentTok{\# Model: Y = m + bk + Ai + Dj + (AD)ij + eijk }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#             Df Sum Sq Mean Sq  F value   Pr(\textgreater{}F)    }
\CommentTok{\# BLOCO        3    158      53    3.621   0.0183 *  }
\CommentTok{\# DOSEN        3  65978   21993 1515.063  \textless{} 2e{-}16 ***}
\CommentTok{\# DOSEK        4  11817    2954  203.513  \textless{} 2e{-}16 ***}
\CommentTok{\# DOSEN:DOSEK 12   2363     197   13.563 1.21e{-}12 ***}
\CommentTok{\# Residuals   57    827      15                      }
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Shapiro{-}Wilk\textquotesingle{}s test for normality of residuals: }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# W =  0.946194 p{-}valor =  0.002100403 }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Anova table for the response surface model }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Response: RG}
\CommentTok{\#             Df Sum Sq Mean Sq  F value    Pr(\textgreater{}F)    }
\CommentTok{\# DOSEN        1   3215    3215  15.4854  0.000186 ***}
\CommentTok{\# DOSEK        1   6538    6538  31.4899 3.301e{-}07 ***}
\CommentTok{\# I(DOSEN\^{}2)   1  50925   50925 245.2693 \textless{} 2.2e{-}16 ***}
\CommentTok{\# I(DOSEK\^{}2)   1   5098    5098  24.5541 4.440e{-}06 ***}
\CommentTok{\# DOSEN:DOSEK  1      1       1   0.0053  0.942298    }
\CommentTok{\# Residuals   74  15365     208                       }
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Model equation for response surface model }
\CommentTok{\# Y = B0 + B1*A + B2*D + B3*A\^{}2 + B4*D\^{}2 + B5*A*D }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Estimated parameters }
\CommentTok{\# B0: {-}317.8340786}
\CommentTok{\# B1: 14.7502633}
\CommentTok{\# B2: 1.0056943}
\CommentTok{\# B3: {-}0.1121344}
\CommentTok{\# B4: {-}0.0076331}
\CommentTok{\# B5: 0.0001973}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Matrix of parameters (A) }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# {-}0.1121344    9.87e{-}05 }
\CommentTok{\# 9.87e{-}05    {-}0.0076331 }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Inverse of the matrix A (invA) }
\CommentTok{\# {-}8.9179679    {-}0.1152744 }
\CommentTok{\# {-}0.1152744    {-}131.0091259 }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Vetor of parameters B1 e B2 (X) }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# B1: 14.7502633}
\CommentTok{\# B2: 1.0056943}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Equation for the optimal points (A and D) }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# {-}0.5*(invA*X)}
\CommentTok{\# Eigenvalue 1: {-}0.007633}
\CommentTok{\# Eigenvalue 2: {-}0.112135}
\CommentTok{\# Stacionary point is maximum!}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Stacionary point obtained with the following original units: }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Optimal dose (DOSEN): 65.8292}
\CommentTok{\# Optimal dose (DOSEK): 66.7277}
\CommentTok{\# Predicted: 201.2184}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Fitted model }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# A = DOSEN}
\CommentTok{\# D = DOSEK}
\CommentTok{\# y = {-}317.83408+14.75026A+1.00569D+{-}0.11213A\^{}2+{-}0.00763D\^{}2+2e{-}04A*D}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Shapiro{-}Wilk normality test}
\CommentTok{\# p{-}value:  0.4522241 }
\CommentTok{\# According to Shapiro{-}Wilk normality test at 5\% of significance, residuals can be considered normal. }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{P1 =}\StringTok{ }\KeywordTok{plot}\NormalTok{(srmod)}
\NormalTok{P2 =}\StringTok{ }\KeywordTok{plot}\NormalTok{(srmod, }\DataTypeTok{cut =} \DecValTok{9}\NormalTok{,}
          \DataTypeTok{colorkey =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{space =} \StringTok{"top"}\NormalTok{, }\DataTypeTok{width =} \DecValTok{1}\NormalTok{),}
          \DataTypeTok{xlab =} \StringTok{"Dose de Nitrogênio (Kg/ha)"}\NormalTok{,}
          \DataTypeTok{ylab=} \StringTok{"Dose de Potássio (Kg/ha)"}\NormalTok{)}

\NormalTok{gridExtra}\OperatorTok{::}\KeywordTok{grid.arrange}\NormalTok{(P1, P2, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-233-1} \end{center}

Podemos observar que a interação DOSEN x DOSEK foi significativa, assim a metodologia de superficie de resposta foi corretamente utilizada. A equação de superfícide considerada é um modelo com termos de segunda ordem, onde a variável resposta é estimada considerando dois preditores, neste caso doses de nitrogênio e doses de potássio. Considerando estes fatores como \emph{A} e \emph{D} o seguinte modelo é ajustado: \(Y_i = \beta_0 + \beta_1A_i+\beta_2D_i+\beta_3A_i^2+\beta_4D_i^2 +\beta_5A_iD_i+\epsilon_i\). Os parametros estimados estão em \emph{Parâmetros estimados}.

As doses ótimas são estimadas pela seguinte equação: \indt{doses ótimas}

\[
- 0.5 \times ({{\boldsymbol{A}}^{ - 1}}{\boldsymbol{X}})
\]

Onde

\[
{\boldsymbol{A}} = \left( {\begin{array}{*{20}{c}}{{\beta _3}}&{{\beta _5}/2}\\{{\beta _5}/2}&{{\beta _4}}\end{array}} \right)
\]

e

\[
{\boldsymbol{X}} = \left( \begin{array}{l}{\beta _1}\\{\beta _2}\end{array} \right)
\]

Em nosso exemplo,

\[
{\boldsymbol{A}} = \left( {\begin{array}{*{20}{c}}{ - 0.11213}&{9.865e - 05}\\{9.865e - 05}&{ - 0.00763}\end{array}} \right){\rm{; }}{{\boldsymbol{A}}^{ - 1}} = \left( {\begin{array}{*{20}{c}}{ - 8.91796}&{ - 0.1152}\\{ - 0.11527}&{ - 131.009}\end{array}} \right)
\]

e

\[
{\boldsymbol{X}} = \left( \begin{array}{l}14.7502\\1.00569\end{array} \right)
\]

Assim

\[
- 0.5 \times \left[ {\left( {\begin{array}{*{20}{c}}{ - 8.91796}&{ - 0.1152}\\{ - 0.11527}&{ - 131.009}\end{array}} \right) \times \left( \begin{array}{l}14.7502\\1.00569\end{array} \right)} \right] = \left( \begin{array}{l}65.8292\\66.7277\end{array} \right)
\]

\hypertarget{experimentos-em-parcelas-subdivididas}{%
\subsection{Experimentos em parcelas subdivididas}\label{experimentos-em-parcelas-subdivididas}}

Experimentos fatoriais são úteis devido a possibilidade de se testar dois ou mais fatores em um mesmo experimento. Uma desvantagem deste tipo de experimento é que cada bloco deve receber todos os tratamentos, ou seja, todas as combinações dos níveis dos dois fatores. Assim, o número de parcelas no experimento e consequentemente o tamanho da área experimental crese drastricamente na medida em que são incluídos fatores ou níveis de fatores no experimento. Uma maneira de se contornar isto, é a condução de experimentos em parcelas subdivididas.

Parcelas subdivididas \indt{parcelas subdivididas} são um caso especial de estrutura de tratamentos fatorial em que um fator é alocado na parcela principal e outro fator é alocado na subparcela. Este tipo de estrutura de tratamentos pode ser utilizada quando um fator é de dificil instalação em pequenas parcelas, como por exemplo, a semeadura mecanizada ou um sistema de irrigação, e o segundo fator pode ser alocado em parcelas mais pequenas, como um doses de nitrogênio, por exemplo.

Diferentemente do \protect\hyperlink{experimentos-bifatoriais}{modelo fatorial tradicional}, o modelo estatístico para análise de experimentos em parcelas subdivididas conta com mais uma fonte de variação. Vamos considerar como exemplo, um experimento que avaliou a influencia de dois fatores, digamos \(\alpha\) e \(\tau\), em uma determinada variável resposta, agora, conduzido em parcelas subivididas, onde o fator \(\alpha\) foi alocado na parcela principal e o fator \(\tau\) alocado na subparcela. O modelo estatístico considerado neste tipo de experimento é:

\[
{y_{ijk}} = {\rm{ }}\mu {\rm{ }} + {\rm{ }}\mathop \alpha \nolimits_i + \mathop \beta \nolimits_{k} + \mathop \eta \nolimits_{ik}  +\mathop \tau \nolimits_j  + \mathop {(\alpha \tau )}\nolimits_{ij}  + {\rm{ }}\mathop \varepsilon \nolimits_{ijk}
\]

onde \({y_{ijk}}\) é a variável resposta observada; \(\mu\) é a média geral; \(\mathop \alpha \nolimits_i\) é o efeito do \emph{i}-ésimo nível de \(\alpha\) ; \(\mathop \beta \nolimits_{k}\) é o efeito do bloco \emph{k}; \(\mathop \eta \nolimits_{ik}\) é o erro de parcela, mais conhecido como erro a; assumido \(\mathop \varepsilon \nolimits_{ijk} \mathop \cap \limits^{iid} N(0,\mathop \sigma \nolimits_\eta^2 )\); \(\mathop \tau \nolimits_j\) é o efeito do \emph{j}-ésimo nível de \(\tau\) ; \(\mathop {(\alpha \tau )}\nolimits_{ij}\) é o efeito da interação do \emph{i}-ésimo nível de \(\alpha\) com o \emph{j}-ésimo nível de \(\tau\); e \(\mathop \varepsilon \nolimits_{ijk}\) é o erro da subparcela, mais conhecido como erro b, assumindo \(\mathop \varepsilon \nolimits_{ijk} \mathop \cap \limits^{iid} N(0,\mathop \sigma \nolimits^2 )\).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{with}\NormalTok{(FAT1\_SI,}
\KeywordTok{psub2.dbc}\NormalTok{(}\DataTypeTok{fator1 =}\NormalTok{  HIBRIDO,}
          \DataTypeTok{fator2 =}\NormalTok{  FONTEN,}
          \DataTypeTok{bloco =}\NormalTok{ BLOCO,}
          \DataTypeTok{resp =}\NormalTok{  RG,}
          \DataTypeTok{fac.names =} \KeywordTok{c}\NormalTok{(}\StringTok{"HIBRIDO"}\NormalTok{, }\StringTok{"FONTEN"}\NormalTok{)))}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Legenda:}
\CommentTok{\# FATOR 1 (parcela):  HIBRIDO }
\CommentTok{\# FATOR 2 (subparcela):  FONTEN }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# $\textasciigrave{}Quadro da analise de variancia\textbackslash{}n{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}\textbackslash{}n\textasciigrave{}}
\CommentTok{\#                GL      SQ QM      Fc Pr(\textgreater{}Fc)    }
\CommentTok{\# HIBRIDO         2  98.051  7 209.972   3e{-}06 ***}
\CommentTok{\# Bloco           3   0.128  2   0.183  0.9041    }
\CommentTok{\# Erro a          6   1.401  3                    }
\CommentTok{\# FONTEN          2  83.048  6  71.117  \textless{}2e{-}16 ***}
\CommentTok{\# HIBRIDO*FONTEN  4   1.350  4   0.578  0.6824    }
\CommentTok{\# Erro b         18  10.510  5                    }
\CommentTok{\# Total          35 194.488  1                    }
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\CommentTok{\# }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# CV 1 = 4.31183 \%}
\CommentTok{\# CV 2 = 6.818585 \%}
\CommentTok{\# }
\CommentTok{\# Interacao nao significativa: analisando os efeitos simples}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# HIBRIDO}
\CommentTok{\# Teste de Tukey}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Grupos Tratamentos Medias}
\CommentTok{\# a      NUPEC\_2     13.33417 }
\CommentTok{\#  b     NUPEC\_3     10.97337 }
\CommentTok{\#   c    NUPEC\_1     9.311875 }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# FONTEN}
\CommentTok{\# Teste de Tukey}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Grupos Tratamentos Medias}
\CommentTok{\# a      AmonioA     13.33304 }
\CommentTok{\#  b     Ureia   10.40515 }
\CommentTok{\#  b     NitratoA    9.881223 }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

\indf{split2.rbd}

\hypertarget{reg}{%
\chapter{Análise de regressão}\label{reg}}

\hypertarget{regressuxe3o-linear}{%
\section{Regressão Linear}\label{regressuxe3o-linear}}

A análise de regressão \indt{regressão linear} tem como objetivo verificar como uma variável independente influencia a resposta de uma variável dependente. A análise de regressão é amplamente utilizada em ciências agrárias e pode ser dividida em simples ou múltipla\indt{regressão múltipla}. Na regressão simples, apenas uma variável independente é declarada no modelo:

\[
Y_i = {\beta _0} + {\beta _1}x + \varepsilon_i  
\]

Onde \(Y_i\) é a variável dependente, \(x\) é a variável independente, \(\beta_0\) é o intercepto, \(\beta_1\) é a inclinação da reta e \(\varepsilon\) é o erro. Na regressão linear múltipla, mais de uma variável independente é declarada no modelo:

\[
Y_i = {\beta _0} + {\beta _1}x_1 + {\beta _2}x_2 + ... + {\beta _k}x_k + \varepsilon_i  
\]

Onde \(Y_i\) é a variável dependente, \(x_1\), \(x_2\),\ldots,\(x_k\) são as variáveis independentes, \(\beta_0\), \(\beta_1\), \(\beta_2\),\ldots,\(\beta_2\) são os parâmetros \indt{parâmetros}da regressão e \(\varepsilon\) é o erro. Então, uma regressão por ser descrita genericamente por (Draper and Smith \protect\hyperlink{ref-Draper1998}{1998})

\[
Y_i = f(x)+\varepsilon_i 
\]

Onde \(Y_i\) é a variável dependente, \(f(x)\) é a função resposta do modelo e \(\varepsilon\) é o erro.

\hypertarget{estimativa}{%
\subsection{Estimativa}\label{estimativa}}

Uma das formas de estimar os parâmetros em regressão é minimizando os erros. Os erros são a diferença entre o valor estimado pela função resposta \(f(x)\) e o valor observado (\(Y_i\)), representados no gráfico abaixo por pontos vermelhos. Então, devemos encontrar valores para \({\boldsymbol{\beta}}\) que minimizem estes erros, representados pela distância entre a reta estimada e os valores observados.

\indf{lm} \indf{ggplot2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_error \textless{}{-}}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{2}\NormalTok{),}
                         \DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{12}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{14}\NormalTok{,}\DecValTok{16}\NormalTok{,}\DecValTok{18}\NormalTok{,}\DecValTok{16}\NormalTok{,}\DecValTok{14}\NormalTok{))}
\NormalTok{mod \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{x, }\DataTypeTok{data =}\NormalTok{ data\_error)}
\KeywordTok{ggplot}\NormalTok{(data\_error, }\KeywordTok{aes}\NormalTok{(x, y)) }\OperatorTok{+}\StringTok{ }
\StringTok{       }\KeywordTok{geom\_segment}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ y, }\DataTypeTok{xend =}\NormalTok{ x, }\DataTypeTok{yend =} \KeywordTok{fitted}\NormalTok{(mod))) }\OperatorTok{+}
\StringTok{       }\KeywordTok{geom\_point}\NormalTok{(}\DataTypeTok{color =} \StringTok{"red"}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{       }\KeywordTok{geom\_smooth}\NormalTok{(}\DataTypeTok{se =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-235-1} 

}

\caption{Gráfico de dispersão de alguns dados com uma linha representando a tendência geral. As linhas verticais representam as diferenças (ou residuais) entre a linha e os dados observados.}\label{fig:unnamed-chunk-235}
\end{figure}

Na figura acima, uma reta é traçada de modo que as distâncias entre ela e os pontos seja mínimo. Essa distância é obtida, pelo método dos mínimos quadrados\indt{mínimos quadrados}, minimizando a soma de quadrados dos resíduos \indt{resíduos} (uma vez que a soma dos resíduos é igual a zero).

\[
S = {\boldsymbol{\varepsilon '\varepsilon }} = \sum\limits_{i = 1}^n {{{\left( {{Y_i} - {{\hat Y}_i}} \right)}^2}} = 0
\]

Para encontrar os valores dos parâmetros \indt{parâmetros}que minimiza essa soma de quadrados basta resolver o sistema de equações normais\indt{sistema de equações normais}, obtida após derivar \(S\) em relação aos parâmetros. A resolução deste sistema fornece estimativas não viesadas dos parâmetros \({\boldsymbol\hat\beta}\).

\[
\begin{array}{c}{\boldsymbol{X'X\beta = X'Y}}\\{\boldsymbol{\hat\beta}} = {\left( {{\boldsymbol{X'X}}}\right)^{- 1}}{\boldsymbol{X'Y}}\end{array}
\]

Percebe-se que as estimativas dos parâmetros não tem nenhuma relação com os pressupostos \indt{pressupostos} de normalidade, homocedasticidade e independência dos resíduios. Porém, cumprir pressupostos é importante para testar hipóteses e construir intervalos de confiança. Outro aspecto importante na estimação é a necessidade da matriz \(\boldsymbol{X'X}\) ser não singular, pois assim é possível inverter essa matriz e resolver o sistema de equações normais \indt{sistema de equações normais} obtendo parâmetros \indt{parâmetros}únicos. O sistema de equações normais também pode ser resolvido utilizando a inversa generalizada. Neste último caso, os valores dos parâmetros que resolvem o sistema de equações não são únicos. Para maiores detalhes sobre como estimar os parâmetros de regressões lineares, ver Draper and Smith (\protect\hyperlink{ref-Draper1998}{1998}), Kutner et al. (\protect\hyperlink{ref-Kutner2005}{2005}) e Rencher and Schaalje (\protect\hyperlink{ref-Rencher2008}{2008}).

Vimos que uma matriz \(\boldsymbol{X'X}\) não singular é necessária para obtermos os parâmetros da nossa regressão. A não singularidade da matriz está relacionada com quanto as variáveis independentes estão correlacionadas. Quando as variáveis independentes estão aproximadamente (ou perfeitamente, o que é praticamente impossível) relacionadas dizemos que há elevada \textbf{multicolinearidade}\indt{multicolinearidade}. O principal problema da multicolinearidade está relacionado com as estimativas dos parâmetros. Quando ela é elevada, um conjunto de funções resposta minimiza os erros e prediz, com precisão, os valores observados.

Quando há multicolinearidade é possível resolver o sistema de equações normais \indt{sistema de equações normais} utilizando a inversa generaliazada de Moore-Penrose, utilizando a função \texttt{ginv()} \indf{ginv} do pacote \emph{MASS}. Utilizando a inversa generalizada minimiza-se a soma dos quadrados, porém não garante-se que os parâmetros \indt{parâmetros}sejam únicos. Então, qualquer inferências sobre como as variáveis se relacionam passa a ser duvidosa (Kutner et al. \protect\hyperlink{ref-Kutner2005}{2005}).

Para demonstrar como a multicolinearidade afeta a estimativa dos parâmetros, utilizamos um exemplo hipotético de Kutner et al. (\protect\hyperlink{ref-Kutner2005}{2005}). Execute a programação em casa e veja os resultados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X1 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{10}\NormalTok{)}
\NormalTok{X2 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{10}\NormalTok{)}
\KeywordTok{cor}\NormalTok{(X1, X2) }\CommentTok{\# correlação entre as variávies independentes}

\CommentTok{\#\# Minimizando a soma de quadrados}
\KeywordTok{require}\NormalTok{ (nls2)}
\NormalTok{resultados \textless{}{-}}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\DataTypeTok{ncol =} \DecValTok{4}\NormalTok{,}\DataTypeTok{nrow =} \DecValTok{20}\NormalTok{))}
\KeywordTok{names}\NormalTok{(resultados) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"b0"}\NormalTok{,}\StringTok{"b1"}\NormalTok{,}\StringTok{"b2"}\NormalTok{,}\StringTok{"sigma"}\NormalTok{)}

\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{20}\NormalTok{)\{}
\NormalTok{Y \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{23}\NormalTok{,}\DecValTok{83}\NormalTok{,}\DecValTok{63}\NormalTok{,}\DecValTok{103}\NormalTok{)}
\NormalTok{X1 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{10}\NormalTok{)}
\NormalTok{X2 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{10}\NormalTok{)}
\NormalTok{grid \textless{}{-}}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\KeywordTok{list}\NormalTok{(}
\NormalTok{b0 \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\NormalTok{i,i, }\DataTypeTok{by =} \FloatTok{0.1}\NormalTok{),}
\NormalTok{b1 \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\NormalTok{i, i, }\DataTypeTok{by =} \FloatTok{0.1}\NormalTok{),}
\NormalTok{b2 \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\NormalTok{i, i, }\DataTypeTok{by =} \FloatTok{0.1}\NormalTok{)}
\NormalTok{)) }\CommentTok{\# Armazenando um conjunto de valores que quero dar aos parâmetros}

\NormalTok{Resp \textless{}{-}}\StringTok{ }\KeywordTok{nls2}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{b0}\OperatorTok{+}\NormalTok{b1}\OperatorTok{*}\NormalTok{X1}\OperatorTok{+}\NormalTok{b2}\OperatorTok{*}\NormalTok{X2,}
\NormalTok{start \textless{}{-}}\StringTok{ }\NormalTok{grid,}
\NormalTok{algorithm \textless{}{-}}\StringTok{ "brute{-}force"}\NormalTok{)}

\NormalTok{b0 \textless{}{-}}\StringTok{ }\KeywordTok{summary}\NormalTok{(Resp)}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{]}
\NormalTok{b1 \textless{}{-}}\StringTok{ }\KeywordTok{summary}\NormalTok{(Resp)}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{]}
\NormalTok{b2 \textless{}{-}}\StringTok{ }\KeywordTok{summary}\NormalTok{(Resp)}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{]}
\NormalTok{sigma \textless{}{-}}\StringTok{ }\KeywordTok{summary}\NormalTok{(Resp)}\OperatorTok{$}\NormalTok{sigma}
\NormalTok{;}
\NormalTok{resultados}\OperatorTok{$}\NormalTok{b0[i] \textless{}{-}}\StringTok{ }\NormalTok{b0}
\NormalTok{resultados}\OperatorTok{$}\NormalTok{b1[i] \textless{}{-}}\StringTok{ }\NormalTok{b1}
\NormalTok{resultados}\OperatorTok{$}\NormalTok{b2[i] \textless{}{-}}\StringTok{ }\NormalTok{b2}
\NormalTok{resultados}\OperatorTok{$}\NormalTok{sigma[i] \textless{}{-}}\StringTok{ }\NormalTok{sigma}
\NormalTok{\}}
\NormalTok{resultados}
\end{Highlighting}
\end{Shaded}

Quando há multicolinearidade\indt{multicolinearidade}, conjuntos de diferentes parâmetros \indt{parâmetros}resolvem o sitema de equações normais e minimizam a soma de quadrados. Por isso, relacionar a resposta da variável dependente em função das variáveis independentes passa a ser impossível. É por isso também que a multicolinearidade é importante na \protect\hyperlink{analise-de-trilha}{análise de trilha}. A relação entre as variáveis na análise de trilha é determinada com base no valor dos coeficientes de trilha, que nada mais são do que parâmetros de uma regressão múltipla estimados com as variáveis padronizadas.

\hypertarget{ajustando-regressuxf5es-com-a-funuxe7uxe3o-lm}{%
\subsection{\texorpdfstring{Ajustando regressões com a função \texttt{lm()}}{Ajustando regressões com a função lm()}}\label{ajustando-regressuxf5es-com-a-funuxe7uxe3o-lm}}

A função \texttt{lm()} \indf{lm} é utilizada para ajustar regresões lineares simples e múltipla. Os argumentos mais importantes desta função são a \texttt{formula}, onde indicamos a função resposta; e \texttt{data}, onde indicamos o banco de dados. Vamos utiliza um exemplo simples retirado de Schenider, Schenider, and Souza (\protect\hyperlink{ref-Schneider2009}{2009}):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{reg \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"REG"}\NormalTok{)}
\NormalTok{mod7 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{X2 }\OperatorTok{+}\StringTok{ }\NormalTok{X3, }\DataTypeTok{data =}\NormalTok{ reg)}
\NormalTok{mod7}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod7}\FloatTok{.1}\NormalTok{, mod7) }\CommentTok{\# Verificar a significância do modelo}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} 1}
\CommentTok{\# Model 2: Y \textasciitilde{} X1 + X2 + X3}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1     12 1834.00                                  }
\CommentTok{\# 2      9   97.47  3    1736.5 53.449 4.653e{-}06 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\end{Highlighting}
\end{Shaded}

Através da função \texttt{anova(mod7.1,\ mod7)} \indf{anova} pode-se verificar se o modelo é ou não significativo. A hipótese \(H_0 = 0\) é rejeitada e conclui-se que o modelo explica o comportamento da variável resposta. Através da função \texttt{summary()} \indf{summary} obtém-se o resultado do teste \emph{t} para os parâmetros \indt{parâmetros}do modelo. A hipótese testada neste caso é \(H_0:\boldsymbol{\beta} = 0\) \emph{vs} \(H_A:\boldsymbol{\beta}\ne 0\). Por fim, a função \texttt{anova()} retorna um teste F que possibilita verificar a contribuição de cada parâmetro em explicar a variabilidade da variável resposta.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(mod7)}
\CommentTok{\# }
\CommentTok{\# Call:}
\CommentTok{\# lm(formula = Y \textasciitilde{} X1 + X2 + X3, data = reg)}
\CommentTok{\# }
\CommentTok{\# Residuals:}
\CommentTok{\#     Min      1Q  Median      3Q     Max }
\CommentTok{\# {-}5.4062 {-}2.2378 {-}0.3066  1.6321  4.8468 }
\CommentTok{\# }
\CommentTok{\# Coefficients:}
\CommentTok{\#             Estimate Std. Error t value Pr(\textgreater{}|t|)    }
\CommentTok{\# (Intercept)  7.86871    3.32628   2.366   0.0422 *  }
\CommentTok{\# X1           2.72881    0.25198  10.830 1.84e{-}06 ***}
\CommentTok{\# X2          {-}1.92182    0.25540  {-}7.525 3.60e{-}05 ***}
\CommentTok{\# X3          {-}0.09752    0.15686  {-}0.622   0.5496    }
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\CommentTok{\# }
\CommentTok{\# Residual standard error: 3.291 on 9 degrees of freedom}
\CommentTok{\# Multiple R{-}squared:  0.9469,  Adjusted R{-}squared:  0.9291 }
\CommentTok{\# F{-}statistic: 53.45 on 3 and 9 DF,  p{-}value: 4.653e{-}06}
\end{Highlighting}
\end{Shaded}

Entre os parâmetros do modelo, apenas \(\hat{\beta_3}\) não foi significativo, indicando que não há necessidade dele ser incluido no modelo. Através do teste F é possível verificar qual o modelo (com ou sem \(\beta_3\)) é o mais parcimonioso. O teste F é dado por:

\[
F_{calc} = \frac{S{Q_{Erro}}(\Omega)- S{Q_{Erro}}(\omega)/G{L_{Erro}}(\Omega)- G{L_{Erro}}(\omega)} {Q{M_{Erro}}(\omega )}\
\]

Onde, \(SQ_{Erro}(\Omega)\) e \(SQ_{Erro}(\omega)\) são as somas de quadrados dos resíduos \indt{resíduos} nos modelos completo e reduzido, respectivamente; \(G{L_{Erro}}(\omega)\) e \(G{L_{Erro}}(\Omega)\) são os graus de liberdade do resíduo do modelo completo e reduzido, respectivamente; e \(Q{M_{Erro}}(\omega )\) é o quadrado médio do resíduo do modelo completo. Podemos realizar o teste F utilizando a função \texttt{anova()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod8 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{X2, }\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod8, mod7)}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} X1 + X2}
\CommentTok{\# Model 2: Y \textasciitilde{} X1 + X2 + X3}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq      F Pr(\textgreater{}F)}
\CommentTok{\# 1     10 101.655                           }
\CommentTok{\# 2      9  97.469  1     4.186 0.3865 0.5496}
\end{Highlighting}
\end{Shaded}

Como ambos modelos são estatisticamente iguais, opta-se pelo modelo reduzido. O modelo que melhor se ajustou aos dados foi \(Y = 6.726 + 2.759X_1 - 1.937X_2\), \(R^2_{Aj} = 0.93\) superior a 90\%.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{coefficients}\NormalTok{(mod8)}
\CommentTok{\# (Intercept)          X1          X2 }
\CommentTok{\#    6.726606    2.759633   {-}1.937615}
\end{Highlighting}
\end{Shaded}

\hypertarget{seleuxe7uxe3o-de-variuxe1veis}{%
\subsection{Seleção de variáveis}\label{seleuxe7uxe3o-de-variuxe1veis}}

Foi mostrado brevemente um exemplo de como ajustar e selecionar variáveis. Porém, no exemplo apresentado, utilizou-se somente três variáveis. No entanto, quando há um elevado número de variáveis, selecioná-las torna-se um trabalho um pouco mais complexo. Nestes casos é necessário utilizar algoritimos de seleção. Os mais comuns são o \emph{Forward}, \emph{Backward} e \emph{Stepwise}.

\textbf{Forward} \indt{forward}

No método \emph{forward} parte-se de um modelo com uma variável independente, que é aquela que possui maior correlação \indt{correlação} amostral com a variável dependente. Posteriormente, realiza-se o teste F para verificar se ela é realmente é significativa. A segunda variável independente com maior correlação amostral com a variável dependente é adicionada ao modelo, e um teste F parcial verifica a significância. As variávies são adicionadas enquanto o F parcial for significativo.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(reg[}\DecValTok{1}\NormalTok{], reg[}\DecValTok{2}\OperatorTok{:}\DecValTok{4}\NormalTok{]) }\CommentTok{\# Correlação}
\CommentTok{\#          X1         X2         X3}
\CommentTok{\# Y 0.7754301 {-}0.4558018 {-}0.2460537}
\NormalTok{mod\_for1 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }\DataTypeTok{data =}\NormalTok{ reg)}
\NormalTok{mod\_for2 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X1, }\DataTypeTok{data =}\NormalTok{ reg) }\CommentTok{\# Adiciona X1 }
\NormalTok{mod\_for3 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{X2, }\DataTypeTok{data =}\NormalTok{ reg)  }\CommentTok{\# Adiciona X2 }
\NormalTok{mod\_for4 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{X2 }\OperatorTok{+}\StringTok{ }\NormalTok{X3, }\DataTypeTok{data =}\NormalTok{ reg)  }\CommentTok{\# Adiciona X3 }
\KeywordTok{anova}\NormalTok{(mod\_for1, mod\_for2, mod\_for3, mod\_for4)  }\CommentTok{\# Seleciona o modelo }
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} 1}
\CommentTok{\# Model 2: Y \textasciitilde{} X1}
\CommentTok{\# Model 3: Y \textasciitilde{} X1 + X2}
\CommentTok{\# Model 4: Y \textasciitilde{} X1 + X2 + X3}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq        F    Pr(\textgreater{}F)    }
\CommentTok{\# 1     12 1834.00                                    }
\CommentTok{\# 2     11  731.23  1   1102.77 101.8264 3.318e{-}06 ***}
\CommentTok{\# 3     10  101.66  1    629.58  58.1331 3.243e{-}05 ***}
\CommentTok{\# 4      9   97.47  1      4.19   0.3865    0.5496    }
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\end{Highlighting}
\end{Shaded}

\textbf{Backward} \indt{backward}

No método \emph{backward} parte-se do modelo completo. As variávies candidatas a serem eliminadas são determinadas através do teste F parcial, como se elas fossem (hipoteticamente) as últimas a serem incluidas no modelo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# F parcial para X3}
\NormalTok{mod\_back.x3 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{X1}\OperatorTok{+}\NormalTok{X2}\OperatorTok{+}\NormalTok{X3,}\DataTypeTok{data =}\NormalTok{ reg)}
\NormalTok{mod\_back.x3}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{X1}\OperatorTok{+}\NormalTok{X2,}\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod\_back.x3}\FloatTok{.1}\NormalTok{,mod\_back.x3) }\CommentTok{\# Menor F parcial}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} X1 + X2}
\CommentTok{\# Model 2: Y \textasciitilde{} X1 + X2 + X3}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq      F Pr(\textgreater{}F)}
\CommentTok{\# 1     10 101.655                           }
\CommentTok{\# 2      9  97.469  1     4.186 0.3865 0.5496}

\CommentTok{\# F parcial para X2}
\NormalTok{mod\_back.x2 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{X1}\OperatorTok{+}\NormalTok{X2}\OperatorTok{+}\NormalTok{X3,}\DataTypeTok{data =}\NormalTok{ reg)}
\NormalTok{mod\_back.x2}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{X1}\OperatorTok{+}\NormalTok{X3,}\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod\_back.x2}\FloatTok{.1}\NormalTok{,mod\_back.x2)}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} X1 + X3}
\CommentTok{\# Model 2: Y \textasciitilde{} X1 + X2 + X3}
\CommentTok{\#   Res.Df    RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1     10 710.70                                  }
\CommentTok{\# 2      9  97.47  1    613.23 56.624 3.598e{-}05 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}

\CommentTok{\# F parcial para X1}
\NormalTok{mod\_back.x1 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{X1}\OperatorTok{+}\NormalTok{X2}\OperatorTok{+}\NormalTok{X3,}\DataTypeTok{data =}\NormalTok{ reg)}
\NormalTok{mod\_back.x1}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{X2}\OperatorTok{+}\NormalTok{X3,}\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod\_back.x1}\FloatTok{.1}\NormalTok{,mod\_back.x1) }\CommentTok{\# Maior F parcial }
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} X2 + X3}
\CommentTok{\# Model 2: Y \textasciitilde{} X1 + X2 + X3}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1     10 1367.60                                  }
\CommentTok{\# 2      9   97.47  1    1270.1 117.28 1.836e{-}06 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}

\CommentTok{\# Elimina a 3, depois a 2 e depois a 1}
\NormalTok{mod\_back1 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{X1}\OperatorTok{+}\NormalTok{X2}\OperatorTok{+}\NormalTok{X3,}\DataTypeTok{data =}\NormalTok{ reg)}
\NormalTok{mod\_back2 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{X1}\OperatorTok{+}\NormalTok{X2,}\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod\_back2,mod\_back1) }\CommentTok{\# elimina X3}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} X1 + X2}
\CommentTok{\# Model 2: Y \textasciitilde{} X1 + X2 + X3}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq      F Pr(\textgreater{}F)}
\CommentTok{\# 1     10 101.655                           }
\CommentTok{\# 2      9  97.469  1     4.186 0.3865 0.5496}

\NormalTok{mod\_back2 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{X1}\OperatorTok{+}\NormalTok{X2,}\DataTypeTok{data =}\NormalTok{ reg)}
\NormalTok{mod\_back3 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y}\OperatorTok{\textasciitilde{}}\NormalTok{X1,}\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod\_back3,mod\_back2) }\CommentTok{\# não elimina X2 e seleciona}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} X1}
\CommentTok{\# Model 2: Y \textasciitilde{} X1 + X2}
\CommentTok{\#   Res.Df    RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1     11 731.23                                  }
\CommentTok{\# 2     10 101.66  1    629.58 61.933 1.359e{-}05 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\end{Highlighting}
\end{Shaded}

\textbf{Stepwise} \indt{stepwise}

O método \emph{stepwise} utiliza características dos métodos \emph{forward} e \emph{backward}. Neste método parte-se de um modelo composto pela variável com maior correlação \indt{correlação} amostral. A cada variável adicionada por \emph{forward}, é relizado um \emph{backward} para retirar uma das variáveis previamente adicionadas.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Passo 1}
\NormalTok{mod\_step1}\FloatTok{.0}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }\DataTypeTok{data =}\NormalTok{ reg)}
\NormalTok{mod\_step1 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X1, }\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod\_step1}\FloatTok{.0}\NormalTok{, mod\_step1) }\CommentTok{\# adiciona X1}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} 1}
\CommentTok{\# Model 2: Y \textasciitilde{} X1}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq      F   Pr(\textgreater{}F)   }
\CommentTok{\# 1     12 1834.00                                }
\CommentTok{\# 2     11  731.23  1    1102.8 16.589 0.001842 **}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}

\CommentTok{\# Passo 2}
\NormalTok{mod\_step2 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X1, }\DataTypeTok{data =}\NormalTok{ reg)}
\NormalTok{mod\_step2}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{X2, }\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod\_step2, mod\_step2}\FloatTok{.1}\NormalTok{) }\CommentTok{\# adiciona X2}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} X1}
\CommentTok{\# Model 2: Y \textasciitilde{} X1 + X2}
\CommentTok{\#   Res.Df    RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1     11 731.23                                  }
\CommentTok{\# 2     10 101.66  1    629.58 61.933 1.359e{-}05 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}

\NormalTok{mod\_step2}\FloatTok{.2}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X2, }\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod\_step2}\FloatTok{.2}\NormalTok{, mod\_step2}\FloatTok{.1}\NormalTok{) }\CommentTok{\# mantém X1 no modelo}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} X2}
\CommentTok{\# Model 2: Y \textasciitilde{} X1 + X2}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1     11 1452.98                                  }
\CommentTok{\# 2     10  101.66  1    1351.3 132.93 4.251e{-}07 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}

\CommentTok{\# Passo 3}
\NormalTok{mod\_step3 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{X2, }\DataTypeTok{data =}\NormalTok{ reg)}
\NormalTok{mod\_step3}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{X2 }\OperatorTok{+}\StringTok{ }\NormalTok{X3,}\DataTypeTok{data =}\NormalTok{ reg)}
\KeywordTok{anova}\NormalTok{(mod\_step3, mod\_step3}\FloatTok{.1}\NormalTok{) }\CommentTok{\# não adiciona X3, seleciona o modelo}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: Y \textasciitilde{} X1 + X2}
\CommentTok{\# Model 2: Y \textasciitilde{} X1 + X2 + X3}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq      F Pr(\textgreater{}F)}
\CommentTok{\# 1     10 101.655                           }
\CommentTok{\# 2      9  97.469  1     4.186 0.3865 0.5496}
\end{Highlighting}
\end{Shaded}

As análises acima foram demonstradas apenas para detalhar o funcionamento dos algoritimos de seleção, utilizando F parcial. O F parcial é muito rigoroso, e por isso muitas vezes o pesquisador usa valores de \(\alpha\) maiores que 5\%. Além disso, várias funções do \emph{R} estão disponíveis para selecionar variáveis utilizando diferentes diferentes critérios. As funções \texttt{ols\_step\_forward\_p()}, \texttt{ols\_step\_backward\_p()} e \texttt{ols\_step\_both\_p()} do pacote \href{https://rdrr.io/cran/olsrr/}{olsrr}\footnote{\url{https://rdrr.io/cran/olsrr/}} selecionam variávies utilizando utilizado \emph{forward}, \emph{backward} ou \emph{stepwise}, respectivamente, considerando p-valores para critério de decisão de inclusão/remoção de variáveis.

\indf{ols\_step\_forward\_p}, \indt{ols\_step\_backward\_p}
\indf{ols\_step\_both\_p}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{olsrr}\OperatorTok{::}\KeywordTok{ols\_step\_forward\_p}\NormalTok{(mod\_for4)}
\NormalTok{olsrr}\OperatorTok{::}\KeywordTok{ols\_step\_backward\_p}\NormalTok{(mod\_for4)}
\NormalTok{olsrr}\OperatorTok{::}\KeywordTok{ols\_step\_both\_p}\NormalTok{(mod\_for4)}
\end{Highlighting}
\end{Shaded}

\hypertarget{falta-de-ajuste}{%
\subsection{Falta de ajuste}\label{falta-de-ajuste}}

Quando várias observações são realizadas para cada variável independente (experimentos com repetição, por exemplo), é necessário verificar a falta de ajuste. Nestes casos, o erro é dividido em duas partes: a) o erro puro, \indt{erro puro} que consiste na diferença entre a média e as observações em cada variável; b) falta de ajuste, \indt{falta de ajuste} que é a diferença entre a média da variável independente e o valor ajustado pela regressão.

\[
{Y_{ij}} - {\hat Y_i} = \left( {{Y_{ij}} - {{\bar Y}{i.}}} \right) + \left( {{{\bar Y}{i.}} - {{\hat Y}_i}} \right)
\]

Onde \(\hat{Y_{ij}}-Y_{ij}\) é o erro do modelo, \((Y_{ij}-\bar{Y_j})\) é o erro puro e \((\hat{Y_{ij}}-\bar{Y_j})\) é a falta de ajuste.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod10 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{DOSEN, }\DataTypeTok{data =}\NormalTok{ quantitativo) }\CommentTok{\# Regressão linear}
\NormalTok{mod10}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{  }\KeywordTok{factor}\NormalTok{(DOSEN), }\DataTypeTok{data =}\NormalTok{ quantitativo) }\CommentTok{\#falta de ajuste}
\KeywordTok{anova}\NormalTok{(mod10, mod10}\FloatTok{.1}\NormalTok{) }\CommentTok{\# Erro puro}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: RG \textasciitilde{} DOSEN}
\CommentTok{\# Model 2: RG \textasciitilde{} factor(DOSEN)}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1     18 2.74295                                  }
\CommentTok{\# 2     15 0.50276  3    2.2402 22.279 8.831e{-}06 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\end{Highlighting}
\end{Shaded}

A significância do teste F indica que o modelo linear não é adequado para representar a relação entre as variávies dependentes e independentes. Isso indica que o modelo ajustado ``não se aproxima'' satisfatoriamente da média das variávies independentes, e que a falta de ajuste \indt{falta de ajuste} é elevada quando comparado ao erro puro. Agora, vamos ajustar um modelo quadrático:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod11 \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(RG }\OperatorTok{\textasciitilde{}}\StringTok{  }\NormalTok{DOSEN }\OperatorTok{+}\KeywordTok{I}\NormalTok{(DOSEN}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ quantitativo) }\CommentTok{\#Regressão quadrática}
\KeywordTok{anova}\NormalTok{(mod11, mod10}\FloatTok{.1}\NormalTok{)}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: RG \textasciitilde{} DOSEN + I(DOSEN\^{}2)}
\CommentTok{\# Model 2: RG \textasciitilde{} factor(DOSEN)}
\CommentTok{\#   Res.Df     RSS Df Sum of Sq      F Pr(\textgreater{}F)}
\CommentTok{\# 1     17 0.58616                           }
\CommentTok{\# 2     15 0.50276  2  0.083408 1.2443 0.3163}
\end{Highlighting}
\end{Shaded}

A não significância do teste F indica que o modelo quadrático é adequado para representar a relação entre as variávies dependentes e independentes. Aqui o exemplo é apresentado para um ajuste de polinômios, mas sua aplicação se estende a qualquer regressão (linear simples, múltipla ou regressão não linear).

\hypertarget{anuxe1lise-dos-resuxedduos}{%
\subsection{Análise dos resíduos}\label{anuxe1lise-dos-resuxedduos}}

Na análise de regressão, os resíduos \indt{resíduos} devem ser normalmente distribuídos, homocedásticos e independentes. O diagnóstico é realizado por testes estatísticos ou através de análise gráfica.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{residuos \textless{}{-}}\StringTok{ }\KeywordTok{residuals}\NormalTok{(mod11)}
\KeywordTok{shapiro.test}\NormalTok{(residuos) }\CommentTok{\# Normalidade}
\CommentTok{\# }
\CommentTok{\#   Shapiro{-}Wilk normality test}
\CommentTok{\# }
\CommentTok{\# data:  residuos}
\CommentTok{\# W = 0.96509, p{-}value = 0.6497}
\KeywordTok{bartlett.test}\NormalTok{(residuos }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{DOSEN, }\DataTypeTok{data =}\NormalTok{ quantitativo) }\CommentTok{\# Homocedasticidade}
\CommentTok{\# }
\CommentTok{\#   Bartlett test of homogeneity of variances}
\CommentTok{\# }
\CommentTok{\# data:  residuos by DOSEN}
\CommentTok{\# Bartlett\textquotesingle{}s K{-}squared = 5.7732, df = 4, p{-}value = 0.2167}
\KeywordTok{autoplot}\NormalTok{(mod11)}\CommentTok{\# análise gráfica dos resíduos}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-247-1} \end{center}

A análise dos resíduos \indt{resíduos} também pode indicar a necessidade de adicionar variávies explicativas ao modelo. Por exemplo, vamos analisar os resíduos de um modelo linear ajustados a dados que tem (conhecidamente) comportamento quadrático.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{residuos \textless{}{-}}\StringTok{ }\KeywordTok{residuals}\NormalTok{(mod10)}
\KeywordTok{autoplot}\NormalTok{(mod10) }\CommentTok{\# análise gráfica dos resíduos}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-248-1} \end{center}

Percebe-se, pelo gráfico residuals \emph{vs} fitted, que os resíduos não são aleatoriamente distribuídos em torno de zero. A distribuição sistemática dos resíduos indica que uma variável que explica consideravelmente a variabilidade dos dados não foi incluída no modelo (no caso o termo quadrático do polinômio).

\hypertarget{pontos-influentes}{%
\subsection{Pontos influentes}\label{pontos-influentes}}

\indt{pontos influentes}

As observações influentes podem ser mensuradas através da \emph{distância de Cook}, \emph{DFBETA} e \emph{DFFITS}. O \emph{DFFITS} e a \emph{distância de Cook} medem a influência das observações sobre a predição das variávies; e o \emph{DFBETA} mede a influência destas observações sobre as estimativas dos parâmetros.

Vamos utilizar as funções gráficas do pacote \texttt{olsrr} para fazer o diagnóstico dos pontos infuentes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{olsrr}\OperatorTok{::}\KeywordTok{ols\_plot\_cooksd\_bar}\NormalTok{(mod11) }\CommentTok{\# Distância de Cook}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-249-1} 

}

\caption{Distância de Cook representando a influencia dos pontos na predição das variávies}\label{fig:unnamed-chunk-249}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{olsrr}\OperatorTok{::}\KeywordTok{ols\_plot\_dfbetas}\NormalTok{(mod11) }\CommentTok{\# DFBetas}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-250-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{olsrr}\OperatorTok{::}\KeywordTok{ols\_plot\_dffits}\NormalTok{(mod11) }\CommentTok{\# DFFits}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-251-1} \end{center}

As observações 8 e 12 são as que mais influenciam os valores preditos e as estimativas dos parâmetros. Os limites pela \emph{distância de Cook}, \emph{DFBETA} e \emph{DFFITS} para realizar o diagnóstico são \(\frac{4}{n} = \frac{4}{20} = 0,20\), \(\frac{2}{\sqrt{n}} = \frac{2}{\sqrt{2}} = 0,45\) e \(2 \times \sqrt {\frac{p}{n}} = 2 \times \sqrt {\frac{3}{{20}}} = 0,77\), respectivamente.

\hypertarget{regressuxe3o-nuxe3o-linear}{%
\section{Regressão não linear}\label{regressuxe3o-nuxe3o-linear}}

Uma regressão é dita não linear quando os parâmetros \indt{parâmetros}não encontram-se de forma aditiva no modelo. Devido a isso, o sistema de equações normais \({\left( {{\boldsymbol{X'X}}} \right)^{{\boldsymbol{ - 1}}}}{\boldsymbol{\beta = X'Y}}\) não pode ser resolvido analiticamente, e os parâmetros precisam ser estimados utilizando métodos iterativos. \indt{sistema de equações normais}

\hypertarget{estimativa-1}{%
\subsection{Estimativa}\label{estimativa-1}}

A estimação dos parâmetros é realizado pelo método dos mínimos quadrados \indt{mínimos quadrados}. O método iterativo utilizado nos softwares R e SAS, por exemplo, é o de \emph{Gauss-Newton}. Este método utiliza aproximações lineares de Taylor de primeira ordem da função resposta, dada por

\[
f\left( {x,{\boldsymbol{\theta }}} \right) = f\left( {x,{{\boldsymbol{\theta }}^0}} \right) + \frac{{\partial f\left( {x,{{\boldsymbol{\theta }}^0}} \right)}}{{\partial {\boldsymbol{\theta }}}}\left( {{\boldsymbol{\theta }} - {{\boldsymbol{\theta }}^0}} \right)   
\]

Essa aproximação linear de primeira ordem pode ser simplificada por \(f\left( {\boldsymbol{\theta }} \right) = f\left( {{{\boldsymbol{\theta }}^0}} \right) + {\boldsymbol{F}}\left( {{\boldsymbol{\theta }} - {{\boldsymbol{\theta }}^0}} \right)\). Substituindo-a na função que minimiza a soma de quadrados, temos:

\[
\begin{array}{c}S\left( {\boldsymbol{\theta }} \right) = \sum\limits_{i = 1}^n {{{\left( {y - f\left( {{\boldsymbol{\hat \theta }}} \right)} \right)}^2}} \\S\left( {\boldsymbol{\theta }} \right) = \sum\limits_{i = 1}^n {{{\left( {y - f\left( {{{\boldsymbol{\theta }}^0}} \right) - {\boldsymbol{F}}\left( {{\boldsymbol{\theta }} - {{\boldsymbol{\theta }}^0}} \right)} \right)}^2}} \\S\left( {\boldsymbol{\theta }} \right) = \sum\limits_{i = 1}^n {{{\left( {\varepsilon  - {\boldsymbol{F}}\left( {{\boldsymbol{\theta }} - {{\boldsymbol{\theta }}^0}} \right)} \right)}^2}} \end{array}
\]

Percebe-se que a matriz \(\boldsymbol{F}\), que substitui \(\boldsymbol{X}\), é sempre dependente de um dos parâmetros \indt{parâmetros}do modelo, e por isso o sistema de equações não tem resolução analítica. O sistema de equações não linear acima é resolvido por \({\boldsymbol{\theta }} - {{\boldsymbol{\theta }}^{\boldsymbol{0}}} = {\left( {{\boldsymbol{F}}'{\boldsymbol{F}}} \right)^{ - 1}}{\boldsymbol{F}}'{\boldsymbol{\varepsilon }}\), que reorganizada como \({\boldsymbol{\theta }} = {{\boldsymbol{\theta }}^{\boldsymbol{0}}} + {\left( {{\boldsymbol{F}}'{\boldsymbol{F}}} \right)^{ - 1}}{\boldsymbol{F}}'{\boldsymbol{\varepsilon }}\), corresponde ao primeiro passo do método iterativo de \emph{Gauss-Newton}. Para algoritimo seja iniciado, um valor inicial para os parâmetros deve ser declarado. O processo é repetido até obter convergência, que ocorre quando os valores estimados em cada passo são próximos um dos outros.

\hypertarget{ajustando-o-modelo-com-a-funuxe7uxe3o-nls}{%
\subsection{\texorpdfstring{Ajustando o modelo com a função \texttt{nls()}}{Ajustando o modelo com a função nls()}}\label{ajustando-o-modelo-com-a-funuxe7uxe3o-nls}}

A função \texttt{nls()} \indt{nls} pode ser utilizada para ajustar modelos não lineares. Os principais argumentos da função são: i) \texttt{formula}, onde o modelo é declarado; ii) \texttt{data}, onde os dados são declarados e iii) \texttt{start} \indt{start}, que é uma lista com os valores iniciais dos parâmetros.

\textbf{Valores iniciais dos parâmetros}

O primeiro passo da análise é encontrar os valores iniciais dos parâmetros. O método gráfico é útil para cumprir esse objetivo. Valores dos parâmetros \indt{parâmetros}são declarados até o ponto em que a curva gerada se aproxime dos valores observados. A programação que será apresentada foi obtida no blog \href{https://ridiculas.wordpress.com/tag/nao-linear/}{Ridículas}, mantido pelo \href{http://www.leg.ufpr.br/doku.php/start}{LEG} da UFPR. Utilizaremos como exemplo o modelo logístico (uma de suas parametrizações), dado por

\[
{Y_i} = \frac{{{\beta _1}}}{{1 + {e^{\left( {{\beta _2} - {\beta _3}{t_i}} \right)}}}} + {\varepsilon _i}
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{nls\_tomato \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"TOMATE"}\NormalTok{)}
\NormalTok{nls\_tomato\_cord \textless{}{-}}\StringTok{ }\KeywordTok{subset}\NormalTok{(nls\_tomato,Genotipo  }\OperatorTok{==}\StringTok{  "Cordillera"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Modelo logístico}
\NormalTok{logi \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, b1, b2, b3)\{}
\NormalTok{  b1 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{+}\StringTok{ }\KeywordTok{exp}\NormalTok{(b2 }\OperatorTok{{-}}\StringTok{ }\NormalTok{b3 }\OperatorTok{*}\StringTok{ }\NormalTok{x))}
\NormalTok{\}}
\NormalTok{start=}\KeywordTok{list}\NormalTok{()}
\KeywordTok{manipulate}\NormalTok{(\{}
  \KeywordTok{plot}\NormalTok{(num}\OperatorTok{\textasciitilde{}}\NormalTok{DAT,}\DataTypeTok{data =}\NormalTok{ nls\_tomato\_cord)}
  \KeywordTok{curve}\NormalTok{(}\KeywordTok{logi}\NormalTok{(x, }\DataTypeTok{b1=}\NormalTok{b1,}\DataTypeTok{b2=}\NormalTok{b2,}\DataTypeTok{b3=}\NormalTok{b3),}\DataTypeTok{add=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{  start\textless{}\textless{}{-}}\KeywordTok{list}\NormalTok{(}\DataTypeTok{b1=}\NormalTok{b1,}\DataTypeTok{b2=}\NormalTok{b2,}\DataTypeTok{b3=}\NormalTok{b3)\},}
  \DataTypeTok{b1=}\KeywordTok{slider}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{50}\NormalTok{,}\DataTypeTok{initial=}\DecValTok{10}\NormalTok{),}
  \DataTypeTok{b2=}\KeywordTok{slider}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{20}\NormalTok{,}\DataTypeTok{initial=}\DecValTok{5}\NormalTok{),}
  \DataTypeTok{b3=}\KeywordTok{slider}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{,}\DataTypeTok{initial=}\DecValTok{0}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figures/Valor_inicial.png}
\caption{Manipulando os valores dos parâmetros}
\end{figure}

\textbf{Ajustando o modelo}

Os valores iniciais serão armazenados na lista \texttt{start}, e esta será declarada no argumento \texttt{start} da função \texttt{nls()} \indf{nls} . A função \texttt{summary()} \indf{summary} retorna o teste de Wald para os parâmetros.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nls1 \textless{}{-}}\StringTok{ }\KeywordTok{nls}\NormalTok{(num}\OperatorTok{\textasciitilde{}}\NormalTok{b1}\OperatorTok{/}\NormalTok{(}\DecValTok{1}\OperatorTok{+}\KeywordTok{exp}\NormalTok{(b2}\OperatorTok{{-}}\NormalTok{b3}\OperatorTok{*}\NormalTok{DAT)), }
         \DataTypeTok{data =}\NormalTok{ nls\_tomato\_cord, }\CommentTok{\# indica os dados}
         \DataTypeTok{start =}\NormalTok{ start) }\CommentTok{\# indica os valores iniciais}
\KeywordTok{summary}\NormalTok{(nls1)}
\CommentTok{\# }
\CommentTok{\# Formula: num \textasciitilde{} b1/(1 + exp(b2 {-} b3 * DAT))}
\CommentTok{\# }
\CommentTok{\# Parameters:}
\CommentTok{\#    Estimate Std. Error t value Pr(\textgreater{}|t|)    }
\CommentTok{\# b1 39.68149    1.50505   26.37 1.96e{-}07 ***}
\CommentTok{\# b2 13.53980    0.94913   14.27 7.42e{-}06 ***}
\CommentTok{\# b3  0.13390    0.01018   13.15 1.19e{-}05 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\CommentTok{\# }
\CommentTok{\# Residual standard error: 0.9108 on 6 degrees of freedom}
\CommentTok{\# }
\CommentTok{\# Number of iterations to convergence: 7 }
\CommentTok{\# Achieved convergence tolerance: 8.502e{-}06}
\end{Highlighting}
\end{Shaded}

\hypertarget{anuxe1lise-dos-resuxedduos-1}{%
\subsection{Análise dos resíduos}\label{anuxe1lise-dos-resuxedduos-1}}

Os resíduos \indt{resíduos} dos modelos não lineares também deve ser normalmente distribuídos, homocedásticos e independentes. Os testes estatísticos e a análise dos resíduos seguem os mesmos princípios dos modelos lineares.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(lmtest) }\CommentTok{\# pacote para carregar teste de Breusch{-}Pagan (homogeneidade)}
\KeywordTok{require}\NormalTok{ (car) }\CommentTok{\# pacote para carregar teste de DW (independência)}
\CommentTok{\#\#\# Normalidade}
\NormalTok{res\_nls1 \textless{}{-}}\StringTok{ }\KeywordTok{residuals}\NormalTok{(nls1)}
\KeywordTok{shapiro.test}\NormalTok{(res\_nls1)}
\CommentTok{\# }
\CommentTok{\#   Shapiro{-}Wilk normality test}
\CommentTok{\# }
\CommentTok{\# data:  res\_nls1}
\CommentTok{\# W = 0.92624, p{-}value = 0.4464}
\NormalTok{nls1\_grad \textless{}{-}}\StringTok{ }\KeywordTok{attr}\NormalTok{(nls1}\OperatorTok{$}\NormalTok{m}\OperatorTok{$}\KeywordTok{fitted}\NormalTok{(), }\StringTok{"gradient"}\NormalTok{) }\CommentTok{\# obtem matriz gradiente}
\NormalTok{nls1\_lm \textless{}{-}}\StringTok{ }\KeywordTok{lm}\NormalTok{(num}\OperatorTok{\textasciitilde{}{-}}\DecValTok{1}\OperatorTok{+}\NormalTok{nls1\_grad, }\DataTypeTok{data =}\NormalTok{ nls\_tomato\_cord) }
\KeywordTok{bptest}\NormalTok{(nls1\_lm) }\CommentTok{\# teste de Breusch{-}Pagan (homogeneidade)}
\CommentTok{\# }
\CommentTok{\#   studentized Breusch{-}Pagan test}
\CommentTok{\# }
\CommentTok{\# data:  nls1\_lm}
\CommentTok{\# BP = 1.5734, df = 2, p{-}value = 0.4554}
\KeywordTok{durbinWatsonTest}\NormalTok{(nls1\_lm) }\CommentTok{\# teste de DW (independência)}
\CommentTok{\#  lag Autocorrelation D{-}W Statistic p{-}value}
\CommentTok{\#    1      0.08163678      1.763777   0.248}
\CommentTok{\#  Alternative hypothesis: rho != 0}
\end{Highlighting}
\end{Shaded}

O cumprimento dos pressupostos \indt{pressupostos} dos resíduos não afeta a estimativa dos parâmetros, mas é de extrema importância para construir intervalos de confiança e testar hipóteses. Percebe-se, no nosso exemplo, que os pressuposto foram cumpridos (\emph{p}-valor\textgreater0,05). Para realizar a análise gráfica dos resíduos pode-se utilizar a função \texttt{nlsResiduals()} \indf{nlsResiduals} do pacote \textbf{nlstools}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(nlstools)}
\NormalTok{res1\_nls1 =}\StringTok{ }\KeywordTok{nlsResiduals}\NormalTok{(nls1)}
\KeywordTok{plot}\NormalTok{(res1\_nls1)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-257-1} \end{center}

No exemplo acima, apenas uma observação foi realizada para cada variável independente (dias após o transplante, no caso). Por isso optou-se por utilizar o teste de \emph{Breusch-Pagan} para realizar o diagnóstico de homocedasticidade dos resíduos. Quando mais de uma observação é realizada em cada variável independente, pode-se utilizar os testes de \emph{Bartlett} ou \emph{Levene}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{nls\_eggplant \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"EGGPLANT"}\NormalTok{)}
\NormalTok{nls\_eggplant \textless{}{-}}\StringTok{ }\KeywordTok{subset}\NormalTok{(nls\_eggplant, ESTUFA  }\OperatorTok{==}\StringTok{  "E1"}\NormalTok{) }
\NormalTok{start \textless{}{-}}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{b1 =} \DecValTok{10}\NormalTok{,}\DataTypeTok{b2 =} \FloatTok{6.7}\NormalTok{,}\DataTypeTok{b3 =} \FloatTok{0.073}\NormalTok{)}
\NormalTok{nls2 \textless{}{-}}\StringTok{ }\KeywordTok{nls}\NormalTok{(NUMERO }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{b1}\OperatorTok{/}\NormalTok{(}\DecValTok{1}\OperatorTok{+}\KeywordTok{exp}\NormalTok{(b2}\OperatorTok{{-}}\NormalTok{b3}\OperatorTok{*}\NormalTok{DAT)), }
            \DataTypeTok{data =}\NormalTok{ nls\_eggplant,}
            \DataTypeTok{start =}\NormalTok{ start)}
\end{Highlighting}
\end{Shaded}

\hypertarget{medidas-de-nuxe3o-linearidade}{%
\subsection{Medidas de não linearidade}\label{medidas-de-nuxe3o-linearidade}}

Conforme vimos acima, a estimação dos parâmetros \indt{parâmetros}é realizada pelo método dos mínimos quadrados \indt{mínimos quadrados} utilizando aproximações lineares de Taylor da função resposta. É esta aproximação linear que garante que os parâmetros estimados sejam proximos de não viesados (só serão não viesados assintoticamente). Modelos com aproximação linear pobre tendem a ter parâmetros muito viesados, o que impede que eles sejam utilizados para explicar determinado fenomeno biológico (eles tem ineterpretação biológica). As medidas de curvatura de Bates e Watts são amplamente utilizadas para avaliar o grau de não linearidade da função resposta. Para maiores detalhes, ver Bates and Watts (\protect\hyperlink{ref-Bates1988}{1988}), cap. 7 e Seber and Wild (\protect\hyperlink{ref-Seber2003}{2003}), cap. 4. Essas medidas são facilmente implementadas através da função \texttt{rms.curv()} \indf{rms.curv} do pacote \emph{MASS}. Para isto, utilizaremos o modelo ajustado \texttt{nls1}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{start \textless{}{-}}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{b1 =} \DecValTok{30}\NormalTok{, }\DataTypeTok{b2 =} \DecValTok{19}\NormalTok{, }\DataTypeTok{b3 =} \FloatTok{0.2}\NormalTok{)}
\CommentTok{\#\# Medidas de não linearidade}
\NormalTok{nls1\_hess \textless{}{-}}\StringTok{ }\KeywordTok{deriv3}\NormalTok{(}\OperatorTok{\textasciitilde{}}\NormalTok{b1}\OperatorTok{/}\NormalTok{(}\DecValTok{1} \OperatorTok{+}\StringTok{ }\KeywordTok{exp}\NormalTok{(b2 }\OperatorTok{{-}}\StringTok{ }\NormalTok{b3 }\OperatorTok{*}\StringTok{ }\NormalTok{DAT)), }\KeywordTok{c}\NormalTok{(}\StringTok{"b1"}\NormalTok{,}\StringTok{"b2"}\NormalTok{,}\StringTok{"b3"}\NormalTok{),}
                   \ControlFlowTok{function}\NormalTok{(DAT,b1,b2,b3)}\OtherTok{NULL}\NormalTok{) }\CommentTok{\#\# hessiana}
\NormalTok{nls1\_hess}\FloatTok{.1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{nls}\NormalTok{(num }\OperatorTok{\textasciitilde{}}\StringTok{ }\KeywordTok{nls1\_hess}\NormalTok{(DAT,b1,b2,b3),}
                   \DataTypeTok{data =}\NormalTok{ nls\_tomato\_cord,}
                   \DataTypeTok{start =}\NormalTok{ start)}
\KeywordTok{rms.curv}\NormalTok{(nls1\_hess}\FloatTok{.1}\NormalTok{)}
\CommentTok{\# Parameter effects: c\^{}theta x sqrt(F) = 0.806 }
\CommentTok{\#         Intrinsic: c\^{}iota  x sqrt(F) = 0.1235}
\end{Highlighting}
\end{Shaded}

Os valores que a função \texttt{rms.curv()} retorna são \({c^\theta } \times \sqrt {{F_{\alpha ;p,n - p}}}\) e \({c^\iota } \times \sqrt {{F_{\alpha ;p,n - p}}}\). Valores baixos destas duas medidas indicam que a função tem boa aproximação linear e, consequentemente, os parâmetros \indt{parâmetros}são próximos de ser não viesados.

\hypertarget{comparauxe7uxe3o-de-paruxe2metros}{%
\subsection{Comparação de parâmetros}\label{comparauxe7uxe3o-de-paruxe2metros}}

Os parâmetros em um modelo podem ser comparados utilizando variávies \emph{dummy}. Utilizando esta técnica, a ocorrência de um determinado fator é associado a um nova variável. Como os modelos são aninhados, pode-se utilizar o teste F para verificar a significância do parâmetro (e, consequentemente, do fator) associado a esta variável.

Vamos ao exemplo. Suponha que queiramos comparar a produção e a taxa de producão de frutos de dois genótipos de tomate. Sabemos que quando acumuladas, a podução de olerícolas tem comportamento sigmoide (Lúcio, Nunes, and Rego \protect\hyperlink{ref-Lucio2015}{2015}; Lucio, Nunes, and Rego \protect\hyperlink{ref-Lucio2016}{2016}), o que permite deteminar essas caracteristicas através dos parâmetros de um modelo logístico:

\[
{Y_i} = \frac{{{\beta _1}}}{{1 + {e^{\left( {{\beta _2} - {\beta _3}{t_i}} \right)}}}} + {\varepsilon _i}
\]

No modelo acima, \(\beta_1\) representa a assíntota, e está associada a produção total dos genótipos; \(\beta_3\) é a taxa de produção de frutos, e está associada a precocidade produtiva dos genótipos (Sari \protect\hyperlink{ref-Sari2018}{2018}). Vamos testar as seguintes hipóteses:

\[
    \begin{array}{*{20}{c}}{{H_0} = {\beta _{11}} = {\beta _{12}}}&{{H_0} = {\beta _{31}} = {\beta _{32}}}\\{{H_A} = {\beta _{11}} \ne {\beta _{12}}}&{{H_A} = {\beta _{31}} \ne {\beta _{32}}}\end{array}
\]

\textbf{Testando a hipótese \(H_0:\beta_{11} = \beta_{12}\)}

Associamos os fatores a novas variávies através de uma nova coluna no banco de dados. No nosso caso, a coluna ``Completo'' associa o fator aos parâmetros \indt{parâmetros}do modelo logístico. Então, como o modelo logístico possui 3 parâmetros, ao associarmos variávies dummys ao fator genótipo (são dois genótipos), o modelo completo passa a ter 6 parâmetros.

Para tertar esta hipótese, associamos variáveis dummy \indt{variáveis dummy}s apenas aos parâmetros \(\beta_1\) e \(\beta_3\). Neste caso, o modelo passa a ter 5 parâmetros (1 \(\beta_1\), 2 \(\beta_2\) e 2 \(\beta_3\)). Podemos comparar esse modelo reduzido com o modelo completo de 6 parâmetros. Se o teste F der significativo, concluímos que há influência do fator genótipo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nls\_dummy \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{nls\_tomato }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{as\_factor}\NormalTok{(Genotipo, Completo, Reduzido)}
\CommentTok{\#\# Modelo completo}
\NormalTok{tomato\_completo \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{nls}\NormalTok{(num }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{b1[Completo] }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{+}\StringTok{ }\KeywordTok{exp}\NormalTok{(b2[Completo] }\OperatorTok{{-}}\StringTok{ }\NormalTok{b3[Completo] }\OperatorTok{*}\StringTok{ }\NormalTok{DAT)), }
      \DataTypeTok{data =}\NormalTok{ nls\_dummy,}
      \DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{b1 =} \KeywordTok{c}\NormalTok{(}\FloatTok{18.94}\NormalTok{, }\FloatTok{39.68}\NormalTok{),}
                   \DataTypeTok{b2 =} \KeywordTok{c}\NormalTok{(}\FloatTok{16.04}\NormalTok{, }\FloatTok{13.54}\NormalTok{),}
                   \DataTypeTok{b3 =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.17}\NormalTok{, }\FloatTok{0.13}\NormalTok{)))}
\CommentTok{\#\# Modelo reduzido (beta 1)}
\NormalTok{tomato\_reduzido.b1 \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{nls}\NormalTok{(num }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{b1[Reduzido] }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{+}\StringTok{ }\KeywordTok{exp}\NormalTok{(b2[Completo] }\OperatorTok{{-}}\StringTok{ }\NormalTok{b3[Completo] }\OperatorTok{*}\StringTok{ }\NormalTok{DAT)), }
      \DataTypeTok{data =}\NormalTok{ nls\_dummy,}
      \DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{b1 =} \KeywordTok{c}\NormalTok{(}\FloatTok{18.94}\NormalTok{),}
                   \DataTypeTok{b2 =} \KeywordTok{c}\NormalTok{(}\FloatTok{16.04}\NormalTok{, }\FloatTok{13.54}\NormalTok{),}
                   \DataTypeTok{b3 =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.17}\NormalTok{, }\FloatTok{0.13}\NormalTok{)))}
\KeywordTok{anova}\NormalTok{(tomato\_reduzido.b1, tomato\_completo)}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: num \textasciitilde{} b1[Reduzido]/(1 + exp(b2[Completo] {-} b3[Completo] * DAT))}
\CommentTok{\# Model 2: num \textasciitilde{} b1[Completo]/(1 + exp(b2[Completo] {-} b3[Completo] * DAT))}
\CommentTok{\#   Res.Df Res.Sum Sq Df Sum Sq F value    Pr(\textgreater{}F)    }
\CommentTok{\# 1     13     55.636                                }
\CommentTok{\# 2     12      7.833  1 47.802  73.228 1.875e{-}06 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\end{Highlighting}
\end{Shaded}

Os valores da assintota diferem estatisticamente entre si. Percebe-se claramente que o genótipo Cordillera foi mais produtivo que o genótipo Gaúcho.

\textbf{Testando a hipótese \(H_0:\beta_{31} = \beta_{32}\)}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Modelo reduzido (beta 3)}
\NormalTok{tomato\_reduzido.b3 \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{nls}\NormalTok{(num }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{b1[Completo] }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{+}\StringTok{ }\KeywordTok{exp}\NormalTok{(b2[Completo] }\OperatorTok{{-}}\StringTok{ }\NormalTok{b3[Reduzido] }\OperatorTok{*}\StringTok{ }\NormalTok{DAT)), }
      \DataTypeTok{data =}\NormalTok{ nls\_dummy,}
      \DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{b1 =} \KeywordTok{c}\NormalTok{(}\FloatTok{18.94}\NormalTok{, }\FloatTok{39.68}\NormalTok{),}
                   \DataTypeTok{b2 =} \KeywordTok{c}\NormalTok{(}\FloatTok{16.04}\NormalTok{, }\FloatTok{13.54}\NormalTok{),}
                   \DataTypeTok{b3 =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.16}\NormalTok{)))}
\KeywordTok{anova}\NormalTok{(tomato\_reduzido.b3, tomato\_completo)}
\CommentTok{\# Analysis of Variance Table}
\CommentTok{\# }
\CommentTok{\# Model 1: num \textasciitilde{} b1[Completo]/(1 + exp(b2[Completo] {-} b3[Reduzido] * DAT))}
\CommentTok{\# Model 2: num \textasciitilde{} b1[Completo]/(1 + exp(b2[Completo] {-} b3[Completo] * DAT))}
\CommentTok{\#   Res.Df Res.Sum Sq Df Sum Sq F value  Pr(\textgreater{}F)  }
\CommentTok{\# 1     13    10.1479                            }
\CommentTok{\# 2     12     7.8335  1 2.3144  3.5454 0.08417 .}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\end{Highlighting}
\end{Shaded}

Os valores da taxa de produção de frutos não diferem estatisticamente entre si.

\hypertarget{representauxe7uxe3o-gruxe1fica-dos-modelos}{%
\subsection{Representação gráfica dos modelos}\label{representauxe7uxe3o-gruxe1fica-dos-modelos}}

Percebe-se claramente que um modelo comum aos dois genótipos não é possível (assintota diferem entre si). Por isso, optou-se por gerar um modelo em separado para cada genótipo. Podemos representar isso graficamente utilizando a função \texttt{ggplot()} \indf{ggplot} .

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{formula \textless{}{-}}\StringTok{ }\KeywordTok{as.formula}\NormalTok{(}\StringTok{"y \textasciitilde{} b1/(1 + exp(b2{-}b3*x))"}\NormalTok{)}
\NormalTok{start \textless{}{-}}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{b1 =} \FloatTok{10.224}\NormalTok{, }\DataTypeTok{b2 =} \FloatTok{6.765}\NormalTok{, }\DataTypeTok{b3 =} \FloatTok{0.0725}\NormalTok{)}

\KeywordTok{ggplot}\NormalTok{(nls\_tomato, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ DAT, }\DataTypeTok{y =}\NormalTok{ num, }\DataTypeTok{colour =}\NormalTok{ Genotipo)) }\OperatorTok{+}\StringTok{ }
\KeywordTok{geom\_point}\NormalTok{() }\OperatorTok{+}
\KeywordTok{geom\_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"nls"}\NormalTok{, }
            \DataTypeTok{method.args =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{formula =}\NormalTok{ formula, }
                                \DataTypeTok{start =}\NormalTok{ start),}
                                \DataTypeTok{se =}\NormalTok{ F,}
                                \DataTypeTok{data =} \KeywordTok{subset}\NormalTok{(nls\_tomato, Genotipo }\OperatorTok{==}\StringTok{ "Cordillera"}\NormalTok{)) }\OperatorTok{+}
\KeywordTok{geom\_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"nls"}\NormalTok{, }
            \DataTypeTok{method.args =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{formula =}\NormalTok{ formula, }
                                \DataTypeTok{start =}\NormalTok{ start),}
                                \DataTypeTok{se =}\NormalTok{ F,}
                                \DataTypeTok{data =} \KeywordTok{subset}\NormalTok{(nls\_tomato, Genotipo }\OperatorTok{==}\StringTok{ "Gaucho"}\NormalTok{))}\OperatorTok{+}
\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}\OperatorTok{+}
\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Dias após o transplante"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Número de frutos"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-262-1} 

}

\caption{Representação gráfica em modelos não lineares}\label{fig:unnamed-chunk-262}
\end{figure}

\hypertarget{regressuxe3o-bisegmentada-com-platuxf4}{%
\section{Regressão bisegmentada com platô}\label{regressuxe3o-bisegmentada-com-platuxf4}}

Continuaremos tomando como exemplo a produção de olerícolas de múltiplas colheitas para exemplificar o uso deste tipo de regressão. Os modelos com platô são modelos bi-segmentados cujo primeiro segmento descreve o crescimento da produção até determinado ponto, e um segundo segmento que descreve a estabilização da produção (platô). Podemos representar um modelo linear-platô por:

\[
{Y_i} = \left\{ \begin{array}{l}{\beta _0} + {\beta _1}x + {\varepsilon _i}{\rm{, se }}{X_i}{\rm{  <  }}{X_0}\\P{\rm{ se }}{X_i}{\rm{  >  }}{X_0}{\rm{ }}\end{array} \right.
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url \textless{}{-}}\StringTok{ "https://github.com/TiagoOlivoto/e{-}bookr/raw/master/data/data\_R.xlsx"}
\NormalTok{plato\_tomato \textless{}{-}}\StringTok{ }\KeywordTok{import}\NormalTok{(url, }\DataTypeTok{sheet =} \StringTok{"PLATO"}\NormalTok{)}
\NormalTok{plato\_cordillera \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{nls}\NormalTok{(num }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{(b0 }\OperatorTok{+}\StringTok{ }\NormalTok{b1 }\OperatorTok{*}\StringTok{ }\NormalTok{DAT }\OperatorTok{*}\StringTok{ }\NormalTok{(DAT }\OperatorTok{\textless{}=}\StringTok{ }\NormalTok{P)) }\OperatorTok{+}\StringTok{ }\NormalTok{(b1 }\OperatorTok{*}\StringTok{ }\NormalTok{P }\OperatorTok{*}\StringTok{ }\NormalTok{(DAT }\OperatorTok{\textgreater{}}\StringTok{ }\NormalTok{P)),}
      \DataTypeTok{data =} \KeywordTok{subset}\NormalTok{(plato\_tomato, Genotipo }\OperatorTok{==}\StringTok{ "Cordillera"}\NormalTok{),}
      \DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{b0 =} \DecValTok{5}\NormalTok{, }\DataTypeTok{b1 =} \DecValTok{11}\OperatorTok{/}\DecValTok{8}\NormalTok{, }\DataTypeTok{P =} \DecValTok{15}\NormalTok{))}
\NormalTok{plato\_SantaCl \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{nls}\NormalTok{(num }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{(b0 }\OperatorTok{+}\StringTok{ }\NormalTok{b1 }\OperatorTok{*}\StringTok{ }\NormalTok{DAT }\OperatorTok{*}\StringTok{ }\NormalTok{(DAT }\OperatorTok{\textless{}=}\StringTok{ }\NormalTok{P)) }\OperatorTok{+}\StringTok{ }\NormalTok{(b1 }\OperatorTok{*}\StringTok{ }\NormalTok{P }\OperatorTok{*}\StringTok{ }\NormalTok{(DAT }\OperatorTok{\textgreater{}}\StringTok{ }\NormalTok{P)),}
      \DataTypeTok{data =} \KeywordTok{subset}\NormalTok{(plato\_tomato, Genotipo }\OperatorTok{==}\StringTok{ "Santa.Clara"}\NormalTok{),}
      \DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{b0 =} \DecValTok{5}\NormalTok{, }\DataTypeTok{b1 =} \DecValTok{11}\OperatorTok{/}\DecValTok{8}\NormalTok{, }\DataTypeTok{P =} \DecValTok{15}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

O genótipo Cordillera produz a uma taxa de 1,33 frutos dia\(^-1\) até os \textasciitilde9 dias após o início das colheitas, quando começa a estabilizar a produção (17,19 frutos). Já o genótipo Santa Clara produz a uma taxa de 0,71 frutos \(^-1\) até os \textasciitilde14 dias após o início das colheitas, quando começa a estabilizar a produção (12,69 frutos). Podemos verificar a taxa de produção e o ponto de estabilização através de variáveis dummy \indt{variáveis dummy}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plato\_dummy \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{plato\_tomato }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{as\_factor}\NormalTok{(Genotipo, Completo, Reduzido)}
\CommentTok{\# Modelo completo}
\NormalTok{plato\_completo \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{nls}\NormalTok{(num }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{(b0[Completo] }\OperatorTok{+}\StringTok{ }\NormalTok{b1[Completo] }\OperatorTok{*}\StringTok{ }\NormalTok{DAT }\OperatorTok{*}\StringTok{ }\NormalTok{(DAT }\OperatorTok{\textless{}=}\StringTok{ }\NormalTok{P[Completo]))}\OperatorTok{+}
\StringTok{        }\NormalTok{(b1[Completo] }\OperatorTok{*}\StringTok{ }\NormalTok{P[Completo] }\OperatorTok{*}\StringTok{ }\NormalTok{(DAT }\OperatorTok{\textgreater{}}\StringTok{ }\NormalTok{P[Completo])),}
      \DataTypeTok{data =}\NormalTok{ plato\_dummy,}
      \DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{b0 =} \KeywordTok{c}\NormalTok{(}\FloatTok{4.8}\NormalTok{, }\FloatTok{2.5}\NormalTok{), }
                   \DataTypeTok{b1 =} \KeywordTok{c}\NormalTok{(}\FloatTok{1.33}\NormalTok{, }\FloatTok{0.71}\NormalTok{), }
                   \DataTypeTok{P =} \KeywordTok{c}\NormalTok{(}\FloatTok{9.28}\NormalTok{, }\FloatTok{14.36}\NormalTok{)))}

\CommentTok{\# Modelo reduzido (taxa de produção)}
\NormalTok{plato\_reduzido.b1 \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{nls}\NormalTok{(num }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{(b0[Completo] }\OperatorTok{+}\StringTok{ }\NormalTok{b1[Reduzido] }\OperatorTok{*}\StringTok{ }\NormalTok{DAT }\OperatorTok{*}\StringTok{ }\NormalTok{(DAT }\OperatorTok{\textless{}=}\StringTok{ }\NormalTok{P[Completo]))}\OperatorTok{+}
\StringTok{        }\NormalTok{(b1[Reduzido] }\OperatorTok{*}\StringTok{ }\NormalTok{P[Completo] }\OperatorTok{*}\StringTok{ }\NormalTok{(DAT }\OperatorTok{\textgreater{}}\StringTok{ }\NormalTok{P[Completo])),}
      \DataTypeTok{data =}\NormalTok{ plato\_dummy,}
      \DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{b0 =} \KeywordTok{c}\NormalTok{(}\FloatTok{4.8}\NormalTok{,}\FloatTok{2.5}\NormalTok{), }
                   \DataTypeTok{b1 =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{), }
                   \DataTypeTok{P =} \KeywordTok{c}\NormalTok{(}\FloatTok{9.28}\NormalTok{,}\FloatTok{14.36}\NormalTok{)))}
\KeywordTok{anova}\NormalTok{(plato\_reduzido.b1, plato\_completo)}

\CommentTok{\# Modelo reduzido (Platô)}
\NormalTok{plato\_reduzido.P \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{nls}\NormalTok{(num }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{(b0[Completo] }\OperatorTok{+}\StringTok{ }\NormalTok{b1[Completo] }\OperatorTok{*}\StringTok{ }\NormalTok{DAT }\OperatorTok{*}\StringTok{ }\NormalTok{(DAT }\OperatorTok{\textless{}=}\StringTok{ }\NormalTok{P[Reduzido])) }\OperatorTok{+}\StringTok{ }
\StringTok{        }\NormalTok{(b1[Completo] }\OperatorTok{*}\StringTok{ }\NormalTok{P[Reduzido] }\OperatorTok{*}\StringTok{ }\NormalTok{(DAT }\OperatorTok{\textgreater{}}\StringTok{ }\NormalTok{P[Reduzido])),}
      \DataTypeTok{data =}\NormalTok{ plato\_dummy,}
      \DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{b0 =} \KeywordTok{c}\NormalTok{(}\FloatTok{4.8}\NormalTok{, }\FloatTok{2.5}\NormalTok{), }
                   \DataTypeTok{b1 =} \KeywordTok{c}\NormalTok{(}\FloatTok{1.33}\NormalTok{, }\FloatTok{0.71}\NormalTok{), }
                   \DataTypeTok{P =} \KeywordTok{c}\NormalTok{(}\DecValTok{12}\NormalTok{)))}
\KeywordTok{anova}\NormalTok{(plato\_reduzido.P, plato\_completo)}
\end{Highlighting}
\end{Shaded}

Percebe-se que a taxa de produção do genótipo Cordillera é significativamente superior a taxa de produção do genótipo Santa Clara. Como consequência, o momento de estabilização da produção ocorre mais precocemente no genótipo Cordillera. O exemplo foi realizado com dados de produção de olerícolas, mas pdoe ser adaptado para qualquer estudo (desde que tenha este comportamento).

\textbf{Representação gráfica dos modelos}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(num }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{DAT,}
     \DataTypeTok{data =} \KeywordTok{subset}\NormalTok{(plato\_tomato,Genotipo }\OperatorTok{==}\StringTok{ "Cordillera"}\NormalTok{),}\DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{20}\NormalTok{),}
     \DataTypeTok{xlab =} \StringTok{"Dias após o transplante (DAT)"}\NormalTok{,}
     \DataTypeTok{ylab =} \StringTok{"Número de frutos por planta"}\NormalTok{,}\DataTypeTok{pch =} \DecValTok{1}\NormalTok{,}\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{)}
\KeywordTok{points}\NormalTok{(num}\OperatorTok{\textasciitilde{}}\NormalTok{DAT,}\DataTypeTok{data =} \KeywordTok{subset}\NormalTok{(plato\_tomato,Genotipo }\OperatorTok{==}\StringTok{ "Santa.Clara"}\NormalTok{),}\DataTypeTok{pch =} \DecValTok{2}\NormalTok{,}\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{)}
\KeywordTok{segments}\NormalTok{(}\DataTypeTok{y0 =} \FloatTok{4.8385}\NormalTok{, }\DataTypeTok{x0 =} \DecValTok{0}\NormalTok{, }\DataTypeTok{y1 =} \FloatTok{17.2083}\NormalTok{, }\DataTypeTok{x1 =} \FloatTok{9.28641}\NormalTok{,}\DataTypeTok{lty =} \DecValTok{1}\NormalTok{,}\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{)}
\KeywordTok{segments}\NormalTok{(}\DataTypeTok{y0 =} \FloatTok{17.2083}\NormalTok{, }\DataTypeTok{x0 =} \FloatTok{9.28641}\NormalTok{, }\DataTypeTok{y1 =} \FloatTok{17.2083}\NormalTok{, }\DataTypeTok{x1 =} \DecValTok{20}\NormalTok{,}\DataTypeTok{lty =} \DecValTok{1}\NormalTok{,}\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{)}
\KeywordTok{segments}\NormalTok{(}\DataTypeTok{y0 =} \FloatTok{2.5000}\NormalTok{, }\DataTypeTok{x0 =} \DecValTok{0}\NormalTok{, }\DataTypeTok{y1 =} \FloatTok{12.7655}\NormalTok{, }\DataTypeTok{x1 =} \FloatTok{14.3606}\NormalTok{,}\DataTypeTok{lty =} \DecValTok{2}\NormalTok{,}\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{)}
\KeywordTok{segments}\NormalTok{(}\DataTypeTok{y0 =} \FloatTok{12.7655}\NormalTok{, }\DataTypeTok{x0 =} \FloatTok{14.3606}\NormalTok{, }\DataTypeTok{y1 =} \FloatTok{12.7655}\NormalTok{, }\DataTypeTok{x1 =} \DecValTok{20}\NormalTok{,}\DataTypeTok{lty =} \DecValTok{2}\NormalTok{,}\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{)}


\KeywordTok{legend}\NormalTok{(}\StringTok{"bottomright"}\NormalTok{, }\DataTypeTok{legend =} \KeywordTok{c}\NormalTok{(}\StringTok{"Cordillera"}\NormalTok{, }\StringTok{"Santa Clara"}\NormalTok{), }\DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{),}
       \DataTypeTok{pch =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{), }\DataTypeTok{lwd =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{bty =} \StringTok{"n"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-265-1} 

}

\caption{Representação gráfica de regressão bisegmentada com platô}\label{fig:unnamed-chunk-265}
\end{figure}

\hypertarget{relations}{%
\chapter{Relações lineares entre variáveis}\label{relations}}

Conhecer o grau de associação linear entre caracteres é de fundamental importância em um programa de melhoramento genético vegetal. Esta importância aumenta, principalmente se algum caractere desejável é de difícil mensuração, ou apresenta baixa herdabilidade. O coeficiente de correlação \indt{correlação} produto-momento de Pearson (\protect\hyperlink{ref-Pearson1920}{1920}), \emph{r}, vem sendo amplamente utilizado para este fim. Embora o mérito desta análise seja atribuído à Karl Pearson, o método foi originalmente concebido por Francis Galton, que definiu o termo correlação como como o seguinte: \emph{duas variáveis são ditas correlacionadas quando a variação de uma é acompanhada na média, mais ou menos a variação da outra, e no mesmo sentido} (Galton \protect\hyperlink{ref-Galton1888}{1888}).

\hypertarget{dados}{%
\section{Dados}\label{dados}}

Nesta sessão, e na sessão de \protect\hyperlink{multivariate}{análise multivariada} iremos utilizar o conjunto de dados \texttt{datage\_2} do pacote \texttt{metan}. Para maiores informações veja \texttt{?data\_ge2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize \textless{}{-}}\StringTok{ }\NormalTok{data\_ge2}
\NormalTok{numeric\_var \textless{}{-}}\StringTok{ }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select\_numeric\_cols}\NormalTok{()}
\NormalTok{datacor \textless{}{-}}\StringTok{ }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select\_cols}\NormalTok{(CD, CL, CW, PH, EH, EP, EL, ED)}
\end{Highlighting}
\end{Shaded}

\hypertarget{correlauxe7uxe3o-linear}{%
\section{Correlação linear}\label{correlauxe7uxe3o-linear}}

A estimativa do \emph{r} leva em consideração a covariância entre duas variáveis, representadas aqui por XY dividia pelo produto dos respectivos desvios padrões de X e de Y, conforme o seguinte modelo:

\[
{\rm{r  =  }}\frac{{\sum\limits_{{\rm{i = 1}}}^{\rm{n}} {{\rm{[ (}}{{\rm{X}}_{\rm{i}}}{\rm{ - \bar X)(}}{{\rm{Y}}_{\rm{i}}}{\rm{ - \bar Y)] }}} }}{{\sqrt {\sum\limits_{{\rm{i = 1}}}^{\rm{n}} {{{{\rm{(}}{{\rm{X}}_{\rm{i}}}{\rm{ - \bar X)}}}^{\rm{2}}}} } \sqrt {\sum\limits_{{\rm{i = 1}}}^{\rm{n}} {{{{\rm{(}}{{\rm{Y}}_{\rm{i}}}{\rm{ - \bar Y)}}}^{\rm{2}}}} } }}
\]

onde \({\rm{\bar X = }}\frac{{\rm{1}}}{{\rm{n}}}\sum\limits_{{\rm{i = 1}}}^{\rm{n}} {{{\rm{X}}_{\rm{i}}}}\) e \({\rm{\bar Y = }}\frac{{\rm{1}}}{{\rm{n}}}\sum\limits_{{\rm{i = 1}}}^{\rm{n}} {{{\rm{Y}}_{\rm{i}}}}\).

Esta sessão é focada em apresentar funções básicas e avançadas para visualização gráfica de associações e estimativas do coeficiente de correlação. Para este fim, utilizaremos o conjunto de dados \texttt{datacor}, criado anteriormente.

\hypertarget{visualizauxe7uxe3o-gruxe1fica}{%
\subsection{Visualização gráfica}\label{visualizauxe7uxe3o-gruxe1fica}}

A seguinte função proporciona uma visualização gráfica de todos os pares de correlação possíveis (\emph{scatter-plot})
\indf{pairs}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pairs}\NormalTok{(datacor)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-267-1} \end{center}

\hypertarget{estimativa-dos-coeficientes-de-correlauxe7uxe3o}{%
\subsection{Estimativa dos coeficientes de correlação}\label{estimativa-dos-coeficientes-de-correlauxe7uxe3o}}

\indf{corr\_coef}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{corr \textless{}{-}}\StringTok{ }\KeywordTok{corr\_coef}\NormalTok{(datacor)}
\KeywordTok{print}\NormalTok{(corr)}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Pearson\textquotesingle{}s correlation coefficient}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#       CD    CL    CW    PH    EH    EP    EL    ED}
\CommentTok{\# CD 1.000 0.300 0.484 0.315 0.281 0.175 0.912 0.390}
\CommentTok{\# CL 0.300 1.000 0.738 0.325 0.397 0.391 0.255 0.697}
\CommentTok{\# CW 0.484 0.738 1.000 0.505 0.519 0.425 0.458 0.737}
\CommentTok{\# PH 0.315 0.325 0.505 1.000 0.932 0.638 0.380 0.661}
\CommentTok{\# EH 0.281 0.397 0.519 0.932 1.000 0.870 0.363 0.630}
\CommentTok{\# EP 0.175 0.391 0.425 0.638 0.870 1.000 0.263 0.458}
\CommentTok{\# EL 0.912 0.255 0.458 0.380 0.363 0.263 1.000 0.385}
\CommentTok{\# ED 0.390 0.697 0.737 0.661 0.630 0.458 0.385 1.000}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# p{-}values for the correlation coefficients}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#          CD       CL       CW       PH       EH       EP       EL       ED}
\CommentTok{\# CD 0.00e+00 1.39e{-}04 1.54e{-}10 6.06e{-}05 3.90e{-}04 2.88e{-}02 1.97e{-}61 4.94e{-}07}
\CommentTok{\# CL 1.39e{-}04 0.00e+00 3.92e{-}28 3.45e{-}05 2.84e{-}07 4.55e{-}07 1.29e{-}03 4.74e{-}24}
\CommentTok{\# CW 1.54e{-}10 3.92e{-}28 0.00e+00 1.83e{-}11 3.76e{-}12 3.25e{-}08 1.81e{-}09 5.31e{-}28}
\CommentTok{\# PH 6.06e{-}05 3.45e{-}05 1.83e{-}11 0.00e+00 1.11e{-}69 3.10e{-}19 9.80e{-}07 5.66e{-}21}
\CommentTok{\# EH 3.90e{-}04 2.84e{-}07 3.76e{-}12 1.11e{-}69 0.00e+00 4.80e{-}49 3.28e{-}06 1.19e{-}18}
\CommentTok{\# EP 2.88e{-}02 4.55e{-}07 3.25e{-}08 3.10e{-}19 4.80e{-}49 0.00e+00 8.92e{-}04 1.83e{-}09}
\CommentTok{\# EL 1.97e{-}61 1.29e{-}03 1.81e{-}09 9.80e{-}07 3.28e{-}06 8.92e{-}04 0.00e+00 6.88e{-}07}
\CommentTok{\# ED 4.94e{-}07 4.74e{-}24 5.31e{-}28 5.66e{-}21 1.19e{-}18 1.83e{-}09 6.88e{-}07 0.00e+00}
\end{Highlighting}
\end{Shaded}

\hypertarget{combinando-visualizauxe7uxe3o-gruxe1fica-e-numuxe9rica-i}{%
\subsection{Combinando visualização gráfica e numérica (I)}\label{combinando-visualizauxe7uxe3o-gruxe1fica-e-numuxe9rica-i}}

\indf{pairs.panels}

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{pairs.panels}\NormalTok{(datacor)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-269-1} \end{center}

Na figura acima, os pontos observados são plotados na diagonal inferior. Na diagonal, é apresentada a estimativa da densidade Kernel (linha preta) e um histgrama de cada variável. A diagonal superior contém os coeficientes de correlação.

\hypertarget{combinando-visualizauxe7uxe3o-gruxe1fica-e-numuxe9rica-ii}{%
\subsection{Combinando visualização gráfica e numérica (II)}\label{combinando-visualizauxe7uxe3o-gruxe1fica-e-numuxe9rica-ii}}

\indf{corr\_plot}

A função \texttt{corr\_plot()}do pacote \texttt{metan} retorna um gráfico semelhante ao anterior, no entanto possui diversas opções, tais como mudança no tamanho da letra dependendo da magnitude da correlação e indicação de cores para correlações significativas.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{corr\_plot}\NormalTok{(datacor)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-270-1} 

}

\caption{Scatter plot de uma matriz de correlação de Pearson}\label{fig:unnamed-chunk-270}
\end{figure}

A função \texttt{corr\_plot()} pode ser utilizada com o operador \texttt{\%\textgreater{}\%}. Em adição, é possível escolher as variáveis a serem plotadas. Para isto, basta digitar o nome das variáveis.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{corr\_plot}\NormalTok{(CD, EL, PERK, NKR, CW,}
            \DataTypeTok{shape.point =} \DecValTok{19}\NormalTok{,}
            \DataTypeTok{size.point =} \DecValTok{2}\NormalTok{,}
            \DataTypeTok{alpha.point =} \FloatTok{0.5}\NormalTok{,}
            \DataTypeTok{alpha.diag =} \DecValTok{0}\NormalTok{,}
            \DataTypeTok{pan.spacing =} \DecValTok{0}\NormalTok{,}
            \DataTypeTok{col.sign =} \StringTok{"gray"}\NormalTok{,}
            \DataTypeTok{alpha.sign =} \FloatTok{0.3}\NormalTok{,}
            \DataTypeTok{axis.labels =} \OtherTok{TRUE}\NormalTok{,}
            \DataTypeTok{progress =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-271-1} 

}

\caption{Scatter plot de uma matriz de correlação de Pearson}\label{fig:unnamed-chunk-271}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{corr\_plot}\NormalTok{(CD, EL, PERK, NKR, CW,}
            \DataTypeTok{shape.point =} \DecValTok{21}\NormalTok{,}
            \DataTypeTok{col.point =} \StringTok{"black"}\NormalTok{,}
            \DataTypeTok{fill.point =} \StringTok{"orange"}\NormalTok{,}
            \DataTypeTok{size.point =} \DecValTok{2}\NormalTok{,}
            \DataTypeTok{alpha.point =} \FloatTok{0.6}\NormalTok{,}
            \DataTypeTok{maxsize =} \DecValTok{4}\NormalTok{,}
            \DataTypeTok{minsize =} \DecValTok{2}\NormalTok{,}
            \DataTypeTok{smooth =} \OtherTok{TRUE}\NormalTok{,}
            \DataTypeTok{col.smooth =} \StringTok{"black"}\NormalTok{,}
            \DataTypeTok{col.sign =} \StringTok{"cyan"}\NormalTok{,}
            \DataTypeTok{upper =} \StringTok{"scatter"}\NormalTok{,}
            \DataTypeTok{lower =} \StringTok{"corr"}\NormalTok{,}
            \DataTypeTok{diag.type =} \StringTok{"density"}\NormalTok{,}
            \DataTypeTok{col.diag =} \StringTok{"cyan"}\NormalTok{,}
            \DataTypeTok{pan.spacing =} \DecValTok{0}\NormalTok{,}
            \DataTypeTok{lab.position =} \StringTok{"bl"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-272-1} 

}

\caption{Scatter plot de uma matriz de correlação de Pearson}\label{fig:unnamed-chunk-272}
\end{figure}

\hypertarget{combinando-visualizauxe7uxe3o-gruxe1fica-e-numuxe9rica-iii}{%
\subsection{Combinando visualização gráfica e numérica (III)}\label{combinando-visualizauxe7uxe3o-gruxe1fica-e-numuxe9rica-iii}}

\indt{corrplot.mixed()}

A função \texttt{corrplot.mixed()} \indf{corrplot.mixed} do pacote \href{https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html}{corrplot}\footnote{\url{https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html}} também é uma boa opção para visualização gráfica, principalmente quando um grande número de combinações está disponível.

\begin{itemize}
\tightlist
\item
  Criando a matrix de correlação utilizando o conjunto de dados \texttt{datacor}.
\item
  8 variáveis \textbar{} 28 combinações
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{cor1 \textless{}{-}}\StringTok{ }\KeywordTok{cor}\NormalTok{(datacor)}
\KeywordTok{corrplot.mixed}\NormalTok{(cor1,}
               \DataTypeTok{upper =} \StringTok{"ellipse"}\NormalTok{,}
               \DataTypeTok{lower =} \StringTok{"number"}\NormalTok{,}
               \DataTypeTok{number.digits =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-273-1} \end{center}

\hypertarget{combinando-visualizauxe7uxe3o-gruxe1fica-e-numuxe9rica-iv}{%
\subsection{Combinando visualização gráfica e numérica (IV)}\label{combinando-visualizauxe7uxe3o-gruxe1fica-e-numuxe9rica-iv}}

\begin{itemize}
\tightlist
\item
  Criando a matrix de correlação utilizando o conjunto de dados dataset.
\item
  14 variáveis \textbar{} 91 combinações
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cor2 \textless{}{-}}\StringTok{ }\KeywordTok{cor}\NormalTok{(numeric\_var)}
\NormalTok{pval \textless{}{-}}\StringTok{ }\KeywordTok{cor.mtest}\NormalTok{(cor2)}\OperatorTok{$}\NormalTok{p}
\end{Highlighting}
\end{Shaded}

A função \texttt{corrplot()} \indf{corrplot} do pacote \texttt{corrplot} permite uma poderosa personalização. Esta função tem a vantagem de apresentar um elevado número de combinações em um gráfico claro e intuitivo.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{corrplot}\NormalTok{(cor2,}
         \DataTypeTok{method =} \StringTok{"pie"}\NormalTok{,}
         \DataTypeTok{p.mat =}\NormalTok{ pval,}
         \DataTypeTok{sig.level =} \FloatTok{0.05}\NormalTok{,}
         \DataTypeTok{insig =} \StringTok{"blank"}\NormalTok{,}
         \DataTypeTok{type =} \StringTok{"lower"}\NormalTok{,}
         \DataTypeTok{diag =}\NormalTok{ F,}
         \DataTypeTok{tl.col =} \StringTok{"black"}\NormalTok{,}
         \DataTypeTok{tl.srt =} \DecValTok{45}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-275-1} 

}

\caption{Gráfico de pizza de uma matriz de correlação de Pearson}\label{fig:unnamed-chunk-275}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{corrplot}\NormalTok{(cor2,}
         \DataTypeTok{method =} \StringTok{"ellipse"}\NormalTok{,}
         \DataTypeTok{p.mat =}\NormalTok{ pval,}
         \DataTypeTok{sig.level =} \FloatTok{0.05}\NormalTok{,}
         \DataTypeTok{insig =} \StringTok{"blank"}\NormalTok{,}
         \DataTypeTok{type =} \StringTok{"upper"}\NormalTok{,}
         \DataTypeTok{diag =}\NormalTok{ F,}
         \DataTypeTok{tl.col =} \StringTok{"black"}\NormalTok{,}
         \DataTypeTok{tl.srt =} \DecValTok{45}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-276-1} \end{center}

\hypertarget{correlauxe7uxf5es-genuxe9ticas}{%
\section{Correlações genéticas}\label{correlauxe7uxf5es-genuxe9ticas}}

A função \texttt{covcor\_design()} pode ser usada para calcular matrizes de correlação/(co) variância genéticas, fenotípicas e residuais através do método de Análise de Variância (ANOVA) usando delineamento de blocos completos casualizados (DBC) ou delineamento inteiramente casualizado (DIC).

As correlações fenotípicas \(r^p_{xy}\), genotípicas \(r^g_{xy}\) e residuais \(r^r_{xy}\) entre duas variáveis \emph{x} e \emph{y} são calculadas conforme segue.

\[
r^p_{xy} = \frac{cov^p_{xy}}{\sqrt{var^p_{x}var^p_{y}}} \
r^g_{xy} = \frac{cov^g_{xy}}{\sqrt{var^g_{x}var^g_{y}}} \
r^r_{xy} = \frac{cov^r_{xy}}{\sqrt{var^r_{x}var^r_{y}}}
\]

Utilizando os quadrados médios (QM) obtidos da ANOVA, as variâncias (var) e covariâncias (cov) são calculadas da seguinte forma:

\[
cov^p_{xy} = [(QMT_{x+y} -QMT_x -QMT_y)/2]/r \\
var^p_x =QMT_x / r \\
var^p_y =QMT_y / r
\]

\[
cov^r_{xy} = (QME_{x+y} - QME_x - QME_y)/2 \\
var^r_x = QME_x \\
var^r_y = QME_y
\]

\[
cov^g_{xy} = [(cov^p_{xy} \times r) - cov^r_{xy}]/r \\
var^g_x = (MST_x - MSE_x)/r \\
var^g_y = (MST_x - MSE_y)/r
\]

onde \emph{QMT} é o quadrado médio para tratamento, \emph{QME} é o quadrado médio do erro e \emph{r} é o número de repetições/blocos. A função \texttt{covcor\_design()} \indf{covcor\_design} retorna uma lista com as matrizes de (co)variâncias e correlações. Matrizes específicas podem ser retornadas usando o tipo de argumento \texttt{type}. No exemplo abaixo, o coeficiente de correlação genotípico entre as variáveis PH, EH, NKE e TKW será computado para o ambiente A1, considerando um DBC.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(ENV }\OperatorTok{==}\StringTok{ "A1"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{covcor\_design}\NormalTok{(}\DataTypeTok{gen =}\NormalTok{ GEN,}
                \DataTypeTok{rep =}\NormalTok{ REP,}
                \DataTypeTok{resp =} \KeywordTok{c}\NormalTok{(PH, EH, NKE, TKW),}
                \DataTypeTok{type =} \StringTok{"gcor"}\NormalTok{)}
\CommentTok{\#               PH           EH        NKE        TKW}
\CommentTok{\# PH   1.000000000 {-}0.006544623  0.2801806  0.2459377}
\CommentTok{\# EH  {-}0.006544623  1.000000000 {-}0.7752497  0.7247684}
\CommentTok{\# NKE  0.280180560 {-}0.775249741  1.0000000 {-}0.5117645}
\CommentTok{\# TKW  0.245937657  0.724768430 {-}0.5117645  1.0000000}
\end{Highlighting}
\end{Shaded}

\indt{Exercícios}
\begin{tarefa}
\textbf{Exercício 13}
Compute a matriz de (co)variâncias residuais para cada ambiente combinando as funções \texttt{group\_by()} e \texttt{covcor\_design()}
\end{tarefa}
\protect\hyperlink{exerc13}{Resposta}

\hypertarget{intervalo-de-confianuxe7a}{%
\section{Intervalo de confiança}\label{intervalo-de-confianuxe7a}}

\hypertarget{paramuxe9trico}{%
\subsection{Paramétrico}\label{paramuxe9trico}}

O intervalo de confiança para o coeficiente de correlação pode ser obtido utilizando a função \texttt{cor.mtest()} do pacote \textbf{corrplot}, conforme o seguinte exemplo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ci\_corr \textless{}{-}}\StringTok{ }\KeywordTok{cor.mtest}\NormalTok{(datacor)}
\end{Highlighting}
\end{Shaded}

\hypertarget{nuxe3o-paramuxe9trico}{%
\subsection{Não paramétrico}\label{nuxe3o-paramuxe9trico}}

Um estimador não paramétrico do intervalo de confiança do coeficiente de correlação de Pearson foi proposto por Olivoto et al. (\protect\hyperlink{ref-Olivoto2018}{2018}). Este estimador é baseado no tamanho da amostra e força de associações e pode ser estimado usando a função \texttt{corr\_ci()} do pacote \texttt{metan}. \indf{corr\_ci} É possível estimar o intervalo de confiança declarando o tamanho da amostra (n) e o coeficiente de correlação (r), ou usando um dataframe. O código a seguir calcula o intervalo de confiança para os possíveis pares de correlação entre as variáveis que contém \textbf{E} no nome. Note o benefício do operador \texttt{\%\textgreater{}\%} neste caso.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(}\KeywordTok{contains}\NormalTok{(}\StringTok{"E"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{corr\_ci}\NormalTok{(}\DataTypeTok{verbose =} \OtherTok{FALSE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{plot\_ci}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-280-1} \end{center}

\hypertarget{tamanho-da-amostra}{%
\section{Tamanho da amostra}\label{tamanho-da-amostra}}

Baseado no modelo proposto por Olivoto et al. (\protect\hyperlink{ref-Olivoto2018}{2018}), o tamanho da amostra suficiente para a estimativa do coeficiente de correlação considerando um intervalo de confiança desejado é obtido pela função \texttt{corr\_ss()}. Neste exemplo, vamos calcular o tamanho da amostra necessário para que uma correlação de 0.6 apresente uma semi-amplitude do intervalo de confiança igual a 0.1 \indf{corr\_ss}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{corr\_ss}\NormalTok{(}\DataTypeTok{r =} \FloatTok{0.6}\NormalTok{, }\DataTypeTok{CI =} \FloatTok{0.1}\NormalTok{)}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{\# Sample size planning for correlation coefficient }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{\# Level of significance: 5\%}
\CommentTok{\# Correlation coefficient: 0.6}
\CommentTok{\# 95\% half{-}width CI: 0.1}
\CommentTok{\# Required sample size: 194}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

\hypertarget{correlauxe7uxe3o-parcial}{%
\section{Correlação parcial}\label{correlauxe7uxe3o-parcial}}

Em certos casos, o coeficiente de correlação linear simples pode nos levar a equívocos na interpretação da associação entre duas variáveis, pois este não considera a influência das demais variáveis contidas no conjunto de dados. O coeficiente de correlação parcial \indt{correlação parcial} é uma técnica baseada em operações matriciais que nos permite identificar a associação entre duas variáveis retirando-se os efeitos das demais variáveis presentes (Anderson \protect\hyperlink{ref-Anderson2003}{2003}) Uma maneira generalizada para a estimativa do coeficiente de correlação parcial entre duas variáveis (\emph{i} e \emph{j}) é por meio da matriz de correlação simples que envolve estas duas variáveis e \emph{m} outras variáveis das quais queremos retirar o efeito. A estimativa do coeficiente de correlação parcial entre \emph{i} e \emph{j} excluído o efeito de \emph{m} outras variáveis é dado por:

\[
{r_{ij.m} = \frac{{- {a_{ij}}}}{{\sqrt {{a_{ii}}{a_{jj}}}}}}
\]

onde \(r_{ij.m}\) é o coeficiente de correlação parcial \indt{correlação parcial} entre as variável \emph{i} e \emph{j}, sem o efeito das outras \emph{m} outras variáveis; \(a_{ij}\) é o elemento da ordem \emph{ij} da inversa da matriz de correlação simples; \(a_{ii}\) e \(a_{jj}\) são os elementos de ordens \emph{ii} e \emph{jj}, respectivamente, da inversa da matriz de correlação simples.

As matrizes de coeficientes de correlação linear e parcial podem ser facilmente obtida utilizando a função \texttt{lpcor()} \indf{lpcor} do pacote \texttt{metan}. A entrada dos dados pode ser realizada de duas maneiras. (i) utilizando os dados com as observações de cada variável; ou (ii) utilizando uma matriz de correlação linear simples pré estimada. Em nosso exemplo, vamos utilziar os mesmos dados utilizados nas funções anteriores (\emph{datacor}).

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{partial \textless{}{-}}\StringTok{ }\KeywordTok{lpcor}\NormalTok{(datacor)}
\KeywordTok{print}\NormalTok{(partial)}
\CommentTok{\# \# A tibble: 28 x 5}
\CommentTok{\#    Pairs   linear partial      t          prob}
\CommentTok{\#    \textless{}chr\textgreater{}    \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}         \textless{}dbl\textgreater{}}
\CommentTok{\#  1 CD x CL  0.300  0.0767  0.936 0.351        }
\CommentTok{\#  2 CD x CW  0.484  0.125   1.53  0.129        }
\CommentTok{\#  3 CD x PH  0.315  0.0196  0.238 0.812        }
\CommentTok{\#  4 CD x EH  0.281 {-}0.0258 {-}0.314 0.754        }
\CommentTok{\#  5 CD x EP  0.175 {-}0.0121 {-}0.147 0.884        }
\CommentTok{\#  6 CD x EL  0.912  0.893  24.1   0            }
\CommentTok{\#  7 CD x ED  0.390  0.0108  0.131 0.896        }
\CommentTok{\#  8 CL x CW  0.738  0.465   6.40  0.00000000198}
\CommentTok{\#  9 CL x PH  0.325 {-}0.309  {-}3.95  0.000121     }
\CommentTok{\# 10 CL x EH  0.397  0.256   3.22  0.00158      }
\CommentTok{\# \# ... with 18 more rows}
\end{Highlighting}
\end{Shaded}

A função retorna 3 objetos: \texttt{linear.mat} que contém a matriz de correlação linear simples; \texttt{partial.mat} que contém a matriz de correlações parciais, \texttt{results} que contém todas as combinações de correlação com seus respectivos testes de hipótese.

\hypertarget{anuxe1lise-de-trilha}{%
\section{Análise de trilha}\label{anuxe1lise-de-trilha}}

Nesta sessão, primeiramente uma breve introdução à análise de trilha é apresentada. Algumas dificuldades, como , por exemplo, a presença de multicolinearidade \indt{multicolinearidade} e possíveis soluções para contorná-la serão discutidas. Posteriormente exemplos numéricos serão realizados utilizando funções do pacote \texttt{metan}.

\hypertarget{introduuxe7uxe3o-1}{%
\subsection{Introdução}\label{introduuxe7uxe3o-1}}

A análise de trilha vem se destacando na área do melhoramento genético, pois a seleção para melhoria de um caractere desejável que possui difícil mensuração e baixa herdabilidade, pode ser realizada indiretamente por outro caractere, diretamente associado a este, mas que apresente alta herdabilidade e seja de fácil mensuração. Esta técnica é baseada em ideias originalmente desenvolvidas por Sewall Wright (Wright \protect\hyperlink{ref-Wright1921}{1921}), no entanto desde sua concepção até a consolidação do método, algumas divergências quanto a fidedignidade do método matemático que explica as relações de causa e efeito foram observadas. Em 1922, Henry E. Niles, em um \href{https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1200533/pdf/258.pdf}{artigo}\footnote{\url{https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1200533/pdf/258.pdf}} publicado na revista \emph{Genetics} intitulado \emph{Correlation, Causation and Wright's theory of path coefficients}, fez uma crítica ao método proposto por Wright, afirmando que a base filosófica do método dos coeficientes de trilha era falha. Niles, testando o método de Wright, evidenciou em alguns de seus resultados coeficientes superiores a \textbar1\textbar, afirmando \emph{{[}\ldots{]}estes resultados são ridículos{[}\ldots{]}} e que Wright teria de fornecer provas bem mais convincentes do que ele estava apresentando Niles (\protect\hyperlink{ref-Niles1922}{1922}).

No ano seguinte, 1923, Sewall Wright em seu \href{https://www.genetics.org/content/genetics/8/3/239.full.pdf}{artigo}\footnote{\url{https://www.genetics.org/content/genetics/8/3/239.full.pdf}} entitulado \emph{The theory of path coefficients: a reply to Niles's criticism}, publicado na mesma revista \emph{Genetics}, consolida seu método ao concluir que Niles pareceu se basear em conceitos matemáticos incorretos, resultado de uma falha em reconhecer que um coeficiente de trilha não é uma função simétrica de duas variáveis, mas que ele necessariamente tem direção. Este autor conclui seu trabalho afirmando que a análise de trilha não fornece uma fórmula geral para deduzir relações causais a partir do conhecimento das correlações. Ela é, no entanto, dentro de certas limitações, um método de avaliar as consequências lógicas de uma hipótese de relação causal em um sistema de variáveis correlacionadas. Acrescenta ainda que as críticas oferecidas por Niles em nada invalidam a teoria do método ou sua aplicação (Wright \protect\hyperlink{ref-Wright1923}{1923}). Atualmente, o método estatístico é consolidado, e utilizado mundialmente em diversas áreas da ciência.

\hypertarget{estimativa-2}{%
\subsection{Estimativa}\label{estimativa-2}}

A decomposição das correlações lineares em efeitos diretos e indiretos de um conjunto de \emph{p}-variáveis explicativas é realizada o sistema de equações normais \indt{sistema de equações normais}

\[
X'X\hat \beta = X'Y
\]

que tem como resolução

\[
\hat \beta = X'X^{-1} X'Y
\]

onde \(\hat \beta\) é o vetor dos coeficiente de regressão parcial (\(\hat \beta_1\), \(\hat \beta_2\), \(\hat \beta_3\),\ldots,\(\hat \beta_p\)) para \emph{p} + 1; \(X'X^{-1}\) é a inversa da matriz de correlação linear entre as variáveis explicativas e \(X'Y\) é a matriz de correlação de cada variável explicativa, com a variável dependente.

Após a estimativa dos coeficientes de regressão (\(\hat \beta_p\)), os efeitos diretos e indiretos do conjunto de p-variáveis explicativas podem ser estimados. Considere o seguinte exemplo, onde um conjunto de variáveis explicativas (\emph{a}, \emph{b}, \emph{c}) são utilizadas para explicar as relações de causa e efeito \indt{causa e efeito} na resposta de uma variável dependente (\emph{y}). Após as estimativas dos coeficientes de regressão parcial (\(\hat \beta_1\), \(\hat \beta_2\) e \(\hat \beta_3\)), os efeitos diretos e indiretos de \emph{a} sobre \emph{y} são dados por:

\[
r_{a:y} = \hat \beta_1 + \hat \beta_{2_{ra:b}} + \hat \beta_{3_{ra:c}}
\]

onde \(r_{a:y}\) é a correlação linear entre \emph{a} e \emph{y}, \(\hat \beta_1\) é o efeito direto de \emph{a} em \emph{y}; \(\hat \beta_{2_{ra:b}}\) é o efeito indireto de \emph{a} em \emph{y} via \emph{b} e \(\hat \beta_{3_{ra:c}}\) é o efeito indireto de \emph{a} em \emph{y} via \emph{c}. Regressões semelhantes são utilizadas para estimativa dos efeitos de \emph{b} e \emph{c}, conforme segue:

\begin{gather*}
r_{b:y} = \hat \beta_{1_{rb:a}} + \hat \beta_2 + \hat \beta_{3_{rb:c}}\\
r_{c:y} = \hat \beta_{1_{rc:a}} + \hat \beta_{2_{rc:b}} + \hat \beta_3
\end{gather*}

Como exemplo numérico, vamos utilizar as variáveis PERK, EH, CDED como variáveis explicativas e a variável KW como dependente, do conjunto de dados \texttt{maize}. Para seleção destas variáveis, a função \texttt{select()}\indf{select} é utilizada.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x \textless{}{-}}\StringTok{ }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(PERK, EH, CDED)}
\NormalTok{y \textless{}{-}}\StringTok{ }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(KW)}

\NormalTok{xx \textless{}{-}}\StringTok{ }\KeywordTok{cor}\NormalTok{(x) }\CommentTok{\# Correlação entre as variáveis explicativas}
\NormalTok{xy \textless{}{-}}\StringTok{ }\KeywordTok{cor}\NormalTok{(x, y) }\CommentTok{\# Correlação das explicativas com a dependente}
\NormalTok{b \textless{}{-}}\StringTok{ }\KeywordTok{solve}\NormalTok{(xx) }\OperatorTok{\%*\%}\StringTok{ }\NormalTok{xy }\CommentTok{\# Estimativa dos coeficientes}

\NormalTok{PERK\_KW\_DIR \textless{}{-}}\StringTok{ }\NormalTok{b[}\DecValTok{1}\NormalTok{] }\CommentTok{\# Direto de PERK em KW}
\NormalTok{PERK\_KW\_EH \textless{}{-}}\StringTok{ }\NormalTok{b[}\DecValTok{2}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{xx[}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{] }\CommentTok{\# Indireto de PERK em KW via EH}
\NormalTok{PERK\_KW\_CDED \textless{}{-}}\StringTok{ }\NormalTok{b[}\DecValTok{3}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{xx[}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{] }\CommentTok{\# Indireto de PERK em KW via CDED}

\NormalTok{EH\_KW\_PERK \textless{}{-}}\StringTok{ }\NormalTok{b[}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{xx[}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{] }\CommentTok{\# Indireto de EH em KW via PERK}
\NormalTok{EH\_KW\_DIR \textless{}{-}}\StringTok{ }\NormalTok{b[}\DecValTok{2}\NormalTok{] }\CommentTok{\# Direto de EH em KW}
\NormalTok{EH\_KW\_CDED \textless{}{-}}\StringTok{ }\NormalTok{b[}\DecValTok{3}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{xx[}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{] }\CommentTok{\# Indireto de EH em KW via CDED}

\NormalTok{CDED\_KW\_PERK \textless{}{-}}\StringTok{ }\NormalTok{b[}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{xx[}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{] }\CommentTok{\# Indireto de CDED em KW via PERK}
\NormalTok{CDED\_KW\_EH \textless{}{-}}\StringTok{ }\NormalTok{b[}\DecValTok{2}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{xx[}\DecValTok{3}\NormalTok{,}\DecValTok{2}\NormalTok{] }\CommentTok{\# Indireto de CDED em KW via EH}
\NormalTok{CDED\_KW\_DIR \textless{}{-}}\StringTok{ }\NormalTok{b[}\DecValTok{3}\NormalTok{] }\CommentTok{\# Direto de CDED em KW}

\CommentTok{\# Coeficientes de trilha (direto na diagonal, indireto fora da diagonal)}
\NormalTok{coeff \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{c}\NormalTok{(PERK\_KW\_DIR, PERK\_KW\_EH, PERK\_KW\_CDED,}
\NormalTok{                  EH\_KW\_PERK, EH\_KW\_DIR, EH\_KW\_CDED,}
\NormalTok{                  CDED\_KW\_PERK, CDED\_KW\_EH, CDED\_KW\_DIR),}
                \DataTypeTok{ncol =} \DecValTok{3}\NormalTok{)}
\KeywordTok{rownames}\NormalTok{(coeff) \textless{}{-}}\StringTok{ }\KeywordTok{colnames}\NormalTok{(coeff) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"PERK"}\NormalTok{, }\StringTok{"EH"}\NormalTok{, }\StringTok{"CDED"}\NormalTok{)}
\NormalTok{coeff}
\CommentTok{\#             PERK          EH        CDED}
\CommentTok{\# PERK {-}0.10410823 0.002222624  0.05948542}
\CommentTok{\# EH   {-}0.01473329 0.690110850 {-}0.04548514}
\CommentTok{\# CDED  0.09200901 0.010613425 {-}0.16102929}
\end{Highlighting}
\end{Shaded}

Utilizando os conhecimentos acumulados até agora, estes mesmos coeficientes podem ser estimados de maneira mais ``elegantemente'', utilizando o código abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n \textless{}{-}}\StringTok{ }\KeywordTok{ncol}\NormalTok{(xx)}
\NormalTok{Coeff \textless{}{-}}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(xx)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{n) \{}
  \ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{n) \{}
\NormalTok{    Coeff[j, i] \textless{}{-}}\StringTok{ }\NormalTok{b[j] }\OperatorTok{*}\StringTok{ }\NormalTok{xx[j, i]}
\NormalTok{  \}}
\NormalTok{\}}
\KeywordTok{rownames}\NormalTok{(coeff) \textless{}{-}}\StringTok{ }\KeywordTok{colnames}\NormalTok{(coeff) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"PERK"}\NormalTok{, }\StringTok{"EH"}\NormalTok{, }\StringTok{"CDED"}\NormalTok{)}
\NormalTok{Coeff}
\CommentTok{\#             PERK          EH        CDED}
\CommentTok{\# PERK {-}0.10410823 0.002222624  0.05948542}
\CommentTok{\# EH   {-}0.01473329 0.690110850 {-}0.04548514}
\CommentTok{\# CDED  0.09200901 0.010613425 {-}0.16102929}
\end{Highlighting}
\end{Shaded}

\hypertarget{multicolinearidade}{%
\subsection{Multicolinearidade}\label{multicolinearidade}}

Embora esta análise revele associações de causa e efeito, sua estimativa é baseada em princípios de regressão múltipla. Assim, as estimativas dos parâmetros \indt{parâmetros}podem ser enviesadas devido a natureza complexa dos dados, em que a resposta da variável dependente está ligada a um grande número de variáveis explicativas, que são muitas vezes correlacionadas ou multicolineares entre si (Graham \protect\hyperlink{ref-Graham2003}{2003}). Assim, sempre que duas supostas variáveis explicativas se apresentam altamente associadas, é difícil estimar as relações de cada variável explicativa individualmente, uma vez que vários parâmetros resolvem o sistema de equações normais. A esta particularidade é atribuída o nome de multicolinearidade \indt{multicolinearidade} (Blalock \protect\hyperlink{ref-Blalock1963a}{1963}).

Os principais meios utilizados para identificar o grau de multicolinearidade em uma matriz de variáveis explicativas são os seguintes:

\begin{itemize}
\tightlist
\item
  Número de condição (CN): \indt{número de condição} O número de condição é calculado pela razão entre o maior e menor autovalor (\(\lambda\)) da matriz de correlação \(X'X\), de acordo com a expressão
\end{itemize}

\[
 {\rm{NC = }}\frac{{\lambda_{\rm{Max}}}}{{\lambda_{\rm{Min}}}}
\]

O grau de multicolinearidade é considerado fraco se NC \(\leq\) 100, moderado se 100 \(\leq\) NC \(\leq\) 1000 e severo quando NC \textgreater{} 1000.

\begin{itemize}
\tightlist
\item
  Determinante da matriz \(X'X\) (D): \indt{determinante da matriz} O determinante da cada matriz de correlação é estimado pelo produto de seus respectivos autovalores, para \(\lambda_j > 0\), de acordo com a expressão
\end{itemize}

\[
\mathop D\nolimits_{{\boldsymbol{X'X}}} {\rm{  = }}\prod\limits_{j = 1}^p {\lambda j}
\]

Um determinantes muito próximo a zero indica dependência linear entre as características explicativas, indicando problemas graves de multicolinearidade.

\begin{itemize}
\tightlist
\item
  Fator de inflação de variância (VIF): \indt{fator de inflação de variância} Os (VIFs) são utilizados para medir o quanto a variância dos coeficientes de regressão estimados (\(\hat \beta_k\)) foi inflada em comparação a quando os caracteres explicativos não são linearmente associados. A estimativa do VIF do \emph{k}-ésimo elemento de \(\hat \beta\) é dada pela soma dos quocientes do quadrado de cada componente do autovetor pelo seu respectivo autovalor associado, de acordo com a expressão
\end{itemize}

\[
\mathop {{\rm{VIF}}}\nolimits_{\mathop \beta \nolimits_k }  = \left( {\frac{{\mathop {{\rm{(AV}}}\nolimits_{KC1} {)^2}}}{{\lambda 1}} + \frac{{{{(\mathop {{\rm{AV}}}\nolimits_{KC2} )}^2}}}{{\lambda 2}} + ... + \frac{{{{(\mathop {{\rm{AV}}}\nolimits_{KCp} )}^2}}}{{\lambda p}}} \right)
 \]

onde \(\mathop {{\rm{VIF}}}\nolimits_{\mathop \beta \nolimits_k }\) é o fator de inflação de variância o k-ésimo elemento de \(\beta\) para \emph{k} = 1, 2, \ldots, \emph{p}; \(\mathop {{\rm{EV}}}\nolimits_{KC{\rm{1}}}\) é o componente do \emph{k}-ésimo autovetor para \emph{k} = 1, 2, \ldots, \emph{p} e \emph{C} = 1, 2, \ldots, \emph{p}; e \(\lambda\) é o autovalor associado ao respectivo autovetor para \(\lambda\) = 1, 2, \ldots, \emph{p}. Os VIFs também podem ser considerados como os elementos da diagonal da inversa da matriz \(X'X\). Considera-se que a presença de VIFs maiores que 10 é um indicativo de multicolinearidade \indt{multicolinearidade}.

\hypertarget{diagnuxf3stico-da-multicolinearidade}{%
\subsubsection{Diagnóstico da multicolinearidade}\label{diagnuxf3stico-da-multicolinearidade}}

A função \texttt{colindiag()} \indf{colindiag} do pacote \texttt{metan} é utilizada para realizar o diagnóstico da multicolinearidade de uma matriz de correlação. Os códigos a seguir calculam um diagnóstico completo de colinearidade de uma matriz de correlação de características preditivas. Vários indicadores, como fator de inflação de variação, número de condição e determinante de matriz são considerados (T. Olivoto, Souza, et al. \protect\hyperlink{ref-Olivoto2017f}{2017}; Tiago Olivoto, Nardino, et al. \protect\hyperlink{ref-Olivoto2017c}{2017}) O diagnóstico pode ser realizado usando: (i) matrizes de correlação; (ii) quadros de dados ou (iii) um objeto agrupado passado de \texttt{group\_by()}.

\begin{itemize}
\tightlist
\item
  \textbf{Usando uma matriz de correlação, estimada anteriormente}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cor\_data \textless{}{-}}\StringTok{ }\KeywordTok{cor}\NormalTok{(datacor)}
\NormalTok{n \textless{}{-}}\StringTok{ }\KeywordTok{nrow}\NormalTok{(datacor)}
\NormalTok{cold1 \textless{}{-}}\StringTok{ }\KeywordTok{colindiag}\NormalTok{(cor\_data, }\DataTypeTok{n =}\NormalTok{ n)}
\KeywordTok{print}\NormalTok{(cold1)}
\CommentTok{\# Severe multicollinearity in the matrix! Pay attention on the variables listed bellow}
\CommentTok{\# CN = 1830.678}
\CommentTok{\# Matrix determinant: 2.32e{-}05 }
\CommentTok{\# Largest correlation: PH x EH = 0.932 }
\CommentTok{\# Smallest correlation: CD x EP = 0.175 }
\CommentTok{\# Number of VIFs \textgreater{} 10: 3 }
\CommentTok{\# Number of correlations with r \textgreater{}= |0.8|: 3 }
\CommentTok{\# Variables with largest weight in the last eigenvalues: }
\CommentTok{\# EH \textgreater{} PH \textgreater{} EP \textgreater{} CL \textgreater{} ED \textgreater{} CW \textgreater{} CD \textgreater{} EL}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Usando um dataframe}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cold2 \textless{}{-}}\StringTok{ }\KeywordTok{colindiag}\NormalTok{(datacor)}
\KeywordTok{print}\NormalTok{(cold2)}
\CommentTok{\# Severe multicollinearity in the matrix! Pay attention on the variables listed bellow}
\CommentTok{\# CN = 1830.678}
\CommentTok{\# Matrix determinant: 2.32e{-}05 }
\CommentTok{\# Largest correlation: PH x EH = 0.932 }
\CommentTok{\# Smallest correlation: CD x EP = 0.175 }
\CommentTok{\# Number of VIFs \textgreater{} 10: 3 }
\CommentTok{\# Number of correlations with r \textgreater{}= |0.8|: 3 }
\CommentTok{\# Variables with largest weight in the last eigenvalues: }
\CommentTok{\# EH \textgreater{} PH \textgreater{} EP \textgreater{} CL \textgreater{} ED \textgreater{} CW \textgreater{} CD \textgreater{} EL}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Diagnóstico para cada nível do fator ENV}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cold3 \textless{}{-}}\StringTok{ }\KeywordTok{colindiag}\NormalTok{(data\_ge2, }\DataTypeTok{by =}\NormalTok{ ENV)}
\KeywordTok{print}\NormalTok{(cold3)}
\CommentTok{\# \# A tibble: 4 x 2}
\CommentTok{\#   ENV   data      }
\CommentTok{\#   \textless{}fct\textgreater{} \textless{}list\textgreater{}    }
\CommentTok{\# 1 A1    \textless{}colindig\textgreater{}}
\CommentTok{\# 2 A2    \textless{}colindig\textgreater{}}
\CommentTok{\# 3 A3    \textless{}colindig\textgreater{}}
\CommentTok{\# 4 A4    \textless{}colindig\textgreater{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{seleuxe7uxe3o-de-preditores-com-muxednima-multicolinearidade}{%
\subsubsection{Seleção de preditores com mínima multicolinearidade}\label{seleuxe7uxe3o-de-preditores-com-muxednima-multicolinearidade}}

A função \texttt{non\_collinear\_vars()}\indf{non\_collinear\_vars} seleciona um conjunto de preditores com multicolinearidade mínima usando o fator de inflação de variação (VIF) como critério para remover variáveis colineares. O algoritmo irá: \textbf{(i)} calcular o valor VIF da matriz de correlação que contém as variáveis originais; \textbf{(ii)} ordenar os valores do VIF e excluir a variável com maior VIF; e \textbf{(iii)} iterar a etapa \textbf{ii} até que o valor VIF seja menor ou igual a um valor pré-estabelecido.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{non\_collinear\_vars}\NormalTok{(data\_ge2)}
\CommentTok{\#          Parameter                                       values}
\CommentTok{\# 1       Predictors                                           10}
\CommentTok{\# 2              VIF                                         7.16}
\CommentTok{\# 3 Condition Number                                       56.797}
\CommentTok{\# 4      Determinant                                 0.0008810515}
\CommentTok{\# 5         Selected PERK, EP, CDED, NKR, PH, NR, TKW, EL, CD, ED}
\CommentTok{\# 6          Removed                          EH, CL, CW, KW, NKE}
\KeywordTok{non\_collinear\_vars}\NormalTok{(data\_ge2, EH, CL, CW, KW, NKE, }\DataTypeTok{max\_vif =} \DecValTok{5}\NormalTok{)}
\CommentTok{\#          Parameter          values}
\CommentTok{\# 1       Predictors               4}
\CommentTok{\# 2              VIF           2.934}
\CommentTok{\# 3 Condition Number          11.248}
\CommentTok{\# 4      Determinant    0.2400583901}
\CommentTok{\# 5         Selected NKE, EH, CL, CW}
\CommentTok{\# 6          Removed              KW}
\end{Highlighting}
\end{Shaded}

\begin{dica}
Em análise de trilha, o diagnóstico da multicolinearidade deve ser realizado na matriz de correlação das variáveis explicativas. No exemplo acima, supondo que a análise de trilha fosse realizada considerando a variável \textbf{PH} como dependente, o seguinte comando deveria ter sido utilizado para o diagnóstico da multicolinearidade.

\texttt{multicol\ \textless{}-\ datacor\ \%\textgreater{}\%\ select(-PH)\ \%\textgreater{}\%\ colindiag()}
\end{dica}

\hypertarget{muxe9todos-para-ajustar-a-multicolinearidade}{%
\subsection{Métodos para ajustar a multicolinearidade}\label{muxe9todos-para-ajustar-a-multicolinearidade}}

Embora os problemas relacionados a multicolinearidade \indt{multicolinearidade} se apresente como uma dificuldade na estimativa de coeficientes de trilha, algumas medidas podem ser tomadas visando mitigar seus efeitos indesejáveis, quando esta for detectada pelos métodos acima citados. Sabe-se atualmente, que a exclusão das variáveis responsáveis por inflar a variância de um coeficiente de regressão é um dos métodos mais indicados para reduzir a multicolinearidade em matrizes de variáveis explicativas (T. Olivoto, Souza, et al. \protect\hyperlink{ref-Olivoto2017f}{2017}). A identificação destas variáveis, no entanto, pode ser uma tarefa difícil. Recentemente, T. Olivoto, Nardino, et al. (\protect\hyperlink{ref-Olivoto2017}{2017}) propuseram a utilização de procedimentos stepwise \indt{stepwise} juntamente com análise de trilha sequencial visando identificar um conjunto de variáveis com alto poder explicativo, mas que não se apresentem altamente correlacionadas. Quando a exclusão das variáveis responsáveis não é um procedimento considerado pelo pesquisador, por exemplo, devido a um número reduzido de variáveis explicativa, ou pela importância em conhecer seus efeitos, uma terceira opção é realizar a análise de trilha com todas as variáveis explicativas, porém com a inclusão de um pequeno valor nos elementos da diagonal \(X'X\), conhecida como regressão em crista\footnote{A regressão em crista é conhecida como \emph{ridge regression} e prossegue adicionando um pequeno valor, \emph{k}, aos elementos diagonais da matriz de correlação. É aqui que a regressão em crista recebe seu nome, pois a diagonal de uma na matriz de correlação pode ser vista como uma crista, ou cumieira (Hoerl and Kennard \protect\hyperlink{ref-Hoerl1976}{1976})}. Este procedimento, no entanto superestima os efeitos diretos, principalmente daquelas variáveis com alto VIF. (T. Olivoto, Souza, et al. \protect\hyperlink{ref-Olivoto2017f}{2017}).

\hypertarget{anuxe1lise-tradicional}{%
\subsection{Análise tradicional}\label{anuxe1lise-tradicional}}

Esta sessão está focada principalmente em três objetivos: (i) diagnóstico da multicolinearidade\indt{multicolinearidade}; (ii) seleção de variáveis \indt{seleção de variáveis} preditoras; e (iii) estimação dos coeficientes de trilha. Embora esta seja a sequência correta a ser seguida para a estimativa dos coeficientes de trilha, utilizaremos somente a função \texttt{path\_coeff()}, \indf{path\_coeff} que possibilita todas estas abordagens. Para isto, o conjunto de dados \texttt{maize} será utilizado.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pathtodas \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{path\_coeff}\NormalTok{(KW, }\DataTypeTok{verbose =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Com a função acima, os coeficientes de trilha foram estimados considerando a variável KW (massa de grãos por espiga) como dependente, e todas as outras variáveis numéricas do conjunto de dados como explicativas. A função \texttt{summary()} pode ser utilizada para resumir os resultados da análise. Note que os coeficientes foram estimados considerando todos os níveis dos fatores \textbf{ENV}, \textbf{GEN}, e \textbf{REP}.

\begin{dica}
A mensagem de aviso gerada pela função acima pode ser suprimidada utilizando o argumento \texttt{verbose\ =\ FALSE}
\end{dica}

De acordo com o NC, VIF e determinante da matriz, a multicolinearidade \indt{multicolinearidade} na matriz das variáveis explicativa é severa. Por exemplo, foram observados oito VIFs \textgreater{} 10 e o determinante da matriz foi de \(8.619 \times 10^{-12}\). A análise dos autovalores-autovetores (\texttt{pathtodas\$weightvar}) indicou que, em ordem de importância, as variáveis que mais contribuem para a multicolinearidadeque são: CL \textgreater{} ED \textgreater{} CDED \textgreater{} EH \textgreater{} CW \textgreater{} PH \textgreater{} NKE \textgreater{} EP \textgreater{} TKW \textgreater{} PERK \textgreater{} NR \textgreater{} EL \textgreater{} NKR \textgreater{} CD. Conforme discutido, temos basicamente duas opções para contornar os problemas da elevada multicolineridade em nossos dados. Excluir as variáveis responsáveis pela multicolinearidade, ou manter todas as variáveis e incluir um fator de correção na diagonal da matrix \textbf{X'X}. Vamos começar pela última opção.

\hypertarget{incluindo-um-fator-de-correuxe7uxe3o-k}{%
\subsection{Incluindo um fator de correção (k)}\label{incluindo-um-fator-de-correuxe7uxe3o-k}}

A variância dos coeficientes de regressão é reduzida quando quando um valor \emph{k} para \(0 < k \leq 1\) é incluído na diagonal da matriz de correlação \(X'X\). Com esta técnica, a estimativa dos coeficientes de regressão é dado por:

\[
\hat \beta = (X'X+Ik)^{-1} X'Y
\]

A escolha da magnitude de \emph{k}, no entanto, deve ser cautelosa. Sugere-se que o valor a ser incluído seja aquele menor possível que estabilize os coeficientes de regressão (\(\beta_p\)). Felizmente, grande parte deste trabalho já foi realizado quando utilizamos a função \texttt{path\_coeff()} \indf{path\_coeff} na \protect\hyperlink{analise-tradicional}{sessão anterior}. Um conjunto de estimativas de \(\beta_p\) foi estimado com 101 valores de \emph{k}, (\(k = 0, 0.01, ..., 1\)) e representado graficamente.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pathtodas}\OperatorTok{$}\NormalTok{plot}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-292-1} 

}

\caption{Valores de beta obtidos com 101 valores de k}\label{fig:unnamed-chunk-292}
\end{figure}

print()

O gráfico acima nos proporciona uma interpretação sobre qual é o valor de \emph{k} mais indicado a ser utilizado. Para fins didátidos, escolheremos, por enquanto, o valor de \emph{k} igual a 0.04, valor no qual os coeficientes de regressão da maioria das variávies se estabiliza. Para incluir este valor de correção, utilizaremos novamente a função \texttt{path\_coeff()}, no entanto, agora, incluiremos o argumento \texttt{correction\ =\ 0.04}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pathtodas\_k \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{path\_coeff}\NormalTok{(KW, }\DataTypeTok{correction =} \FloatTok{0.04}\NormalTok{, }\DataTypeTok{verbose =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Com a inclusão do fator de correção (\emph{k} = 0.04) na diagonal de \(X'X\), a multicolinearidade foi classificada como moderada (NC = 141). Inevitavelmente, temos duas opções para obtermos menores níveis de multicollinearidade. A primeira é aumentar o valor de \emph{k}, digamos, para 0.1. Isto iria reduzir ainda mais o nível de multicolinearidade \indt{multicolinearidade} em nossa matriz, no entanto, o viés na estimativa dos coeficientes aumentaria. A segunda (e mais razoável) opção, é a exclusão das variáveis que mais causam problemas de multicolinearidade. Por exemplo, podemos considerar as variáveis com maior peso nos últimos autovalores, ou aquelas com maior VIF. As variáveis CL e EL apresentam alta correlação (veja a seção \protect\hyperlink{estimativa-dos-coeficientes-de-correlacao}{estimativas dos coeficientes de correlação}), assim poderíamos manter apenas uma destas variáveis. A mesma interpretação pode ser considerada para CDED. Esta é uma co-variável (razão do diâmetro do sabugo e diâmetro da espiga, CDED = CD/ED). Vamos considerar então a exclusão destas variáveis.

\hypertarget{excluindo-variuxe1veis}{%
\subsection{Excluindo variáveis}\label{excluindo-variuxe1veis}}

O ajuste do novo modelo excluindo estas variáveis é facilmente realizado. Para isto, iremos utilizar dois argumentos da função \texttt{path\_coeff()} \indf{path\_coeff} não vistos até agora: \texttt{pred} e \texttt{exclude}. As variáveis informadas em \texttt{pred} podem ser as variáveis preditoras (\emph{default}) ou as variáveis a serem excluídas, se \texttt{exclude\ =\ TRUE}. Vamos ao exemplo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_exclude \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{path\_coeff}\NormalTok{(}\DataTypeTok{resp =}\NormalTok{ KW,}
             \DataTypeTok{pred =} \KeywordTok{c}\NormalTok{(PERK, EH, CDED),}
             \DataTypeTok{exclude =} \OtherTok{TRUE}\NormalTok{,}
             \DataTypeTok{verbose =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Abaixo, um resumo das três abordagens realizadas até agora, utilizando o resumo apresentado na tabela abaixo.

\begin{longtable}[]{@{}llll@{}}
\toprule
Estatística & Convencional & Incluindo \emph{k} & Excluindo variáveis\tabularnewline
\midrule
\endhead
Número de Condição & 7866 & 141 & 125.7\tabularnewline
Determinante & 0 & 2.7e-07 & 1.452e-05\tabularnewline
Maior VIF & 665.12 & 14.76 & 13.2\tabularnewline
R2 & 0.988 & 0.966 & 0.982\tabularnewline
Residual & 0.011 & 0.033 & 0.017\tabularnewline
\bottomrule
\end{longtable}

Conforme também observado por Hoerl and Kennard (\protect\hyperlink{ref-Hoerl1970}{1970}) e T. Olivoto, Souza, et al. (\protect\hyperlink{ref-Olivoto2017f}{2017}), a exclusão de variáveis responsáveis pela multicolinearidade \indt{multicolinearidade} foi mais eficiente que a inclusão do \emph{k}, proporcionando menores níveis de multicolinearidade e maior precisão do modelo (maior \(R^2\) e menor residual). Os níveis de multicolinearidade ao excluir as variáveis ainda preocupam. Vimos que tanto a identificação das variáveis responsáveis pela multicolinearidae quanto o ajuste do modelo declarando preditores específicos é um procedimento relativamente simples utilização a função \texttt{path\_coeff()}\indf{path\_coeff}. Mas, e se algum procedimento estatistico-computacional facilitasse ainda mais essa tarefa? Vamos, a partir de agora, considerar isso.

T. Olivoto, Nardino, et al. (\protect\hyperlink{ref-Olivoto2017}{2017}) sugeriram a utilização de regressões stepwise para seleção de um conjunto de preditores com minima multicolinearidade em análise de trilha. Esta opção está disponível na função \texttt{path\_coeff()}. Baseado em um algoritmo heurístico iterativo executado pelo argumento \texttt{brutstep\ =\ TRUE}, um conjunto de preditores com mínima multicolienaridade é selecionado com base nos valores de VIF\indt{fator de inflação de variância}. Posteriormente, uma série de regressões stepwise são ajustadas. A primeira regressão stepwise é ajustada considerando \(p-1\) variáveis preditoras selecionadas, sendo \emph{p} o número de variáveis selecionadas no processo iterativo. O segundo modelo ajusta uma regressão considerando \(p-2\) variávies selecionadas, e assim por diante até o último modelo, que considera apenas duas variáveis selecionadas. Vamos ao exemplo.

\hypertarget{seleuxe7uxe3o-de-variuxe1veis-em-anuxe1lise-de-trilha}{%
\subsection{Seleção de variáveis em análise de trilha}\label{seleuxe7uxe3o-de-variuxe1veis-em-anuxe1lise-de-trilha}}

\indt{seleção de variáveis} \indt{stepwise}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_step \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{path\_coeff}\NormalTok{(}\DataTypeTok{resp =}\NormalTok{ KW,}
             \DataTypeTok{brutstep =} \OtherTok{TRUE}\NormalTok{)}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# The algorithm has selected a set of 10 predictors with largest VIF = 7.16. }
\CommentTok{\# Selected predictors: PERK EP CDED NKR PH NR TKW EL CD ED }
\CommentTok{\# A forward stepwise{-}based selection procedure will fit 8 models.}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Adjusting the model 1 with 9 predictors (12.5\% concluded)}
\CommentTok{\# Adjusting the model 2 with 8 predictors (25\% concluded)}
\CommentTok{\# Adjusting the model 3 with 7 predictors (37.5\% concluded)}
\CommentTok{\# Adjusting the model 4 with 6 predictors (50\% concluded)}
\CommentTok{\# Adjusting the model 5 with 5 predictors (62.5\% concluded)}
\CommentTok{\# Adjusting the model 6 with 4 predictors (75\% concluded)}
\CommentTok{\# Adjusting the model 7 with 3 predictors (87.5\% concluded)}
\CommentTok{\# Adjusting the model 8 with 2 predictors (100\% concluded)}
\CommentTok{\# Done!}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Summary of the adjusted models }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#    Model  AIC Numpred    CN Determinant    R2 Residual maxVIF}
\CommentTok{\#  MODEL\_1 1099       9 50.99     0.00216 0.945   0.0545   6.96}
\CommentTok{\#  MODEL\_2 1098       8 45.48     0.00396 0.945   0.0550   6.80}
\CommentTok{\#  MODEL\_3 1097       7 37.46     0.02618 0.944   0.0555   6.42}
\CommentTok{\#  MODEL\_4 1103       6 35.70     0.03481 0.942   0.0582   5.71}
\CommentTok{\#  MODEL\_5 1116       5 26.39     0.08049 0.936   0.0642   5.71}
\CommentTok{\#  MODEL\_6 1129       4 21.07     0.17146 0.930   0.0705   5.71}
\CommentTok{\#  MODEL\_7 1170       3  4.97     0.55639 0.907   0.0933   1.78}
\CommentTok{\#  MODEL\_8 1232       2  1.57     0.95068 0.860   0.1402   1.05}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

Três objetos são criados por esta função: \texttt{Summary}, \texttt{Models} e \texttt{Selectedpred}. O objeto \texttt{Summary} contém um resumo do procedimento, listando o número do modelo, o valor do AIC, o diagnóstico da multicolinearidade \indt{multicolinearidade} e os valores de R2 e residual. O objeto \texttt{Models}, contém todos os modelos ajustados, e o objeto \texttt{Selectedpred}, contém o nome das variávies preditoras selecionadas no processo iterativo. Podemos notar que o algorítmo selecionou um conjunto com 10 preditores (PERK, EP, CDED, NKR, PH, NR, TKW, EL, CD, ED) que apresenta multicolinearidade em niveis aceitáveis. Assim, qualquer um destes modelos poderia ser utilizado sem maiores problemas em relação à isto. O procedimento stepwise realizado com diferentes números de variáveis selecionados também permite a seleção de um modelo mais parcimonio, tarefa que ficará a critério do pesquisador.

\hypertarget{anuxe1lise-de-trilha-para-cada-nuxedvel-de-um-fator}{%
\subsection{Análise de trilha para cada nível de um fator}\label{anuxe1lise-de-trilha-para-cada-nuxedvel-de-um-fator}}

Em alguns casos, é de interesse estimar os coeficientes de trilha para cada nível de um fator, por exemplo, para cada ambiente em um ensaio multi-ambiente. Utilizando o argumento \texttt{by}, isto é facilmente realizado. . Para fins didáticos vamos estimar os coeficientes para cada ambiente do conjunto de dados \texttt{maize}.

\indt{seleção de variáveis} \indt{stepwise}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_levels \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(ENV) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{path\_coeff}\NormalTok{(}\DataTypeTok{resp =}\NormalTok{ KW,}
             \DataTypeTok{pred =} \KeywordTok{c}\NormalTok{(TKW, NKE, PERK))}
\CommentTok{\# Weak multicollinearity. }
\CommentTok{\# Condition Number = 4.697}
\CommentTok{\# You will probably have path coefficients close to being unbiased. }
\CommentTok{\# Weak multicollinearity. }
\CommentTok{\# Condition Number = 2.296}
\CommentTok{\# You will probably have path coefficients close to being unbiased. }
\CommentTok{\# Weak multicollinearity. }
\CommentTok{\# Condition Number = 4.244}
\CommentTok{\# You will probably have path coefficients close to being unbiased. }
\CommentTok{\# Weak multicollinearity. }
\CommentTok{\# Condition Number = 1.884}
\CommentTok{\# You will probably have path coefficients close to being unbiased.}
\end{Highlighting}
\end{Shaded}

\hypertarget{correlauxe7uxe3o-canuxf4nica}{%
\section{Correlação canônica}\label{correlauxe7uxe3o-canuxf4nica}}

Correlações canônicas podem ser implementadas com a função \texttt{can\_corr()}\indf{can\_corr}. Primeiro, renomearemos as variáveis relacionadas à planta \texttt{PH} \texttt{EH} e \texttt{EP} com o sufixo \texttt{\_PLA} para mostrar a usabilidade do \emph{select helper} \texttt{contains()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_cc \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{rename}\NormalTok{(data\_ge2,}
         \DataTypeTok{PH\_PLA =}\NormalTok{ PH,}
         \DataTypeTok{EH\_PLA =}\NormalTok{ EH,}
         \DataTypeTok{EP\_PLA =}\NormalTok{ EP)}

\CommentTok{\# Digitar nome das variáveis}
\NormalTok{cc1 \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{can\_corr}\NormalTok{(data\_cc,}
           \DataTypeTok{FG =} \KeywordTok{c}\NormalTok{(PH\_PLA, EH\_PLA, EP\_PLA),}
           \DataTypeTok{SG =} \KeywordTok{c}\NormalTok{(EL, ED, CL, CD, CW, KW))}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Matrix (correlation/covariance) between variables of first group (FG)}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#           PH\_PLA    EH\_PLA    EP\_PLA}
\CommentTok{\# PH\_PLA 1.0000000 0.9318282 0.6384123}
\CommentTok{\# EH\_PLA 0.9318282 1.0000000 0.8695460}
\CommentTok{\# EP\_PLA 0.6384123 0.8695460 1.0000000}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Collinearity within first group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# The multicollinearity in the matrix should be investigated.}
\CommentTok{\# CN = 977.586}
\CommentTok{\# Largest VIF = 229.164618380199}
\CommentTok{\# Matrix determinant: 0.0025852 }
\CommentTok{\# Largest correlation: PH\_PLA x EH\_PLA = 0.932 }
\CommentTok{\# Smallest correlation: PH\_PLA x EP\_PLA = 0.638 }
\CommentTok{\# Number of VIFs \textgreater{} 10: 3 }
\CommentTok{\# Number of correlations with r \textgreater{}= |0.8|: 2 }
\CommentTok{\# Variables with largest weight in the last eigenvalues: }
\CommentTok{\# EH\_PLA \textgreater{} PH\_PLA \textgreater{} EP\_PLA }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Matrix (correlation/covariance) between variables of second group (SG)}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#           EL        ED        CL        CD        CW        KW}
\CommentTok{\# EL 1.0000000 0.3851451 0.2554068 0.9118653 0.4581728 0.6685601}
\CommentTok{\# ED 0.3851451 1.0000000 0.6974629 0.3897128 0.7371305 0.8241426}
\CommentTok{\# CL 0.2554068 0.6974629 1.0000000 0.3003636 0.7383379 0.4709310}
\CommentTok{\# CD 0.9118653 0.3897128 0.3003636 1.0000000 0.4840299 0.6259806}
\CommentTok{\# CW 0.4581728 0.7371305 0.7383379 0.4840299 1.0000000 0.7348622}
\CommentTok{\# KW 0.6685601 0.8241426 0.4709310 0.6259806 0.7348622 1.0000000}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Collinearity within second group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Weak multicollinearity in the matrix}
\CommentTok{\# CN = 66.084}
\CommentTok{\# Matrix determinant: 0.0028626 }
\CommentTok{\# Largest correlation: EL x CD = 0.912 }
\CommentTok{\# Smallest correlation: EL x CL = 0.255 }
\CommentTok{\# Number of VIFs \textgreater{} 10: 0 }
\CommentTok{\# Number of correlations with r \textgreater{}= |0.8|: 2 }
\CommentTok{\# Variables with largest weight in the last eigenvalues: }
\CommentTok{\# KW \textgreater{} EL \textgreater{} ED \textgreater{} CD \textgreater{} CL \textgreater{} CW }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Matrix (correlation/covariance) between FG and SG}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#               EL        ED        CL        CD        CW        KW}
\CommentTok{\# PH\_PLA 0.3801960 0.6613148 0.3251648 0.3153910 0.5047388 0.7534439}
\CommentTok{\# EH\_PLA 0.3626537 0.6302561 0.3971935 0.2805118 0.5193136 0.7029469}
\CommentTok{\# EP\_PLA 0.2634237 0.4580196 0.3908239 0.1750448 0.4248098 0.4974193}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Correlation of the canonical pairs and hypothesis testing }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#              Var   Percent       Sum      Corr  Lambda     Chisq DF   p\_val}
\CommentTok{\# U1V1 0.630438540 78.617161  78.61716 0.7940016 0.30668 177.29224 18 0.00000}
\CommentTok{\# U2V2 0.163384310 20.374406  98.99157 0.4042083 0.82985  27.97651 10 0.00182}
\CommentTok{\# U3V3 0.008086721  1.008433 100.00000 0.0899262 0.99191   1.21794  4 0.87514}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Canonical coefficients of the first group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#               U1        U2         U3}
\CommentTok{\# PH\_PLA  2.609792  5.490798   7.575090}
\CommentTok{\# EH\_PLA {-}2.559005 {-}7.646096 {-}12.812234}
\CommentTok{\# EP\_PLA  1.191023  2.428742   6.604968}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Canonical coefficients of the second group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#             V1         V2          V3}
\CommentTok{\# EL {-}0.01008726 {-}1.0481893  0.60553720}
\CommentTok{\# ED  0.14629899  0.7853469 {-}1.30457763}
\CommentTok{\# CL {-}0.09112023 {-}1.2989864 {-}0.07497186}
\CommentTok{\# CD {-}0.29105227  1.1513083 {-}1.50589651}
\CommentTok{\# CW {-}0.12527616 {-}0.0361706  0.21180796}
\CommentTok{\# KW  1.16041981 {-}0.1022916  1.34278026}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Canonical loads of the first group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#               U1          U2         U3}
\CommentTok{\# PH\_PLA 0.9856022 {-}0.08351129 {-}0.1470178}
\CommentTok{\# EH\_PLA 0.9085216 {-}0.41771278 {-}0.0102277}
\CommentTok{\# EP\_PLA 0.6319736 {-}0.71449671  0.3001730}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Canonical loads of the second group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#           V1          V2         V3}
\CommentTok{\# EL 0.4759982 {-}0.11260907 {-}0.2944636}
\CommentTok{\# ED 0.8294407 {-}0.18663860 {-}0.4477426}
\CommentTok{\# CL 0.3749015 {-}0.74801793 {-}0.4937819}
\CommentTok{\# CD 0.3951578  0.02985218 {-}0.5415818}
\CommentTok{\# CW 0.6225367 {-}0.41451273 {-}0.2698904}
\CommentTok{\# KW 0.9570820 {-}0.07344796 {-}0.1498587}

\CommentTok{\# Use select helpers}
\NormalTok{cc2 \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{can\_corr}\NormalTok{(data\_cc,}
           \DataTypeTok{FG =} \KeywordTok{contains}\NormalTok{(}\StringTok{"\_PLA"}\NormalTok{),}
           \DataTypeTok{SG =} \KeywordTok{c}\NormalTok{(EL, ED, CL, CD, CW, KW))}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Matrix (correlation/covariance) between variables of first group (FG)}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#           PH\_PLA    EH\_PLA    EP\_PLA}
\CommentTok{\# PH\_PLA 1.0000000 0.9318282 0.6384123}
\CommentTok{\# EH\_PLA 0.9318282 1.0000000 0.8695460}
\CommentTok{\# EP\_PLA 0.6384123 0.8695460 1.0000000}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Collinearity within first group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# The multicollinearity in the matrix should be investigated.}
\CommentTok{\# CN = 977.586}
\CommentTok{\# Largest VIF = 229.164618380199}
\CommentTok{\# Matrix determinant: 0.0025852 }
\CommentTok{\# Largest correlation: PH\_PLA x EH\_PLA = 0.932 }
\CommentTok{\# Smallest correlation: PH\_PLA x EP\_PLA = 0.638 }
\CommentTok{\# Number of VIFs \textgreater{} 10: 3 }
\CommentTok{\# Number of correlations with r \textgreater{}= |0.8|: 2 }
\CommentTok{\# Variables with largest weight in the last eigenvalues: }
\CommentTok{\# EH\_PLA \textgreater{} PH\_PLA \textgreater{} EP\_PLA }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Matrix (correlation/covariance) between variables of second group (SG)}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#           EL        ED        CL        CD        CW        KW}
\CommentTok{\# EL 1.0000000 0.3851451 0.2554068 0.9118653 0.4581728 0.6685601}
\CommentTok{\# ED 0.3851451 1.0000000 0.6974629 0.3897128 0.7371305 0.8241426}
\CommentTok{\# CL 0.2554068 0.6974629 1.0000000 0.3003636 0.7383379 0.4709310}
\CommentTok{\# CD 0.9118653 0.3897128 0.3003636 1.0000000 0.4840299 0.6259806}
\CommentTok{\# CW 0.4581728 0.7371305 0.7383379 0.4840299 1.0000000 0.7348622}
\CommentTok{\# KW 0.6685601 0.8241426 0.4709310 0.6259806 0.7348622 1.0000000}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Collinearity within second group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Weak multicollinearity in the matrix}
\CommentTok{\# CN = 66.084}
\CommentTok{\# Matrix determinant: 0.0028626 }
\CommentTok{\# Largest correlation: EL x CD = 0.912 }
\CommentTok{\# Smallest correlation: EL x CL = 0.255 }
\CommentTok{\# Number of VIFs \textgreater{} 10: 0 }
\CommentTok{\# Number of correlations with r \textgreater{}= |0.8|: 2 }
\CommentTok{\# Variables with largest weight in the last eigenvalues: }
\CommentTok{\# KW \textgreater{} EL \textgreater{} ED \textgreater{} CD \textgreater{} CL \textgreater{} CW }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Matrix (correlation/covariance) between FG and SG}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#               EL        ED        CL        CD        CW        KW}
\CommentTok{\# PH\_PLA 0.3801960 0.6613148 0.3251648 0.3153910 0.5047388 0.7534439}
\CommentTok{\# EH\_PLA 0.3626537 0.6302561 0.3971935 0.2805118 0.5193136 0.7029469}
\CommentTok{\# EP\_PLA 0.2634237 0.4580196 0.3908239 0.1750448 0.4248098 0.4974193}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Correlation of the canonical pairs and hypothesis testing }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#              Var   Percent       Sum      Corr  Lambda     Chisq DF   p\_val}
\CommentTok{\# U1V1 0.630438540 78.617161  78.61716 0.7940016 0.30668 177.29224 18 0.00000}
\CommentTok{\# U2V2 0.163384310 20.374406  98.99157 0.4042083 0.82985  27.97651 10 0.00182}
\CommentTok{\# U3V3 0.008086721  1.008433 100.00000 0.0899262 0.99191   1.21794  4 0.87514}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Canonical coefficients of the first group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#               U1        U2         U3}
\CommentTok{\# PH\_PLA  2.609792  5.490798   7.575090}
\CommentTok{\# EH\_PLA {-}2.559005 {-}7.646096 {-}12.812234}
\CommentTok{\# EP\_PLA  1.191023  2.428742   6.604968}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Canonical coefficients of the second group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#             V1         V2          V3}
\CommentTok{\# EL {-}0.01008726 {-}1.0481893  0.60553720}
\CommentTok{\# ED  0.14629899  0.7853469 {-}1.30457763}
\CommentTok{\# CL {-}0.09112023 {-}1.2989864 {-}0.07497186}
\CommentTok{\# CD {-}0.29105227  1.1513083 {-}1.50589651}
\CommentTok{\# CW {-}0.12527616 {-}0.0361706  0.21180796}
\CommentTok{\# KW  1.16041981 {-}0.1022916  1.34278026}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Canonical loads of the first group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#               U1          U2         U3}
\CommentTok{\# PH\_PLA 0.9856022 {-}0.08351129 {-}0.1470178}
\CommentTok{\# EH\_PLA 0.9085216 {-}0.41771278 {-}0.0102277}
\CommentTok{\# EP\_PLA 0.6319736 {-}0.71449671  0.3001730}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Canonical loads of the second group }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#           V1          V2         V3}
\CommentTok{\# EL 0.4759982 {-}0.11260907 {-}0.2944636}
\CommentTok{\# ED 0.8294407 {-}0.18663860 {-}0.4477426}
\CommentTok{\# CL 0.3749015 {-}0.74801793 {-}0.4937819}
\CommentTok{\# CD 0.3951578  0.02985218 {-}0.5415818}
\CommentTok{\# CW 0.6225367 {-}0.41451273 {-}0.2698904}
\CommentTok{\# KW 0.9570820 {-}0.07344796 {-}0.1498587}
\end{Highlighting}
\end{Shaded}

\$\$

\hypertarget{multivariate}{%
\chapter{Análise multivariada}\label{multivariate}}

No melhoramento genético de plantas, diversas variáveis são mensuradas em cada genótipo, visando maior segurança na distinção de tais genótipos. Embora em alguns casos possa fazer sentido isolar cada variável e estudá-la separadamente, geralmente, uma análise que englobe todas as variáveis fornece um maior número de informações. Como todo o conjunto de variáveis é medido em cada genótipo, as variáveis serão relacionadas em maior ou menor grau. Consequentemente, se cada variável é analisada isoladamente, a estrutura completa dos dados pode não ser revelada. A análise multivariada é a análise estatística simultânea de uma coleção de variáveis que utilzia informações sobre as relações entre estas. É muito provável que a análise de cada variável separadamente não revele padrões interessantes que a análise multivariada proporciona.

A concepção da análise multivariada \indt{análise multivariada} é provavelmente o trabalho realizado por Francis Galton e Karl Pearson no final do século XIX sobre a quantificação da relação entre descendentes e características parentais e o desenvolvimento do coeficiente de correlação (Galton \protect\hyperlink{ref-Galton1888}{1888}). Naquele tempo, o processamento computacional era muito limitado para suportar o peso das vastas quantidades de aritmética envolvidas na aplicação dos métodos multivariados que estavam sendo propostos. Assim, os desenvolvimentos eram principalmente matemáticos e a pesquisa multivariada era, na época, em grande parte, um ramo de álgebra linear. No entanto, a chegada e rápida expansão do uso de computadores eletrônicos na segunda metade do século XX, levou à crescente aplicação prática dos métodos existentes de análise multivariada, renovando o interesse no desenvolvimento de novas técnicas.

Nos primeiros anos do século XXI, a ampla disponibilidade de computadores pessoais e laptops relativamente baratos e extremamente poderosos, aliados a softwares estatísticos flexíveis fez com que todos os métodos de análise multivariada pudessem ser aplicados rotineiramente, mesmo para grandes conjuntos de dados, como os gerados em um programa de melhoramento genético --por exemplo, dados de marcadores moleculares e sequenciamento gênico.

\hypertarget{correlauxe7uxf5es-canuxf4nicas}{%
\section{Correlações canônicas}\label{correlauxe7uxf5es-canuxf4nicas}}

Correlações canonicas podem ser computadas utilizando a função \texttt{can\_corr()} do pacote \texttt{metan}.\indf{can\_corr} O primeiro argumento da função é o conjunto de dados (opcional) que deve conter as variáveis numéricas que serão usadas na estimativa das correlações canônicas. Os grupos de variáveis são definidos pelos argumentos \texttt{FG} (primeiro/menor grupo) e \texttt{SG} (segundo/maior grupo). Por padrão, um diagnótico da multicolinearidade é realizado em cada grupo de variável. No exemplo abaixo, os coeficientes foram armazenados no objeto \textbf{cc1}. Note que o argumento \texttt{verbose\ =\ FALSE} foi utilizado para previnir uma longa saída.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cc1 =}\StringTok{ }\KeywordTok{can\_corr}\NormalTok{(maize,}
               \DataTypeTok{FG =} \KeywordTok{c}\NormalTok{(PH, EH, EP),}
               \DataTypeTok{SG =} \KeywordTok{c}\NormalTok{(EL, ED, CL, CD, CW, KW, NR),}
               \DataTypeTok{verbose =} \OtherTok{FALSE}\NormalTok{)}
\KeywordTok{print}\NormalTok{(cc1}\OperatorTok{$}\NormalTok{Sigtest, }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)}
\CommentTok{\#        Var Percent Sum Corr Lambda Chisq DF  p\_val}
\CommentTok{\# U1V1 0.632    76.2  76 0.79   0.30 181.8 21 0.0000}
\CommentTok{\# U2V2 0.187    22.5  99 0.43   0.80  32.5 12 0.0012}
\CommentTok{\# U3V3 0.011     1.3 100 0.10   0.99   1.6  5 0.9015}
\end{Highlighting}
\end{Shaded}

\begin{dica}
Na função \texttt{can\_corr()}, os dados também podem ser passados diretamente pelos argumentos \texttt{FG} e \texttt{SG}, por exemplo, \texttt{FG\ =\ maize{[},\ 4:6{]}}. Alternativamente, dados podem ser passados da função \texttt{split\_factors()}. Nesse caso, as correlações canônicas serão estimadas para cada nível da variável de agrupamento nessa função.
\end{dica}

\hypertarget{anuxe1lise-de-agrupamento}{%
\section{Análise de agrupamento}\label{anuxe1lise-de-agrupamento}}

A análise de agrupamento \indt{agrupamento} é um procedimento multivariado muito útil no melhoramento de plantas. O princípio básico é agrupar indivíduos (genótipos) de acordo com suas semelhanças (variáveis analizadas). Esta sessão é focada na estimativa de matrizes de distâncias e na implementação de algorítimos aglomerativos de agrupamento hierárquicos para confecção de dendrogramas. \indt{dendrograma} A função \texttt{clustering()} \indf{clustering} do pacote \texttt{metan} será utilizada para este fim.

Existem muitos métodos para calcular as informações de (di)similaridade. As opções incluidas na função são: ``euclidean'' (padrão), ``maximum'', ``manhattan'', ``canberra'', ``binary'', ``minkowski'', ``pearson'', ``kendall'' e ``spearman''. Estas três últimas são distâncias baseadas em correlação. Para maiores informações veja \texttt{?clustering}.

\hypertarget{todas-as-linhas-e-todas-as-variuxe1veis-numuxe9ricas}{%
\subsection{Todas as linhas e todas as variáveis numéricas}\label{todas-as-linhas-e-todas-as-variuxe1veis-numuxe9ricas}}

Por padrão, a função computa as distancias para cada combinação de linhas do conjunto de dados, utilizando todas as variáveis numéricas do conjunto. Isto significa que, considerando o conjunto de dados \textbf{maize}, com 156 observações, 12090 distancias serão computadas baseadas nas 15 variáveis numéricas do conjunto.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d1 \textless{}{-}}\StringTok{ }\KeywordTok{clustering}\NormalTok{(maize)}
\end{Highlighting}
\end{Shaded}

\hypertarget{com-base-na-muxe9dia-de-cada-genuxf3tipo}{%
\subsection{Com base na média de cada genótipo}\label{com-base-na-muxe9dia-de-cada-genuxf3tipo}}

Supondo que o pesquisador deseja computar as distancias entre cada genótipo (o que é lógico em melhoramento genético vegetal) e que esta distancia deve ser computada apenas com algumas variáveis numéricas do conjunto de dados, o seguinte código deverá ser utilizado. Para selecionar as variáveis a serem utilziadas, basta apenas fornecer uma lista de nomes separadas por vírgula e sem o uso do conhecido (e ultrapassado) "". Em adição, para que a distância seja computada entre os genótipos, basta passar os dados médios de cada genótipo computados com \texttt{means\_by()} \indf{means\_by}. Neste caso, a média de cada genótipo é calculada internamente para cada variável numérica e a distãncia é computada utilizando estas médias. A função \texttt{plot()} pode ser usada para plotar um dendrograma. Uma linha é desenhada no ponto de corte sugerido de acordo com Mojena (\protect\hyperlink{ref-Mojena1977}{1977}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mgen \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{means\_by}\NormalTok{(GEN) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{column\_to\_rownames}\NormalTok{(}\StringTok{"GEN"}\NormalTok{)}
\NormalTok{d2 \textless{}{-}}\StringTok{ }\KeywordTok{clustering}\NormalTok{(mgen, NKR, TKW, NKE)}
\KeywordTok{plot}\NormalTok{(d2, }\DataTypeTok{horiz =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Distância euclidiana"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-301-1} \end{center}

No dendrograma exibido acima, cada \emph{folha} corresponde a um genótipo. À medida que subimos na \emph{árvore}, genótipos que são semelhantes uns aos outros são combinados em \emph{ramos}, que vão sendo fundidos a uma altura cada vez maior maior. A altura da fusão, fornecida no eixo vertical, indica a (di)similaridade/distância entre dois genótipos. Quanto maior a altura da fusão, menos semelhantes são os genótipos.

\indt{Curiosidade}
\begin{vcsabia}
As inferências sobre a proximidade de dois genótipos são realizadas apenas com base na altura em que as ramificações que contêm estes dois genótipos são fundidas. Não podemos usar a proximidade de dois genótipos ao longo do eixo horizontal como critério de similaridade. Por exemplo, é incorreto dizer que os genotipos \textbf{H6} e \textbf{H9} são dissimilares só porque eles estão nos extremos do dendrograma.
\end{vcsabia}

Após a confecção do dendrograma \indt{dendrograma}, convém avaliar se as distâncias (ou seja, as alturas) na árvore refletem as distâncias originais com precisão. Uma maneira de medir o quão bem o dendrograma gerado reflete seus dados é calcular a correlação entre as distâncias cofenéticas e a matriz de de distância originais. No procedimento anterior o dendrograma não foi mostrado, no entanto, o coeficiente de correlação cofenético foi calculado. Para isto basta incluir o seguinte comando:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d2}\OperatorTok{$}\NormalTok{cophenetic}
\CommentTok{\# [1] 0.8640355}
\end{Highlighting}
\end{Shaded}

Quanto mais próximo o valor do coeficiente de correlação for de 1, mais precisamente o dendrograma \indt{dendrograma} refletirá as distâncias originais. Valores acima de 0,75 são considerados bons. O método de ligação ``average'', ou UPGMA (padrão na função \texttt{clustering()} parece produzir altos valores dessa estatística. Esta pode ser uma das razões por que ele é tão popular.

\hypertarget{seleuxe7uxe3o-de-variuxe1veis-1}{%
\subsection{Seleção de variáveis}\label{seleuxe7uxe3o-de-variuxe1veis-1}}

A função \texttt{clustering()} \indf{clustering} também conta com um algorítimo de seleção de variáveis \indt{seleção de variáveis}. O objetivo é selecionar um grupo de variáveis que mais contribuam para explicar a variabilidade dos dados originais. Digamos que se algumas poucas variáveis pudessem ser utilizadas para agrupar os genótipos sem que haja perda de informação, recursos humanos e financeiros poderiam ser poupados. Assim ao envés de avaliarmos 15 variáveis (em nosso exemplo), poderiamos avaliar somente aquelas que realmente contribuiem para a distinção dos genótipos.

O algoritmo de seleção de variáveis é executado quando o argumento \texttt{selvar\ =\ TRUE} é incluído na função. A seleção das variáveis é baseada na solução de autovalores/autovetores baseada nos seguintes passos: \textbf{1:} calcular a matriz de distância e a correlação cofenética com as variáveis originais (todas as variáveis numéricas no conjunto de dados); \textbf{2:} calcular os autovalores e autovetores da matriz de correlação entre as variáveis; \textbf{3:} deletar a variável com o maior peso (maior autovetor no menor autovalor); \textbf{4:} calcular a matriz de distância e correlação cofenética com as variáveis que restaram; \textbf{5:} calcular a correlação de Mantel entre a matriz de distâncias obtidas e a matriz de distância original; \textbf{6:} iterar os passos 2 a 5 \emph{p} - 2 vezes, onde \emph{p} é o número de variáveis originais. No final das iterações, um resumo dos modelos é retornado. A distância é calculada com as variáveis que geraram o modelo com a maior correlação copenética. Sugerimos uma avaliação criteriosa com o objetivo de escolher um modelo parcimonioso, ou seja, aquele com menor número de variáveis, que apresente correlação cofenética aceitável e alta similaridade com as distâncias originais.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d3 \textless{}{-}}\StringTok{ }\KeywordTok{clustering}\NormalTok{(mgen, }\DataTypeTok{selvar =} \OtherTok{TRUE}\NormalTok{)}
\CommentTok{\# Model 1 with 15 variables. \textquotesingle{}EH\textquotesingle{} excluded in this step (7.1\%).}
\CommentTok{\# Model 2 with 14 variables. \textquotesingle{}EP\textquotesingle{} excluded in this step (14.3\%).}
\CommentTok{\# Model 3 with 13 variables. \textquotesingle{}CDED\textquotesingle{} excluded in this step (21.4\%).}
\CommentTok{\# Model 4 with 12 variables. \textquotesingle{}PH\textquotesingle{} excluded in this step (28.6\%).}
\CommentTok{\# Model 5 with 11 variables. \textquotesingle{}CL\textquotesingle{} excluded in this step (35.7\%).}
\CommentTok{\# Model 6 with 10 variables. \textquotesingle{}NR\textquotesingle{} excluded in this step (42.9\%).}
\CommentTok{\# Model 7 with 9 variables. \textquotesingle{}PERK\textquotesingle{} excluded in this step (50\%).}
\CommentTok{\# Model 8 with 8 variables. \textquotesingle{}EL\textquotesingle{} excluded in this step (57.1\%).}
\CommentTok{\# Model 9 with 7 variables. \textquotesingle{}CD\textquotesingle{} excluded in this step (64.3\%).}
\CommentTok{\# Model 10 with 6 variables. \textquotesingle{}ED\textquotesingle{} excluded in this step (71.4\%).}
\CommentTok{\# Model 11 with 5 variables. \textquotesingle{}KW\textquotesingle{} excluded in this step (78.6\%).}
\CommentTok{\# Model 12 with 4 variables. \textquotesingle{}CW\textquotesingle{} excluded in this step (85.7\%).}
\CommentTok{\# Model 13 with 3 variables. \textquotesingle{}NKR\textquotesingle{} excluded in this step (92.9\%).}
\CommentTok{\# Model 14 with 2 variables. \textquotesingle{}TKW\textquotesingle{} excluded in this step (100\%).}
\CommentTok{\# Done! }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{\# }
\CommentTok{\# Summary of the adjusted models }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{\#     Model excluded cophenetic remaining cormantel    pvmantel}
\CommentTok{\#   Model 1        {-}  0.8656190        15 1.0000000 0.000999001}
\CommentTok{\#   Model 2       EH  0.8656191        14 1.0000000 0.000999001}
\CommentTok{\#   Model 3       EP  0.8656191        13 1.0000000 0.000999001}
\CommentTok{\#   Model 4     CDED  0.8656191        12 1.0000000 0.000999001}
\CommentTok{\#   Model 5       PH  0.8656189        11 1.0000000 0.000999001}
\CommentTok{\#   Model 6       CL  0.8655939        10 0.9999996 0.000999001}
\CommentTok{\#   Model 7       NR  0.8656719         9 0.9999982 0.000999001}
\CommentTok{\#   Model 8     PERK  0.8657259         8 0.9999977 0.000999001}
\CommentTok{\#   Model 9       EL  0.8657904         7 0.9999972 0.000999001}
\CommentTok{\#  Model 10       CD  0.8658997         6 0.9999964 0.000999001}
\CommentTok{\#  Model 11       ED  0.8658274         5 0.9999931 0.000999001}
\CommentTok{\#  Model 12       KW  0.8643556         4 0.9929266 0.000999001}
\CommentTok{\#  Model 13       CW  0.8640355         3 0.9927593 0.000999001}
\CommentTok{\#  Model 14      NKR  0.8648384         2 0.9925396 0.000999001}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Suggested variables to be used in the analysis }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{\# The clustering was calculated with the  Model 10 }
\CommentTok{\# The variables included in this model were...}
\CommentTok{\#  ED CW KW NKR TKW NKE }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

A saída acima nos mostra o progresso do algorítmo, indicando qual foi a variável excluída em cada passo. Isto pode ser omitido, indicando \texttt{verbose\ =\ FALSE} na função. O resumo do modelo (\emph{Summary of the adjusted models}) nos fornece duas informações muito úteis. Primeira: ao reduzir o número de variáveis utilziadas na estimativa das distâncias, o coeficiente de correlação cofenético não reduziu significativamente, apresentando variação apenas na terceira casa decimal. A segunda, e talvez mais importante, é a correlação de mantel realizada com a matriz de distâncias em cada passo da análise com a matriz de distâncias inicial, que foi computada com todas as variáveis. Percebe-se que utilizando apenas duas variáveis, as distâncias calculadas foram praticamente idênticas (r = 0.992) às distâncias calculadas com todas as variáveis. Por padrão, o algorítmo estima a matriz de distâncias considerando as variáveis do modelo com maior coeficiente de correlação cofenética. Em nosso exemplo, as variáveis utilizadas foram ED, CW, KW, NKR, TKW, e NKE. Veja que reduzimos em um terço o número de variáveis necessárias para diferenciar os tratamentos, sem perda de informação. Salienta-se, no entanto, que este resultado pode não ser reproduzido em um conjunto de dados diferente, cabendo usuário decidir qual é o melhor modelo a ser utilizado.

\hypertarget{escolha-do-nuxfamero-de-clusters}{%
\subsection{Escolha do número de clusters}\label{escolha-do-nuxfamero-de-clusters}}

Um dos problemas com o agrupamento \indt{agrupamento} hierárquico é que ele não nos informa quantos clusters existem ou onde cortar o dendrograma \indt{dendrograma} para formar os clusters. Você pode cortar a árvore hierárquica a uma determinada altura, digamos, na média das distâncias, no entanto esta decisão é puramente impirica. Por exemplo, se o ponto de corte for muito alto, tendemos a agrupar genótipos que podem, de fato, não ser semelhantes. Um ponto de corte muito baixo, por outro lado, pode resultar em fracassos na seleção, pois consideramos que os genótipos são distintos, podendo não o serem. Procedimentos estatisticos à exemplo de Milligan and Cooper (\protect\hyperlink{ref-Milligan1985}{1985}), Scott and Symons (\protect\hyperlink{ref-Scott1971}{1971}), Krzanowski and Lai (\protect\hyperlink{ref-Krzanowski1988}{1988}), Halkidi, Batistakis, and Vazirgiannis (\protect\hyperlink{ref-Halkidi2001}{2001}) e Hubert and Arabie (\protect\hyperlink{ref-Hubert1985}{1985}) são recomendados para esta escolha. Estes algorítimos estão implementados no pacote \texttt{NbClust} (Charrad et al. \protect\hyperlink{ref-Charrad2014}{2014}) pode ser utilizado para este fim. Por padrão, a função fornece o ponto de corte calculado pelo método de Mojena (\protect\hyperlink{ref-Mojena1977}{1977}).

Procedimentos baseado em reamostragens bootstrap que calcula a probabilidade de erro de cada \emph{galho} do dendrograma \indt{dendrograma} podem ser utilizados. O código abaixo estima p-valores para cada junção no dendrograma do modelo \texttt{d3}. Para maiore detalhes sobre o métoddo veja Suzuki and Shimodaira (\protect\hyperlink{ref-Suzuki2006}{2006}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pv\_clust \textless{}{-}}\StringTok{ }\KeywordTok{pvclust}\NormalTok{(}\KeywordTok{t}\NormalTok{(d3}\OperatorTok{$}\NormalTok{data), }\DataTypeTok{nboot =} \DecValTok{100}\NormalTok{, }\DataTypeTok{method.dist =} \StringTok{"euclidean"}\NormalTok{)}
\CommentTok{\# Bootstrap (r = 0.5)... Done.}
\CommentTok{\# Bootstrap (r = 0.67)... Done.}
\CommentTok{\# Bootstrap (r = 0.83)... Done.}
\CommentTok{\# Bootstrap (r = 1.0)... Done.}
\CommentTok{\# Bootstrap (r = 1.17)... Done.}
\CommentTok{\# Bootstrap (r = 1.33)... Done.}
\KeywordTok{plot}\NormalTok{(pv\_clust, }\DataTypeTok{hang =} \DecValTok{{-}1}\NormalTok{, }\DataTypeTok{cex =} \FloatTok{0.5}\NormalTok{)}
\KeywordTok{pvrect}\NormalTok{(pv\_clust, }\DataTypeTok{alpha =} \FloatTok{0.95}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-305-1} \end{center}

O resultado do procedimento bootstrap indicou a formação de dois clusters, com probabilidade de erro de 5\%. Assim, nas próximas funções, serão demostrados os diferentes dendrogramas \indt{dendrograma} que podem ser gerados

\hypertarget{dendrogramas-personalizados}{%
\subsection{Dendrogramas personalizados}\label{dendrogramas-personalizados}}

O pacote \href{https://cran.r-project.org/web/packages/dendextend/vignettes/introduction.html}{factoextra} oferece um conjunto de funções para estender objetos dendrogramas em R. Um exemplo simples é dado abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{de1 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_dend}\NormalTok{(d3}\OperatorTok{$}\NormalTok{hc,}
                 \DataTypeTok{k =} \DecValTok{2}\NormalTok{,}
                 \DataTypeTok{xlab =} \StringTok{"Genótipos"}\NormalTok{,}
                 \DataTypeTok{ylab =}  \StringTok{"Distância euclidiana"}\NormalTok{,}
                 \DataTypeTok{main =} \StringTok{""}\NormalTok{) }
\NormalTok{de2 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_dend}\NormalTok{(d3}\OperatorTok{$}\NormalTok{hc,}
                 \DataTypeTok{k =} \DecValTok{2}\NormalTok{,}
                 \DataTypeTok{type =} \StringTok{"circular"}\NormalTok{)}
\NormalTok{de3 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_dend}\NormalTok{(d3}\OperatorTok{$}\NormalTok{hc,}
                 \DataTypeTok{k =} \DecValTok{2}\NormalTok{,}
                 \DataTypeTok{type =} \StringTok{"phylogenic"}\NormalTok{,}
                 \DataTypeTok{repel =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{de4 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_dend}\NormalTok{(d1}\OperatorTok{$}\NormalTok{hc,}
                 \DataTypeTok{k =} \DecValTok{5}\NormalTok{,}
                 \DataTypeTok{xlab =} \StringTok{"Genótipos"}\NormalTok{,}
                 \DataTypeTok{ylab =}  \StringTok{"Distância euclidiana"}\NormalTok{,}
                 \DataTypeTok{palette =} \StringTok{"jco"}\NormalTok{,}
                 \DataTypeTok{show\_labels =} \OtherTok{FALSE}\NormalTok{,}
                 \DataTypeTok{main =} \StringTok{""}\NormalTok{)}
\NormalTok{cp1 \textless{}{-}}\StringTok{ }\KeywordTok{plot\_grid}\NormalTok{(de1, de2, de3, }\DataTypeTok{nrow =} \DecValTok{1}\NormalTok{,}
                 \DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"de1"}\NormalTok{, }\StringTok{"de2"}\NormalTok{, }\StringTok{"de3"}\NormalTok{))}
\KeywordTok{plot\_grid}\NormalTok{(cp1, de4, }\DataTypeTok{rows =} \DecValTok{2}\NormalTok{, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{"de4"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-306-1} \end{center}

\hypertarget{distancias-para-cada-ambiente}{%
\subsection{Distancias para cada ambiente}\label{distancias-para-cada-ambiente}}

O seguinte código computa as distâncias para cada nível do fator \textbf{AMB} do conjunto de dados maize. A função \texttt{group\_by()} \indf{group\_by} é utilizada para criar uma lista onde cada elemento conterá os dados de cada ambiente. Note que o argumento \texttt{keep\_factors\ =\ TRUE} foi utilizado para manter as colunas de fatores. Assim é possível computar a média para cada genótipo quando informado o argumento \texttt{means\_by\ =\ GEN} na função \texttt{clustering()} \indf{clustering}. O resultado desta função é então passado para a função \texttt{pairs\_mantel()}. \indf{pairs\_mantel} Esta função é utilizada para avaliar a associação entre as quatro matrizes de distância.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d4 \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(ENV) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{clustering}\NormalTok{(NKR, TKW, NKE, }\DataTypeTok{nclust =} \DecValTok{4}\NormalTok{)}
\KeywordTok{pairs\_mantel}\NormalTok{(d4, }\DataTypeTok{names =} \KeywordTok{c}\NormalTok{(}\StringTok{"A1"}\NormalTok{, }\StringTok{"A2"}\NormalTok{, }\StringTok{"A3"}\NormalTok{, }\StringTok{"A4"}\NormalTok{),}
             \DataTypeTok{maxsize =} \DecValTok{5}\NormalTok{, }\DataTypeTok{minsize =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-307-1} \end{center}

\hypertarget{componentes-principais}{%
\section{Componentes principais}\label{componentes-principais}}

\hypertarget{conceito}{%
\subsection{Conceito}\label{conceito}}

O objetivo básico da análise de componentes principais (\emph{Principal Component Analysis}, PCA) é descrever a variação em um conjunto de variáveis correlacionadas \(x^T = (x_1, ..., x_q)\), em termos de um novo conjunto de variáveis não correlacionadas, \(y^T = (y_1, ..., y_q)\), onde cada variável é uma combinação linear das variáveis \emph{x}. As novas variáveis são ordenadas em ordem decrescente de ``importância'', no sentido de que \(y_1\) é responsável pelo máximo possível da variação dos dados originais entre todas as combinações lineares de \emph{x}. Então \(y_2\) é escolhido para explicar o máximo possível da variação restante, sujeito a ser não correlacionado com \(y_1\), e assim por diante. As novas variáveis definidas por este processo, \(y_1, ..., y_q\), são os componentes principais. A principal vantagem da análise de componentes principais é que os primeiros componentes serão responsáveis por uma proporção substancial da variação nas variáveis originais, e podem, conseqüentemente, serem usados para fornecer um resumo de dimensões inferiores dessas variáveis.

\hypertarget{pacotes-r}{%
\subsection{Pacotes R}\label{pacotes-r}}

Diversas funções de diferentes pacotes estão disponíveis no software R para realização da PCA, no entanto, a função \texttt{prcomp()} do pacote \textbf{stats} (nativa do R) será utilizada aqui. Para a confecção de biplots e extração dos resultados, funções do pacote \href{https://rpkgs.datanovia.com/factoextra/index.html}{factoextra} serão utilizadas. O primeiro passo é realizar a instalação e o carregamento do pacote.

\hypertarget{formato-dos-dados}{%
\subsection{Formato dos dados}\label{formato-dos-dados}}

Para realizar a aplicação da técnica de componentes principais, os dados em \emph{data\_ge2} serão utilizados. Precisamos, primeiramente, organizar os dados de modo que tenhamos uma matriz de dupla entrada, contendo os genótipos nas linhas e as variáveis nas colunas.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{data\_pca \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{data\_ge2 }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{means\_by}\NormalTok{(GEN) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{column\_to\_rownames}\NormalTok{(}\StringTok{"GEN"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Em PCA, as variáveis são frequentemente dimensionadas (isto é, padronizadas). Isto é particularmente recomendado quando as variáveis são medidas em diferentes escalas (quilogramas, quilômetros, centímetros, \ldots). Caso contrário, os resultados da PCA podem ser severamente afetados. Geralmente as variáveis são escalonadas para média zero e variáncia unitária, de acordo com a seguinte fórmula.

\[
x_s = \frac{x_i- mean(x)}{sd(x)}
\]

onde \(mean(x)\) é a média dos valores de x e \(sd(x)\) é o desvio padrão. A função nativa do R \texttt{scale()} pode ser utilizada para padronizar os dados. Isto pode ser realizado, no entanto, utilizando o argumento \texttt{scale.\ =\ TRUE} na função \texttt{prcomp()}.

\hypertarget{cuxf3digo-r}{%
\subsection{Código R}\label{cuxf3digo-r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res.pca \textless{}{-}}\StringTok{ }\KeywordTok{prcomp}\NormalTok{(data\_pca, }\DataTypeTok{scale. =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Para ajudar na interpretação do PCA realizado acima, usaremos funções do pacote factoextra. Essas funções incluem:
\texttt{get\_eigenvalue(res.pca)}: Extrai os autovalores/variâncias dos componentes principais
\texttt{fviz\_eig(res.pca)}: Para visualizar os autovalores
\texttt{get\_pca\_ind(res.pca)}, \texttt{get\_pca\_var(res.pca)}: Para extrair os resultados dos genótipos e variáveis, respectivamente.
\texttt{fviz\_pca\_ind(res.pca)}, \texttt{fviz\_pca\_var(res.pca)}: Para visualizar os resultados dos genótipos e variáveis, respectivamente.
\texttt{fviz\_pca\_biplot(res.pca)}: Para confecção de biplots.

\hypertarget{autovalores}{%
\subsection{Autovalores}\label{autovalores}}

Os autovalores medem a quantidade de variância retida por cada componente principal. Autovalores são grandes para os primeiros PCs e pequenos para os PCs subseqüentes. Ou seja, os primeiros PCs correspondem às direções com a quantidade máxima de variação no conjunto de dados. Examinamos os autovalores para determinar o número de componentes principais a serem considerados. Os autovalores e a proporção de variâncias (isto é, informação) retidos pelos componentes principais (PCs) são extraídos usando a função \texttt{get\_eigenvalue()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eig.val \textless{}{-}}\StringTok{ }\KeywordTok{get\_eigenvalue}\NormalTok{(res.pca)}
\end{Highlighting}
\end{Shaded}

A soma de todos os autovalores resulta em uma variância total de 15 A proporção de variação explicada por cada autovalor é dada na segunda coluna. Por exemplo, 7.623 dividido por 15 é igual a 0.5082, ou, cerca de 50.82\% da variação é explicada por este primeiro autovalor. A porcentagem acumulada explicada é obtida adicionando as proporções sucessivas de variação explicadas. Por exemplo, 50.82\% mais 18.13\% é igual a 68.95\% e assim por diante. Assim, cerca de 59,627\% da variação é explicada pelos dois primeiros autovalores.

\indt{Curiosidade}
\begin{vcsabia}
Um autovalor maior que 1 indica que os componentes principais são responsáveis por mais variâncias do que as contabilizadas por uma das variáveis originais nos dados padronizados. Isso é comumente usado como um ponto de corte para o qual os PCs são mantidos (Kaiser \protect\hyperlink{ref-Kaiser1961}{1961}). No entanto, isto vale apenas quando os dados são padronizados.
\end{vcsabia}

Infelizmente, não há maneira objetiva bem aceita de decidir quantos componentes principais são suficientes. Em nossa análise, os três primeiros componentes principais explicam 83.62\% da variação. Esta é uma percentagem aceitavelmente grande. Um método alternativo para determinar o número de componentes principais é olhar para um Scree Plot, que é o gráfico de autovalores ordenados do maior para o menor. O número de componentes é determinado no ponto, além do qual os autovalores remanescentes são todos relativamente pequenos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_eig}\NormalTok{(res.pca)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_eig}\NormalTok{(res.pca,}
               \DataTypeTok{addlabels =} \OtherTok{TRUE}\NormalTok{,}
               \DataTypeTok{geom =} \StringTok{"bar"}\NormalTok{,}
               \DataTypeTok{barfill =} \StringTok{"orange"}\NormalTok{,}
               \DataTypeTok{barcolor =} \StringTok{"black"}\NormalTok{,}
               \DataTypeTok{xlab =} \StringTok{"Componentes Principais"}\NormalTok{,}
               \DataTypeTok{ylab =} \StringTok{"Percentagem da variância explicada"}\NormalTok{,}
               \DataTypeTok{main =} \StringTok{""}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-312-1} 

}

\caption{Autovalores e variância acumulada na análise de componentes principais}\label{fig:unnamed-chunk-312}
\end{figure}

\hypertarget{gruxe1fico-das-variuxe1veis}{%
\subsection{Gráfico das variáveis}\label{gruxe1fico-das-variuxe1veis}}

Um método simples para extrair os resultados, para variáveis, de uma saída da função \texttt{prcomp()} \indf{prcomp} é usar a função \texttt{get\_pca\_var()} \indf{get\_pca\_var}. Esta função fornece uma lista de matrizes contendo todos os seguintes resultados:

\begin{itemize}
\tightlist
\item
  coord: coordenadas de variáveis para criar um gráfico de dispersão.
\item
  cos2: representa a qualidade da representação para variáveis no mapa de fatores. É equivalente ao quadrado das coordenadas.
\item
  contrib: contém as contribuições (em percentagem) das variáveis para os componentes principais.
\end{itemize}

\hypertarget{cuxedrculo-de-correlauxe7uxe3o}{%
\subsubsection{Círculo de correlação}\label{cuxedrculo-de-correlauxe7uxe3o}}

A correlação entre uma variável e um componente principal (PC) é usada como as coordenadas da variável no PC. Um gráfico pode ser obtido utilizando a função \texttt{fviz\_pca\_var()}, \indf{fviz\_pca\_var}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_pca\_var}\NormalTok{(res.pca)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_pca\_var}\NormalTok{(res.pca,}
                   \DataTypeTok{col.circle =} \StringTok{"red"}\NormalTok{,}
                   \DataTypeTok{xlab =} \StringTok{"PCA1 (50,8\%)"}\NormalTok{,}
                   \DataTypeTok{ylab =} \StringTok{"PCA2 (18,1\%)"}\NormalTok{,}
                   \DataTypeTok{geom =} \KeywordTok{c}\NormalTok{(}\StringTok{"point"}\NormalTok{, }\StringTok{"arrow"}\NormalTok{, }\StringTok{"text"}\NormalTok{),}
                   \DataTypeTok{title =} \StringTok{"Gráfico das variáveis"}\NormalTok{,}
                   \DataTypeTok{repel =} \OtherTok{TRUE}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"p1"}\NormalTok{, }\StringTok{"p2"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-313-1} \end{center}

O gráfico acima mostra as relações entre todas as variáveis. Ele pode ser interpretado da seguinte forma:

\begin{itemize}
\tightlist
\item
  Variáveis positivamente correlacionadas são agrupadas.
\item
  Variáveis negativamente correlacionadas são posicionadas em lados opostos da origem do gráfico (quadrantes opostos).
\item
  A distância entre as variáveis e a origem mede a qualidade das variáveis no mapa de fatores. Variáveis que estão longe da origem (próximas ao círculo) estão bem representadas no mapa de fatores.
\end{itemize}

\hypertarget{representauxe7uxe3o-e-contribuiuxe7uxe3o-das-variuxe1veis}{%
\subsubsection{Representação e contribuição das variáveis}\label{representauxe7uxe3o-e-contribuiuxe7uxe3o-das-variuxe1veis}}

A qualidade e a contribuição das variáveis pode ser exibida no mapa de fatores utilizando o argumento \texttt{col.var\ =\ "cos2"} e \texttt{col.var\ =\ "contrib"}, respectivamente. Note que é possível também colorir as variáveis utilizando uma variável categórica. Para fins didáticos criaremos uma variável categórica com três neíveis, baseado no algorítmo kmeans aplicado nas coordenadas das variáveis.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_pca\_var}\NormalTok{(res.pca,}
                   \DataTypeTok{col.var =} \StringTok{"cos2"}\NormalTok{,}
                   \DataTypeTok{geom =} \KeywordTok{c}\NormalTok{(}\StringTok{"point"}\NormalTok{, }\StringTok{"arrow"}\NormalTok{, }\StringTok{"text"}\NormalTok{),}
                   \DataTypeTok{repel =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{res.km \textless{}{-}}\StringTok{ }\KeywordTok{kmeans}\NormalTok{(}\KeywordTok{get\_pca\_var}\NormalTok{(res.pca)}\OperatorTok{$}\NormalTok{coord, }\DataTypeTok{centers =} \DecValTok{3}\NormalTok{, }\DataTypeTok{nstart =} \DecValTok{25}\NormalTok{)}
\NormalTok{grp \textless{}{-}}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(res.km}\OperatorTok{$}\NormalTok{cluster)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_pca\_var}\NormalTok{(res.pca,}
                   \DataTypeTok{col.var =}\NormalTok{ grp,}
                   \DataTypeTok{palette =} \KeywordTok{c}\NormalTok{(}\StringTok{"green"}\NormalTok{, }\StringTok{"blue"}\NormalTok{, }\StringTok{"red"}\NormalTok{),}
                   \DataTypeTok{geom =} \KeywordTok{c}\NormalTok{(}\StringTok{"point"}\NormalTok{, }\StringTok{"arrow"}\NormalTok{, }\StringTok{"text"}\NormalTok{),}
                   \DataTypeTok{repel =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}
\StringTok{      }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"p1"}\NormalTok{, }\StringTok{"p2"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-314-1} \end{center}

\hypertarget{gruxe1fico-de-indivuxedduos}{%
\subsection{Gráfico de indivíduos}\label{gruxe1fico-de-indivuxedduos}}

Os resultados, para indivíduos, podem ser extraídos usando a função \texttt{get\_pca\_ind()}\indf{get\_pca\_ind}. Similarmente ao \texttt{get\_pca\_var()}, esta função fornece uma lista de matrizes contendo todos os resultados para os indivíduos (coordenadas, correlação entre indivíduos e eixos, quadrado das distâncias e contribuições). A função \texttt{fviz\_pca\_ind()} é usada para produzir o gráfico de indivíduos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_pca\_ind}\NormalTok{(res.pca)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_pca\_ind}\NormalTok{(res.pca,}
                   \DataTypeTok{pointsize =} \StringTok{"cos2"}\NormalTok{, }
                   \DataTypeTok{pointshape =} \DecValTok{21}\NormalTok{,}
                   \DataTypeTok{fill =} \StringTok{"\#E7B800"}\NormalTok{,}
                   \DataTypeTok{repel =} \OtherTok{TRUE}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"p1"}\NormalTok{, }\StringTok{"p2"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-315-1} \end{center}

\hypertarget{gruxe1fico-biplot}{%
\subsection{Gráfico biplot}\label{gruxe1fico-biplot}}

Um gráfico biplot combina os marcadores de variáveis e indivíduos em um mesmo gráfico. A função \texttt{fviz\_pca\_biplot()} é utilizada para gerar este tipo de gráfico. O primeiro biplot (p1) é confeccionado com o exemplo em \texttt{res.pca}. Um exemplo um pouco mais complexo será mostrado utilizando o banco de dados do R iris. Neste exemplo, os indivíduos são coloridos por grupos (cor discreta) e variáveis por suas contribuições para os componentes principais (cores de gradiente). Além disso, alteraremos a transparência das variáveis por suas contribuições usando o argumento \texttt{alpha.var}. \indf{fviz\_pca\_biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_pca\_biplot}\NormalTok{(res.pca)}

\NormalTok{iris.pca \textless{}{-}}\StringTok{ }\KeywordTok{prcomp}\NormalTok{(iris[,}\OperatorTok{{-}}\DecValTok{5}\NormalTok{], }\DataTypeTok{scale. =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_pca\_biplot}\NormalTok{(iris.pca, }
                \CommentTok{\# indivíduos}
                \DataTypeTok{geom.ind =} \StringTok{"point"}\NormalTok{,}
                \DataTypeTok{fill.ind =}\NormalTok{ iris}\OperatorTok{$}\NormalTok{Species, }\DataTypeTok{col.ind =} \StringTok{"black"}\NormalTok{,}
                \DataTypeTok{pointshape =} \DecValTok{21}\NormalTok{, }\DataTypeTok{pointsize =} \DecValTok{2}\NormalTok{,}
                \DataTypeTok{palette =} \StringTok{"jco"}\NormalTok{,}
                \DataTypeTok{addEllipses =} \OtherTok{TRUE}\NormalTok{,}
                \DataTypeTok{repel =} \OtherTok{TRUE}\NormalTok{,}
                \CommentTok{\# variáveis}
                \DataTypeTok{alpha.var =}\StringTok{"contrib"}\NormalTok{, }\DataTypeTok{col.var =} \StringTok{"contrib"}\NormalTok{,}
                \DataTypeTok{gradient.cols =} \StringTok{"RdYlBu"}\NormalTok{,}
                \DataTypeTok{legend.title =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"Especies"}\NormalTok{,}
                                    \DataTypeTok{color =} \StringTok{"Contribuição"}\NormalTok{,}
                                    \DataTypeTok{alpha =} \StringTok{"Contribuição"}\NormalTok{))}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"p1"}\NormalTok{, }\StringTok{"p2"}\NormalTok{), }\DataTypeTok{rel\_widths =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.4}\NormalTok{, }\FloatTok{0.6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-316-1} \end{center}

\hypertarget{k-means}{%
\section{K-means}\label{k-means}}

\hypertarget{conceito-1}{%
\subsection{Conceito}\label{conceito-1}}

A idéia básica por trás do agrupamento \indt{agrupamento} \emph{k}-means consiste em definir clusters para que a variação total dentro do cluster seja minimizada. Existem vários algoritmos \emph{k}-means disponíveis. O algoritmo padrão e o mais utilizado é o algoritmo de Hartigan-Wong (Hartigan and Wong \protect\hyperlink{ref-Hartigan1979}{1979}), que define a variação total dentro do cluster como a soma das distâncias Euclidianas quadráticas entre os itens e o centróide correspondente. Os passos básicos para a análise são os que seguem:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Especifique o número de clusters (\emph{k}) a serem criados;
\item
  Selecione aleatoriamente k objetos do conjunto de dados como os centros de clusters iniciais ou médias;
\item
  Atribua cada observação ao seu centróide mais próximo, com base na distância euclidiana entre o objeto e o centróide;
\item
  Para cada um dos \emph{k} clusters, atualize o centróide do cluster calculando os novos valores médios de todos os pontos de dados no cluster. O centróide do \emph{k}-ésimo cluster é um vetor de comprimento p (p = número de variáveis) contendo as médias de todas as variáveis para as observações no \emph{k}-ésimo cluster;
\item
  Iterativamente, minimize a soma de quadrados total dentro do cluster; isto é, iterar as etapas 3 e 4 até que as atribuições do cluster parem de mudar ou até que o número máximo de iterações sejam atingidas. Por padrão, o software R usa 10 como o valor padrão para o número máximo de iterações.
\end{enumerate}

\hypertarget{pacotes-r-1}{%
\subsection{Pacotes R}\label{pacotes-r-1}}

Para implementar o método \emph{k}-means\indt{kmeans}, a função \texttt{kmeans()}\indf{kmeans} do pacote \textbf{stats} (nativa do R) será utilizada. Para a confecção do gráfico, a função \texttt{fviz\_cluster()} \indf{fviz\_cluster} do pacote \href{https://rpkgs.datanovia.com/factoextra/index.html}{factoextra} será utilizada.

\hypertarget{formato-dos-dados-e-cuxf3digos-r}{%
\subsection{Formato dos dados e códigos R}\label{formato-dos-dados-e-cuxf3digos-r}}

O formato dos dados utilizados é o mesmo dos utilizados para realizar a \protect\hyperlink{componentes-principais}{análise de componentes principais}. Assim, neste exemplo, somente criaremos um novo conjunto renomeando os dados organizados anteriormente (\texttt{data\_pca}) para \texttt{data\_km}. O próximo passo é ajustar o modelo \emph{k}-means e armazenar em um objeto, em nosso exemplo, \texttt{kmres}. Posteriormente, a função \texttt{fviz\_cluster()} é utilizada para confeccionar o gráfico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_km \textless{}{-}}\StringTok{ }\NormalTok{data\_pca}
\NormalTok{km.res \textless{}{-}}\StringTok{ }\KeywordTok{kmeans}\NormalTok{(data\_km, }\DecValTok{2}\NormalTok{, }\DataTypeTok{nstart =} \DecValTok{25}\NormalTok{)}
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_cluster}\NormalTok{(km.res, }\DataTypeTok{data =}\NormalTok{ data\_pca)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{fviz\_cluster}\NormalTok{(km.res,}
                   \DataTypeTok{data =}\NormalTok{ data\_pca,}
                   \DataTypeTok{ellipse =} \OtherTok{TRUE}\NormalTok{,}
                   \DataTypeTok{main =} \StringTok{""}\NormalTok{,}
                   \DataTypeTok{ellipse.type =} \StringTok{"confidence"}\NormalTok{,}
                   \DataTypeTok{ggtheme =} \KeywordTok{theme\_metan}\NormalTok{())}\OperatorTok{+}
\StringTok{      }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}
\KeywordTok{plot\_grid}\NormalTok{(p1, p2, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"p1"}\NormalTok{, }\StringTok{"p2"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-317-1} \end{center}

\hypertarget{interaction}{%
\chapter{\texorpdfstring{Interação genótipo-\emph{vs}-ambiente}{Interação genótipo-vs-ambiente}}\label{interaction}}

Uma cultura pode ser vista como um sistema complexo com resultados (por exemplo, rendimento de grãos) que são afetados por informações genéticas, fisiológicas, pedoclimáticas e de manejo. Melhoristas e geneticistas se esforçam continuamente para aumentar a produtividade das culturas visando suprir a demanda mundial cada vez maior por alimentos. É na fase final de um programa de melhoramento de plantas que muito esforço e recursos precisam ser investidos na avaliação dos genótipos (\emph{\emph{g}}) a serem selecionados. Geralmente algumas centenas de genótipos precisam ser avaliados em um grande número de ambientes (\emph{\emph{e}}). Estes ensaios são conhecidos como ensaios multi-ambientes (\indt{EMA}) e os dados destes experimentos resultam em uma matriz \textbf{\emph{M}} de dimensões \(g \times e\) . É nesta fase do processo que surge um dos maiores desafios da análise de \indt{EMA}: compreender a interação genótipo-\emph{vs}-ambiente buscando novas formas de explorá-la e utilizá-la a favor da seleção de genótipos com estabilidade \indt{estabilidade} produtiva satisfatória.

Funções do pacote \texttt{metan}, acrônimo para \textbf{m}ulti \textbf{e}nvironment \textbf{t}rial \textbf{an}alysis serão utilizadas para análise de dados de ensaios multi-ambientes\indt{EMA}. O foi desenvolvido em linguagem R e é distribuído sob a licença GPL (General Public Licence) 3.0. Isto significa que qualquer pessoa pode: (i) utilizar o código sem nenhuma restrição/pagamento; (ii) estudar o código e adaptá-lo às suas necessidades; (iii) sugerir modificações/melhorias no código de modo a aperfeiçoá-lo para uma comunidade maior de usuários, mantendo, porém, os direitos do autor. O pacote \texttt{metan} fornece funções úteis para analisar dados de ensaios multi-ambientes usando métodos paramétricos e não paramétricos, incluindo, mas não limitados a:

\begin{itemize}
\tightlist
\item
  Análise gráfica da interação genótipo-\emph{vs}-ambiente;
\item
  Análise de variância individual
\item
  Procedimentos de validação cruzada para modelos da família AMMI e BLUP;
\item
  Estimativas usando AMMI com diferentes números de termos multiplicativos;
\item
  Índices de estabilidade baseados em AMMI;
\item
  Biplots baseados no modelo GGE;
\item
  Predição baseada em modelos de efeito misto;
\item
  Índices de estabilidade baseados em BLUP;
\item
  Componentes de variância e parâmetros genéticos em modelos de efeito misto;
\item
  Ferramentas gráficas para confecção de biplots.
\item
  Estatísticas de estabilidade paramétrica e não paramétrica.
\end{itemize}

Nesta seção, usaremos o conjunto de dados \texttt{data\_ge} disponível no pacote \texttt{metan}. Para mais informações, por favor, consulte \texttt{?data\_ge}. Outros conjuntos de dados podem ser usados desde que as seguintes colunas estejam no conjunto de dados: ambiente, genótipo, bloco e variável(eis) resposta.

\hypertarget{anuxe1lise-gruxe1fica-da-interauxe7uxe3o}{%
\section{Análise gráfica da interação}\label{anuxe1lise-gruxe1fica-da-interauxe7uxe3o}}

A função \texttt{ge\_plot()} pode ser usada para visualizar o desempenho do genótipo através dos ambientes. O losango preto mostra a média para cada ambiente.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a \textless{}{-}}\StringTok{ }\KeywordTok{ge\_plot}\NormalTok{ (data\_ge, ENV, GEN, GY)}
\NormalTok{b \textless{}{-}}\StringTok{ }\KeywordTok{ge\_plot}\NormalTok{ (data\_ge, ENV, GEN, GY) }\OperatorTok{+}\StringTok{ }\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{coord\_flip}\NormalTok{ ()}
\KeywordTok{arrange\_ggplot}\NormalTok{(a, b)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-318-1} \end{center}

Para identificar o genótipo vencedor em cada ambiente, podemos usar a função \texttt{ge\_winners()}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ge\_winners}\NormalTok{(data\_ge2, ENV, GEN, }\DataTypeTok{resp =} \KeywordTok{everything}\NormalTok{())}
\CommentTok{\# \# A tibble: 4 x 16}
\CommentTok{\#   ENV   PH    EH    EP    EL    ED    CL    CD    CW    KW    NR    NKR   CDED }
\CommentTok{\#   \textless{}fct\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{}}
\CommentTok{\# 1 A1    H3    H1    H1    H6    H6    H8    H6    H6    H6    H2    H4    H8   }
\CommentTok{\# 2 A2    H2    H1    H1    H6    H2    H2    H6    H2    H2    H2    H6    H13  }
\CommentTok{\# 3 A3    H13   H13   H6    H4    H13   H6    H2    H7    H13   H13   H4    H6   }
\CommentTok{\# 4 A4    H5    H5    H10   H7    H11   H5    H7    H5    H7    H11   H9    H10  }
\CommentTok{\# \# ... with 3 more variables: PERK \textless{}chr\textgreater{}, TKW \textless{}chr\textgreater{}, NKE \textless{}chr\textgreater{}}
\end{Highlighting}
\end{Shaded}

Ou obtenha a classificação dos genótipos em cada ambiente.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ge\_winners}\NormalTok{(data\_ge2, ENV, GEN, }\DataTypeTok{resp =} \KeywordTok{everything}\NormalTok{ (), }\DataTypeTok{type =} \StringTok{"ranks"}\NormalTok{)}
\CommentTok{\# \# A tibble: 52 x 16}
\CommentTok{\#    ENV   PH    EH    EP    EL    ED    CL    CD    CW    KW    NR    NKR   CDED }
\CommentTok{\#    \textless{}fct\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{}}
\CommentTok{\#  1 A1    H3    H1    H1    H6    H6    H8    H6    H6    H6    H2    H4    H8   }
\CommentTok{\#  2 A1    H9    H4    H10   H11   H13   H9    H11   H8    H13   H13   H5    H9   }
\CommentTok{\#  3 A1    H4    H9    H4    H10   H10   H6    H9    H9    H9    H3    H6    H7   }
\CommentTok{\#  4 A1    H5    H10   H7    H4    H9    H10   H10   H7    H2    H7    H11   H12  }
\CommentTok{\#  5 A1    H2    H7    H12   H5    H8    H13   H5    H5    H1    H12   H3    H11  }
\CommentTok{\#  6 A1    H10   H5    H11   H9    H2    H7    H4    H13   H4    H8    H2    H10  }
\CommentTok{\#  7 A1    H7    H3    H6    H3    H3    H12   H8    H4    H3    H6    H1    H6   }
\CommentTok{\#  8 A1    H13   H11   H9    H7    H1    H11   H3    H12   H8    H10   H13   H13  }
\CommentTok{\#  9 A1    H6    H13   H13   H1    H7    H5    H7    H10   H5    H4    H8    H5   }
\CommentTok{\# 10 A1    H11   H6    H5    H12   H4    H1    H1    H3    H10   H1    H12   H1   }
\CommentTok{\# \# ... with 42 more rows, and 3 more variables: PERK \textless{}chr\textgreater{}, TKW \textless{}chr\textgreater{}, NKE \textless{}chr\textgreater{}}
\end{Highlighting}
\end{Shaded}

Para mais detalhes sobre os testes, podemos usar \texttt{ge\_details()}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ge\_details}\NormalTok{(data\_ge2, ENV, GEN, }\DataTypeTok{resp =} \KeywordTok{everything}\NormalTok{())}
\CommentTok{\# \# A tibble: 10 x 16}
\CommentTok{\#    Parameters PH    EH    EP    EL    ED    CL    CD    CW    KW    NR    NKR  }
\CommentTok{\#    \textless{}chr\textgreater{}      \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{}}
\CommentTok{\#  1 Mean       "2.4\textasciitilde{} "1.3\textasciitilde{} "0.5\textasciitilde{} "15.\textasciitilde{} "49.\textasciitilde{} "29.\textasciitilde{} "15.\textasciitilde{} "24.\textasciitilde{} "172\textasciitilde{} "16.\textasciitilde{} "32.\textasciitilde{}}
\CommentTok{\#  2 SE         "0.0\textasciitilde{} "0.0\textasciitilde{} "0"   "0.1" "0.2\textasciitilde{} "0.1\textasciitilde{} "0.0\textasciitilde{} "0.5" "2.6\textasciitilde{} "0.1\textasciitilde{} "0.2\textasciitilde{}}
\CommentTok{\#  3 SD         "0.3\textasciitilde{} "0.2\textasciitilde{} "0.0\textasciitilde{} "1.2\textasciitilde{} "2.7\textasciitilde{} "2.3" "1.1\textasciitilde{} "6.2\textasciitilde{} "32.\textasciitilde{} "1.6\textasciitilde{} "3.4\textasciitilde{}}
\CommentTok{\#  4 CV         "13.\textasciitilde{} "21.\textasciitilde{} "10.\textasciitilde{} "8.2\textasciitilde{} "5.5\textasciitilde{} "7.9\textasciitilde{} "7.3\textasciitilde{} "25.\textasciitilde{} "18.\textasciitilde{} "10.\textasciitilde{} "10.\textasciitilde{}}
\CommentTok{\#  5 Min        "1.7\textasciitilde{} "0.7\textasciitilde{} "0.3\textasciitilde{} "11.\textasciitilde{} "43.\textasciitilde{} "23.\textasciitilde{} "12.\textasciitilde{} "11.\textasciitilde{} "105\textasciitilde{} "12.\textasciitilde{} "23.\textasciitilde{}}
\CommentTok{\#  6 Max        "3.0\textasciitilde{} "1.8\textasciitilde{} "0.6\textasciitilde{} "17.\textasciitilde{} "54.\textasciitilde{} "34.\textasciitilde{} "18.\textasciitilde{} "38.\textasciitilde{} "250\textasciitilde{} "21.\textasciitilde{} "42 \textasciitilde{}}
\CommentTok{\#  7 MinENV     "A3 \textasciitilde{} "A3 \textasciitilde{} "A3 \textasciitilde{} "A3 \textasciitilde{} "A3 \textasciitilde{} "A3 \textasciitilde{} "A3 \textasciitilde{} "A3 \textasciitilde{} "A3 \textasciitilde{} "A3 \textasciitilde{} "A3 \textasciitilde{}}
\CommentTok{\#  8 MaxENV     "A1 \textasciitilde{} "A1 \textasciitilde{} "A1 \textasciitilde{} "A1 \textasciitilde{} "A1 \textasciitilde{} "A1 \textasciitilde{} "A1 \textasciitilde{} "A1 \textasciitilde{} "A1 \textasciitilde{} "A1 \textasciitilde{} "A1 \textasciitilde{}}
\CommentTok{\#  9 MinGEN     "H10\textasciitilde{} "H8 \textasciitilde{} "H8 \textasciitilde{} "H12\textasciitilde{} "H9 \textasciitilde{} "H12\textasciitilde{} "H12\textasciitilde{} "H11\textasciitilde{} "H9 \textasciitilde{} "H9 \textasciitilde{} "H12\textasciitilde{}}
\CommentTok{\# 10 MaxGEN     "H1 \textasciitilde{} "H1 \textasciitilde{} "H1 \textasciitilde{} "H6 \textasciitilde{} "H6 \textasciitilde{} "H6 \textasciitilde{} "H5 \textasciitilde{} "H5 \textasciitilde{} "H6 \textasciitilde{} "H13\textasciitilde{} "H4 \textasciitilde{}}
\CommentTok{\# \# ... with 4 more variables: CDED \textless{}chr\textgreater{}, PERK \textless{}chr\textgreater{}, TKW \textless{}chr\textgreater{}, NKE \textless{}chr\textgreater{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{anuxe1lise-de-variuxe2ncia-individual}{%
\section{Análise de variância individual}\label{anuxe1lise-de-variuxe2ncia-individual}}

A função \texttt{anova\_ind()} \indf{anova\_ind} pode ser utilziada para realizar uma análise de variância para cada ambiente, conforme o seguinte código.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ind \textless{}{-}}\StringTok{ }\KeywordTok{anova\_ind}\NormalTok{(data\_ge, ENV, GEN, REP, GY)}
\KeywordTok{print}\NormalTok{(ind}\OperatorTok{$}\NormalTok{GY}\OperatorTok{$}\NormalTok{individual)}
\CommentTok{\# \# A tibble: 14 x 12}
\CommentTok{\#    ENV    MEAN   MSG   FCG     PFG    MSB    FCB     PFB    MSE    CV    h2}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 E1     2.52 0.337  2.34 5.94e{-}2 0.0652  0.453 6.43e{-}1 0.144  15.1  0.573}
\CommentTok{\#  2 E10    2.18 0.296 11.1  1.10e{-}5 0.654  24.5   7.28e{-}6 0.0267  7.51 0.910}
\CommentTok{\#  3 E11    1.37 0.151  1.44 2.44e{-}1 0.377   3.59  4.86e{-}2 0.105  23.7  0.304}
\CommentTok{\#  4 E12    1.61 0.320  5.98 6.47e{-}4 0.0919  1.72  2.08e{-}1 0.0535 14.4  0.833}
\CommentTok{\#  5 E13    2.91 0.713  7.18 2.10e{-}4 0.0767  0.772 4.77e{-}1 0.0994 10.8  0.861}
\CommentTok{\#  6 E14    1.78 0.131  1.73 1.53e{-}1 0.104   1.37  2.78e{-}1 0.0753 15.4  0.423}
\CommentTok{\#  7 E2     3.18 0.207  1.16 3.76e{-}1 0.698   3.91  3.88e{-}2 0.179  13.3  0.136}
\CommentTok{\#  8 E3     4.06 0.335  1.87 1.23e{-}1 0.489   2.73  9.21e{-}2 0.179  10.4  0.466}
\CommentTok{\#  9 E4     3.68 0.531  3.86 7.12e{-}3 0.116   0.846 4.46e{-}1 0.138  10.1  0.741}
\CommentTok{\# 10 E5     3.91 0.526  7.93 1.10e{-}4 0.219   3.30  6.02e{-}2 0.0664  6.59 0.874}
\CommentTok{\# 11 E6     2.66 0.135  2.30 6.35e{-}2 0.160   2.73  9.22e{-}2 0.0586  9.09 0.565}
\CommentTok{\# 12 E7     1.99 0.337  3.70 8.73e{-}3 0.381   4.19  3.22e{-}2 0.0910 15.2  0.730}
\CommentTok{\# 13 E8     2.54 0.215  7.72 1.31e{-}4 0.817  29.4   2.15e{-}6 0.0278  6.57 0.870}
\CommentTok{\# 14 E9     3.06 0.679  6.12 5.62e{-}4 0.583   5.25  1.60e{-}2 0.111  10.9  0.837}
\CommentTok{\# \# ... with 1 more variable: AS \textless{}dbl\textgreater{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{baseada-em-regressuxe3o}{%
\section{Baseada em regressão}\label{baseada-em-regressuxe3o}}

Eberhart and Russell (\protect\hyperlink{ref-Eberhart1966}{1966}) popularizaram a análise de estabilidade baseada em regressão. Nesse procedimento, a análise de adaptabilidade e estabilidade é realizada por meio de ajustes de equações de regressão onde a variável dependente é estimada em função de um índice ambiental, conforme o seguinte modelo:

\[
\mathop Y\nolimits_{ij}  = {\beta _{0i}} + {\beta _{1i}}{I_j} + {\delta _{ij}} + {\bar \varepsilon _{ij}}
\]

onde \({\beta _{0i}}\) é a média geral do genótipo \emph{i} (\emph{i} = 1, 2, \ldots, I); \({\beta _{1i}}\) é a respota linear do genótipo \emph{i} ao índice ambiental; \emph{Ij} é o índice ambiental (\emph{j} = 1, 2, \ldots, \emph{e}), onde \({I_j} = [(y_{.j}/g)- (y_{..}/ge)]\), \({\delta _{ij}}\) é o desvio da regressão, e \({\bar \varepsilon _{ij}}\) é o erro experimental.
O modelo é ajustado com a função \texttt{ge\_reg()} \indf{ge\_reg}. Os métodos S3 \texttt{plot()} e \texttt{summary()} podem ser utilizados para explorar os resultados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg\_model \textless{}{-}}\StringTok{ }\KeywordTok{ge\_reg}\NormalTok{(data\_ge, ENV, GEN, REP, GY)}
\NormalTok{reg\_model}\OperatorTok{$}\NormalTok{GY}\OperatorTok{$}\NormalTok{anova}
\CommentTok{\# \# A tibble: 17 x 6}
\CommentTok{\#    SV                       Df \textasciigrave{}Sum Sq\textasciigrave{} \textasciigrave{}Mean Sq\textasciigrave{} \textasciigrave{}F value\textasciigrave{}  \textasciigrave{}Pr(\textgreater{}F)\textasciigrave{}}
\CommentTok{\#    \textless{}chr\textgreater{}                 \textless{}dbl\textgreater{}    \textless{}dbl\textgreater{}     \textless{}dbl\textgreater{}     \textless{}dbl\textgreater{}     \textless{}dbl\textgreater{}}
\CommentTok{\#  1 "Total"                 139  324.       2.33      NA     NA       }
\CommentTok{\#  2 "GEN"                     9   13.0      1.44       6.28   3.05e{-} 7}
\CommentTok{\#  3 "ENV + (GEN x ENV)"     130  311.       2.39      NA     NA       }
\CommentTok{\#  4 "ENV (linear)"            1  280.     280.        NA     NA       }
\CommentTok{\#  5 " GEN x ENV (linear)"     9    3.61     0.402      1.75   8.58e{-} 2}
\CommentTok{\#  6 "Pooled deviation"      120   27.6      0.230     NA     NA       }
\CommentTok{\#  7 "G1"                     12    1.11     0.0924     1.06   3.92e{-} 1}
\CommentTok{\#  8 "G10"                    12    7.54     0.629      7.22   1.66e{-}11}
\CommentTok{\#  9 "G2"                     12    2.95     0.246      2.82   1.14e{-} 3}
\CommentTok{\# 10 "G3"                     12    0.699    0.0582     0.669  7.81e{-} 1}
\CommentTok{\# 11 "G4"                     12    2.23     0.186      2.14   1.48e{-} 2}
\CommentTok{\# 12 "G5"                     12    1.49     0.124      1.42   1.55e{-} 1}
\CommentTok{\# 13 "G6"                     12    1.27     0.106      1.22   2.71e{-} 1}
\CommentTok{\# 14 "G7"                     12    3.25     0.270      3.11   3.72e{-} 4}
\CommentTok{\# 15 "G8"                     12    2.54     0.211      2.43   5.15e{-} 3}
\CommentTok{\# 16 "G9"                     12    4.54     0.378      4.34   2.42e{-} 6}
\CommentTok{\# 17 "Pooled error"          280   24.4      0.0870    NA     NA}
\NormalTok{reg\_model}\OperatorTok{$}\NormalTok{GY}\OperatorTok{$}\NormalTok{regression}
\CommentTok{\# \# A tibble: 10 x 6}
\CommentTok{\#    GEN       Y slope deviations  RMSE    R2}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}      \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 G1     2.60 1.06    {-}0.00142 0.162 0.966}
\CommentTok{\#  2 G10    2.47 1.12     0.177   0.424 0.823}
\CommentTok{\#  3 G2     2.74 1.05     0.0497  0.265 0.913}
\CommentTok{\#  4 G3     2.96 1.03    {-}0.0128  0.129 0.977}
\CommentTok{\#  5 G4     2.64 0.937    0.0298  0.231 0.917}
\CommentTok{\#  6 G5     2.54 0.887    0.00902 0.188 0.937}
\CommentTok{\#  7 G6     2.53 0.861    0.00304 0.174 0.942}
\CommentTok{\#  8 G7     2.74 0.819    0.0579  0.278 0.852}
\CommentTok{\#  9 G8     3.00 1.03     0.0382  0.246 0.922}
\CommentTok{\# 10 G9     2.51 1.19     0.0938  0.329 0.897}
\KeywordTok{plot}\NormalTok{(reg\_model)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-323-1} \end{center}

\hypertarget{uxedndice-de-confianuxe7a-genotuxedpico}{%
\section{Índice de confiança genotípico}\label{uxedndice-de-confianuxe7a-genotuxedpico}}

Annicchiarico (\protect\hyperlink{ref-Annicchiarico1992}{1992}) propôs um método de estabilidade em que o parâmetro de estabilidade é medido pela superioridade do genótipo em relação à média de cada ambiente, de acordo com o seguinte modelo:

\[
{Z_ {ij}} = \frac{{{Y_ {i}}}} {{{{\bar Y} _ {. J}}}} \times 100
\]

O índice de confiança genotípico do genótipo \emph{i} (\(W_i\)) é então estimado da seguinte forma:

\[
W_i = Z_{i.} / E - \alpha \times sd (Z_{i.})
\]

Onde \(\alpha\) é o quantil da distribuição normal padrão a uma dada probabilidade de erro (\(\alpha \approx 1.64\) a 0.05). O método é implementado usando a função \texttt{Annicchiarico()} \indf{Annicchiarico}. O índice de confiança é estimado considerando todos os ambientes, os ambientes favoráveis (índice positivo) e os ambientes desfavoráveis (índice negativo), como segue:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ann \textless{}{-}}\StringTok{ }\KeywordTok{Annicchiarico}\NormalTok{(data\_ge, ENV, GEN, REP, GY)}
\NormalTok{ann}\OperatorTok{$}\NormalTok{GY}\OperatorTok{$}\NormalTok{general}
\CommentTok{\# \# A tibble: 10 x 6}
\CommentTok{\#    GEN       Y Mean\_rp Sd\_rp    Wi  rank}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 G1     2.60    96.5  7.38  91.5     6}
\CommentTok{\#  2 G10    2.47    90.3 18.9   77.5    10}
\CommentTok{\#  3 G2     2.74   103.  12.1   94.5     4}
\CommentTok{\#  4 G3     2.96   111.   4.59 108.      1}
\CommentTok{\#  5 G4     2.64    99.1  8.03  93.7     5}
\CommentTok{\#  6 G5     2.54    95.5  7.74  90.2     8}
\CommentTok{\#  7 G6     2.53    95.5  7.61  90.4     7}
\CommentTok{\#  8 G7     2.74   105.  12.5   96.0     3}
\CommentTok{\#  9 G8     3.00   113.   8.87 107.      2}
\CommentTok{\# 10 G9     2.51    91.6 13.8   82.3     9}
\end{Highlighting}
\end{Shaded}

\hypertarget{uxedndice-de-superioridade-genotuxedpico}{%
\section{Índice de superioridade genotípico}\label{uxedndice-de-superioridade-genotuxedpico}}

A função \texttt{superiority()}\indf{superiority} implementa o método não-paramétrico proposto por Lin and Binns (\protect\hyperlink{ref-Lin1988}{1988}), que considera que a medida de superioridade geral da cultivar para dados de cultivar x localização é definida como quadrado médio da distância entre a resposta da cultivar e a média de resposta máxima em todas as localidades, de acordo com o seguinte modelo.

\[
P_i = \sum \limits_{j = 1} ^ n {(y_ {ij} - y _ {. J}) ^ 2 / (2n)}
\]
onde \emph{n} é o número de ambientes. Da mesma forma que o índice de confiança genotípico, o índice de superioridade é calculado por todos os ambientes, para os favoráveis e para os desfavoráveis.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{super \textless{}{-}}\StringTok{ }\KeywordTok{superiority}\NormalTok{(data\_ge, ENV, GEN, GY)}
\NormalTok{super}\OperatorTok{$}\NormalTok{GY}\OperatorTok{$}\NormalTok{index}
\CommentTok{\# \# A tibble: 10 x 8}
\CommentTok{\#    GEN       Y   Pi\_a   R\_a   Pi\_f   R\_f    Pi\_u   R\_u}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 G1     2.60 0.169      5 0.228      4 0.125       6}
\CommentTok{\#  2 G10    2.47 0.344     10 0.475     10 0.245      10}
\CommentTok{\#  3 G2     2.74 0.126      3 0.149      3 0.108       5}
\CommentTok{\#  4 G3     2.96 0.0410     1 0.0723     1 0.0175      2}
\CommentTok{\#  5 G4     2.64 0.173      6 0.289      5 0.0853      4}
\CommentTok{\#  6 G5     2.54 0.240      8 0.382      8 0.133       7}
\CommentTok{\#  7 G6     2.53 0.238      7 0.377      7 0.134       8}
\CommentTok{\#  8 G7     2.74 0.149      4 0.318      6 0.0214      3}
\CommentTok{\#  9 G8     3.00 0.0412     2 0.0882     2 0.00588     1}
\CommentTok{\# 10 G9     2.51 0.291      9 0.390      9 0.217       9}
\end{Highlighting}
\end{Shaded}

\hypertarget{estratificauxe7uxe3o-ambiental}{%
\section{Estratificação ambiental}\label{estratificauxe7uxe3o-ambiental}}

Um método que combina análise de estabilidade e estratificação ambiental usando análise fatorial foi proposto por Murakami and Cruz (\protect\hyperlink{ref-murakami2004}{2004}). Este método é implementado com a função \texttt{ge\_factanal()}\indf{ge\_factanal}, como segue:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fato \textless{}{-}}\StringTok{ }\KeywordTok{ge\_factanal}\NormalTok{(data\_ge, ENV, GEN, REP, GY)}
\KeywordTok{plot}\NormalTok{(fato)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-326-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(fato}\OperatorTok{$}\NormalTok{GY}\OperatorTok{$}\NormalTok{PCA)}
\CommentTok{\# \# A tibble: 14 x 4}
\CommentTok{\#    PCA   Eigenvalues  Variance Cumul\_var}
\CommentTok{\#    \textless{}chr\textgreater{}       \textless{}dbl\textgreater{}     \textless{}dbl\textgreater{}     \textless{}dbl\textgreater{}}
\CommentTok{\#  1 PC1      5.60e+ 0  4.00e+ 1      40.0}
\CommentTok{\#  2 PC2      2.51e+ 0  1.79e+ 1      58.0}
\CommentTok{\#  3 PC3      2.41e+ 0  1.72e+ 1      75.1}
\CommentTok{\#  4 PC4      1.37e+ 0  9.80e+ 0      84.9}
\CommentTok{\#  5 PC5      1.13e+ 0  8.05e+ 0      93.0}
\CommentTok{\#  6 PC6      4.87e{-} 1  3.48e+ 0      96.5}
\CommentTok{\#  7 PC7      3.03e{-} 1  2.16e+ 0      98.6}
\CommentTok{\#  8 PC8      1.29e{-} 1  9.25e{-} 1      99.6}
\CommentTok{\#  9 PC9      6.24e{-} 2  4.46e{-} 1     100  }
\CommentTok{\# 10 PC10     1.72e{-}16  1.23e{-}15     100  }
\CommentTok{\# 11 PC11     1.41e{-}16  1.01e{-}15     100  }
\CommentTok{\# 12 PC12    {-}1.74e{-}16 {-}1.25e{-}15     100  }
\CommentTok{\# 13 PC13    {-}2.67e{-}16 {-}1.91e{-}15     100  }
\CommentTok{\# 14 PC14    {-}3.01e{-}16 {-}2.15e{-}15     100}
\KeywordTok{print}\NormalTok{(fato}\OperatorTok{$}\NormalTok{GY}\OperatorTok{$}\NormalTok{FA)}
\CommentTok{\# \# A tibble: 14 x 8}
\CommentTok{\#    Env        FA1     FA2      FA3     FA4     FA5 Communality Uniquenesses}
\CommentTok{\#    \textless{}chr\textgreater{}    \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}    \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}       \textless{}dbl\textgreater{}        \textless{}dbl\textgreater{}}
\CommentTok{\#  1 E1    {-}0.881    0.327   0.00927 {-}0.0631  0.274        0.963      0.0369 }
\CommentTok{\#  2 E10   {-}0.942   {-}0.158  {-}0.0820   0.113   0.174        0.962      0.0380 }
\CommentTok{\#  3 E11   {-}0.929   {-}0.233  {-}0.0336  {-}0.242   0.110        0.989      0.0111 }
\CommentTok{\#  4 E12   {-}0.848    0.135   0.0263   0.0941  0.241        0.805      0.195  }
\CommentTok{\#  5 E13   {-}0.940    0.108  {-}0.0842  {-}0.0637 {-}0.235        0.961      0.0391 }
\CommentTok{\#  6 E14   {-}0.150   {-}0.123  {-}0.916   {-}0.0872  0.265        0.954      0.0463 }
\CommentTok{\#  7 E2    {-}0.198   {-}0.0521 {-}0.126   {-}0.969   0.0328       0.997      0.00266}
\CommentTok{\#  8 E3    {-}0.0806   0.910   0.341   {-}0.0173 {-}0.110        0.963      0.0370 }
\CommentTok{\#  9 E4     0.209    0.543  {-}0.272   {-}0.728  {-}0.120        0.957      0.0433 }
\CommentTok{\# 10 E5    {-}0.777    0.392  {-}0.269   {-}0.0470 {-}0.267        0.904      0.0963 }
\CommentTok{\# 11 E6    {-}0.524    0.569  {-}0.309   {-}0.174  {-}0.238        0.781      0.219  }
\CommentTok{\# 12 E7    {-}0.244    0.342  {-}0.520    0.297   0.619        0.918      0.0820 }
\CommentTok{\# 13 E8     0.00161 {-}0.0589 {-}0.914   {-}0.226  {-}0.143        0.911      0.0891 }
\CommentTok{\# 14 E9    {-}0.0794  {-}0.291  {-}0.0183  {-}0.0539  0.927        0.954      0.0463}
\KeywordTok{print}\NormalTok{(fato}\OperatorTok{$}\NormalTok{GY}\OperatorTok{$}\NormalTok{env\_strat)}
\CommentTok{\# \# A tibble: 14 x 6}
\CommentTok{\#    Env   Factor  Mean   Min   Max    CV}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}chr\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 E1    FA1     2.52 1.97   2.90 13.3 }
\CommentTok{\#  2 E10   FA1     2.18 1.54   2.57 14.4 }
\CommentTok{\#  3 E11   FA1     1.37 0.899  1.68 16.4 }
\CommentTok{\#  4 E12   FA1     1.61 1.02   2    20.3 }
\CommentTok{\#  5 E13   FA1     2.91 1.83   3.52 16.8 }
\CommentTok{\#  6 E5    FA1     3.91 3.37   4.81 10.7 }
\CommentTok{\#  7 E3    FA2     4.06 3.43   4.57  8.22}
\CommentTok{\#  8 E6    FA2     2.66 2.34   2.98  7.95}
\CommentTok{\#  9 E14   FA3     1.78 1.43   2.06 11.7 }
\CommentTok{\# 10 E8    FA3     2.54 2.05   2.88 10.5 }
\CommentTok{\# 11 E2    FA4     3.18 2.61   3.61  8.25}
\CommentTok{\# 12 E4    FA4     3.68 3.02   4.27 11.5 }
\CommentTok{\# 13 E7    FA5     1.99 1.39   2.55 16.8 }
\CommentTok{\# 14 E9    FA5     3.06 1.94   3.72 15.6}
\end{Highlighting}
\end{Shaded}

A maneira mais fácil de calcular os índices de estabilidade acima mencionados é usando a função \texttt{ge\_stats()}. \indf{ge\_stats}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stat\_ge \textless{}{-}}\StringTok{ }\KeywordTok{ge\_stats}\NormalTok{(data\_ge, ENV, GEN, REP, GY)}
\end{Highlighting}
\end{Shaded}

Se você deseja exportar um resumo dos resultados, a maneira mais simples é usando função \texttt{summary()}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(stat\_ge, }\DataTypeTok{export =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Este comando criará um arquivo de texto chamado \emph{ge\_stats summary.txt } no diretório de trabalho atual.

\hypertarget{o-modelo-ammi}{%
\section{O modelo AMMI}\label{o-modelo-ammi}}

O modelo linear mais simples com efeito de interação usado na análise de EMA é

\[
{y_{ijk}} = {\rm{ }}\mu {\rm{ }} + \mathop \alpha \nolimits_i  + \mathop \tau \nolimits_j  + \mathop {(\alpha \tau )}\nolimits_{ij}  + \mathop \gamma \nolimits_{jk}  + {\rm{ }}\mathop \varepsilon \nolimits_{ijk}
\]

onde \({y_{ijk}}\) é a variável resposta observada no \emph{k}-ésimo bloco do \emph{i}-ésimo genótipo no \emph{j}-ésimo ambiente (\emph{i} = 1, 2, \ldots, \emph{g}; \emph{j} = 1, 2, \ldots, \emph{e}; \emph{k} = 1, 2, \ldots, \emph{b}); \(\mu\) é a média geral; \(\mathop\alpha\nolimits_i\) é o efeito principal do genótipo \emph{i}; \(\mathop \tau \nolimits_j\) é o principal efeito do ambiente \emph{j}; \(\mathop {(\alpha \tau )}\nolimits_{ij}\) é o efeito de interação do genótipo \emph{i} com o ambiente \emph{j}; \(\mathop \gamma \nolimits_{jk}\) é o efeito do bloco \emph{k} no ambiente \emph{j}; e \({\rm{ }}\mathop \varepsilon \nolimits_{ijk}\) é o erro aleatório assumindo \(i.i.d \sim N(0, \sigma^2 )\).

Métodos que combinam diferentes princípios estatísticos ganharam espaço na análise de \indt{EMA} por volta da década 1960, com destaque especial ao estudo de Gollob (\protect\hyperlink{ref-Gollob1968}{1968}), que propôs um método que combina os benefícios da análise de fatores e análise de variância em um único método para estudar a estabilidade \indt{estabilidade}. Naquela época este método era conhecido como FANOVA. Atualmente este mesmo método foi popularizado por Gauch (\protect\hyperlink{ref-Gauch1988}{1988}) com o acrônimo AMMI.

A análise AMMI \indt{AMMI}utiliza análise aditiva de variância aos fatores principais (genótipo e ambiente) e decomposição por valores singulares ao residual do modelo aditivo, isto é, o efeito da interação genótipo-\emph{vs}-ambiente somado ao erro experimental. Esta matriz dos efeitos não aditivos, então, pode ser aproximadamente exibida por meio de biplots \indt{biplots} Gabriel (\protect\hyperlink{ref-Gabriel1971}{1971}). Este método tem ganhado destaque nas últimas décadas, principalmente devido a rápida evolução computacional, o que tornou possível as complexas decomposições de matrizes de alta ordem.

De posse de uma matriz de dupla entrada oriunda de ensaios multiambientes, a estimativa da variável resposta do \emph{i}-ésimo genótipo no \emph{j}-ésimo ambiente é obtida utilizando AMMI \indt{AMMI}de acordo com o seguinte modelo:

\[
{y_{ij}} = \mu  + {\alpha_i} + {\tau_j} + \sum\limits_{k = 1}^k {{\lambda _k}{a_{ik}}} {t_{jk}} + {\rho _{ij}} + {\varepsilon _{ij}}
\]

onde \({\lambda_k}\) é o valor singular para o \emph{k}-ésimo eixo do componente principal; \(a_{ik}\) é o \emph{i}-ésimo elemento do \emph{k}-ésimo autovetor de genótipos; \(t_{jk}\) é o \emph{j}-ésimo elemento do \emph{k}-ésimo autovetor de ambientes. Um resíduo \(\rho _{ij}\) permanece, se todos os \emph{k}-PCAs não são considerados, onde \emph{k} = \(min(G-1; E-1)\).

\hypertarget{ajuste-do-modelo}{%
\subsection{Ajuste do modelo}\label{ajuste-do-modelo}}

O modelo AMMI é ajustado com a função \texttt{performs\_ammi()}\indf{performs\_ammi}. O primeiro argumento é os dados, no nosso exemplo \texttt{data\_ge}. Os próximos argumentos (\texttt{ENV}, \texttt{GEN} e \texttt{REP}) são os nomes das colunas que contém os níveis dos fatores ambiente, genótipo, repetição, respectivamente. No argumento \texttt{resp} são declaradas as variáveis resposta. Uma única variável pode ser analizada (como em nosso exemplo) ou, um vetor de variáveis, usando, por exemplo \texttt{resp\ =\ c(GY,\ HM)}.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{AMMI\_model \textless{}{-}}\StringTok{ }\KeywordTok{performs\_ammi}\NormalTok{(data\_ge, ENV, GEN, REP, GY)}
\CommentTok{\# variable GY }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# AMMI analysis table}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#     Source  Df  Sum Sq Mean Sq F value   Pr(\textgreater{}F) Proportion Accumulated}
\CommentTok{\#        ENV  13 279.574 21.5057   62.33 0.00e+00          .           .}
\CommentTok{\#   REP(ENV)  28   9.662  0.3451    3.57 3.59e{-}08          .           .}
\CommentTok{\#        GEN   9  12.995  1.4439   14.93 2.19e{-}19          .           .}
\CommentTok{\#    GEN:ENV 117  31.220  0.2668    2.76 1.01e{-}11          .           .}
\CommentTok{\#        PC1  21  10.749  0.5119    5.29 0.00e+00       34.4        34.4}
\CommentTok{\#        PC2  19   9.924  0.5223    5.40 0.00e+00       31.8        66.2}
\CommentTok{\#        PC3  17   4.039  0.2376    2.46 1.40e{-}03       12.9        79.2}
\CommentTok{\#        PC4  15   3.074  0.2049    2.12 9.60e{-}03        9.8          89}
\CommentTok{\#        PC5  13   1.446  0.1113    1.15 3.18e{-}01        4.6        93.6}
\CommentTok{\#        PC6  11   0.932  0.0848    0.88 5.61e{-}01          3        96.6}
\CommentTok{\#        PC7   9   0.567  0.0630    0.65 7.53e{-}01        1.8        98.4}
\CommentTok{\#        PC8   7   0.362  0.0518    0.54 8.04e{-}01        1.2        99.6}
\CommentTok{\#        PC9   5   0.126  0.0252    0.26 9.34e{-}01        0.4         100}
\CommentTok{\#  Residuals 252  24.367  0.0967      NA       NA          .           .}
\CommentTok{\#      Total 536 389.036  0.7258      NA       NA       \textless{}NA\textgreater{}        \textless{}NA\textgreater{}}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# All variables with significant (p \textless{} 0.05) genotype{-}vs{-}environment interaction}
\CommentTok{\# Done!}
\end{Highlighting}
\end{Shaded}

\indt{Dicas}
\begin{dica}
Note que os argumentos inseridos na função obedecem a ordem dos argumentos requiridos na função {[}veja \texttt{args(waas)}{]}. Se obedecida esta ordem de avaliação, não é necessário declarar qual argumento está sendo inserido. Por exemplo, se mudássemos a ordem de entrada, teríamos um código semelhante a \texttt{waas(data\_ge,\ gen\ =\ GEN,\ env\ =\ \ ENV,\ REP,\ resp\ =\ c(PH,\ ED,\ TKW,\ NKR))}.
\end{dica}

\hypertarget{analise-residual}{%
\subsection{Analise residual}\label{analise-residual}}

O pacote \texttt{metan} conta com uma opção para análise residual do modelo AMMI ajustado. Gráficos podem ser obtidos utilizando o seguinte comando.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(AMMI\_model)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-331-1} \end{center}

A figura acima, obtida com a função \texttt{autoplot()}, mostra 4 gráficos. Os dois primeiros são os mais importantes. O primeiro (\emph{Residual vs fitted}) pode ser utilizado para identificar a homogeneidade das variâncias. Uma distribuição aleatória dos pontos no gráfico deve ser observada. Quando um padrão de distibuição é observado --como, por exemplo, a distribuição dos pontos em forma de funil-- uma investigação deve ser realizada, pois este padrão indica a possiblidade de heterogeneidade das variâncias. O segundo gráfico (\emph{Normal Q-Q}) nos informa quanto a normalidade dos resíduos, ou seja, é desejado que os pontos sejam distribuídos ao redor da linha diagonal.

\hypertarget{escolha-do-nuxfamero-de-termos-multiplicativos}{%
\subsection{Escolha do número de termos multiplicativos}\label{escolha-do-nuxfamero-de-termos-multiplicativos}}

Conforme já discutido, a análise AMMI \indt{AMMI}aplica a técnica de decomposição por valores singulares na matriz dos efeitos não aditivos do modelo (\textbf{\emph{A}}). Logo, esta matriz pode ser aproximada pela pelo seguinte modelo: \(A = U \lambda V^T\), onde onde \textbf{U} é uma matriz \emph{g} \(\times\) \emph{e} contendo os vetores singulares de \(AA^T\) e formam a base ortonormal para os efeitos de genótipos; \(V^T\) é uma matriz \emph{e} \(\times\) \emph{e} que contém os vetores singulares de \(\mathbf{A^TA}\) e formam a base ortonormal para os efeitos de ambientes; e \(\lambda\) é uma matriz diagonal \emph{e} \(\times\) \emph{e} contendo \emph{k}-valores singulares de \(A^TA\) , onde \emph{k} = \(min(G-1; E-1)\). Assim, diferentes modelos (dependendo do número de termos multiplicativos utilizados) podem ser utilziados para predizer o rendimento do genótipo \emph{i} no ambiente \emph{j}. A tabela abaixo mostra os possíveis modelos. No modelo AMMI0 apenas os efeitos aditivos são considerados. No modelo AMMI1, o primeiro termo multiplicativo é considerado, e assim por diante, até o modelo AMMIF, onde \(min(G-1;E-1)\) termos são considerados.

\begin{longtable}[]{@{}ll@{}}
\toprule
\begin{minipage}[b]{0.17\columnwidth}\raggedright
Família AMMI\strut
\end{minipage} & \begin{minipage}[b]{0.77\columnwidth}\raggedright
Resposta esperado do genótipo \emph{i} no ambiente \emph{j}\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.17\columnwidth}\raggedright
AMMI0\strut
\end{minipage} & \begin{minipage}[t]{0.77\columnwidth}\raggedright
\(\hat{y}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..}\)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\raggedright
AMMI1\strut
\end{minipage} & \begin{minipage}[t]{0.77\columnwidth}\raggedright
\(\hat{y}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..} +\lambda_1 a_{i1}t_{j1}\)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\raggedright
AMMI2\strut
\end{minipage} & \begin{minipage}[t]{0.77\columnwidth}\raggedright
\(\hat{y}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..} +\lambda_1 a_{i1}t_{j1}+\lambda_2 a_{i2}t_{j2}\)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\raggedright
\ldots{}\strut
\end{minipage} & \begin{minipage}[t]{0.77\columnwidth}\raggedright
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\raggedright
AMMIF\strut
\end{minipage} & \begin{minipage}[t]{0.77\columnwidth}\raggedright
\(\hat{y}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..} +\lambda_1 a_{i1}t_{j1}+\lambda_2 a_{i2}t_{j2}+...+\lambda_p a_{ip}t_{jp}\)\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

A escolha do número de termos multiplicativos a ser utilizado é baseada em basicamente dois critérios de sucesso de análise: \textbf{Postdiscritive sucess} e \textbf{Predictive sucess}. Por definição, \textbf{Predictive sucess} significa literalmente a afirmação prévia do que acontecerá em algum momento futuro. Neste contexto, testes de validação cruzada (cross-validation) podem ser utilizadas para avaliar o sucesso preditivo dos membros de modelos da familia AMMI (Tiago Olivoto, Lúcio, et al. \protect\hyperlink{ref-Olivoto2019}{2019}\protect\hyperlink{ref-Olivoto2019}{a}). Por outro lado, \textbf{Postdiscritive sucess} significa fazer uma afirmação ou dedução sobre algo que aconteceu no passado. Na escolha do número de termos multiplicativos da análise AMMI \indt{AMMI}este sucesso pode ser calculado utilizando testes como o proposto por Gollob (\protect\hyperlink{ref-Gollob1968}{1968}).

\hypertarget{postdiscritive-sucess}{%
\subsubsection{Postdiscritive sucess}\label{postdiscritive-sucess}}

\indt{postdiscritive sucess}

No objeto \texttt{anova} \indt{ANOVA} gerado pela função \texttt{waas()} \indf{waas} testes de hipóteses são realizados e probabilidades de erro são atribuídas para cada modelo considerando a distribuição de graus de liberdade proposto por Gollob (\protect\hyperlink{ref-Gollob1968}{1968}). Assim é possível identificar qual é o número ideal de termos a ser considerado na predição. Em nosso exemplo, dois termos foram significativos a 5\% de probabilidade de erro.

\hypertarget{predictive-sucess}{%
\subsubsection{Predictive sucess}\label{predictive-sucess}}

\indt{predictive sucess}

O pacote \texttt{metan} fornece uma solução completa para validaçao cruzada do modelo AMMI. Utilizando a função \texttt{cv\_ammif()} \indf{cv\_ammif}, por exemplo, é possível realizar um teste de \emph{cross-validation} para a família de modelos AMMI \indt{AMMI}(AMMI0-AMMIF) usando dados com repetições. Automaticamente, a primeira validação é realizada considerando a AMMIF (todos possíveis IPCAs são usados). Considerando esse modelo, o conjunto de dados original é dividido em dois conjuntos de dados: dados de modelagem e dados de validação. O conjunto de dados ``modelagem'' possui todas as combinações (genótipo \emph{vs} ambiente) com R-1 repetições. O conjunto de dados ``validação'' tem uma repetição. O diagrama abaixo representa o procedimento realizado.

A divisão do conjunto de dados em dados de modelagem e validação depende do design informado. Considerando um delineamento de blocos completos casualizados (DBC)\index{DBC}, blocos completos são aleatoriamente selecionados dentro de ambientes, como mostrado por Tiago Olivoto, Lúcio, et al. (\protect\hyperlink{ref-Olivoto2019}{2019}\protect\hyperlink{ref-Olivoto2019}{a}). O bloco restante serve dados de validação. Se \texttt{design\ =\ "CRD"} for informado, assim declarando que um delineamento intericamente casualizado (DIC) \index{DIC} foi usado, observações são aleatoriamente selecionadas para cada tratamento (combinação genótipo-\emph{vs}-ambiente). Este é o mesmo procedimento sugerido por Gauch (\protect\hyperlink{ref-Gauch1988}{1988}). Os valores estimados para o membro da família AMMI \index{AMMI}em estudo são então comparados com os dados de ``validação'' e um erro de predição \(\hat{z}_{ij}\) é estimado para cada tratamento. A raiz quadrada do quadrado médio da diferença de predição (RMSPD) é calculado. Este procedimento é repetido \emph{n} vezes, utilizando o argumento \texttt{nboot\ =\ n}. Ao final do procedimento, o algorítimo armazena as \emph{n} estimativas do RMSPD para o modelo em questão, e um novo modelo é então testado seguindo os mesmos passos.

Como exemplo, a função \texttt{cv\_ammi()}\indf{cv\_ammi} é usada para calcular um procedimento de validação cruzada para os modelos AMMI0, AMMI2 e AMMIF (9 eixos).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{AMMI0 \textless{}{-}}\StringTok{ }\KeywordTok{cv\_ammi}\NormalTok{(data\_ge, ENV, GEN, REP, GY, }\DataTypeTok{naxis =} \DecValTok{0}\NormalTok{) }\CommentTok{\# AMMI0}
\NormalTok{AMMI2 \textless{}{-}}\StringTok{ }\KeywordTok{cv\_ammi}\NormalTok{(data\_ge, ENV, GEN, REP, GY, }\DataTypeTok{naxis =} \DecValTok{2}\NormalTok{) }\CommentTok{\# AMMI2}
\NormalTok{AMMI9 \textless{}{-}}\StringTok{ }\KeywordTok{cv\_ammi}\NormalTok{(data\_ge, ENV, GEN, REP, GY, }\DataTypeTok{naxis =} \DecValTok{9}\NormalTok{) }\CommentTok{\# AMMIF}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{AMMI0 para AMMIF}
  A função \texttt{cv\_ammif()}\indf{cv\_ammif} é usada para calcular um procedimento de validação cruzada para todos os membros do modelo da família AMMI. Nesse caso, AMMI0-AMMI9.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{AMMIF \textless{}{-}}\StringTok{ }\KeywordTok{cv\_ammif}\NormalTok{(data\_ge, ENV, GEN, REP, GY)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  \textbf{Validação cruzada para previsão de BLUP}
  A função \texttt{cv\_blup\ ()} fornece uma validação cruzada de dados baseados em replicação usando modelos mistos. Por padrão, blocos completos são selecionados aleatoriamente para cada ambiente. Usando o argumento `random ', é possível escolher os efeitos aleatórios do modelo, como mostrado abaixo.
\item
  \textbf{Genótipo e genótipo versus ambiente como efeitos aleatórios}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{BLUP\_g \textless{}{-}}\StringTok{ }\KeywordTok{cv\_blup}\NormalTok{(dados\_ge, ENV, GEN, REP, GY, }\DataTypeTok{random =} \StringTok{"gen"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Ambiente, replicação dentro do ambiente e interação como efeitos aleatórios}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{BLUP\_e \textless{}{-}}\StringTok{ }\KeywordTok{cv\_blup}\NormalTok{(dados\_ge, ENV, GEN, REP, GY, }\DataTypeTok{random =} \StringTok{"env"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Um modelo aleatório (todos os termos como efeitos aleatórios)}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{BLUP\_ge \textless{}{-}}\StringTok{ }\KeywordTok{cv\_blup}\NormalTok{(dados\_ge, ENV, GEN, REP, GY, }\DataTypeTok{random =} \StringTok{"all"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{imprimindo-os-meios-das-estimativas-rmspd}{%
\section{Imprimindo os meios das estimativas RMSPD}\label{imprimindo-os-meios-das-estimativas-rmspd}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bind\_mod \textless{}{-}}\StringTok{ }\KeywordTok{bind\_cv}\NormalTok{(AMMIF, BLUP\_g, }\DataTypeTok{bind =} \StringTok{"means"}\NormalTok{)}
\KeywordTok{print}\NormalTok{(bind\_mod}\OperatorTok{$}\NormalTok{RMSPD)}
\CommentTok{\# \# A tibble: 11 x 6}
\CommentTok{\#    MODEL        mean     sd      se  Q2.5 Q97.5}
\CommentTok{\#    \textless{}fct\textgreater{}       \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 BLUP\_g\_RCBD 0.405 0.0249 0.00176 0.357 0.453}
\CommentTok{\#  2 AMMI2       0.411 0.0242 0.00171 0.369 0.460}
\CommentTok{\#  3 AMMI4       0.416 0.0234 0.00166 0.373 0.462}
\CommentTok{\#  4 AMMI3       0.416 0.0215 0.00152 0.377 0.457}
\CommentTok{\#  5 AMMI5       0.422 0.0232 0.00164 0.377 0.464}
\CommentTok{\#  6 AMMI6       0.422 0.0219 0.00155 0.381 0.462}
\CommentTok{\#  7 AMMI7       0.425 0.0199 0.00141 0.381 0.458}
\CommentTok{\#  8 AMMI8       0.427 0.0204 0.00145 0.387 0.462}
\CommentTok{\#  9 AMMIF       0.429 0.0213 0.00150 0.390 0.469}
\CommentTok{\# 10 AMMI1       0.430 0.0251 0.00178 0.384 0.479}
\CommentTok{\# 11 AMMI0       0.430 0.0283 0.00200 0.370 0.485}
\end{Highlighting}
\end{Shaded}

A tabela acima mostra as estatísticas descritivas (média, desvio padrão, erro padrão da média e quantis 2,5\% e 97,5\%) das 100 estimativas RMSPD para cada modelo, e são apresentadas a partir do modelo mais preciso (menor média RMSPD) para o modelo menos preciso (maior média RMSPD).

\hypertarget{plotagem-dos-valores-rmspd}{%
\section{Plotagem dos valores RMSPD}\label{plotagem-dos-valores-rmspd}}

Os valores das estimativas RMSPD obtidas no processo de validação cruzada podem ser plotados usando a função \texttt{plot\ ()}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(metan)}
\NormalTok{bind1 \textless{}{-}}\StringTok{ }\KeywordTok{bind\_cv}\NormalTok{(AMMI0, AMMI2, AMMI9)}
\NormalTok{bind2 \textless{}{-}}\StringTok{ }\KeywordTok{bind\_cv}\NormalTok{ (AMMIF, BLUP\_g, BLUP\_e, BLUP\_ge)}
\NormalTok{a \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(bind1, }\DataTypeTok{violino =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{b \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(bind2,}
          \DataTypeTok{width.boxplot =} \FloatTok{0.6}\NormalTok{,}
          \DataTypeTok{order\_box =} \OtherTok{TRUE}\NormalTok{,}
          \DataTypeTok{plot\_theme =} \KeywordTok{theme\_metan\_minimal}\NormalTok{ ())}
\KeywordTok{arrange\_ggplot}\NormalTok{(a, b, }\DataTypeTok{tag\_levels =} \KeywordTok{list}\NormalTok{(letters[}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\includegraphics{html_r_files/figure-latex/unnamed-chunk-339-1}

Seis estatísticas são mostradas neste boxplot. A média (losango preto), a mediana (linha preta), as dobradiças inferior e superior que correspondem ao primeiro e terceiro quartis (percentis 25 e 75, respectivamente). O bigode superior se estende da dobradiça até o maior valor não mais que \(1,5 \times {IQR}\) a partir da dobradiça (em que IQR é o intervalo entre quartis). O bigode mais baixo se estende da dobradiça ao menor valor, no máximo \(1,5 \times {IQR}\) da dobradiça. Dados além do final dos bigodes são considerados pontos extremos. Se a condição \texttt{violin\ =\ TRUE}, uma plotagem de violino é adicionada junto com o boxplot. Um gráfico de violino é uma exibição compacta de uma distribuição contínua exibida da mesma maneira que um gráfico de caixa.

\hypertarget{valores-estimados-pelo-modelo-ammi}{%
\subsection{Valores estimados pelo modelo AMMI}\label{valores-estimados-pelo-modelo-ammi}}

Em nosso exemplo, o modelo AMMI2 foi o que apresentou o menor RMSPD, sendo então o mais indicado para estimar a variável GY. A estimativa considerando dois termos multiplicativos pode realizada utilizando a função \texttt{predict()}, tendo como argumentos o modelo AMMI ajustado (\texttt{AMMI\_model}) e o número de termos multiplicativos considerados na estimação (\texttt{naxis}). \indf{predict}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{predicted \textless{}{-}}\StringTok{ }\KeywordTok{predict}\NormalTok{(AMMI\_model, }\DataTypeTok{naxis =} \DecValTok{2}\NormalTok{)}
\NormalTok{predicted}\OperatorTok{$}\NormalTok{GY}
\CommentTok{\# \# A tibble: 140 x 8}
\CommentTok{\#    ENV   GEN       Y RESIDUAL Ypred ResAMMI[,1] YpredAMMI[,1] AMMI0}
\CommentTok{\#    \textless{}fct\textgreater{} \textless{}fct\textgreater{} \textless{}dbl\textgreater{}    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}       \textless{}dbl\textgreater{}         \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 E1    G1     2.37  {-}0.0843  2.45     0.0693           2.52  2.45}
\CommentTok{\#  2 E1    G10    1.97  {-}0.344   2.32    {-}0.360            1.96  2.32}
\CommentTok{\#  3 E1    G2     2.90   0.311   2.59     0.0735           2.66  2.59}
\CommentTok{\#  4 E1    G3     2.89   0.0868  2.80    {-}0.00963          2.79  2.80}
\CommentTok{\#  5 E1    G4     2.59   0.100   2.49     0.0144           2.50  2.49}
\CommentTok{\#  6 E1    G5     2.19  {-}0.196   2.38    {-}0.0317           2.35  2.38}
\CommentTok{\#  7 E1    G6     2.30  {-}0.0797  2.38     0.0238           2.40  2.38}
\CommentTok{\#  8 E1    G7     2.77   0.186   2.59     0.186            2.77  2.59}
\CommentTok{\#  9 E1    G8     2.90   0.0493  2.85     0.0852           2.94  2.85}
\CommentTok{\# 10 E1    G9     2.33  {-}0.0307  2.36    {-}0.0515           2.31  2.36}
\CommentTok{\# \# ... with 130 more rows}
\end{Highlighting}
\end{Shaded}

As seguintes variáveis são retornadas: \textbf{ENV} é o ambiente; \textbf{GEN} é o genótipo; \textbf{Y} é o valor observado; \textbf{resOLS} é o residual (\(\hat{z}_{ij}\)) estimado pelos Mínimos Quadrados Ordinários, onde \(\hat{z}_{ij} = y_{ij} - \bar{y}_{i.} - \bar{y}_{.j} + \bar{y}_{..}\); \textbf{Ypred} é o valor estimado pelos mínimos quadrados ordinários (\(\hat{y}_{ij} = y_{ij} -\hat{z}_{ij}\)); \textbf{ResAMMI} é o residual estimado pelo modelo AMMI \index{AMMI}(\(\hat{a}_{ij}\)) considerando o número de termos multiplicativos informado na função (neste caso 2), onde \(\hat{a}_{ij} = \lambda_1a_{i1}t_{j1}\); \textbf{YpredAMMI} é o valor estimado pelo modelo AMMI \(\hat{ya}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..}+\hat{a}_{ij}\); e \textbf{AMMI0} é o valor estimado quando nenhum termo multiplicativo é usado, ou seja, \(\hat{y}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..}\).

\hypertarget{uxedndices-de-estabilidade-baseados-em-ammi}{%
\subsection{Índices de estabilidade baseados em AMMI}\label{uxedndices-de-estabilidade-baseados-em-ammi}}

(Tiago Olivoto, Lúcio, et al. \protect\hyperlink{ref-Olivoto2019}{2019}\protect\hyperlink{ref-Olivoto2019}{a}) demonstraram que a média ponderada dos escores absolutos (WAAS, \textbf{W}eighted \textbf{A}verage of \textbf{A}bsolute \textbf{S}cores), pode ser utilizada como um índice quantitativo de estabilidade na análise AMMI. Utilizando a função \texttt{get\_model\_data()} é possível obter facilmente este índice para diversas variáveis com poucas linhas de código. Veja o exemplo abaixo, com quatro variáveis. Este índice também é computado em uma estrutura de modelo misto. \protect\hyperlink{wsb}{Veja o exemplo aqui}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{waas}\NormalTok{(data\_ge2, ENV, GEN, REP,}
     \DataTypeTok{resp =} \KeywordTok{c}\NormalTok{(PH, ED, TKW, NKR)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{ }\KeywordTok{get\_model\_data}\NormalTok{(}\DataTypeTok{what =} \StringTok{"WAAS"}\NormalTok{)}
\CommentTok{\# variable PH }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# AMMI analysis table}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#     Source  Df Sum Sq Mean Sq F value   Pr(\textgreater{}F) Proportion Accumulated}
\CommentTok{\#        ENV   3  7.719  2.5728 127.913 4.25e{-}07          .           .}
\CommentTok{\#   REP(ENV)   8  0.161  0.0201   0.897 5.22e{-}01          .           .}
\CommentTok{\#        GEN  12  1.865  0.1554   6.929 6.89e{-}09          .           .}
\CommentTok{\#    GEN:ENV  36  5.397  0.1499   6.686 5.01e{-}14          .           .}
\CommentTok{\#        PC1  14  4.466  0.3190  14.230 0.00e+00       82.8        82.8}
\CommentTok{\#        PC2  12  0.653  0.0545   2.430 8.40e{-}03       12.1        94.9}
\CommentTok{\#        PC3  10  0.277  0.0277   1.240 2.76e{-}01        5.1         100}
\CommentTok{\#  Residuals  96  2.153  0.0224      NA       NA          .           .}
\CommentTok{\#      Total 191 22.692  0.1188      NA       NA       \textless{}NA\textgreater{}        \textless{}NA\textgreater{}}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# variable ED }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# AMMI analysis table}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#     Source  Df Sum Sq Mean Sq F value   Pr(\textgreater{}F) Proportion Accumulated}
\CommentTok{\#        ENV   3  306.0  101.99  43.386 2.70e{-}05          .           .}
\CommentTok{\#   REP(ENV)   8   18.8    2.35   0.906 5.15e{-}01          .           .}
\CommentTok{\#        GEN  12  212.9   17.74   6.838 8.95e{-}09          .           .}
\CommentTok{\#    GEN:ENV  36  398.2   11.06   4.263 7.60e{-}09          .           .}
\CommentTok{\#        PC1  14  212.2   15.16   5.840 0.00e+00       53.3        53.3}
\CommentTok{\#        PC2  12  134.7   11.23   4.330 0.00e+00       33.8        87.1}
\CommentTok{\#        PC3  10   51.3    5.13   1.980 4.38e{-}02       12.9         100}
\CommentTok{\#  Residuals  96  249.1    2.59      NA       NA          .           .}
\CommentTok{\#      Total 191 1583.2    8.29      NA       NA       \textless{}NA\textgreater{}        \textless{}NA\textgreater{}}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# variable TKW }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# AMMI analysis table}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#     Source  Df Sum Sq Mean Sq F value   Pr(\textgreater{}F) Proportion Accumulated}
\CommentTok{\#        ENV   3  37013   12338   11.13 3.16e{-}03          .           .}
\CommentTok{\#   REP(ENV)   8   8869    1109    1.21 3.03e{-}01          .           .}
\CommentTok{\#        GEN  12  44633    3719    4.05 4.41e{-}05          .           .}
\CommentTok{\#    GEN:ENV  36 164572    4571    4.98 1.73e{-}10          .           .}
\CommentTok{\#        PC1  14 104276    7448    8.11 0.00e+00       63.4        63.4}
\CommentTok{\#        PC2  12  33361    2780    3.03 1.20e{-}03       20.3        83.6}
\CommentTok{\#        PC3  10  26935    2694    2.93 3.00e{-}03       16.4         100}
\CommentTok{\#  Residuals  96  88171     918      NA       NA          .           .}
\CommentTok{\#      Total 191 507829    2659      NA       NA       \textless{}NA\textgreater{}        \textless{}NA\textgreater{}}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# variable NKR }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# AMMI analysis table}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#     Source  Df Sum Sq Mean Sq F value   Pr(\textgreater{}F) Proportion Accumulated}
\CommentTok{\#        ENV   3  237.0   79.01  15.843 0.000997          .           .}
\CommentTok{\#   REP(ENV)   8   39.9    4.99   0.635 0.746348          .           .}
\CommentTok{\#        GEN  12  227.8   18.99   2.418 0.008726          .           .}
\CommentTok{\#    GEN:ENV  36  602.7   16.74   2.132 0.001839          .           .}
\CommentTok{\#        PC1  14  337.4   24.10   3.070 0.000600         56          56}
\CommentTok{\#        PC2  12  192.2   16.02   2.040 0.028500       31.9        87.9}
\CommentTok{\#        PC3  10   73.1    7.31   0.930 0.509500       12.1         100}
\CommentTok{\#  Residuals  96  753.7    7.85      NA       NA          .           .}
\CommentTok{\#      Total 191 2463.8   12.90      NA       NA       \textless{}NA\textgreater{}        \textless{}NA\textgreater{}}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# All variables with significant (p \textless{} 0.05) genotype{-}vs{-}environment interaction}
\CommentTok{\# Done!}
\CommentTok{\# Class of the model: waas}
\CommentTok{\# Variable extracted: WAAS}
\CommentTok{\# \# A tibble: 13 x 5}
\CommentTok{\#    GEN      PH    ED   TKW   NKR}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 H1    0.318 0.667 2.72  0.929}
\CommentTok{\#  2 H10   0.230 0.973 2.15  0.506}
\CommentTok{\#  3 H11   0.201 0.649 1.26  0.836}
\CommentTok{\#  4 H12   0.364 0.315 0.558 0.228}
\CommentTok{\#  5 H13   0.363 0.838 0.514 0.946}
\CommentTok{\#  6 H2    0.342 1.08  4.41  0.404}
\CommentTok{\#  7 H3    0.374 0.486 4.10  0.252}
\CommentTok{\#  8 H4    0.294 0.378 3.07  0.281}
\CommentTok{\#  9 H5    0.168 0.567 0.738 0.611}
\CommentTok{\# 10 H6    0.270 0.409 1.64  1.60 }
\CommentTok{\# 11 H7    0.228 0.384 3.44  0.518}
\CommentTok{\# 12 H8    0.315 0.653 4.91  0.941}
\CommentTok{\# 13 H9    0.146 0.907 5.50  0.888}
\end{Highlighting}
\end{Shaded}

Além do índice WAAS mostrado acima, os seguintes índices de estabilidade baseados em AMMI podem ser calculados usando a função \texttt{AMMI\_indexes()}:

\begin{itemize}
\tightlist
\item
  \textbf{AMMI stability value, ASV, (Purchase, Hatting, and Deventer \protect\hyperlink{ref-Purchase2000}{2000}).}
\end{itemize}

\[
ASV = \sqrt {{{\left[ {\frac{{IPCA{1_{ss}}}}{{IPCA{2_{ss}}}} \times \left( {IPCA{1_{score}}} \right)} \right]}^2} + {{\left( {IPCA{2_{score}}} \right)}^2}}
\]

\begin{itemize}
\tightlist
\item
  \textbf{Soma dos valores absolutos dos escores IPCA, SIPC}
\end{itemize}

\[
SIP{C_i} = \sum\nolimits_{k = 1}^P {\left| {\mathop {\lambda }\nolimits_k^{0.5} {a_{ik}}} \right|}
\]

\begin{itemize}
\tightlist
\item
  \textbf{Média dos autovetores elevados ao quadrado, EV}
\end{itemize}

\[
E{V_i} = \sum\nolimits_{k = 1}^P {\mathop a\nolimits_{ik}^2 } /P
\]

descritos por Sneller, Kilgore-Norquest, and Dombek (\protect\hyperlink{ref-Sneller1997}{1997}), onde \emph{P} é o número de IPCA retido por meio de testes F

\begin{itemize}
\tightlist
\item
  \textbf{valor absoluto da contribuição relativa dos IPCAs para a interação (Zali et al. \protect\hyperlink{ref-Zali2012}{2012}).}
\end{itemize}

\[
Z{a_i} = \sum\nolimits_{k = 1}^P {{\theta _k}{a_{ik}}}
\]

Onde \({\theta _k}\) é o percentual da soma de quadrados explicada pelo \emph{k} -ésimo IPCA. índices de selecção simultâneas (SSI) são calculados pela soma dos ranques dos índices Za ASV, SIPC e EV e o ranque da variável dependente (Farshadfar \protect\hyperlink{ref-Farshadfar2008}{2008}) que resulta em ssiASV, ssiSIPC, ssiEV, e ssiZa, respectivamente.

A função \texttt{AMMI\_index\ ()} tem dois argumentos. O primeiro (x) é o modelo, que deve ser um objeto da classe \texttt{waas}. O segundo, (order.y) é a ordem para a variável resposta. Por padrão, ele é definido como nulo, o que significa que a variável resposta é ordenada em ordem decrescente. Se \texttt{x} é uma lista com mais de uma variável, então \texttt{order.y} deve ser um vetor com o mesmo comprimento de x. Cada elemento do vetor deve ser um dos ``h'' ou ``l''. Se ``h'' for usado, a variável resposta será ordenada em ordem decrescente. Se ``l'' for usado, a variável resposta será ordenada em ordem crescente da média dos genótipos. Usando o operador \emph{\%\textgreater\% } é possível estruturar uma sequência lógica de operações. Vamos construir esse modelo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stab\_indexes \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{data\_ge }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{waas}\NormalTok{(ENV, GEN, REP, GY, }\DataTypeTok{verbose =} \OtherTok{FALSE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{AMMI\_indexes}\NormalTok{()}
\KeywordTok{print}\NormalTok{(stab\_indexes)}
\CommentTok{\# Variable GY }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# AMMI{-}based stability indexes}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# \# A tibble: 10 x 7}
\CommentTok{\#    GEN       Y   ASV  SIPC     EV     ZA  WAAS}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 G1     2.60 0.346 0.463 0.0149 0.100  0.151}
\CommentTok{\#  2 G10    2.47 1.23  2.07  0.210  0.437  0.652}
\CommentTok{\#  3 G2     2.74 0.249 1.54  0.179  0.216  0.283}
\CommentTok{\#  4 G3     2.96 0.113 0.552 0.0207 0.0797 0.106}
\CommentTok{\#  5 G4     2.64 0.594 1.04  0.0521 0.219  0.326}
\CommentTok{\#  6 G5     2.54 0.430 0.997 0.0433 0.186  0.270}
\CommentTok{\#  7 G6     2.53 0.265 1.14  0.0911 0.172  0.233}
\CommentTok{\#  8 G7     2.74 0.663 1.79  0.191  0.303  0.428}
\CommentTok{\#  9 G8     3.00 0.574 1.18  0.0669 0.225  0.327}
\CommentTok{\# 10 G9     2.51 0.983 1.50  0.131  0.336  0.507}
\end{Highlighting}
\end{Shaded}

\hypertarget{biplots}{%
\subsection{Biplots}\label{biplots}}

O pacote \texttt{metan} conta com gráficos gerados pelo pacote \textbf{ggplot2}, o que lhe confere um alto nível de personalização. A função utilizada para obtenção dos diferentes tipos de biplots será a \texttt{plot\_scores()}. \indf{plot\_scores}Para maiores detalhes veja \texttt{?plot\_.\_scores}.

\hypertarget{biplot-tipo-2-gy-x-pc1}{%
\subsubsection{Biplot tipo 2: GY x PC1}\label{biplot-tipo-2-gy-x-pc1}}

O biplot conhecido como \textbf{AMMI1} é confeccionado utilizando o argumento \texttt{type\ =\ 2} na função \texttt{plot\_scores()}. O biplot \textbf{AMMI1} é utilizado para identificar tanto a estabilidade quando a produtividade dos genótipos. Neste tipo de biplot, os genótipos com escores do PC1 próximos de zero e à direita da linha vertical, são considerados os mais estáveis e com rendimento superior a média geral.\indf{plot\_scores}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p3 \textless{}{-}}\KeywordTok{plot\_scores}\NormalTok{(AMMI\_model)}
\NormalTok{p4 \textless{}{-}}\KeywordTok{plot\_scores}\NormalTok{(AMMI\_model,}
                 \DataTypeTok{col.segm.env =} \StringTok{"transparent"}\NormalTok{) }\OperatorTok{+}
\StringTok{                 }\KeywordTok{theme\_gray}\NormalTok{() }\OperatorTok{+}
\StringTok{                 }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{),}
                       \DataTypeTok{legend.background =} \KeywordTok{element\_rect}\NormalTok{(}\DataTypeTok{fill =} \OtherTok{NA}\NormalTok{))}

\KeywordTok{arrange\_ggplot}\NormalTok{(p3, p4, }\DataTypeTok{tag\_levels =} \KeywordTok{list}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"p3"}\NormalTok{,}\StringTok{"p4"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-343-1} 

}

\caption{Biplot AMMI1 gerado pelo pacote metan}\label{fig:unnamed-chunk-343}
\end{figure}

\hypertarget{biplot-tipo-1-ipca1-x-ipca2}{%
\subsubsection{biplot tipo 1: IPCA1 x IPCA2}\label{biplot-tipo-1-ipca1-x-ipca2}}

O biplot conhecido como \textbf{AMMI2} é confeccionado utilizando o argumento \texttt{type\ =\ 1} (padrão) na função \texttt{plot\_scores()}. O biplot \textbf{AMMI2} representa os dois primeiros IPCAs oriundos da decomposição por valor singular da matriz dos efeitos da interação e é utilizado para realizar inferências quanto aos padrões da interação genótipo \emph{vs} ambiente. Neste caso, os dois primeiros IPCAs explicam 66.2\% da da soma de quadrados da interação.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{p1 \textless{}{-}}\KeywordTok{plot\_scores}\NormalTok{(AMMI\_model, }\DataTypeTok{type =} \DecValTok{2}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\KeywordTok{plot\_scores}\NormalTok{(AMMI\_model,}
                 \DataTypeTok{type =} \DecValTok{2}\NormalTok{,}
                 \DataTypeTok{polygon =} \OtherTok{TRUE}\NormalTok{,}
                 \DataTypeTok{col.gen =} \StringTok{"black"}\NormalTok{,}
                 \DataTypeTok{col.env =} \StringTok{"gray70"}\NormalTok{,}
                 \DataTypeTok{col.segm.env =} \StringTok{"gray70"}\NormalTok{,}
                 \DataTypeTok{axis.expand =} \FloatTok{1.5}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2, }\DataTypeTok{tag\_levels =} \KeywordTok{list}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"p1"}\NormalTok{,}\StringTok{"p2"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-344-1} 

}

\caption{Biplot AMMI2, gerado pelo pacote metan}\label{fig:unnamed-chunk-344}
\end{figure}

\hypertarget{rendimento-nominal-x-ipca1}{%
\subsubsection{Rendimento nominal x IPCA1}\label{rendimento-nominal-x-ipca1}}

Com o objetivo de identificar possíveis mega-ambientes, bem como visualizar o padrão \emph{which-won-where} do conjunto de dados, um gráfico com o rendimento nominal (\(\mathop {\hat y} \nolimits_ {ij}^*\) ) em função dos escores PCA1 dos ambientes é também confecionado pela função \texttt{plot\_scores()} utilizando o argumento \texttt{type\ =\ 4}. Neste gráfico, cada genótipo é representado por uma linha reta com a equação \(\hat y_{ij}^* = \mu_i + PCA1_i \times PCA1_j\) , onde \(\hat y_{ij}^*\) é o rendimento nominal para o genótipo \emph{i} no ambiente \emph{J}; \(\mu\) é a média geral do genótipo \emph{i}; \(PC{1_i}\) é o escore PCA1 do genótipo \emph{i} e \(PC{1_j}\) é o escore PCA1 do ambiente \emph{j}. O genótipo vencedor em um determinado ambiente possui o maior rendimento nominal nesse ambiente.\indf{plot\_scores}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot\_scores}\NormalTok{(AMMI\_model,}
            \DataTypeTok{type =} \DecValTok{4}\NormalTok{,}
            \DataTypeTok{size.tex.pa =} \DecValTok{2}\NormalTok{,}
            \DataTypeTok{x.lab =} \StringTok{"Rendimento nominal (Mg/ha)"}\NormalTok{,}
            \DataTypeTok{y.lab =} \StringTok{"Escore dos ambientes no PCA1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-345-1} 

}

\caption{Gráfico do tipo 'which-won-where' baseado no modelo AMMI}\label{fig:unnamed-chunk-345}
\end{figure}

\hypertarget{o-modelo-gge}{%
\section{O modelo GGE}\label{o-modelo-gge}}

\indt{GGE}

O modelo GGE (Genotype plus Genotype-vs-Environment interaction) tem sido amplamente utilizado para avaliação de genótipos e identificação de mega-ambientes em ensaios multi-ambientais (MET). Este modelo considera um biplot que é construído pelos dois primeiros componentes principais (PC1 e PC2) derivados da decomposição por valores singulares de dados oriundos de um MET centrados no ambiente (Yan et al. \protect\hyperlink{ref-Yan2007}{2007}).

Comunmente, o rendimento médio do genótipo \emph{i} no ambiente \emph{j} é descrito pelo seguinte modelo linear geral, ignorando quaisquer erros aleatórios

\[
\hat y_{ij} + \mu + \alpha_i + \beta_j + \phi_{ij}
\]

onde \(\hat y_{ij}\) é o rendimento médio do genótipo \emph{i} no ambiente \emph{j}, \(i = 1, ... g; j = 1, ... e\) sendo \emph{g} e \emph{e} o número de genótipos e ambientes, respectivamente; \(\mu\) é a média geral; \(\alpha_i\) é o efeito principal do genótipo \emph{i}; \(\beta_j\) é o efeito principal do ambiente \emph{j} e \(\phi_{ij}\) é o efeito de interação entre genótipo \emph{i} e o ambiente \emph{j}. Quando \(\phi_{ij}\) é submetido a Decomposição por Valor Singular (SVD), temos o bem conhecido modelo AMMI, visto anteriormente. No modelo GGE, o termo \(\alpha_i\) é deletado do modelo acima, permitindo que a variação explicada por este termo seja absorvida por \(\phi_{ij}\). Em seguida, esta matriz de dados --agora centrada no ambiente-- é submetida a SVD (Yan et al. \protect\hyperlink{ref-Yan2007}{2007}; Yan and Kang \protect\hyperlink{ref-Yan2003}{2003}). Explicitamente, temos

\[
{\phi_{ij} =  \hat y_{ij}} - \mu - \beta_j  = \sum\limits_{k = 1}^p \xi_{ik}^*\eta_{jk}^*
\]

onde \(\xi_{ik}^* = \lambda_k^ \alpha \xi_{ik}\); \(\eta_{jk}^* = \lambda_k^{1-\alpha}\eta_{jk}\) sendo \(\lambda_k\) o \emph{k}-ésimo autovalor da SVD (\(k = 1, ... p\)), com \(p \le min (e, g)\); \(\alpha\) é o fator de partição do valor singular para o Componente Principal (PC) \emph{k} (Yan \protect\hyperlink{ref-Yan2002b}{2002}); \(\xi_{ik}^*\) e \(\eta_{jk}^*\) são os escores do PC \emph{k} para genótipo \emph{i} e ambiente \emph{j}, respectivamente.

A função \texttt{gge()} do pacote \texttt{metan} é usada para ajustar o modelo GGE. De acordo com Yan and Kang (\protect\hyperlink{ref-Yan2003}{2003}), a função suporta quatro métodos de centralização de dados, dois métodos de escalonamento de dados e três opções para particionamento de valor singular:

\hypertarget{data-centering}{%
\subsection{Data centering}\label{data-centering}}

\begin{itemize}
\tightlist
\item
  0 ou \texttt{none}: para dados não centralizados;
\item
  1 ou \texttt{global}: para dados centralizados globalmente (E + G + GE);
\item
  2 ou \texttt{environment}: (padrão), para dados centrados no ambiente (G + GE);
\item
  3 ou \texttt{double}: para dados centrados duplamente (GE). Um biplot não pode ser produzido sem modelos produzidos sem centralização.
\end{itemize}

\hypertarget{data-scaling}{%
\subsection{Data scaling}\label{data-scaling}}

\begin{itemize}
\tightlist
\item
  0 ou \texttt{none}: (padrão) para nenhum escalonamento;
\item
  1 ou \texttt{sd}: Cada valor é dividido pelo desvio padrão do seu ambiente correspondente (coluna). Isso colocará todos os ambientes com aproximadamente o mesmo intervalo de valores.
\end{itemize}

\hypertarget{singular-value-partition}{%
\subsection{Singular value partition}\label{singular-value-partition}}

\indf{gge}

\begin{itemize}
\tightlist
\item
  1 ou \texttt{genotype}: O valor singular é inteiramente particionado nos autovetores de Genótipo (\(\alpha = 1\)), Também chamado de \emph{row metric preserving};
\item
  2 ou \texttt{environment}: (padrão) O valor singular é inteiramente particionado nos autovetores de ambiente (\(\alpha = 0\)), também chamado de \emph{column metric preserving};
\item
  3 ou \texttt{symmetrical}: O valor singular é simetricamente dividida nos autovetores de genótipo e ambiente (\(\alpha = 0,5\)). Esta partição é mais frequentemente usada na análise AMMI.
\end{itemize}

\hypertarget{ajustando-o-modelo-gge}{%
\subsection{Ajustando o modelo GGE}\label{ajustando-o-modelo-gge}}

Para ajustar o modelo GGE, usaremos os dados em \texttt{data\_ge}, que contém dados do rendimento de grãos avaliados em 10 genótipos conduzidos em 14 ambientes. Primeiro de tudo, vamos criar uma tabela bidirecional para esses dados usando a função \texttt{make\_mat()}. \indf{make\_mat}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ge\_table =}\StringTok{ }\KeywordTok{make\_mat}\NormalTok{(data\_ge, GEN, ENV, GY)}
\KeywordTok{print.data.frame}\NormalTok{(ge\_table, }\DataTypeTok{digits =} \DecValTok{3}\NormalTok{)}
\CommentTok{\#       E1  E10   E11  E12  E13  E14   E2   E3   E4   E5   E6   E7   E8   E9}
\CommentTok{\# G1  2.37 2.31 1.356 1.34 3.00 1.53 3.04 4.08 3.49 4.17 2.81 1.90 2.27 2.78}
\CommentTok{\# G10 1.97 1.54 0.899 1.02 1.83 1.86 3.15 4.11 4.27 3.37 2.48 2.24 2.70 3.15}
\CommentTok{\# G2  2.90 2.30 1.491 1.99 3.03 1.43 3.23 4.57 3.72 3.83 2.54 1.99 2.05 3.36}
\CommentTok{\# G3  2.89 2.34 1.568 1.76 3.47 2.06 3.61 4.13 4.13 4.13 2.98 2.16 2.85 3.29}
\CommentTok{\# G4  2.59 2.17 1.370 1.53 2.64 1.86 3.19 3.85 3.30 3.78 2.70 1.98 2.30 3.72}
\CommentTok{\# G5  2.19 2.14 1.326 1.69 2.57 1.78 3.14 3.74 3.38 3.47 2.43 1.66 2.71 3.30}
\CommentTok{\# G6  2.30 2.21 1.501 1.39 2.91 1.80 3.29 3.43 3.40 3.57 2.34 1.76 2.54 3.04}
\CommentTok{\# G7  2.77 2.44 1.364 1.95 3.18 1.94 2.61 4.10 3.02 4.05 2.67 2.55 2.58 3.14}
\CommentTok{\# G8  2.90 2.57 1.683 2.00 3.52 1.99 3.44 4.11 4.14 4.81 2.91 2.26 2.88 2.83}
\CommentTok{\# G9  2.33 1.74 1.125 1.41 2.95 1.57 3.09 4.51 3.90 3.93 2.77 1.39 2.49 1.94}
\end{Highlighting}
\end{Shaded}

A função \texttt{gge()} ajusta um modelo GGE baseado em uma tabela bidirecional (\texttt{ge\_table} em nosso caso) com genótipos nas linhas e ambientes em colunas, ou em um data.frame contendo pelo menos as colunas para genótipos, ambientes e variável(is) resposta.
\indf{gge}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Usando um data frame}
\NormalTok{gge\_model \textless{}{-}}\StringTok{ }\KeywordTok{gge}\NormalTok{(data\_ge, ENV, GEN, GY)}
\end{Highlighting}
\end{Shaded}

O modelo acima foi ajustado considerando (i) \emph{column metric preserving} (onde o valor singular é inteiramente particionado nos autovetores do ambiente); (ii) \emph{environment centered} (o biplot conterá uma informação mista de G + GEI); e nenhum método de escalonamento. Para alterar estas configurações padrão, use os argumentos \texttt{svp}, \texttt{centering} e \texttt{scaling}, respectivamente. Por favor, note que no segundo exemplo o argumento \texttt{table} foi definido como \texttt{TRUE} para indicar que os dados de entrada são uma tabela bidirecional.

\hypertarget{valores-estimados-pelo-modelo-gge}{%
\subsection{Valores estimados pelo modelo GGE}\label{valores-estimados-pelo-modelo-gge}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{predicted \textless{}{-}}\StringTok{ }\KeywordTok{predict}\NormalTok{(gge\_model, }\DataTypeTok{naxis =} \DecValTok{2}\NormalTok{)}
\KeywordTok{print}\NormalTok{(predicted}\OperatorTok{$}\NormalTok{GY, }\DataTypeTok{digits =} \DecValTok{3}\NormalTok{)}
\CommentTok{\# \# A tibble: 10 x 14}
\CommentTok{\#       E1   E10   E11   E12   E13   E14    E2    E3    E4    E5    E6    E7    E8}
\CommentTok{\#  * \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1  2.51  2.14 1.35   1.59  2.95  1.76  3.20  4.14  3.78  3.97  2.70  1.95  2.56}
\CommentTok{\#  2  1.93  1.62 0.988  1.07  2.07  1.66  3.08  3.99  3.78  3.28  2.43  1.69  2.48}
\CommentTok{\#  3  2.67  2.33 1.47   1.75  3.09  1.82  3.19  4.04  3.59  4.03  2.70  2.08  2.54}
\CommentTok{\#  4  2.83  2.44 1.56   1.88  3.40  1.83  3.26  4.18  3.73  4.32  2.83  2.10  2.59}
\CommentTok{\#  5  2.50  2.25 1.39   1.64  2.71  1.83  3.09  3.81  3.32  3.65  2.52  2.11  2.47}
\CommentTok{\#  6  2.32  2.06 1.27   1.46  2.52  1.78  3.09  3.87  3.46  3.54  2.49  1.99  2.47}
\CommentTok{\#  7  2.40  2.11 1.31   1.52  2.65  1.78  3.12  3.92  3.52  3.66  2.54  2.00  2.49}
\CommentTok{\#  8  2.78  2.49 1.56   1.88  3.17  1.87  3.17  3.93  3.40  4.04  2.68  2.21  2.52}
\CommentTok{\#  9  2.99  2.54 1.64   2.00  3.71  1.84  3.33  4.33  3.89  4.61  2.96  2.11  2.64}
\CommentTok{\# 10  2.27  1.78 1.15   1.30  2.82  1.64  3.28  4.43  4.28  4.03  2.79  1.65  2.62}
\CommentTok{\# \# ... with 1 more variable: E9 \textless{}dbl\textgreater{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{visualizando-o-biplot}{%
\subsection{Visualizando o Biplot}\label{visualizando-o-biplot}}

A função genérica \texttt{plot()} é usada para gerar um biplot usando como entrada o modelo ajustado da classe \texttt{gge}. O tipo de biplot é escolhido pelo argumento \texttt{type} na função. Dez tipos de biplots estão disponíveis de acordo com Yan and Kang (\protect\hyperlink{ref-Yan2003}{2003}).

\begin{itemize}
\tightlist
\item
  \texttt{type\ =\ 1} Um biplot básico.
\item
  \texttt{type\ =\ 2} Desempenho médio vs.~estabilidade
\item
  \texttt{type\ =\ 3} Que ganhou onde.
\item
  \texttt{type\ =\ 4} Descriminação vs.~representatividade
\item
  \texttt{type\ =\ 5} Examinar um ambiente.
\item
  \texttt{type\ =\ 6} Ranquear os ambientes.
\item
  \texttt{type\ =\ 7} Examinar um genótipo.
\item
  \texttt{type\ =\ 8} Ranquear os genótipos.
\item
  \texttt{type\ =\ 9} Comparar dois genótipos.
\item
  \texttt{type\ =\ 10} Relação entre os ambientes.
\end{itemize}

Neste material, para cada tipo de biplot, dois gráficos são produzidos. Um com as configurações padrão e outro para mostrar algumas opções gráficas da função.

\hypertarget{biplot-tipo-1-um-biplot-buxe1sico}{%
\subsubsection{Biplot tipo 1: Um biplot básico}\label{biplot-tipo-1-um-biplot-buxe1sico}}

Esta é a configuração padrão no gráfico da função, portanto, este biplot é produzido apenas chamando \texttt{plot(model)}, como mostrado abaixo.
\indt{biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(gge\_model)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(gge\_model,}
           \DataTypeTok{col.gen =} \StringTok{"blue"}\NormalTok{,}
           \DataTypeTok{size.text.env =} \DecValTok{2}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-349-1} \end{center}

\hypertarget{biplot-tipo-2-desempenho-muxe9dio-vs.-estabilidade}{%
\subsubsection{Biplot tipo 2: Desempenho médio vs.~estabilidade}\label{biplot-tipo-2-desempenho-muxe9dio-vs.-estabilidade}}

Neste biplot, a visualização da média e da estabilidade dos genótipos é obtida desenhando uma coordenada média de ambiente (AEC) no biplot obtido com \emph{row metric preserving}. Primeiro, um ambiente médio, representado pelo pequeno círculo, é definido pelas médias dos escores PC1 e PC2 dos ambientes. A linha que passa pela origem do biplot e pelo AEC pode ser chamada de média. As projeções de marcadores genotípicos nesse eixo deve, portanto, aproximar o rendimento médio dos genótipos. Assim, o G8 foi claramente o genótipo de maior rendimento, em média.

A ordenada de AEC é a linha que passa pela origem do biplot e é perpendicular à abscissa do AEC. Portanto, se a abscissa AEC representa o G, a ordenada AEC deve aproximar o GEI associado a cada genótipo, que é uma medida de variabilidade ou instabilidade dos genótipos (Yan et al. \protect\hyperlink{ref-Yan2007}{2007}). Uma projeção maior na ordenada AEC, independentemente da direção, significa maior instabilidade. Em nosso exemplo, o G3 foi o mais estável e o segundo genótipo mais produtivo, enquanto o G9 apresentou alta instabilidade.
\indt{biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gge\_model \textless{}{-}}\KeywordTok{gge}\NormalTok{(data\_ge, ENV, GEN, GY, }\DataTypeTok{svp =} \StringTok{"genotype"}\NormalTok{)}
\NormalTok{p1 \textless{}{-}}\KeywordTok{plot}\NormalTok{(gge\_model, }\DataTypeTok{type =} \DecValTok{2}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\KeywordTok{plot}\NormalTok{(gge\_model,}
          \DataTypeTok{type =} \DecValTok{2}\NormalTok{,}
          \DataTypeTok{col.gen =} \StringTok{"black"}\NormalTok{,}
          \DataTypeTok{col.env =} \StringTok{"gray"}\NormalTok{,}
          \DataTypeTok{axis\_expand =} \FloatTok{1.5}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-350-1} \end{center}

\hypertarget{biplot-tipo-3-quem-ganhou-onde}{%
\subsubsection{Biplot tipo 3: quem ganhou onde}\label{biplot-tipo-3-quem-ganhou-onde}}

Neste biplot (obtido com particionamento de valores singulares simétrico) um polígono é desenhado juntando os genótipos (G7, G8, G9, G10 e G4) que estão localizadas mais distante da origem do biplot fazendo com que todos os outros genótipos fiquem contidos no polígono. Os \emph{genótipos vértex} têm os vetores mais longos, em suas respectivas direções, que é uma medida da capacidade de resposta aos ambientes. Estes genótipos estão, portanto, entre os genótipos mais responsivos. Todos os outros genótipos são menos responsivos em suas respectivas direções.

As linhas perpendiculares aos lados do polígono dividem o biplot em setores. Cada setor tem um genótipo vértice. Por exemplo, o setor com o genótipo-vértice G4 pode ser referido como o setor G4. Um ambiente (E9), foi enquadrado neste setor. Como regra geral, o genótipo vértex é o genótipo de mais alto rendimento em todos os ambientes que compartilham o setor com ele (Yan et al. \protect\hyperlink{ref-Yan2007}{2007}). Neste caso, G4 teve o maior rendimento em E9, como mostrado na tabela acima.
\indt{biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gge\_model \textless{}{-}}\KeywordTok{gge}\NormalTok{(data\_ge, ENV, GEN, GY, }\DataTypeTok{svp =} \StringTok{"symmetrical"}\NormalTok{)}
\NormalTok{p1 \textless{}{-}}\KeywordTok{plot}\NormalTok{(gge\_model, }\DataTypeTok{type =} \DecValTok{3}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\KeywordTok{plot}\NormalTok{(gge\_model,}
          \DataTypeTok{type =} \DecValTok{3}\NormalTok{,}
          \DataTypeTok{size.shape.win =} \DecValTok{5}\NormalTok{,}
          \DataTypeTok{large\_label =} \DecValTok{6}\NormalTok{,}
          \DataTypeTok{col.gen =} \StringTok{"black"}\NormalTok{,}
          \DataTypeTok{col.env =} \StringTok{"gray"}\NormalTok{,}
          \DataTypeTok{annotation =} \OtherTok{FALSE}\NormalTok{,}
          \DataTypeTok{title =} \OtherTok{FALSE}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-351-1} \end{center}

\hypertarget{biplot-tipo-4-discriminauxe7uxe3o-vs.-representatividade}{%
\subsubsection{Biplot tipo 4: Discriminação vs.~representatividade}\label{biplot-tipo-4-discriminauxe7uxe3o-vs.-representatividade}}

\indt{biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\KeywordTok{plot}\NormalTok{(gge\_model, }\DataTypeTok{type =} \DecValTok{4}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\KeywordTok{plot}\NormalTok{(gge\_model,}
          \DataTypeTok{type =} \DecValTok{4}\NormalTok{,}
          \DataTypeTok{plot\_theme =} \KeywordTok{theme\_gray}\NormalTok{())}\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-352-1} \end{center}

\hypertarget{biplot-tipo-5-examinar-um-ambiente}{%
\subsubsection{Biplot tipo 5: Examinar um ambiente}\label{biplot-tipo-5-examinar-um-ambiente}}

A identificação de genótipos mais adaptados a um ambiente pode ser facilmente alcançada utilizando o biplot GGE. Por exemplo, para visualizar o desempenho de diferentes genótipos em um dado ambiente, por exemplo, E10, simplesmente desenhe uma linha que passa pela origem biplot e o marcador do E10. Os genótipos podem ser classificados de acordo com suas projeções no eixo E10 com base em seu desempenho neste ambiente, na direção apontada pela seta. Em nosso exemplo, no E10, o genótipo de maior rendimento foi o genótipo G8 e o genótipo de menor rendimento foi G10. A ordem dos genótipos foi G8 \textgreater{} G7 \textgreater{} G3 \textgreater{} G2 \textgreater{} G4 \textgreater{} G1 \textgreater{} G6 \textgreater{} G5 \textgreater{} G9 \textgreater{} G10.
\indt{biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gge\_model \textless{}{-}}\KeywordTok{gge}\NormalTok{(data\_ge, ENV, GEN, GY, }\DataTypeTok{svp =} \StringTok{"symmetrical"}\NormalTok{)}
\NormalTok{p1 \textless{}{-}}\KeywordTok{plot}\NormalTok{(gge\_model, }\DataTypeTok{type =} \DecValTok{5}\NormalTok{, }\DataTypeTok{sel\_env =} \StringTok{"E10"}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\KeywordTok{plot}\NormalTok{(gge\_model,}
          \DataTypeTok{type =} \DecValTok{5}\NormalTok{,}
          \DataTypeTok{sel\_env =} \StringTok{"E10"}\NormalTok{,}
          \DataTypeTok{col.gen =} \StringTok{"black"}\NormalTok{,}
          \DataTypeTok{col.env =} \StringTok{"black"}\NormalTok{,}
          \DataTypeTok{size.text.env =} \DecValTok{10}\NormalTok{,}
          \DataTypeTok{axis\_expand =} \FloatTok{1.5}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-353-1} \end{center}

\hypertarget{biplot-tipo-6-ranquear-os-ambientes}{%
\subsubsection{Biplot tipo 6: ranquear os ambientes}\label{biplot-tipo-6-ranquear-os-ambientes}}

Neste biplot o ambiente ``ideal'' é usado como o centro de um conjunto de linhas concêntricas que servem para medir a distância entre um ambiente e o ambiente ``ideal''. Como o foco principal neste biplot são os ambientes, a partição de valor singular usada é ``ambiente'' (padrão). Pode ser visto que E13 é o mais próximo do ambiente ideal e, portanto, é o mais desejável de todos os 14 ambientes. E4 e E9 foram os ambientes de teste menos desejados.
\indt{biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gge\_model \textless{}{-}}\StringTok{ }\KeywordTok{gge}\NormalTok{(data\_ge, ENV, GEN, GY)}
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(gge\_model, }\DataTypeTok{type =} \DecValTok{6}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(gge\_model,}
           \DataTypeTok{type =} \DecValTok{6}\NormalTok{,}
           \DataTypeTok{col.gen =} \StringTok{"black"}\NormalTok{,}
           \DataTypeTok{col.env =} \StringTok{"black"}\NormalTok{,}
           \DataTypeTok{size.text.env =} \DecValTok{10}\NormalTok{,}
           \DataTypeTok{axis\_expand =} \FloatTok{1.5}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-354-1} \end{center}

\hypertarget{biplot-tipo-7-examinar-um-genuxf3tipo}{%
\subsubsection{Biplot tipo 7: examinar um genótipo}\label{biplot-tipo-7-examinar-um-genuxf3tipo}}

Semelhante à visualização dos desempenhos genotípicos em um determinado ambiente (biplot 5), a visualização da média e da estabilidade dos genótipos é obtida desenhando-se uma AEC no biplot com foco no genótipo, ou \emph{row metric preserving} (Yan et al. \protect\hyperlink{ref-Yan2007}{2007}).
\indt{biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gge\_model \textless{}{-}}\StringTok{ }\KeywordTok{gge}\NormalTok{(data\_ge, ENV, GEN, GY, }\DataTypeTok{svp =} \StringTok{"genotype"}\NormalTok{)}
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(gge\_model, }\DataTypeTok{type =} \DecValTok{7}\NormalTok{, }\DataTypeTok{sel\_gen =} \StringTok{"G8"}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(gge\_model,}
           \DataTypeTok{type =} \DecValTok{7}\NormalTok{,}
           \DataTypeTok{sel\_gen =} \StringTok{"G8"}\NormalTok{,}
           \DataTypeTok{col.gen =} \StringTok{"black"}\NormalTok{,}
           \DataTypeTok{col.env =} \StringTok{"black"}\NormalTok{,}
           \DataTypeTok{size.text.env =} \DecValTok{10}\NormalTok{,}
           \DataTypeTok{axis\_expand =} \FloatTok{1.5}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-355-1} \end{center}

\hypertarget{biplot-tipo-8-ranquear-os-genuxf3tipos}{%
\subsubsection{Biplot tipo 8: ranquear os genótipos}\label{biplot-tipo-8-ranquear-os-genuxf3tipos}}

Este biplot compara todos os genótipos com o genótipo ``ideal''. O genótipo ideal, representado pelo pequeno círculo com uma seta apontando para ele, é definido como tendo o maior rendimento em todos os ambientes. Ou seja, tem o maior rendimento médio e é absolutamente estável. Os genótipos são classificados com base em sua distância do genótipo ideal (Yan et al. \protect\hyperlink{ref-Yan2007}{2007}). Em nosso exemplo, o G3 e o G8 superaram os outros genótipos.
\indt{biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gge\_model \textless{}{-}}\StringTok{ }\KeywordTok{gge}\NormalTok{(data\_ge, ENV, GEN, GY, }\DataTypeTok{svp =} \StringTok{"genotype"}\NormalTok{)}
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(gge\_model, }\DataTypeTok{type =} \DecValTok{8}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(gge\_model,}
           \DataTypeTok{type =} \DecValTok{8}\NormalTok{,}
           \DataTypeTok{col.gen =} \StringTok{"black"}\NormalTok{,}
           \DataTypeTok{col.env =} \StringTok{"gray"}\NormalTok{,}
           \DataTypeTok{size.text.gen =} \DecValTok{6}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-356-1} \end{center}

\hypertarget{biplot-tipo-9-comparar-dois-genuxf3tipos}{%
\subsubsection{Biplot tipo 9: comparar dois genótipos}\label{biplot-tipo-9-comparar-dois-genuxf3tipos}}

Para comparar dois genótipos, por exemplo, G10 e G8, desenhe uma linha de conexão para conectá-los e trace uma linha perpendicular que passa pela origem do biplot e é perpendicular à linha de conexão. Vemos que um ambiente, E9, está do mesmo lado da linha perpendicular do G10, e os outros 13 ambientes estão do outro lado da linha perpendicular, junto com o G8. Isso indica que G10 produziu mais do que o G8 no E9, mas G8 produziu mais que o G10 nos outros 13 ambientes (Yan et al. \protect\hyperlink{ref-Yan2007}{2007}).
\indt{biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gge\_model \textless{}{-}}\StringTok{ }\KeywordTok{gge}\NormalTok{(data\_ge, ENV, GEN, GY, }\DataTypeTok{svp =} \StringTok{"symmetrical"}\NormalTok{)}
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(gge\_model, }\DataTypeTok{type =} \DecValTok{9}\NormalTok{, }\DataTypeTok{sel\_gen1 =} \StringTok{"G8"}\NormalTok{, }\DataTypeTok{sel\_gen2 =} \StringTok{"G10"}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(gge\_model,}
           \DataTypeTok{type =} \DecValTok{9}\NormalTok{,}
           \DataTypeTok{sel\_gen1 =} \StringTok{"G8"}\NormalTok{,}
           \DataTypeTok{sel\_gen2 =} \StringTok{"G10"}\NormalTok{,}
           \DataTypeTok{col.gen =} \StringTok{"black"}\NormalTok{,}
           \DataTypeTok{title =} \OtherTok{FALSE}\NormalTok{,}
           \DataTypeTok{annotation =} \OtherTok{FALSE}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-357-1} \end{center}

\hypertarget{biplot-tipo-10-relauxe7uxe3o-entre-os-ambientes}{%
\subsubsection{Biplot tipo 10: relação entre os ambientes}\label{biplot-tipo-10-relauxe7uxe3o-entre-os-ambientes}}

\indt{biplot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gge\_model \textless{}{-}}\KeywordTok{gge}\NormalTok{(data\_ge, ENV, GEN, GY)}
\NormalTok{p1 \textless{}{-}}\KeywordTok{plot}\NormalTok{(gge\_model, }\DataTypeTok{type =} \DecValTok{10}\NormalTok{)}
\NormalTok{p2 \textless{}{-}}\KeywordTok{plot}\NormalTok{(gge\_model,}
          \DataTypeTok{type =} \DecValTok{10}\NormalTok{,}
          \DataTypeTok{col.gen =} \StringTok{"black"}\NormalTok{,}
          \DataTypeTok{title =} \OtherTok{FALSE}\NormalTok{,}
          \DataTypeTok{annotation =} \OtherTok{FALSE}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-358-1} \end{center}

\hypertarget{modelos-mistos-na-avaliauxe7uxe3o-de-met}{%
\section{Modelos mistos na avaliação de MET}\label{modelos-mistos-na-avaliauxe7uxe3o-de-met}}

Assumindo \(\mathop\alpha\nolimits_i\) e \(\mathop {(\alpha \tau )}\nolimits_{ij}\) como sendo de efeitos aleatórios, o modelo em \ref{eu_eqn} pode ser convenientemente reescrito utilizando o seguinte modelo linear misto:
\[ \label{meq}
{\boldsymbol{y  = X\beta  + Zu + \varepsilon }}
\]

onde \textbf{y} é um vetor \(n[ = \sum\nolimits_{j = 1}^e {(gb)]} \times 1\), \({\boldsymbol{y}} = {\rm{ }}{\left[ {{y_{111}},{\rm{ }}{y_{112}},{\rm{ }} \ldots ,{\rm{ }}{y_{geb}}} \right]^\prime }\); \(\boldsymbol{\beta}\) é um vetor \(eb \times 1\) de efeitos fixos, \({\boldsymbol{\beta }} = [\mathop \gamma \nolimits_{11} ,\mathop \gamma \nolimits_{12} ,...,\mathop \gamma \nolimits_{eb} ]'\); \textbf{u} é um vetor \(m[ = g + ge] \times 1\) de efeitos aleatórios, \({\boldsymbol{u}} = {\rm{ }}{\left[ {{\alpha _1},{\alpha _2},...,{\alpha _g},\mathop {(\alpha \tau )}\nolimits_{11} ,\mathop {(\alpha \tau )}\nolimits_{12} ,...,\mathop {(\alpha \tau )}\nolimits_{ge} } \right]^\prime }\); \textbf{X} é uma matriz delineamento de dimensão \(n \times eb\) relacionando \textbf{y} a \({\boldsymbol{\beta }}\); \textbf{Z} é uma matriz delineamento de dimensão \(m\times n\) relacionando \textbf{y} a \(\boldsymbol{u}\); e \({\boldsymbol{\varepsilon }}\) é um vetor n×1 de erros aleatórios, \({\boldsymbol{\varepsilon }} = {\rm{ }}{\left[ {{y_{111}},{\rm{ }}{y_{112}},{\rm{ }} \ldots ,{\rm{ }}{y_{geb}}} \right]^\prime }\)

Os vetores aleatórios \({\boldsymbol{\beta }}\) e \(\boldsymbol{u}\) são assumidos como normais e independentemente distribuídos com média zero e matrizes de variância-covariância \textbf{G} e \textbf{R}, respectivamente, de tal forma que

\[
\left[ \begin{array}{l}{\boldsymbol{u}}\\{\boldsymbol{\varepsilon }}\end{array} \right]\sim N\left( {\left[ \begin{array}{l}{\boldsymbol{0}}\\{\boldsymbol{0}}\end{array} \right]{\boldsymbol{,}}\left[ {\begin{array}{*{20}{c}}{\boldsymbol{G}}&{\boldsymbol{0}}\\{\boldsymbol{0}}&{\boldsymbol{R}}\end{array}} \right]} \right)
\]

A matriz de variância-covariância \textbf{G} tem muitas formas possíveis. A estrutura mais simples -e a opção padrão na maioria dos pacotes estatísticos para modelos mistos- são os componentes de variância, de modo que

\[
{\boldsymbol{G}} = \left[ {\begin{array}{*{20}{c}}{\mathop {\hat \sigma }\nolimits_\alpha ^2 {{\boldsymbol{I}}_g}}&0\\0&{\mathop {\hat \sigma }\nolimits_{\alpha \tau }^2 {{\boldsymbol{I}}_{ge}}}\end{array}} \right]
\]

e \({\boldsymbol{R}} = \mathop {\hat \sigma }\nolimits_\varepsilon ^2 {{\boldsymbol{I}}_n}\), sendo \(\mathop {\hat \sigma }\nolimits_\alpha ^2\), \(\mathop {\hat \sigma }\nolimits_{\alpha \tau }^2\) e \(\mathop {\hat \sigma }\nolimits_\varepsilon ^2\) as variâncias para genótipo, interação genótipo-ambiente e erros aleatórios, respectivamente.

Os vetores \({\boldsymbol{\beta }}\) e \(\boldsymbol{u}\) são estimados considerando a bem conhecida equação de modelo misto Henderson (\protect\hyperlink{ref-Henderson1975}{1975}).

\[ \label{ad}
\left[ {\begin{array}{*{20}{c}}{{\boldsymbol{\hat \beta }}}\\{{\boldsymbol{\hat u}}}\end{array}} \right]{\boldsymbol{ = }}{\left[ {\begin{array}{*{20}{c}}{{\boldsymbol{X'}}{{\boldsymbol{R}}^{\ - {\boldsymbol{1}}}}{\boldsymbol{X}}}&{{\boldsymbol{X'}}{{\boldsymbol{R}}^{ - {\boldsymbol{1}}}}{\boldsymbol{Z}}}\\{{\boldsymbol{Z'}}{{\boldsymbol{R}}^{ - {\boldsymbol{1}}}}{\boldsymbol{X}}}&{{\boldsymbol{Z'}}{{\boldsymbol{R}}^{ - {\boldsymbol{1}}}}{\boldsymbol{Z + }}{{\boldsymbol{G}}^{ - {\boldsymbol{1}}}}}\end{array}} \right]^ - }\left[ {\begin{array}{*{20}{c}}{{\boldsymbol{X'}}{{\boldsymbol{R}}^{ - {\boldsymbol{1}}}}{\boldsymbol{y}}}\\{{\boldsymbol{Z'}}{{\boldsymbol{R}}^{ - {\boldsymbol{1}}}}{\boldsymbol{y}}}\end{array}} \right]
\]

Onde o sobescrito \(^{-1}\) e \(^-\) representam as inversas e inversas generalizadas das matrizes, respectivamente. A estimativa dos componentes de variância em \({\boldsymbol{\hat G}}\) e \({\boldsymbol{\hat R}}\), pode ser realizada sem maiores problemas utilizando ANOVA \indt{ANOVA} convencional quando os dados são balanceados. Quando este pressuposto não é cumprido, a estimativa baseada em Restricted Maximum Likelihood (REML) \indt{REML} utilizando o algoritmo Expectation-Maximization (Dempster, Laird, and Rubin \protect\hyperlink{ref-Dempster1977}{1977}) é a mais indicada.

Desde a década de 1990, os modelos mistos vêm ganhando cada vez mais espaço na avaliação de MET, pois permitem a estimativa de parâmetros genéticos \indt{parâmetros genéticos} e ambientais, bem como a predição dos valores genotípicos de forma não-viciada (Smith, Cullis, and Thompson \protect\hyperlink{ref-Smith2005}{2005}). Da mesma forma, modelos mistos reduzem os ruídos de análises realizadas com dados desbalanceados e também de variáveis que não assumem aditividade, características frequentemente observadas em MET (Hu \protect\hyperlink{ref-Hu2015}{2015}). Na avaliação dos dados oriundos de MET é de interesse do pesquisador predizer o ``verdadeiro'' rendimento \(w_{ij}\) dado os rendimentos observados \(y_{ij}\). Quando um fator é considerado fixo, as inferências são limitadas apenas aos níveis testados deste fator e os efeitos são estimados por Best Linear Unbiased Estimator, ou BLUE \indt{BLUE}. Para efeitos aleatórios, onde deseja-se expandir as inferências para uma população de tratamentos (ou ambientes), a predição é realizada por Best Linear Unbiased Predictor, ou BLUP \indt{BLUP} (Henderson \protect\hyperlink{ref-Henderson1975}{1975}).
Eq. \ref{ad}

\hypertarget{ajustando-o-modelo}{%
\subsection{Ajustando o modelo}\label{ajustando-o-modelo}}

A função \texttt{waasb()} \indf{waasb} do pacote \texttt{metan} será utilizada para a análise dos dados de nosso exemplo utilizando o modelo misto descrito acima, considerando como aleatório os efeitos de genótipo e da interação genótipo-\emph{vs}-ambiente.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{BLUP\_model \textless{}{-}}\StringTok{ }\KeywordTok{waasb}\NormalTok{(data\_ge, ENV, GEN, REP,}
                    \DataTypeTok{resp =} \KeywordTok{c}\NormalTok{(GY, HM),}
                    \DataTypeTok{verbose =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

A função \texttt{get\_model\_data()} pode ser utilizada para extrair importantes informações do modelo ajustado com a função \texttt{waasb()}.

\begin{itemize}
\tightlist
\item
  Resumo do experimento
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{get\_model\_data}\NormalTok{(BLUP\_model, }\StringTok{"details"}\NormalTok{)}
\CommentTok{\# \# A tibble: 14 x 3}
\CommentTok{\#    Parameters GY                  HM              }
\CommentTok{\#    \textless{}chr\textgreater{}      \textless{}chr\textgreater{}               \textless{}chr\textgreater{}           }
\CommentTok{\#  1 Mean       "2.67"              "48.09"         }
\CommentTok{\#  2 SE         "0.05"              "0.21"          }
\CommentTok{\#  3 SD         "0.92"              "4.37"          }
\CommentTok{\#  4 CV         "34.56"             "9.09"          }
\CommentTok{\#  5 Min        "0.67 (G10 in E11)" "38 (G2 in E14)"}
\CommentTok{\#  6 Max        "5.09 (G8 in E5)"   "58 (G8 in E11)"}
\CommentTok{\#  7 MinENV     "E11 (1.37)"        "E14 (41.03)"   }
\CommentTok{\#  8 MaxENV     "E3 (4.06)"         "E11 (54.2)"    }
\CommentTok{\#  9 MinGEN     "G10 (2.47) "       "G2 (46.66) "   }
\CommentTok{\# 10 MaxGEN     "G8 (3) "           "G5 (49.3) "    }
\CommentTok{\# 11 wresp      "50"                "50"            }
\CommentTok{\# 12 mresp      "100"               "100"           }
\CommentTok{\# 13 Ngen       "10"                "10"            }
\CommentTok{\# 14 Nenv       "14"                "14"}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Teste de razão de máxima verossimilhanças (LRT)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{get\_model\_data}\NormalTok{(BLUP\_model, }\StringTok{"lrt"}\NormalTok{)}
\CommentTok{\# \# A tibble: 4 x 8}
\CommentTok{\#   VAR   model    npar logLik   AIC   LRT    Df \textasciigrave{}Pr(\textgreater{}Chisq)\textasciigrave{}}
\CommentTok{\#   \textless{}chr\textgreater{} \textless{}chr\textgreater{}   \textless{}int\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}        \textless{}dbl\textgreater{}}
\CommentTok{\# 1 GY    GEN        44  {-}224.  537. 19.3      1     1.11e{-} 5}
\CommentTok{\# 2 GY    GEN:ENV    44  {-}237.  562. 44.8      1     2.15e{-}11}
\CommentTok{\# 3 HM    GEN        44  {-}867. 1821.  7.86     1     5.07e{-} 3}
\CommentTok{\# 4 HM    GEN:ENV    44  {-}894. 1876. 62.8      1     2.27e{-}15}
\end{Highlighting}
\end{Shaded}

O teste LRT \indt{LRT} indicou diferenças significativas para os efeitos aleatórios de genótipo e interação genótipo-\emph{vs}-ambiente. Assim, a utilização de modelos mistos é indicada para predição do rendimento em nosso exemplo.

\begin{itemize}
\tightlist
\item
  Componentes da variância
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{get\_model\_data}\NormalTok{(BLUP\_model, }\StringTok{"vcomp"}\NormalTok{)}
\CommentTok{\# \# A tibble: 3 x 3}
\CommentTok{\#   Group        GY    HM}
\CommentTok{\#   \textless{}chr\textgreater{}     \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\# 1 GEN      0.0280 0.490}
\CommentTok{\# 2 GEN:ENV  0.0567 2.19 }
\CommentTok{\# 3 Residual 0.0967 2.84}
\end{Highlighting}
\end{Shaded}

\hypertarget{anuxe1lise-dos-resuxedduos-2}{%
\subsection{Análise dos resíduos}\label{anuxe1lise-dos-resuxedduos-2}}

A função \texttt{autoplot()} também pode ser utilizada para a investigação dos pressupostos do modelo neste exemplo. Dois gráficos que são gerados mas não mostrados por padrão são vistos neste exemplo.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(BLUP\_model)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-363-1} \end{center}

\hypertarget{paruxe2metros-genuxe9ticos}{%
\subsection{Parâmetros genéticos}\label{paruxe2metros-genuxe9ticos}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{get\_model\_data}\NormalTok{(BLUP\_model, }\StringTok{"genpar"}\NormalTok{)}
\CommentTok{\# Class of the model: waasb}
\CommentTok{\# Variable extracted: genpar}
\CommentTok{\# \# A tibble: 9 x 3}
\CommentTok{\#   Parameters              GY     HM}
\CommentTok{\#   \textless{}chr\textgreater{}                \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}}
\CommentTok{\# 1 Phenotypic variance  0.181 5.52  }
\CommentTok{\# 2 Heritability         0.154 0.0887}
\CommentTok{\# 3 GEIr2                0.313 0.397 }
\CommentTok{\# 4 h2mg                 0.815 0.686 }
\CommentTok{\# 5 Accuracy             0.903 0.828 }
\CommentTok{\# 6 rge                  0.370 0.435 }
\CommentTok{\# 7 CVg                  6.26  1.46  }
\CommentTok{\# 8 CVr                 11.6   3.50  }
\CommentTok{\# 9 CV ratio             0.538 0.415}
\end{Highlighting}
\end{Shaded}

Além dos componentes de variância \indt{componentes de variância} para os efeitos aleatórios declarados, alguns importantes parâmetros genéticos \indt{parâmetros genéticos} são mostrados. \textbf{Heribatility} é a herdabilidade no sentido amplo (\(\mathop h\nolimits_g^2\)) estimada por \(\mathop h\nolimits_g^2 = \mathop \sigma \nolimits_g^2 /\left( {\mathop \sigma \nolimits_g^2 + \mathop \sigma \nolimits_i^2 + \mathop \sigma \nolimits_e^2 } \right)\) onde \((\mathop \sigma \nolimits_g^2 )\) é a variância genotípica; \((\mathop \sigma \nolimits_i^2 )\) é a variância da interação GE; e \((\mathop \sigma \nolimits_e^2 )\) é a variância residual. \textbf{GEIr2} é o coeficiente de determinação do efeito da interação GE (\(\mathop r\nolimits_i^2\) ) estimado por \(\mathop r\nolimits_i^2 = \mathop \sigma \nolimits_i^2 /\left( {\mathop \sigma \nolimits_g^2 + \mathop \sigma \nolimits_i^2 + \mathop \sigma \nolimits_e^2 } \right)\); \textbf{Heribatility of means} é a herdabilidade da média assumindo ausência de valores perdidos \((\mathop h\nolimits_{gm}^2 )\), estimada por \(\mathop h\nolimits_{gm}^2 = \mathop \sigma \nolimits_g^2 /\left[ {\mathop \sigma \nolimits_g^2 + \mathop \sigma \nolimits_i^2 /a + \mathop \sigma \nolimits_e^2 /\left( {ab} \right)} \right]\), onde \emph{a} e \emph{b} são o número de ambientes e blocos, respectivamente; \textbf{Accuracy} é a acurácia de seleção (\emph{Ac}), estimada por \(Ac = \sqrt{\mathop h\nolimits_{gm}^2}\) ; \textbf{rge} é a correlação genótipo-ambiente \((\mathop r\nolimits_{ge})\) estimada por \(\mathop r\nolimits_{ge} = \mathop \sigma \nolimits_g^2 /\left({\mathop \sigma \nolimits_g^2 + \mathop \sigma \nolimits_i^2} \right)\); \textbf{CVg} é o coeficiente de variação genotípico, estimado por \({\left({\mathop \sigma \nolimits_g^2 /\mu } \right)^{0.5}} \times 100\), onde \(\mu\) é a média geral; \textbf{CVr} é o coeficiente de variação residual, estimado por \({\left( {\mathop \sigma \nolimits_e^2 /\mu} \right)^{0.5}} \times 100\) ; \textbf{CV ratio} é a razão entre o coeficiente de variação genotípico e residual.

\hypertarget{muxe9dias-preditas}{%
\subsection{Médias preditas}\label{muxe9dias-preditas}}

\begin{itemize}
\tightlist
\item
  Imprimindo os BLUPs preditos para genótipos
\end{itemize}

\indt{BLUP}

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{print}\NormalTok{(BLUP\_model}\OperatorTok{$}\NormalTok{GY}\OperatorTok{$}\NormalTok{BLUPgen)}
\CommentTok{\# \# A tibble: 10 x 6}
\CommentTok{\#     Rank GEN     BLUPg Predicted    LL    UL}
\CommentTok{\#    \textless{}dbl\textgreater{} \textless{}fct\textgreater{}   \textless{}dbl\textgreater{}     \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1     1 G8     0.269       2.94  2.78  3.11}
\CommentTok{\#  2     2 G3     0.229       2.90  2.74  3.07}
\CommentTok{\#  3     3 G2     0.0570      2.73  2.57  2.90}
\CommentTok{\#  4     4 G7     0.0543      2.73  2.56  2.89}
\CommentTok{\#  5     5 G4    {-}0.0264      2.65  2.48  2.81}
\CommentTok{\#  6     6 G1    {-}0.0575      2.62  2.45  2.78}
\CommentTok{\#  7     7 G5    {-}0.112       2.56  2.40  2.73}
\CommentTok{\#  8     8 G6    {-}0.114       2.56  2.39  2.73}
\CommentTok{\#  9     9 G9    {-}0.134       2.54  2.37  2.71}
\CommentTok{\# 10    10 G10   {-}0.166       2.51  2.34  2.67}
\end{Highlighting}
\end{Shaded}

\texttt{blupGEN} mostra a média predita para os genótipos testados. \textbf{BLUPg} é o efeito genotípico \((\hat{g}_{i})\) estimado por \(\hat{g}_{i} = h_g^2(\bar{y}_{i.}-\bar{y}_{..})\) onde \(h_g^2\) é o efeito \emph{shrinkage} para genótipo, estimado por \(\mathop h\nolimits_g^2 = (\mathop {\hat \sigma }\nolimits_i^2 + E\mathop {\hat \sigma }\nolimits_g^2 )/(\mathop {\hat \sigma }\nolimits_i^2 + \mathop {\hat \sigma }\nolimits_\varepsilon ^2 + E\mathop {\hat \sigma }\nolimits_g^2 ).\). \textbf{Predicted} é a média predita por \(\hat{g}_{i}+\mu\) onde \(\mu\) é a média geral. \textbf{LL} e \textbf{UL} são os limites inferiore e superior, respectivamente estimado por \((\hat{g}_{i}+\mu)\pm{CI}\). \(CI\) é o intervalo de confiança para predição BLUP, assumindo uma dada probabilidade de erro, onde \(CI = t\times\sqrt{((1-Ac)\times{\mathop \sigma \nolimits_g^2)}}\) onde \(t\) é o valor \emph{t}-Student para um teste bilateral a uma dada probabilidade de erro; \(Ac\) é a acurácia de seleçao; e \(\mathop \sigma \nolimits_g^2\) é a variância genotípica.

\begin{itemize}
\tightlist
\item
  plotando os BLUPs preditos para genótipos
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\KeywordTok{plot\_blup}\NormalTok{(BLUP\_model)}
\NormalTok{p2 \textless{}{-}}\KeywordTok{plot\_blup}\NormalTok{(BLUP\_model,}
               \DataTypeTok{col.shape  =}  \KeywordTok{c}\NormalTok{(}\StringTok{"gray20"}\NormalTok{, }\StringTok{"gray80"}\NormalTok{),}
               \DataTypeTok{y.lab =} \StringTok{"Genótipos"}\NormalTok{,}
               \DataTypeTok{x.lab =} \StringTok{"Rendimento de grãos predito"}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{coord\_flip}\NormalTok{()}

\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2, }\DataTypeTok{tag\_levels =} \KeywordTok{list}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"p1"}\NormalTok{, }\StringTok{"p2"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-366-1} 

}

\caption{Médias preditas para genótipos considerando um modelo misto}\label{fig:unnamed-chunk-366}
\end{figure}

\begin{itemize}
\tightlist
\item
  Imprimindo os BLUPs estimados para as combinações genótipo x ambiente (primeiras 10 entradas)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{print}\NormalTok{(BLUP\_model}\OperatorTok{$}\NormalTok{GY}\OperatorTok{$}\NormalTok{BLUPint)}
\CommentTok{\# \# A tibble: 420 x 7}
\CommentTok{\#    ENV   GEN   REP     BLUPg  BLUPge \textasciigrave{}BLUPg+ge\textasciigrave{} Predicted}
\CommentTok{\#    \textless{}fct\textgreater{} \textless{}fct\textgreater{} \textless{}fct\textgreater{}   \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{}      \textless{}dbl\textgreater{}     \textless{}dbl\textgreater{}}
\CommentTok{\#  1 E1    G1    1     {-}0.0575 {-}0.0621    {-}0.120       2.46}
\CommentTok{\#  2 E1    G1    2     {-}0.0575 {-}0.0621    {-}0.120       2.44}
\CommentTok{\#  3 E1    G1    3     {-}0.0575 {-}0.0621    {-}0.120       2.31}
\CommentTok{\#  4 E1    G2    1      0.0570  0.207      0.264       2.84}
\CommentTok{\#  5 E1    G2    2      0.0570  0.207      0.264       2.82}
\CommentTok{\#  6 E1    G2    3      0.0570  0.207      0.264       2.69}
\CommentTok{\#  7 E1    G3    1      0.229   0.0885     0.318       2.89}
\CommentTok{\#  8 E1    G3    2      0.229   0.0885     0.318       2.87}
\CommentTok{\#  9 E1    G3    3      0.229   0.0885     0.318       2.75}
\CommentTok{\# 10 E1    G4    1     {-}0.0264  0.0601     0.0337      2.61}
\CommentTok{\# \# ... with 410 more rows}
\end{Highlighting}
\end{Shaded}

A saída acima os BLUPs \indt{BLUP} estimados para as combinações genótipo x ambiente. \textbf{BLUPg} é o efeito genotípico, descrito acima; \textbf{BLUPge} é o efeito genotípico do genótipo \emph{i} no ambiente \emph{j} \((\hat{g}_{ij})\) estimado por \(\hat{g}_{ij} = h_g^2(\bar{y}_{i.}-\bar{y}_{..})+h_{ge}^2(y_{ij}-\bar{y}_{i.}-\bar{y}_{.j}+\bar{y}_{..})\), onde \(h_{ge}^2\) é o efeito \emph{shrinkage} para a interação GE, estimado por \(\mathop h\nolimits_{ge}^2 = \mathop {\hat \sigma }\nolimits_i^2 /(\mathop {\hat \sigma }\nolimits_i^2 + \mathop {\hat \sigma }\nolimits_\varepsilon ^2)\); \textbf{BLUPg+ge} é \(BLUP_g+BLUP_{ge}\); \textbf{Predicted} é a média predita (\(\hat{y}_{ij}\)) estimada por \(\hat{y}_{ij} = \bar{y}_{.j}+BLUP_{g+ge}\).

Para obter os valores acima para cada variável do modelo basta utilizar a função \texttt{get\_model\_data()}, por exemplo:

\begin{itemize}
\tightlist
\item
  \texttt{get\_model\_data(BLUP\_model,\ "blupg")} para as médias preditas de genótipos;
\item
  \texttt{get\_model\_data(BLUP\_model,\ "blupge")} para as médias preditas de genótipos em ambientes;
\end{itemize}

\hypertarget{uxedndices-de-estabilidade-baseados-em-blup}{%
\subsection{Índices de estabilidade baseados em BLUP}\label{uxedndices-de-estabilidade-baseados-em-blup}}

\hypertarget{wsb}{%
\subsubsection{O índice WAASB}\label{wsb}}

Recentemente, (Tiago Olivoto, Lúcio, et al. \protect\hyperlink{ref-Olivoto2019}{2019}\protect\hyperlink{ref-Olivoto2019}{a}) propuseram um índice de estabilidade, WAASB (\textbf{W}eighted \textbf{A}verage of \textbf{A}bsolute \textbf{S}cores), que combina as características do modelo AMMI e BLUP. O índice é baseado na média ponderada dos escores absolutos obtidos pela decomposição por valores singulares da matriz BLUP dos efeitos da interação em um modelo de efeito misto, conforme a seguite equação.

\[
        WAASB_i  =
        \sum_{k = 1}^{p} |IPCA_{ik} \times EP_k|/ \sum_{k = 1}^{p}EP_k
\]

onde \(WAASB_i\) é a média ponderada dos escores absolutos do genótipo \emph{i}; \(IPCA_{ik}\) é o escore do genótipo \emph{i} no \emph{k}-esimo IPCA; e \(EP_k\) é a variância explicada pelo \emph{k} IPCA para \(k = 1,2, .., p\), sendo \(p = min (g-1; e-1)\). O genótipo mais estável é aquele com o menor valor de WAASB (Tiago Olivoto, Lúcio, et al. \protect\hyperlink{ref-Olivoto2019}{2019}\protect\hyperlink{ref-Olivoto2019}{a}).

Devido a aplicação da ténica de decomposição por valores singulares, é possível a confecção de biplots semelhantes ao método AMMI, considerando agora, um modelo de efeito misto. Para isto, a função \texttt{plot\_scores} \indf{plot\_scores} é utilizada utilizando como argumento de o modelo ajustado \texttt{BLUP\_model}. Tiago Olivoto, Lúcio, et al. (\protect\hyperlink{ref-Olivoto2019}{2019}\protect\hyperlink{ref-Olivoto2019}{a}) e Tiago Olivoto, Lúcio, et al. (\protect\hyperlink{ref-Olivoto2019a}{2019}\protect\hyperlink{ref-Olivoto2019a}{b}) propuseram a utilização do índice WAASB na ordenada do biplot AMMI1, substituindo os valores do IPCA1 pelos valores do WAASB. Este biplot é criado utilizando \texttt{type\ =\ 3} na função.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p5 =}\StringTok{ }\KeywordTok{plot\_scores}\NormalTok{(BLUP\_model, }\DataTypeTok{type =} \DecValTok{3}\NormalTok{)}
\NormalTok{p6 =}\StringTok{ }\KeywordTok{plot\_scores}\NormalTok{(BLUP\_model, }\DataTypeTok{type =} \DecValTok{3}\NormalTok{) }\OperatorTok{+}
\StringTok{                 }\KeywordTok{theme\_gray}\NormalTok{() }\OperatorTok{+}
\StringTok{                 }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{),}
                       \DataTypeTok{legend.background =} \KeywordTok{element\_rect}\NormalTok{(}\DataTypeTok{fill =} \OtherTok{NA}\NormalTok{))}

\KeywordTok{arrange\_ggplot}\NormalTok{(p5, p6, }\DataTypeTok{tag\_levels =} \KeywordTok{list}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"p5"}\NormalTok{,}\StringTok{"p6"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{html_r_files/figure-latex/unnamed-chunk-368-1} 

}

\caption{Biplot AMMI2 gerado pelo pacote metan}\label{fig:unnamed-chunk-368}
\end{figure}

Os quadrantes propostos nesta interpretação representam as quatro classificações propostas por Tiago Olivoto, Lúcio, et al. (\protect\hyperlink{ref-Olivoto2019}{2019}\protect\hyperlink{ref-Olivoto2019}{a}) em relação à interpretação conjunta da produtividade e estabilidade. Os genótipos ou ambientes incluídos no quadrante I podem ser considerados genótipos instáveis --ou ambientes com alta capacidade de discriminação, mas com produtividade abaixo da média geral. No quadrante II estão incluídos os genótipos instáveis, embora com produtividade acima da média geral. Os ambientes incluídos neste quadrante merecem atenção especial, pois, além de fornecerem altas magnitudes da variável resposta, apresentam boa capacidade de discriminação. Os genótipos dentro do quadrante III têm baixa produtividade, mas podem ser considerados estáveis devido aos valores mais baixos do WAASB. Quanto menor esse valor, mais estável o genótipo pode ser considerado. Os ambientes incluídos neste quadrante podem ser considerados pouco produtivos e com baixa capacidade de discriminação. Os genótipos dentro do quadrante IV são altamente produtivos e estáveis.

\hypertarget{o-uxedndice-waasby}{%
\subsubsection{O índice WAASBY}\label{o-uxedndice-waasby}}

Um novo índice de superioridade que considera tanto a estabilidade quanto a produtividade para a classificação dos genótipos também foi proposto por Tiago Olivoto, Lúcio, et al. (\protect\hyperlink{ref-Olivoto2019}{2019}\protect\hyperlink{ref-Olivoto2019}{a}), considerando a seguinte equação.

\[
WAASB{Y_i} = \frac{{\left( {r{G_i} \times {\theta _Y}} \right) + \left( {r{W_i} \times {\theta _S}} \right)}}{{{\theta _Y} + {\theta _S}}}
\]

onde \(WAASBY_i\) é o índice de superioridade para o genótipo \emph{i} que pondera entre desempenho e estabilidade; \(rG_i\) e \(rW_i\) são os valores escalonados (0-100) para GY e WAASB, respectivamente; \(\theta_Y\) e \(\theta_S\) são os pesos para GY e WAASB, respectivamente.

Este índice permite atribuir pesos para estabilidade e produtividade na classificação dos genótipos. Para isto, o argumento \texttt{wresp} da função \texttt{waasb()} \indf{waasb} é usado. Por exemplo, se o objetivo é selecionar genótipos com alto rendimento (independentemente de sua estabilidade), então o \texttt{wresp\ =\ 100} deve ser usado. Nesse caso, a classificação do índice WAASBY corresponderá perfeitamente à classificação da variável de resposta. Por outro lado, visando selecionar genótipos altamente estáveis (independentemente da produtividade), então o \texttt{wresp\ =\ 0} deve ser usado. Nesse caso, a classificação do índice WAASBY corresponderá perfeitamente à classificação do índice WAASB. Qualquer valor entre 0 e 100 pode ser usado no argumento \texttt{wresp} para ponderar entre o desempenho médio e a estabilidade. Em nosso exemplo, o índice WAASBY foi calculado considerando \texttt{wresp\ =\ 50} (padrão da função), o que significa pesos iguais para desempenho e estabilidade médios. Para plotar os valores de WAASBY, o código a seguir é usado.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{plot\_waasby}\NormalTok{(BLUP\_model)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{plot\_waasby}\NormalTok{(BLUP\_model,}
                  \DataTypeTok{col.shape =} \KeywordTok{c}\NormalTok{(}\StringTok{"black"}\NormalTok{, }\StringTok{"gray"}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{coord\_flip}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\indt{Dicas}
\begin{dica}
O reescalonamento da variável resposta e do índice WAASB é necessário para que eles sejam diretamente comparáveis. Por padrão, a variável resposta é reescalonada de forma que o valor máximo (genótipo com a maior média) seja 100 e o valor mínimo (genótipo com a menor média) seja 0. Digamos que para uma determinada variável, menores valores são desejados, então o argumento \texttt{mresp\ =\ 100} (padrão) deve ser ajustado para \texttt{mresp\ =\ 0}.
\end{dica}

Par obter o índice WAASBY para múltiplas variáveis, por exemplo, basta utilizar a função \texttt{get\_model\_data()}, como mostrado abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{waas}\NormalTok{(data\_ge2, ENV, GEN, REP,}
     \DataTypeTok{resp =} \KeywordTok{c}\NormalTok{(PH, ED, TKW, NKR),}
     \DataTypeTok{wresp =} \KeywordTok{rep}\NormalTok{(}\DecValTok{65}\NormalTok{, }\DecValTok{4}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{ }\KeywordTok{get\_model\_data}\NormalTok{(}\DataTypeTok{what =} \StringTok{"WAASY"}\NormalTok{)}
\CommentTok{\# variable PH }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# AMMI analysis table}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#     Source  Df Sum Sq Mean Sq F value   Pr(\textgreater{}F) Proportion Accumulated}
\CommentTok{\#        ENV   3  7.719  2.5728 127.913 4.25e{-}07          .           .}
\CommentTok{\#   REP(ENV)   8  0.161  0.0201   0.897 5.22e{-}01          .           .}
\CommentTok{\#        GEN  12  1.865  0.1554   6.929 6.89e{-}09          .           .}
\CommentTok{\#    GEN:ENV  36  5.397  0.1499   6.686 5.01e{-}14          .           .}
\CommentTok{\#        PC1  14  4.466  0.3190  14.230 0.00e+00       82.8        82.8}
\CommentTok{\#        PC2  12  0.653  0.0545   2.430 8.40e{-}03       12.1        94.9}
\CommentTok{\#        PC3  10  0.277  0.0277   1.240 2.76e{-}01        5.1         100}
\CommentTok{\#  Residuals  96  2.153  0.0224      NA       NA          .           .}
\CommentTok{\#      Total 191 22.692  0.1188      NA       NA       \textless{}NA\textgreater{}        \textless{}NA\textgreater{}}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# variable ED }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# AMMI analysis table}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#     Source  Df Sum Sq Mean Sq F value   Pr(\textgreater{}F) Proportion Accumulated}
\CommentTok{\#        ENV   3  306.0  101.99  43.386 2.70e{-}05          .           .}
\CommentTok{\#   REP(ENV)   8   18.8    2.35   0.906 5.15e{-}01          .           .}
\CommentTok{\#        GEN  12  212.9   17.74   6.838 8.95e{-}09          .           .}
\CommentTok{\#    GEN:ENV  36  398.2   11.06   4.263 7.60e{-}09          .           .}
\CommentTok{\#        PC1  14  212.2   15.16   5.840 0.00e+00       53.3        53.3}
\CommentTok{\#        PC2  12  134.7   11.23   4.330 0.00e+00       33.8        87.1}
\CommentTok{\#        PC3  10   51.3    5.13   1.980 4.38e{-}02       12.9         100}
\CommentTok{\#  Residuals  96  249.1    2.59      NA       NA          .           .}
\CommentTok{\#      Total 191 1583.2    8.29      NA       NA       \textless{}NA\textgreater{}        \textless{}NA\textgreater{}}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# variable TKW }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# AMMI analysis table}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#     Source  Df Sum Sq Mean Sq F value   Pr(\textgreater{}F) Proportion Accumulated}
\CommentTok{\#        ENV   3  37013   12338   11.13 3.16e{-}03          .           .}
\CommentTok{\#   REP(ENV)   8   8869    1109    1.21 3.03e{-}01          .           .}
\CommentTok{\#        GEN  12  44633    3719    4.05 4.41e{-}05          .           .}
\CommentTok{\#    GEN:ENV  36 164572    4571    4.98 1.73e{-}10          .           .}
\CommentTok{\#        PC1  14 104276    7448    8.11 0.00e+00       63.4        63.4}
\CommentTok{\#        PC2  12  33361    2780    3.03 1.20e{-}03       20.3        83.6}
\CommentTok{\#        PC3  10  26935    2694    2.93 3.00e{-}03       16.4         100}
\CommentTok{\#  Residuals  96  88171     918      NA       NA          .           .}
\CommentTok{\#      Total 191 507829    2659      NA       NA       \textless{}NA\textgreater{}        \textless{}NA\textgreater{}}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# variable NKR }
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# AMMI analysis table}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\#     Source  Df Sum Sq Mean Sq F value   Pr(\textgreater{}F) Proportion Accumulated}
\CommentTok{\#        ENV   3  237.0   79.01  15.843 0.000997          .           .}
\CommentTok{\#   REP(ENV)   8   39.9    4.99   0.635 0.746348          .           .}
\CommentTok{\#        GEN  12  227.8   18.99   2.418 0.008726          .           .}
\CommentTok{\#    GEN:ENV  36  602.7   16.74   2.132 0.001839          .           .}
\CommentTok{\#        PC1  14  337.4   24.10   3.070 0.000600         56          56}
\CommentTok{\#        PC2  12  192.2   16.02   2.040 0.028500       31.9        87.9}
\CommentTok{\#        PC3  10   73.1    7.31   0.930 0.509500       12.1         100}
\CommentTok{\#  Residuals  96  753.7    7.85      NA       NA          .           .}
\CommentTok{\#      Total 191 2463.8   12.90      NA       NA       \textless{}NA\textgreater{}        \textless{}NA\textgreater{}}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }
\CommentTok{\# All variables with significant (p \textless{} 0.05) genotype{-}vs{-}environment interaction}
\CommentTok{\# Done!}
\CommentTok{\# Class of the model: waas}
\CommentTok{\# Variable extracted: WAASY}
\CommentTok{\# \# A tibble: 13 x 5}
\CommentTok{\#    GEN      PH    ED   TKW   NKR}
\CommentTok{\#    \textless{}chr\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 H1     73.6 78.1   84.5  42.7}
\CommentTok{\#  2 H10    22.0 18.8   34.8  56.3}
\CommentTok{\#  3 H11    42.5 39.2   56.6  56.3}
\CommentTok{\#  4 H12    27.5 51.5   41.0  35  }
\CommentTok{\#  5 H13    49.2 60.2   70.7  25.1}
\CommentTok{\#  6 H2     66.3 54.9   62.5  51.6}
\CommentTok{\#  7 H3     59.4 57.9   52.1  48.5}
\CommentTok{\#  8 H4     68.6 59.4   59.8  98.7}
\CommentTok{\#  9 H5     85.3 61.6   69.9  75.2}
\CommentTok{\# 10 H6     67.5 95.7   90.3  34.5}
\CommentTok{\# 11 H7     41.4 62.8   55.8  42.6}
\CommentTok{\# 12 H8     11.6 32.2   17.3  29.2}
\CommentTok{\# 13 H9     45.5  7.93   0    48.4}
\end{Highlighting}
\end{Shaded}

\hypertarget{diferentes-cenuxe1rios-para-a-estimativa-do-waasby}{%
\subsubsection{Diferentes cenários para a estimativa do WAASBY}\label{diferentes-cenuxe1rios-para-a-estimativa-do-waasby}}

No exemplo a seguir, aplicaremos a função \texttt{wsmp()} \indf{wsmp} (\textbf{w}eighting the \textbf{s}tability and the \textbf{m}ean \textbf{p}erformance) ao modelo previamente ajustado \texttt{BLUP\_model} visando planejar diferentes cenários de estimação do WAASBY alterando os pesos atribuídos à estabilidade e ao desempenho médio. O número de cenários é definido pelo argumento \texttt{increment}. Por padrão, vinte e um cenários diferentes são simulados. Neste caso, o índice de superioridade WAASBY é calculado considerando os seguintes pesos: estabilidade = 100; desempenho médio = 0. Em outras palavras, apenas a estabilidade é considerada para a classificação dos genótipos. Na próxima iteração, os pesos se tornam 95/5 (uma vez que \texttt{increment\ =\ 5}). No terceiro cenário, os pesos se tornam 90/10, e assim por diante até esses pesos se tornarem 0/100. Na última iteração, a classificação do genótipo para o WAASBY corresponde perfeitamente às classificações da variável resposta.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{scenarios \textless{}{-}}\StringTok{ }\KeywordTok{wsmp}\NormalTok{(BLUP\_model)}
\NormalTok{p1 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(scenarios)}
\NormalTok{p2 \textless{}{-}}\StringTok{ }\KeywordTok{plot}\NormalTok{(scenarios, }\DataTypeTok{type =} \DecValTok{2}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2, }\DataTypeTok{tag\_levels =} \KeywordTok{list}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"p1"}\NormalTok{, }\StringTok{"p2"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-372-1} \end{center}

A função genérica \texttt{plot()} \indf{plot} é então usada para plotar o objeto. Dois \emph{heatmaps} são criados. O primeiro tipo mostra a classificação do genótipo dependendo do número de eixos de componentes principais usados para estimar o índice WAASB. Um dendrograma baseado na distância euclidiana é usado para agrupar a classificação dos genótipos. O segundo tipo mostra a classificação do genótipo dependendo da relação WAASB/GY. As classificações obtidas no cenário 100/0 consideram exclusivamente a estabilidade para o ranking de genótipos. Por outro lado, o cenário 0/100 considera exclusivamente a produtividade para o ranking de genótipos.

\hypertarget{performance-e-muxe9dia-harmuxf4nica-dos-valores-genotuxedpicos}{%
\subsubsection{Performance e média harmônica dos valores genotípicos}\label{performance-e-muxe9dia-harmuxf4nica-dos-valores-genotuxedpicos}}

A função \texttt{Resende\_indexes()} computa os índices Média Harmônica dos Valores Genotípicos (MHVG), Performance Relativa dos Valores Genotípicos (PRVG) e Média Harmônica da Performance Relativa dos Valores Genotipicos (MHPRVG), conforme descrito em Colombari Filho et al. (\protect\hyperlink{ref-ColombariFilho2013}{2013}). Estes índices são calculados para cada genótipo de acordo com as seguintes equações.

\[
MHVG_i = \frac{1}{e}\sum\limits_{j = 1}^e {\frac{1}{{G{v_{ij}}}}}
\]

\[
PRVG_i = \frac{1}{e}\sum\limits_{j = 1}^e {G{v_{ij}}/{\mu_j}}
\]

\[
MHPRVG_i = \frac{1}{e}\sum\limits_{j = 1}^e {\frac{1}{{G{v_{ij}}/{\mu_j}}}}
\]

onde \emph{e} é o número de ambientes incluídos na análise, \(Gv_{ij}\) é o valor genotípico (BLUP) para o genótipo \emph{i} no ambiente \emph{j}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Indexes \textless{}{-}}\StringTok{ }\KeywordTok{Resende\_indexes}\NormalTok{(BLUP\_model)}
\KeywordTok{print}\NormalTok{(Indexes}\OperatorTok{$}\NormalTok{GY)}
\CommentTok{\# \# A tibble: 10 x 10}
\CommentTok{\#    GEN       Y  HMGV HMGV\_R  RPGV RPGV\_Y RPGV\_R HMRPGV HMRPGV\_Y HMRPGV\_R}
\CommentTok{\#    \textless{}fct\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}    \textless{}dbl\textgreater{}    \textless{}dbl\textgreater{}}
\CommentTok{\#  1 G1     2.60  2.32      6 0.969   2.59      6  0.967     2.59        6}
\CommentTok{\#  2 G10    2.47  2.11     10 0.913   2.44     10  0.896     2.40       10}
\CommentTok{\#  3 G2     2.74  2.47      4 1.03    2.74      4  1.02      2.73        4}
\CommentTok{\#  4 G3     2.96  2.68      2 1.11    2.96      2  1.10      2.95        2}
\CommentTok{\#  5 G4     2.64  2.39      5 0.990   2.65      5  0.988     2.64        5}
\CommentTok{\#  6 G5     2.54  2.30      8 0.954   2.55      7  0.952     2.55        8}
\CommentTok{\#  7 G6     2.53  2.30      7 0.954   2.55      8  0.952     2.55        7}
\CommentTok{\#  8 G7     2.74  2.52      3 1.04    2.77      3  1.03      2.76        3}
\CommentTok{\#  9 G8     3.00  2.74      1 1.13    3.01      1  1.12      3.00        1}
\CommentTok{\# 10 G9     2.51  2.18      9 0.926   2.48      9  0.917     2.45        9}
\end{Highlighting}
\end{Shaded}

\hypertarget{ammi-ou-blup-decisuxe3o-em-cada-caso}{%
\section{AMMI ou BLUP? Decisão em cada caso!}\label{ammi-ou-blup-decisuxe3o-em-cada-caso}}

Vimos anteriormente que um membro da família de modelos AMMI \indt{AMMI}(AMMI2) é o mais preciso na predição da variável resposta em nosso exemplo. Após analizar-mos os mesmos dados utilizando modelos mistos, nos surge a seguinte questão. Qual é o método mais preciso para predizer a variável resposta em nosso exemplo? A resposta a esta pergunda será dada agora. O pacote \texttt{metan} também conta com uma função para \emph{cross-validation} considerando o modelo misto acima. A idéia é simples. Relizaremos uma validação cruzada semelhante àquela realizada no modelo AMMI e compararemos o RMSPD dos valores preditos utilizando BLUP com aqueles obtidos pelo modelo AMMI.

A função \texttt{cv\_blup()} realiza uma validação cruzada para experimentos com repetição usando modelos mistos. Por padrão, blocos completos são selecionados aleatoriamente em cada ambiente. O procedimento para calcular o RMSPD é idêntico ao apresentado na análise AMMI.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{valida\_blup \textless{}{-}}\StringTok{ }\KeywordTok{cv\_blup}\NormalTok{(data\_ge, ENV, GEN, REP, GY, }\DataTypeTok{nboot =} \DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Para unir os resultados obtidos pelas funções \texttt{cv\_ammif()} e \texttt{cv\_blup()} a função \texttt{bind\_cv()}. Usando o argumento \texttt{bind\ =\ "means"} é possível concatenar os valores médios obtidos por cada modelo. \indf{cv\_ammif} \indf{cv\_blup} \indf{bind\_cv}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{val\_means \textless{}{-}}\StringTok{ }\KeywordTok{bind\_cv}\NormalTok{(AMMIF, valida\_blup, }\DataTypeTok{bind =} \StringTok{"means"}\NormalTok{)}
\NormalTok{val\_means}\OperatorTok{$}\NormalTok{RMSPD}
\CommentTok{\# \# A tibble: 11 x 6}
\CommentTok{\#    MODEL        mean     sd      se  Q2.5 Q97.5}
\CommentTok{\#    \textless{}fct\textgreater{}       \textless{}dbl\textgreater{}  \textless{}dbl\textgreater{}   \textless{}dbl\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\CommentTok{\#  1 BLUP\_g\_RCBD 0.408 0.0232 0.00518 0.370 0.439}
\CommentTok{\#  2 AMMI2       0.411 0.0242 0.00171 0.369 0.460}
\CommentTok{\#  3 AMMI4       0.416 0.0234 0.00166 0.373 0.462}
\CommentTok{\#  4 AMMI3       0.416 0.0215 0.00152 0.377 0.457}
\CommentTok{\#  5 AMMI5       0.422 0.0232 0.00164 0.377 0.464}
\CommentTok{\#  6 AMMI6       0.422 0.0219 0.00155 0.381 0.462}
\CommentTok{\#  7 AMMI7       0.425 0.0199 0.00141 0.381 0.458}
\CommentTok{\#  8 AMMI8       0.427 0.0204 0.00145 0.387 0.462}
\CommentTok{\#  9 AMMIF       0.429 0.0213 0.00150 0.390 0.469}
\CommentTok{\# 10 AMMI1       0.430 0.0251 0.00178 0.384 0.479}
\CommentTok{\# 11 AMMI0       0.430 0.0283 0.00200 0.370 0.485}
\end{Highlighting}
\end{Shaded}

Um gráfico boxplot também pode ser obtido utilizando o argumento \texttt{bind\ =\ "boot"} (padrão).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{val\_plot \textless{}{-}}\StringTok{ }\KeywordTok{bind\_cv}\NormalTok{(AMMIF, valida\_blup)}
\NormalTok{p1 \textless{}{-}}\KeywordTok{plot}\NormalTok{(val\_plot)}
\NormalTok{p2 \textless{}{-}}\KeywordTok{plot}\NormalTok{(val\_plot,}
          \DataTypeTok{width.boxplot =} \FloatTok{0.6}\NormalTok{,}
          \DataTypeTok{col.boxplot =} \StringTok{"cyan"}\NormalTok{)}
\KeywordTok{arrange\_ggplot}\NormalTok{(p1, p2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{html_r_files/figure-latex/unnamed-chunk-376-1} \end{center}

\hypertarget{referuxeancias}{%
\chapter{Referências}\label{referuxeancias}}

\setlength{\parindent}{0in}

\setlength{\parskip}{8pt}

\noindent

\hypertarget{refs}{}
\begin{cslreferences}
\leavevmode\hypertarget{ref-Altman2017}{}%
Altman, N., and M. Krzywinski. 2017. ``Interpreting P values.'' \emph{Nature Methods} 14 (3): 213--14. \url{https://doi.org/10.1038/nmeth.4210}.

\leavevmode\hypertarget{ref-Anderson2003}{}%
Anderson, T. W. 2003. \emph{An introduction to multivariate statistical analysis}. 3rd ed. Wiley-Interscience.

\leavevmode\hypertarget{ref-Annicchiarico1992}{}%
Annicchiarico, P. 1992. ``Cultivar adaptation and recommendation from alfalfa trials in Northern Italy.'' \emph{Journal of Genetics and Breeding} 46: 269--78.

\leavevmode\hypertarget{ref-Baker2016}{}%
Baker, Monya. 2016. ``Statisticians issue warning over misuse of P values.'' \emph{Nature} 531 (7593): 151--51. \url{https://doi.org/10.1038/nature.2016.19503}.

\leavevmode\hypertarget{ref-Bartlett1947}{}%
Bartlett, M. S. 1947. ``The Use of Transformations.'' \emph{Biometrics} 3 (1): 39--52. \url{https://doi.org/10.2307/3001536}.

\leavevmode\hypertarget{ref-Bates1988}{}%
Bates, D. M., and D. G. Watts. 1988. \emph{Nonlinear Regression Analysis and Its Applications}. 2nd ed. Wiley Series in Probability and Statistics. Hoboken, NJ, USA: John Wiley \& Sons, Inc. \url{https://doi.org/10.1002/9780470316757}.

\leavevmode\hypertarget{ref-Blalock1963a}{}%
Blalock, H. M. 1963. ``Correlated independent variables: The problem of multicollinearity.'' \emph{Social Forces} 42 (2): 233--37. \url{https://doi.org/10.1093/sf/42.2.233}.

\leavevmode\hypertarget{ref-Blanca2017}{}%
Blanca, M. J., R. Alarcón, J. Arnau, R. Bono, and R. Bendayan. 2017. ``Non-normal data: Is ANOVA still a valid option?'' \emph{Psicothema} 29 (4): 552--57. \url{https://doi.org/10.7334/psicothema2016.383}.

\leavevmode\hypertarget{ref-Box1964}{}%
Box, G. E. P., and D. R. Cox. 1964. ``An Analysis of Transformations.'' \emph{Journal of the Royal Statistical Society. Series B (Methodological)} 211-252: 211--52. \url{https://doi.org/10.2307/2984418}.

\leavevmode\hypertarget{ref-Breslow1993}{}%
Breslow, N. E., and D. G. Clayton. 1993. ``Approximate Inference in Generalized Linear Mixed Models.'' \emph{Journal of the American Statistical Association} 88 (421): 9--25. \url{https://doi.org/10.2307/2290687}.

\leavevmode\hypertarget{ref-Casella2008}{}%
Casella, George. 2008. \emph{Statistical Design}. Springer Texts in Statistics. New York, NY: Springer New York. \url{https://doi.org/10.1007/978-0-387-75965-4}.

\leavevmode\hypertarget{ref-Charrad2014}{}%
Charrad, Malika, Nadia Ghazzali, Véronique Boiteau, and Azam Niknafs. 2014. ``\textless b\textgreater NbClust\textless/b\textgreater{} : An \textless i\textgreater R\textless/i\textgreater{} Package for Determining the Relevant Number of Clusters in a Data Set.'' \emph{Journal of Statistical Software} 61 (6): 1--36. \url{https://doi.org/10.18637/jss.v061.i06}.

\leavevmode\hypertarget{ref-Chawla2017}{}%
Chawla, D. S. 2017. ``Big names in statistics want to shake up much-maligned P value.'' \emph{Nature} 548 (7665): 16--17. \url{https://doi.org/10.1038/nature.2017.22375}.

\leavevmode\hypertarget{ref-Cochran1940}{}%
Cochran, W. G. 1940. ``The Analysis of Variance when Experimental Errors Follow the Poisson or Binomial Laws.'' \emph{The Annals of Mathematical Statistics} 11 (3): 335--47. \url{https://doi.org/10.1214/aoms/1177731871}.

\leavevmode\hypertarget{ref-ColombariFilho2013}{}%
Colombari Filho, J. M., M. D. V. Resende, O. P. Morais, A. P. Castro, É. P. Guimarães, J. A. Pereira, M. M. Utumi, and F. Breseghello. 2013. ``Upland rice breeding in Brazil: a simultaneous genotypic evaluation of stability, adaptability and grain yield.'' \emph{Euphytica} 192 (1): 117--29. \url{https://doi.org/10.1007/s10681-013-0922-2}.

\leavevmode\hypertarget{ref-Dempster1977}{}%
Dempster, A. P., N. M. Laird, and D. B. Rubin. 1977. ``Maximum likelihood from incomplete data via the EM algorithm.'' \emph{Journal of the Royal Statistical Society, Series B} 39 (1): 1--38. \url{https://www.jstor.org/stable/2984875}.

\leavevmode\hypertarget{ref-Draper1998}{}%
Draper, Norman R, and Harry Smith. 1998. \emph{Applied regression analysis}. John Wiley \& Sons. \url{https://books.google.com.br/books?hl=pt-BR\%7B/\&\%7Dlr=\%7B/\&\%7Did=uSReBAAAQBAJ\%7B/\&\%7Doi=fnd\%7B/\&\%7Dpg=PT12\%7B/\&\%7Dots=P9bwDDSasT\%7B/\&\%7Dsig=4RbKqw-ZEgE40xtra-EsI9dLDPk}.

\leavevmode\hypertarget{ref-Eberhart1966}{}%
Eberhart, S. A., and W. A. Russell. 1966. ``Stability parameters for comparing varieties.'' \emph{Crop Science} 6 (1): 36--40. \url{https://doi.org/10.2135/cropsci1966.0011183X000600010011x}.

\leavevmode\hypertarget{ref-Eisenhart1947}{}%
Eisenhart, C. 1947. ``The assumptions underlying the analysis of variance.'' \emph{Biometrics} 3 (1): 1--21. \url{http://www.ncbi.nlm.nih.gov/pubmed/20240414}.

\leavevmode\hypertarget{ref-Farshadfar2008}{}%
Farshadfar, E. 2008. ``Incorporation of AMMI stability value and grain yield in a single non-parametric index (GSI) in bread wheat.'' \emph{Pakistan Journal of Biological Sciences} 11 (14): 1791--6. \url{https://doi.org/10.3923/pjbs.2008.1791.1796}.

\leavevmode\hypertarget{ref-Ferreira2009}{}%
Ferreira, D. F. 2009. \emph{Estatistica Basica}. Viçosa, MG.: UFV.

\leavevmode\hypertarget{ref-Ferreira2018}{}%
Ferreira, E. B., P. P. Cavalcanti, and D. A. Nogueira. 2018. ``ExpDes: Experimental Designs.'' \url{https://cran.r-project.org/web/packages/ExpDes/index.html}.

\leavevmode\hypertarget{ref-Field2012}{}%
Field, A., J. Miles, and Z. Field. 2012. \emph{Discovering Statistics Using R}. SAGE Publications Ltd. \url{https://us.sagepub.com/en-us/sam/discovering-statistics-using-r/book236067}.

\leavevmode\hypertarget{ref-Fisher1925}{}%
Fisher, R. A. 1925. \emph{Statistical methods for research workers}. 11th ed. Edinburgh: Oliver; Boyd.

\leavevmode\hypertarget{ref-Fisher1935}{}%
---------. 1935. \emph{The design of experiments}. Edinburgh: Oliver; Boyd.

\leavevmode\hypertarget{ref-Fisher1923}{}%
Fisher, R. A., and W. A. Mackenzie. 1923. ``Studies in crop variation. II. The manurial response of different potato varieties.'' \emph{The Journal of Agricultural Science} 13 (03): 311--20. \url{https://doi.org/10.1017/S0021859600003592}.

\leavevmode\hypertarget{ref-Friedman1937}{}%
Friedman, M. 1937. ``The Use of Ranks to Avoid the Assumption of Normality Implicit in the Analysis of Variance.'' \emph{Journal of the American Statistical Association} 32 (200): 675--701. \url{https://doi.org/10.2307/2279372}.

\leavevmode\hypertarget{ref-Gabriel1971}{}%
Gabriel, K. R. 1971. ``The biplot graphic display of matrices with application to principal component analysis.'' \emph{Biometrika} 58 (3): 453--67. \url{https://doi.org/10.2307/2334381}.

\leavevmode\hypertarget{ref-Galton1888}{}%
Galton, Francis. 1888. ``Co-relations and their measurement, chiefly from anthropometric data.'' \emph{Proceedings of the Royal Society of London} 45 (273-279): 135--45. \url{http://rspl.royalsocietypublishing.org/content/45/273-279/135.full.pdf}.

\leavevmode\hypertarget{ref-Gauch1988}{}%
Gauch, H. G. 1988. ``Model selection and validation for yield trials with interaction.'' \emph{Biometrics} 44 (3): 705--15. \url{https://doi.org/10.2307/2531585}.

\leavevmode\hypertarget{ref-Gollob1968}{}%
Gollob, H. F. 1968. ``A statistical model which combines features of factor analytic and analysis of variance techniques.'' \emph{Psychometrika} 33 (1): 73--115. \url{https://doi.org/10.1007/BF02289676}.

\leavevmode\hypertarget{ref-Graham2003}{}%
Graham, Michael H. 2003. ``Confronting Multicollinearity in Ecological Multiple Regression.'' \emph{Ecology} 84 (11): 2809--15. \url{https://doi.org/10.1890/02-3114}.

\leavevmode\hypertarget{ref-Halkidi2001}{}%
Halkidi, Maria, Yannis Batistakis, and Michalis Vazirgiannis. 2001. ``On Clustering Validation Techniques.'' \emph{Journal of Intelligent Information Systems} 17 (2/3): 107--45. \url{https://doi.org/10.1023/A:1012801612483}.

\leavevmode\hypertarget{ref-Hartigan1979}{}%
Hartigan, J. A., and M. A. Wong. 1979. ``Algorithm AS 136: A K-Means Clustering Algorithm.'' \emph{Applied Statistics} 28 (1): 100--108. \url{https://doi.org/10.2307/2346830}.

\leavevmode\hypertarget{ref-Henderson1949}{}%
Henderson, C. R. 1949. ``Estimation of changes in herd environment.'' \emph{Journal of Dairy Science} 32: 706.

\leavevmode\hypertarget{ref-Henderson1950}{}%
---------. 1950. ``Estimation of genetic parameters.'' \emph{Annals of Mathematical Statistics} 21: 309--10.

\leavevmode\hypertarget{ref-Henderson1975}{}%
---------. 1975. ``Best linear unbiased estimation and prediction under a selection model.'' \emph{Biometrics} 31 (2): 423--47. \url{https://doi.org/10.2307/2529430}.

\leavevmode\hypertarget{ref-Henderson1953}{}%
---------. 1953. ``Estimation of Variance and Covariance Components.'' \emph{Biometrics} 9 (2): 226--52. \url{https://doi.org/10.2307/3001853}.

\leavevmode\hypertarget{ref-Hoerl1976}{}%
Hoerl, Arthur E, and Robert W Kennard. 1976. ``Ridge regression iterative estimation of the biasing parameter.'' \emph{Communications in Statistics - Theory and Methods} 5 (1): 77--88. \url{https://doi.org/10.1080/03610927608827333}.

\leavevmode\hypertarget{ref-Hoerl1970}{}%
Hoerl, Arthur E., and Robert W. Kennard. 1970. ``Ridge Regression: Biased Estimation for Nonorthogonal Problems.'' \emph{Technometrics} 12 (1): 55--67. \url{https://doi.org/10.1080/00401706.1970.10488634}.

\leavevmode\hypertarget{ref-Hu2015}{}%
Hu, X. 2015. ``A comprehensive comparison between ANOVA and BLUP to valuate location-specific genotype effects for rape cultivar trials with random locations.'' \emph{Field Crops Research} 179: 144--49. \url{https://doi.org/10.1016/j.fcr.2015.04.023}.

\leavevmode\hypertarget{ref-Hubert1985}{}%
Hubert, Lawrence, and Phipps Arabie. 1985. ``Comparing partitions.'' \emph{Journal of Classification} 2 (1): 193--218. \url{https://doi.org/10.1007/BF01908075}.

\leavevmode\hypertarget{ref-Kaiser1961}{}%
Kaiser, Henry F. 1961. ``A Note on Guttman's Lower Bound for the Number of Common Factors.'' \emph{British Journal of Statistical Psychology} 14 (1): 1--2. \url{https://doi.org/10.1111/j.2044-8317.1961.tb00061.x}.

\leavevmode\hypertarget{ref-Koopman1936}{}%
Koopman, B. O. 1936. ``On distributions admitting a sufficient statistic.'' \emph{Transactions of the American Mathematical Society} 39 (3): 399--409. \url{https://doi.org/10.1090/S0002-9947-1936-1501854-3}.

\leavevmode\hypertarget{ref-Kozak2017}{}%
Kozak, M., and H.-P. Piepho. 2017. ``What's normal anyway? Residual plots are more telling than significance tests when checking ANOVA assumptions.'' \emph{Journal of Agronomy and Crop Science} 204: 86--98. \url{https://doi.org/10.1111/jac.12220}.

\leavevmode\hypertarget{ref-Kruskal1952}{}%
Kruskal, W. H., and W. A. Wallis. 1952. ``Use of Ranks in One-Criterion Variance Analysis.'' \emph{Journal of the American Statistical Association} 47 (260): 583--621. \url{https://doi.org/10.2307/2280779}.

\leavevmode\hypertarget{ref-Krzanowski1988}{}%
Krzanowski, W. J., and Y. T. Lai. 1988. ``A Criterion for Determining the Number of Groups in a Data Set Using Sum-of-Squares Clustering.'' \emph{Biometrics} 44 (1): 23--34. \url{https://doi.org/10.2307/2531893}.

\leavevmode\hypertarget{ref-Krzywinski2013}{}%
Krzywinski, M., and N. Altman. 2013. ``Significance, P values and t-tests.'' \emph{Nature Methods} 10 (11): 1041--2. \url{https://doi.org/10.1038/nmeth.2698}.

\leavevmode\hypertarget{ref-Kutner2005}{}%
Kutner, Michael H., Chris Nachtsheim, John Neter, and William Li. 2005. \emph{Applied linear statistical models}.

\leavevmode\hypertarget{ref-Langsrud2003}{}%
Langsrud, Ø. 2003. ``ANOVA for unbalanced data: Use Type II instead of Type III sums of squares.'' \emph{Statistics and Computing} 13 (2): 163--67. \url{https://doi.org/10.1023/A:1023260610025}.

\leavevmode\hypertarget{ref-Laurent2013}{}%
Laurent, R., and P. Turk. 2013. ``The Effects of Misconceptions on the Properties of Friedman's Test.'' \emph{Communications in Statistics - Simulation and Computation} 42 (7): 1596--1615. \url{https://doi.org/10.1080/03610918.2012.671874}.

\leavevmode\hypertarget{ref-Lin1988}{}%
Lin, C. S., and M. R. Binns. 1988. ``A superiority measure of cultivar performance for cultivar x location data.'' \emph{Canadian Journal of Plant Science} 68 (1): 193--98. \url{https://doi.org/10.4141/cjps88-018}.

\leavevmode\hypertarget{ref-Lucio2016}{}%
Lucio, Alessandro Dal Col, Luis F Nunes, and Francisco Rego. 2016. ``Nonlinear regression and plot size to estimate green beans production.'' \emph{Horticultura Brasileira} 34 (4): 507--13. \url{https://doi.org/10.1590/s0102-053620160409}.

\leavevmode\hypertarget{ref-Lucio2015}{}%
Lúcio, Alessandro Dal Col, Luis Filipe Nunes, and Francisco Rego. 2015. ``Nonlinear models to describe production of fruit in Cucurbita pepo and Capiscum annuum.'' \emph{Scientia Horticulturae} 193: 286--93. \url{https://doi.org/10.1016/j.scienta.2015.07.021}.

\leavevmode\hypertarget{ref-Lucio2017}{}%
Lúcio, Alessandro D., Daniel Santos, and Tiago Olivoto. 2017. ``Variability and Experimental Desing for Trials with Cucurbita pepo and Capsicum annuum.'' \emph{Journal of Agricultural Science} 9 (11): 58--75. \url{https://doi.org/10.5539/jas.v9n11p58}.

\leavevmode\hypertarget{ref-Mayer2014}{}%
Mayer, A., B. Nagengast, J. Fletcher, and R. Steyer. 2014. ``Analyzing average and conditional effects with multigroup multilevel structural equation models.'' \emph{Frontiers in Psychology} 5 (304): 1--16. \url{https://doi.org/10.3389/fpsyg.2014.00304}.

\leavevmode\hypertarget{ref-Miller2001}{}%
Miller, G. A., and J. P. Chapman. 2001. ``Misunderstanding analysis of covariance.'' \emph{Journal of Abnormal Psychology} 110 (1): 40--48. \url{http://www.ncbi.nlm.nih.gov/pubmed/11261398}.

\leavevmode\hypertarget{ref-Milligan1985}{}%
Milligan, Glenn W., and Martha C. Cooper. 1985. ``An examination of procedures for determining the number of clusters in a data set.'' \emph{Psychometrika} 50 (2): 159--79. \url{https://doi.org/10.1007/BF02294245}.

\leavevmode\hypertarget{ref-Mojena1977}{}%
Mojena, R. 1977. ``Hierarchical grouping methods and stopping rules: an evaluation.'' \emph{The Computer Journal} 20 (4): 359--63. \url{https://doi.org/10.1093/comjnl/20.4.359}.

\leavevmode\hypertarget{ref-Mora2008}{}%
Mora, F., L. M. Goncalves, C. A. Scapim, E. N. Martins, and M. F. P. S. Machado. 2008. ``Generalized lineal models for the analysis of binary data from propagation experiments of Brazilian orchids.'' \emph{Brazilian Archives of Biology and Technology} 51 (5): 963--70. \url{https://doi.org/10.1590/S1516-89132008000500013}.

\leavevmode\hypertarget{ref-murakami2004}{}%
Murakami, D. M., and C. D. Cruz. 2004. ``Proposal of methodologies for environment stratification and analysis of genotype adaptability.'' \emph{Crop Breeding and Applied Biotechnology} 4 (1): 7--11. \url{https://doi.org/10.12702/1984-7033.v04n01a02}.

\leavevmode\hypertarget{ref-Nelder1972}{}%
Nelder, J. A., and R. W. M. Wedderburn. 1972. ``Generalized Linear Models.'' \emph{Journal of the Royal Statistical Society. Series A (General)} 135 (3): 370--84. \url{https://doi.org/10.2307/2344614}.

\leavevmode\hypertarget{ref-Niles1922}{}%
Niles, Henry E. 1922. ``Correlation, Causation and Wright's Theory of "Path Coefficients".'' \emph{Genetics} 7 (3): 258--73. \url{http://www.ncbi.nlm.nih.gov/pmc/articles/PMC1200533/}.

\leavevmode\hypertarget{ref-Nuzzo2014}{}%
Nuzzo, Regina. 2014. ``Scientific method: Statistical errors.'' \emph{Nature} 506 (7487): 150--52. \url{https://doi.org/10.1038/506150a}.

\leavevmode\hypertarget{ref-Olivoto2020a}{}%
Olivoto, Tiago, and Alessandro Dal'Col Lúcio. 2020. ``metan: An R package for multi‐environment trial analysis.'' \emph{Methods in Ecology and Evolution} 11 (6): 783--89. \url{https://doi.org/10.1111/2041-210X.13384}.

\leavevmode\hypertarget{ref-Olivoto2019}{}%
Olivoto, Tiago, Alessandro D. C. Lúcio, José A. G. Silva, Volmir S. Marchioro, Velci Q. Souza, and Evandro Jost. 2019a. ``Mean Performance and Stability in Multi‐Environment Trials I: Combining Features of AMMI and BLUP Techniques.'' \emph{Agronomy Journal} 111 (6): 2949--60. \url{https://doi.org/10.2134/agronj2019.03.0220}.

\leavevmode\hypertarget{ref-Olivoto2019a}{}%
Olivoto, Tiago, Alessandro D. C Lúcio, José A. G. Silva, Bruno G. Sari, and Maria I. Diel. 2019b. ``Mean Performance and Stability in Multi‐Environment Trials II: Selection Based on Multiple Traits.'' \emph{Agronomy Journal} 111 (6): 2961--9. \url{https://doi.org/10.2134/agronj2019.03.0221}.

\leavevmode\hypertarget{ref-Olivoto2018}{}%
Olivoto, Tiago, Alessandro D. C Lúcio, Velci Q. de Souza, Maicon Nardino, Maria I. Diel, Bruno G. Sari, Dionatan .K. Krysczun, Daniela Meira, and Carine Meier. 2018. ``Confidence Interval Width for Pearson's Correlation Coefficient: A Gaussian-Independent Estimator Based on Sample Size and Strength of Association.'' \emph{Agronomy Journal} 110 (2): 503--10. \url{https://doi.org/10.2134/agronj2017.09.0566}.

\leavevmode\hypertarget{ref-Olivoto2017c}{}%
Olivoto, Tiago, Maicon Nardino, Ivan Ivan Ricardo Carvalho, Diego Nicolau Follmann, M. Ferrari, Alan J. de Pelegrin, V. Jardel Szareski, Antônio Costa de Oliveira, Braulio Otomar Caron, and Velci Queiroz de Souza. 2017. ``Optimal sample size and data arrangement method in estimating correlation matrices with lesser collinearity: A statistical focus in maize breeding.'' \emph{African Journal of Agricultural Research} 12 (2): 93--103. \url{https://doi.org/10.5897/AJAR2016.11799}.

\leavevmode\hypertarget{ref-Olivoto2017}{}%
Olivoto, T., M. Nardino, I. R. Carvalho, D. N. Follmann, M. Ferrari, V. J. Szareski, A. J. de Pelegrin, and V. Q. de Souza. 2017. ``REML/BLUP and sequential path analysis in estimating genotypic values and interrelationships among simple maize grain yield-related traits.'' \emph{Genetics and Molecular Research} 16 (1): gmr16019525. \url{https://doi.org/10.4238/gmr16019525}.

\leavevmode\hypertarget{ref-Olivoto2017f}{}%
Olivoto, T., V. Q. Souza, M. Nardino, I. R. Carvalho, M. Ferrari, A. J. Pelegrin, V. J. Szareski, and D. Schmidt. 2017. ``Multicollinearity in path analysis: a simple method to reduce its effects.'' \emph{Agronomy Journal} 109 (1): 131--42. \url{https://doi.org/10.2134/agronj2016.04.0196}.

\leavevmode\hypertarget{ref-Patterson1971}{}%
Patterson, H. D., and R. Thompson. 1971. ``Recovery of Inter-Block Information when Block Sizes are Unequal.'' \emph{Biometrika} 58 (3): 545--54. \url{https://doi.org/10.2307/2334389}.

\leavevmode\hypertarget{ref-Pearson1920}{}%
Pearson, K. 1920. ``Notes on the History of Correlation.'' \emph{Biometrika} 13 (1): 25--45. \url{https://doi.org/10.2307/2331722}.

\leavevmode\hypertarget{ref-Piepho2018}{}%
Piepho, H. P., and R. N. Edmondson. 2018. ``A tutorial on the statistical analysis of factorial experiments with qualitative and quantitative treatment factor levels.'' \emph{Journal of Agronomy and Crop Science} 204 (5): 429--55. \url{https://doi.org/10.1111/jac.12267}.

\leavevmode\hypertarget{ref-Purchase2000}{}%
Purchase, J. L., H. Hatting, and C. S. van Deventer. 2000. ``Genotype × environment interaction of winter wheat (Triticum aestivum L.) in South Africa: II. Stability analysis of yield performance.'' \emph{South African Journal of Plant and Soil} 17 (3): 101--7. \url{https://doi.org/10.1080/02571862.2000.10634878}.

\leavevmode\hypertarget{ref-Rencher2008}{}%
Rencher, Alvin C., and G. Bruce. Schaalje. 2008. \emph{Linear models in statistics}. John Wiley \& Sons.

\leavevmode\hypertarget{ref-Rodrigues-Soares2018}{}%
Rodrigues-Soares, J. P, G. F. A. Jesus, E. L. T. Gonçalves, K.TN. Moraes, E. C. Chagas, F. C. M. Chaves, M. A. A. Belo, Adolfo Jatobá, J. L. P. Mouriño, and M. L. Martins. 2018. ``Induced aerocystitis and hemato-immunological parameters in Nile tilapia fed supplemented diet with essential oil of Lippia alba.'' \emph{Brazilian Journal of Veterinary Research and Animal Science} 55 (1): 1--12. \url{https://doi.org/10.11606/issn.1678-4456.bjvras.2018.136717}.

\leavevmode\hypertarget{ref-Rutherford2001}{}%
Rutherford, A. 2001. \emph{Introducing ANOVA and ANCOVA : a GLM approach}. London: SAGE.

\leavevmode\hypertarget{ref-Sari2018}{}%
Sari, B. G. 2018. ``Parametros biologicos da producao de tomateiro via modelo logistico.'' PhD thesis, Universidade Federal de Santa Maria.

\leavevmode\hypertarget{ref-Scheiner2001}{}%
Scheiner, S. M., and J. Gurevitch. 2001. \emph{Design and analysis of ecological experiments}. 2nd ed. New York: Oxford University Press.

\leavevmode\hypertarget{ref-Schneider2009}{}%
Schenider, P. R., P. S. P. Schenider, and C. A. M. Souza. 2009. \emph{Analise de regressao aplicada a engenharia florestal}. Santa Maria: FACOS, UFSM.

\leavevmode\hypertarget{ref-Scott1971}{}%
Scott, A. J., and M. J. Symons. 1971. ``Clustering Methods Based on Likelihood Ratio Criteria.'' \emph{Biometrics} 27 (2): 387--97. \url{https://doi.org/10.2307/2529003}.

\leavevmode\hypertarget{ref-Seber2003}{}%
Seber, G. A. F., and C. J. Wild. 2003. \emph{Nonlinear regression}. John Wiley \& Sons, Inc. \url{https://www.wiley.com/en-us/Nonlinear+Regression-p-9780471471356}.

\leavevmode\hypertarget{ref-Senoglu2001}{}%
Senoglu, Birdal, and Moti L. Tiku. 2001. ``Analysis of variance in experimental design with nonnormal error distributions.'' \emph{Communications in Statistics - Theory and Methods} 30 (7): 1335--52. \url{https://doi.org/10.1081/STA-100104748}.

\leavevmode\hypertarget{ref-Silverman1998}{}%
Silverman, B. W. 1998. \emph{Density Estimation for Statistics and Data Analysis}. New York: Routledge. \url{https://doi.org/10.1201/9781315140919}.

\leavevmode\hypertarget{ref-Smith2005}{}%
Smith, A. B., B. R. Cullis, and R. Thompson. 2005. ``The analysis of crop cultivar breeding and evaluation trials: an overview of current mixed model approaches.'' \emph{The Journal of Agricultural Science} 143 (06): 449--62. \url{https://doi.org/10.1017/S0021859605005587}.

\leavevmode\hypertarget{ref-Snedecor1967}{}%
Snedecor, G. W., and W. G. Cochran. 1967. \emph{Statistical methods}. 6th ed. Ames: Iowa State University Press.

\leavevmode\hypertarget{ref-Sneller1997}{}%
Sneller, C. H., L. Kilgore-Norquest, and D. Dombek. 1997. ``Repeatability of yield stability statistics in soybean.'' \emph{Crop Science} 37 (2): 383--90. \url{https://doi.org/10.2135/cropsci1997.0011183X003700020013x}.

\leavevmode\hypertarget{ref-Stevens2009}{}%
Stevens, James (James Paul). 2009. \emph{Applied multivariate statistics for the social sciences}. Routledge.

\leavevmode\hypertarget{ref-Stroup2013}{}%
Stroup, W. W. 2013. \emph{Generalized linear mixed models : modern concepts, methods and applications}. Boca Raton,FL.: CRC Press.

\leavevmode\hypertarget{ref-Stroup2015}{}%
---------. 2015. ``Rethinking the Analysis of Non-Normal Data in Plant and Soil Science.'' \emph{Agronomy Journal} 107 (2): 811--27. \url{https://doi.org/10.2134/agronj2013.0342}.

\leavevmode\hypertarget{ref-Suzuki2006}{}%
Suzuki, R., and H. Shimodaira. 2006. ``Pvclust: an R package for assessing the uncertainty in hierarchical clustering.'' \emph{Bioinformatics} 22 (12): 1540--2. \url{https://doi.org/10.1093/bioinformatics/btl117}.

\leavevmode\hypertarget{ref-Wickham2009}{}%
Wickham, Hadley. 2009. \emph{Ggplot2 : elegant graphics for data analysis}. Springer. \url{https://doi.org/10.1007/978-0-387-98141-3}.

\leavevmode\hypertarget{ref-Wilkinson2005}{}%
Wilkinson, L. 2005. \emph{The grammar of graphics}. Springer.

\leavevmode\hypertarget{ref-Wolfinger1993}{}%
Wolfinger, R., and M. O'connell. 1993. ``Generalized linear mixed models a pseudo-likelihood approach.'' \emph{Journal of Statistical Computation and Simulation} 48 (3-4): 233--43. \url{https://doi.org/10.1080/00949659308811554}.

\leavevmode\hypertarget{ref-Wright1921}{}%
Wright, Sewall. 1921. ``Correlation and causation.'' \emph{Journal of Agricultural Research} 20 (7): 557--85. \url{http://www.ssc.wisc.edu/soc/class/soc952/Wright/Wright\%7B/_\%7DCorrelation\%20and\%20Causation.pdf}.

\leavevmode\hypertarget{ref-Wright1923}{}%
---------. 1923. ``The Theory of Path Coefficients a Reply to Niles's Criticism.'' \emph{Genetics} 8 (3): 239--55. \url{http://www.ncbi.nlm.nih.gov/pmc/articles/PMC1200747/}.

\leavevmode\hypertarget{ref-Yan2002b}{}%
Yan, Weikai. 2002. ``Singular-Value Partitioning in Biplot Analysis of Multienvironment Trial Data.'' \emph{Agronomy Journal} 94 (5): 990--96. \url{https://doi.org/10.2134/agronj2002.0990}.

\leavevmode\hypertarget{ref-Yan2003}{}%
Yan, Weikai., and Manjit S. Kang. 2003. \emph{GGE biplot analysis: a graphical tool for breeders, geneticists, and agronomists}. CRC Press.

\leavevmode\hypertarget{ref-Yan2007}{}%
Yan, W., M. S. Kang, B. Ma, S. Woods, and P. L. Cornelius. 2007. ``GGE Biplot vs. AMMI analysis of genotype-by-environment data.'' \emph{Crop Science} 47 (2): 641--53. \url{https://doi.org/10.2135/cropsci2006.06.0374}.

\leavevmode\hypertarget{ref-Yates1940}{}%
Yates, F. 1940. ``The recovery of inter-block information in balanced incomplete block designs.'' \emph{Annals of Eugenics} 10 (1): 317--25. \url{https://doi.org/10.1111/j.1469-1809.1940.tb02257.x}.

\leavevmode\hypertarget{ref-Zali2012}{}%
Zali, H., E. Farshadfar, S. H. Sabaghpour, and R. Karimizadeh. 2012. ``Evaluation of genotype × environment interaction in chickpea using measures of stability from AMMI model.'' \emph{Annals of Biological Research} 3 (7): 3126--36. \url{http://eprints.icrisat.ac.in/7173/}.

\leavevmode\hypertarget{ref-Zoz2018}{}%
Zoz, T, F Steiner, A Zoz, D. D. Castagnara, T. W. Witt, M. D. Zanotto, and D. L. Auld. 2018. ``Effect of row spacing and plant density on grain yield and yield components of Crambe abyssinica Hochst.'' \emph{Semina: Ciencias Agrarias} 39 (1): 393--402. \url{https://doi.org/10.5433/1679-0359.2018v39n1p393}.
\end{cslreferences}

\hypertarget{appendix-apuxeandices}{%
\appendix}


\renewcommand{\chaptername}{Apêndice}

\hypertarget{resposta-dos-exercuxedcios}{%
\chapter{Resposta dos exercícios}\label{resposta-dos-exercuxedcios}}

\hypertarget{exerc1}{%
\section{Exercício 1}\label{exerc1}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{F2}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\CommentTok{\# [1] 8}
\KeywordTok{F2}\NormalTok{(}\DataTypeTok{y =} \DecValTok{3}\NormalTok{, }\DataTypeTok{x =}\DecValTok{2}\NormalTok{)}
\CommentTok{\# [1] 8}
\end{Highlighting}
\end{Shaded}

O resultado foi o mesmo, pois embora se tenha invertido o valor dos números, no segundo exemplo se declarou a qual argumento o numero pertencial.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{F3}\NormalTok{(}\DecValTok{20}\NormalTok{)}
\CommentTok{\# Error in F3(20): O argumento x = 20 é inválido. \textquotesingle{}x\textquotesingle{} precisa ser maior que 10}
\end{Highlighting}
\end{Shaded}

Pois o argumento (if x \textgreater{} 10) faz com que ocorra um erro e a função não seja executada.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{elevar}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DataTypeTok{eleva =} \StringTok{"cubico"}\NormalTok{)}
\CommentTok{\# Error in elevar(12, eleva = "cubico"): O argumento eleva = cubico deve ser ou \textquotesingle{}quadrado\textquotesingle{} ou \textquotesingle{}cubo\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

O argumento `eleva' não está correto. Ele deve ser ou `quadrado' ou `cubo'.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mega =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(jogos, }\DataTypeTok{numeros =} \DecValTok{6}\NormalTok{)\{}
  \ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\NormalTok{numeros }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{6}\OperatorTok{:}\DecValTok{15}\NormalTok{))\{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"O numero deve ser entre 6 e 15"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  result =}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{jogos)\{}
\NormalTok{result[[i]] =}\StringTok{ }\KeywordTok{sort}\NormalTok{(}
  \KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{60}\NormalTok{, }\DataTypeTok{size =}\NormalTok{ numeros, }\DataTypeTok{replace =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{  )}
\NormalTok{\}}
  \KeywordTok{return}\NormalTok{(}\KeywordTok{do.call}\NormalTok{(rbind, result))}
\NormalTok{\}}

\CommentTok{\# 4 jogos}
\KeywordTok{mega}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\CommentTok{\#      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]}
\CommentTok{\# [1,]    1    3    8   13   22   27   33   40   54    59}
\CommentTok{\# [2,]    6   16   21   22   38   39   41   42   51    53}
\CommentTok{\# [3,]    2    4   11   13   25   26   27   28   36    49}
\CommentTok{\# [4,]   10   12   21   22   32   35   46   47   59    60}
\CommentTok{\# [5,]    1    2    6   10   21   28   33   35   46    60}
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc2}{%
\section{Exercício 2}\label{exerc2}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{MGRA\_kg =}\NormalTok{ MGRA }\OperatorTok{/}\StringTok{ }\DecValTok{1000}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(AMB, HIB, REP, MGRA\_kg) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{top\_n}\NormalTok{(}\DecValTok{5}\NormalTok{, MGRA\_kg)}
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc3}{%
\section{Exercício 3}\label{exerc3}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(HIB) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{MGRA\_mean =} \KeywordTok{mean}\NormalTok{(MGRA)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Rank =} \KeywordTok{rank}\NormalTok{(MGRA\_mean)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(Rank)}
  
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc4}{%
\section{Exercício 4}\label{exerc4}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH, }\DataTypeTok{colour =}\NormalTok{ AMB, }\DataTypeTok{size =}\NormalTok{ APLA)) }\OperatorTok{+}
\KeywordTok{geom\_point}\NormalTok{()}
  
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc5}{%
\section{Exercício 5}\label{exerc5}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH, }\DataTypeTok{colour =}\NormalTok{ GEN)) }\OperatorTok{+}
\StringTok{     }\KeywordTok{geom\_point}\NormalTok{() }\OperatorTok{+}
\StringTok{     }\KeywordTok{facet\_wrap}\NormalTok{(}\OperatorTok{\textasciitilde{}}\NormalTok{AMB)}\OperatorTok{+}
\StringTok{     }\KeywordTok{my\_theme}\NormalTok{()}
  
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc6}{%
\section{Exercício 6}\label{exerc6}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(dados\_gg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ RG, }\DataTypeTok{y =}\NormalTok{ PH)) }\OperatorTok{+}
\StringTok{     }\KeywordTok{geom\_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =}\NormalTok{ AMB))}\OperatorTok{+}
\StringTok{     }\KeywordTok{geom\_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{se =}\NormalTok{ F)}\OperatorTok{+}
\StringTok{     }\KeywordTok{my\_theme}\NormalTok{()}\OperatorTok{+}
\StringTok{     }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Rendimento de grãos"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Peso hectolitro"}\NormalTok{)}
  
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc7}{%
\section{Exercício 7}\label{exerc7}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{means =}\StringTok{ }\NormalTok{qualitativo }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(HIBRIDO) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{RG =} \KeywordTok{mean}\NormalTok{(RG)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{letras =} \StringTok{"a"}\NormalTok{)}
\KeywordTok{ggplot}\NormalTok{(means, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ HIBRIDO, }\DataTypeTok{y =}\NormalTok{ RG)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_bar}\NormalTok{(}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"orange"}\NormalTok{, }\DataTypeTok{width =} \FloatTok{0.5}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{scale\_y\_continuous}\NormalTok{(}\DataTypeTok{expand =} \KeywordTok{expand\_scale}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{.1}\NormalTok{)))}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{label =}\NormalTok{ letras), }\DataTypeTok{hjust =} \DecValTok{{-}1}\NormalTok{, }\DataTypeTok{size =} \FloatTok{3.5}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_hline}\NormalTok{(}\DataTypeTok{yintercept =} \KeywordTok{mean}\NormalTok{(means}\OperatorTok{$}\NormalTok{RG), }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{coord\_flip}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc8}{%
\section{Exercício 8}\label{exerc8}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot\_lines}\NormalTok{(quantitativo, }\DataTypeTok{x =}\NormalTok{ DOSEN, }\DataTypeTok{y =}\NormalTok{ RG, }\DataTypeTok{fit =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =}\NormalTok{ F)}
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc9}{%
\section{Exercício 9}\label{exerc9}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{with}\NormalTok{(quantitativo, }\KeywordTok{dbc}\NormalTok{(DOSEN, BLOCO, RG, }\DataTypeTok{quali =} \OtherTok{FALSE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc10}{%
\section{Exercício 10}\label{exerc10}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res =}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{Convencional =} \KeywordTok{residuals}\NormalTok{(convencional),}
             \DataTypeTok{Transformado =} \KeywordTok{residuals}\NormalTok{(transform),}
             \DataTypeTok{Generalizado =} \KeywordTok{residuals}\NormalTok{(general, }\DataTypeTok{type =} \StringTok{"deviance"}\NormalTok{))}
\KeywordTok{shapiro.test}\NormalTok{(res}\OperatorTok{$}\NormalTok{Convencional)}
\KeywordTok{shapiro.test}\NormalTok{(res}\OperatorTok{$}\NormalTok{Transformado)}
\KeywordTok{shapiro.test}\NormalTok{(res}\OperatorTok{$}\NormalTok{Generalizado)}
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc11}{%
\section{Exercício 11}\label{exerc11}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot\_factbars}\NormalTok{(FAT1\_CI,}
\NormalTok{              HIBRIDO,}
\NormalTok{              FONTEN,}
              \DataTypeTok{resp =}\NormalTok{ RG,}
              \DataTypeTok{palette =} \StringTok{"Greys"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc12}{%
\section{Exercício 12}\label{exerc12}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{NUPEC\_}\DecValTok{1}\NormalTok{ \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{FAT2\_CI }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(HIBRIDO }\OperatorTok{==}\StringTok{ "NUPEC\_1"}\NormalTok{)}
\KeywordTok{ggplot}\NormalTok{(NUPEC\_}\DecValTok{1}\NormalTok{, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ DOSEN, }\DataTypeTok{y =}\NormalTok{ RG)) }\OperatorTok{+}
\KeywordTok{geom\_point}\NormalTok{()}\OperatorTok{+}
\KeywordTok{stat\_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{formula =} \KeywordTok{as.formula}\NormalTok{(}\StringTok{"y \textasciitilde{} poly(x, 2)"}\NormalTok{)) }\OperatorTok{+}
\KeywordTok{geom\_vline}\NormalTok{(}\DataTypeTok{xintercept =} \DecValTok{50}\NormalTok{, }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\DataTypeTok{col =} \StringTok{"gray"}\NormalTok{) }\OperatorTok{+}
\KeywordTok{geom\_vline}\NormalTok{(}\DataTypeTok{xintercept =} \DecValTok{48}\NormalTok{, }\DataTypeTok{col =} \StringTok{"gray"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{exerc13}{%
\section{Exercício 13}\label{exerc13}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{covar\_mat =}\StringTok{ }\NormalTok{maize }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{split\_factors}\NormalTok{(ENV, }\DataTypeTok{keep\_factors =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{covcor\_design}\NormalTok{(}\DataTypeTok{gen =}\NormalTok{ GEN,}
                \DataTypeTok{rep =}\NormalTok{ REP,}
                \DataTypeTok{resp =} \KeywordTok{c}\NormalTok{(PH, EH, NKE, TKW),}
                \DataTypeTok{type =} \StringTok{"rcov"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{tabela-de-distribuiuxe7uxf5es}{%
\chapter{Tabela de distribuições}\label{tabela-de-distribuiuxe7uxf5es}}

\hypertarget{distribuiuxe7uxe3o-f}{%
\section{Distribuição F}\label{distribuiuxe7uxe3o-f}}

\textbf{Tabela 1.} Limite unilateral da cauda direita da distribuição F de Fisher-Snedecor, 0,01 de probabilidade de erro

\(~\)
\(~\)
\(~\)

\textbf{Tabela 2.} Limite unilateral da cauda direita da distribuição F de Fisher-Snedecor, 0,05 de probabilidade de erro

\(~\)
\(~\)
\(~\)

\hypertarget{tabela-para-o-teste-tukey}{%
\section{Tabela para o teste Tukey}\label{tabela-para-o-teste-tukey}}

\textbf{Tabela 3.} Valores da estatística q para teste de Tukey

\(~\)
\(~\)
\(~\)

\hypertarget{distribuiuxe7uxe3o-t}{%
\section{Distribuição t}\label{distribuiuxe7uxe3o-t}}

\textbf{Tabela 4.} Valores críticos da distribuição t de Student bicaudal em diferentes probabilidades

\(~\)
\(~\)
\(~\)

\hypertarget{distribuiuxe7uxe3o-normal-padruxe3o}{%
\section{Distribuição normal padrão}\label{distribuiuxe7uxe3o-normal-padruxe3o}}

\textbf{Tabela 5.} Valores da distribuição normal padrão. Primeira decimal de Z nas linhas e segunda decimal de Z nas colunas

\(~\)
\(~\)
\(~\)

\hypertarget{distribuiuxe7uxe3o-qui-quadrado}{%
\section{Distribuição qui-quadrado}\label{distribuiuxe7uxe3o-qui-quadrado}}

\textbf{Tabela 6.} Valores críticos (função inversa) em relação a cauda esquerda da distribuição Chi-quadrado

\(~\)
\(~\)
\(~\)

\textbf{Tabela 7.} Valores críticos (função inversa) em relação a cauda direita da distribuição Chi-quadrado

\printindex
\printindex[function]

\end{document}
