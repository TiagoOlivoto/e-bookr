<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 13 Análise multivariada | Software R para avaliação de dados experimentais</title>
<meta name="author" content="Tiago Olivoto, Bruno Giacomini Sari">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.17/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><script src="libs/jszip-1.10.20/jszip.min.js"></script><link href="libs/dt-ext-buttons-1.10.20/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-buttons-1.10.20/js/dataTables.buttons.min.js"></script><script src="libs/dt-ext-buttons-1.10.20/js/buttons.flash.min.js"></script><script src="libs/dt-ext-buttons-1.10.20/js/buttons.html5.min.js"></script><script src="libs/dt-ext-buttons-1.10.20/js/buttons.colVis.min.js"></script><script src="libs/dt-ext-buttons-1.10.20/js/buttons.print.min.js"></script><link href="libs/dt-ext-fixedcolumns-1.10.20/css/fixedColumns.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-fixedcolumns-1.10.20/js/dataTables.fixedColumns.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Um foco em experimentos agronômicos">Software R para avaliação de dados experimentais</a>:
        <small class="text-muted">Um foco em experimentos agronômicos</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefácio</a></li>
<li><a class="" href="sobre-os-autores.html">Sobre os autores</a></li>
<li><a class="" href="detalhes-importantes.html">Detalhes importantes</a></li>
<li class="book-part">O ambiente R</li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introdução ao ambiente R</a></li>
<li><a class="" href="objects.html"><span class="header-section-number">2</span> Tipos de objetos</a></li>
<li><a class="" href="math.html"><span class="header-section-number">3</span> Operações matemáticas</a></li>
<li><a class="" href="loops.html"><span class="header-section-number">4</span> Loops</a></li>
<li><a class="" href="dataframe.html"><span class="header-section-number">5</span> Construindo uma tabela</a></li>
<li class="book-part">Organização, manipulação e apresentação de dados</li>
<li><a class="" href="entrada.html"><span class="header-section-number">6</span> Entrada de dados</a></li>
<li><a class="" href="manipula.html"><span class="header-section-number">7</span> Manipulação de dados</a></li>
<li><a class="" href="graph.html"><span class="header-section-number">8</span> Gráficos com o pacote ggplot2</a></li>
<li><a class="" href="exporta.html"><span class="header-section-number">9</span> Exportando dados</a></li>
<li class="book-part">Análise de dados</li>
<li><a class="" href="analdata.html"><span class="header-section-number">10</span> Análise de dados experimentais</a></li>
<li><a class="" href="reg.html"><span class="header-section-number">11</span> Análise de regressão</a></li>
<li><a class="" href="relations.html"><span class="header-section-number">12</span> Relações lineares entre variáveis</a></li>
<li><a class="active" href="multivariate.html"><span class="header-section-number">13</span> Análise multivariada</a></li>
<li><a class="" href="interaction.html"><span class="header-section-number">14</span> Interação genótipo-vs-ambiente</a></li>
<li><a class="" href="refer%C3%AAncias.html"><span class="header-section-number">15</span> Referências</a></li>
<li class="book-part">Apêndices</li>
<li><a class="" href="resposta-dos-exerc%C3%ADcios.html"><span class="header-section-number">A</span> Resposta dos exercícios</a></li>
<li><a class="" href="tabela-de-distribui%C3%A7%C3%B5es.html"><span class="header-section-number">B</span> Tabela de distribuições</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/TiagoOlivoto/e-bookr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="multivariate" class="section level1" number="13">
<h1>
<span class="header-section-number">Capítulo 13</span> Análise multivariada<a class="anchor" aria-label="anchor" href="#multivariate"><i class="fas fa-link"></i></a>
</h1>
<p>No melhoramento genético de plantas, diversas variáveis são mensuradas em cada genótipo, visando maior segurança na distinção de tais genótipos. Embora em alguns casos possa fazer sentido isolar cada variável e estudá-la separadamente, geralmente, uma análise que englobe todas as variáveis fornece um maior número de informações. Como todo o conjunto de variáveis é medido em cada genótipo, as variáveis serão relacionadas em maior ou menor grau. Consequentemente, se cada variável é analisada isoladamente, a estrutura completa dos dados pode não ser revelada. A análise multivariada é a análise estatística simultânea de uma coleção de variáveis que utilzia informações sobre as relações entre estas. É muito provável que a análise de cada variável separadamente não revele padrões interessantes que a análise multivariada proporciona.</p>
<p>A concepção da análise multivariada  é provavelmente o trabalho realizado por Francis Galton e Karl Pearson no final do século XIX sobre a quantificação da relação entre descendentes e características parentais e o desenvolvimento do coeficiente de correlação <span class="citation">(Galton <a href="refer%C3%AAncias.html#ref-Galton1888" role="doc-biblioref">1888</a>)</span>. Naquele tempo, o processamento computacional era muito limitado para suportar o peso das vastas quantidades de aritmética envolvidas na aplicação dos métodos multivariados que estavam sendo propostos. Assim, os desenvolvimentos eram principalmente matemáticos e a pesquisa multivariada era, na época, em grande parte, um ramo de álgebra linear. No entanto, a chegada e rápida expansão do uso de computadores eletrônicos na segunda metade do século XX, levou à crescente aplicação prática dos métodos existentes de análise multivariada, renovando o interesse no desenvolvimento de novas técnicas.</p>
<p>Nos primeiros anos do século XXI, a ampla disponibilidade de computadores pessoais e laptops relativamente baratos e extremamente poderosos, aliados a softwares estatísticos flexíveis fez com que todos os métodos de análise multivariada pudessem ser aplicados rotineiramente, mesmo para grandes conjuntos de dados, como os gerados em um programa de melhoramento genético –por exemplo, dados de marcadores moleculares e sequenciamento gênico.</p>
<div id="correlações-canônicas" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> Correlações canônicas<a class="anchor" aria-label="anchor" href="#correla%C3%A7%C3%B5es-can%C3%B4nicas"><i class="fas fa-link"></i></a>
</h2>
<p>Correlações canonicas podem ser computadas utilizando a função <code><a href="https://rdrr.io/pkg/metan/man/can_corr.html">can_corr()</a></code> do pacote <code>metan</code>. O primeiro argumento da função é o conjunto de dados (opcional) que deve conter as variáveis numéricas que serão usadas na estimativa das correlações canônicas. Os grupos de variáveis são definidos pelos argumentos <code>FG</code> (primeiro/menor grupo) e <code>SG</code> (segundo/maior grupo). Por padrão, um diagnótico da multicolinearidade é realizado em cada grupo de variável. No exemplo abaixo, os coeficientes foram armazenados no objeto <strong>cc1</strong>. Note que o argumento <code>verbose = FALSE</code> foi utilizado para previnir uma longa saída.</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cc1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/can_corr.html">can_corr</a></span><span class="op">(</span><span class="va">maize</span>,
               FG <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">PH</span>, <span class="va">EH</span>, <span class="va">EP</span><span class="op">)</span>,
               SG <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">EL</span>, <span class="va">ED</span>, <span class="va">CL</span>, <span class="va">CD</span>, <span class="va">CW</span>, <span class="va">KW</span>, <span class="va">NR</span><span class="op">)</span>,
               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cc1</span><span class="op">$</span><span class="va">Sigtest</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#        Var Percent Sum Corr Lambda Chisq DF  p_val</span>
<span class="co"># U1V1 0.632    76.2  76 0.79   0.30 181.8 21 0.0000</span>
<span class="co"># U2V2 0.187    22.5  99 0.43   0.80  32.5 12 0.0012</span>
<span class="co"># U3V3 0.011     1.3 100 0.10   0.99   1.6  5 0.9015</span></code></pre></div>

<div class="dica">
<p>Na função <code><a href="https://rdrr.io/pkg/metan/man/can_corr.html">can_corr()</a></code>, os dados também podem ser passados diretamente pelos argumentos <code>FG</code> e <code>SG</code>, por exemplo, <code>FG = maize[, 4:6]</code>. Alternativamente, dados podem ser passados da função <code><a href="https://rdrr.io/pkg/metan/man/split_factors.html">split_factors()</a></code>. Nesse caso, as correlações canônicas serão estimadas para cada nível da variável de agrupamento nessa função.</p>
</div>
</div>
<div id="análise-de-agrupamento" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> Análise de agrupamento<a class="anchor" aria-label="anchor" href="#an%C3%A1lise-de-agrupamento"><i class="fas fa-link"></i></a>
</h2>
<p>A análise de agrupamento  é um procedimento multivariado muito útil no melhoramento de plantas. O princípio básico é agrupar indivíduos (genótipos) de acordo com suas semelhanças (variáveis analizadas). Esta sessão é focada na estimativa de matrizes de distâncias e na implementação de algorítimos aglomerativos de agrupamento hierárquicos para confecção de dendrogramas.  A função <code><a href="https://rdrr.io/pkg/metan/man/clustering.html">clustering()</a></code>  do pacote <code>metan</code> será utilizada para este fim.</p>
<p>Existem muitos métodos para calcular as informações de (di)similaridade. As opções incluidas na função são: “euclidean” (padrão), “maximum”, “manhattan”, “canberra”, “binary”, “minkowski”, “pearson”, “kendall” e “spearman”. Estas três últimas são distâncias baseadas em correlação. Para maiores informações veja <code><a href="https://rdrr.io/pkg/metan/man/clustering.html">?clustering</a></code>.</p>
<div id="todas-as-linhas-e-todas-as-variáveis-numéricas" class="section level3" number="13.2.1">
<h3>
<span class="header-section-number">13.2.1</span> Todas as linhas e todas as variáveis numéricas<a class="anchor" aria-label="anchor" href="#todas-as-linhas-e-todas-as-vari%C3%A1veis-num%C3%A9ricas"><i class="fas fa-link"></i></a>
</h3>
<p>Por padrão, a função computa as distancias para cada combinação de linhas do conjunto de dados, utilizando todas as variáveis numéricas do conjunto. Isto significa que, considerando o conjunto de dados <strong>maize</strong>, com 156 observações, 12090 distancias serão computadas baseadas nas 15 variáveis numéricas do conjunto.</p>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/clustering.html">clustering</a></span><span class="op">(</span><span class="va">maize</span><span class="op">)</span></code></pre></div>
</div>
<div id="com-base-na-média-de-cada-genótipo" class="section level3" number="13.2.2">
<h3>
<span class="header-section-number">13.2.2</span> Com base na média de cada genótipo<a class="anchor" aria-label="anchor" href="#com-base-na-m%C3%A9dia-de-cada-gen%C3%B3tipo"><i class="fas fa-link"></i></a>
</h3>
<p>Supondo que o pesquisador deseja computar as distancias entre cada genótipo (o que é lógico em melhoramento genético vegetal) e que esta distancia deve ser computada apenas com algumas variáveis numéricas do conjunto de dados, o seguinte código deverá ser utilizado. Para selecionar as variáveis a serem utilziadas, basta apenas fornecer uma lista de nomes separadas por vírgula e sem o uso do conhecido (e ultrapassado) "". Em adição, para que a distância seja computada entre os genótipos, basta passar os dados médios de cada genótipo computados com <code><a href="https://rdrr.io/pkg/metan/man/utils_stats.html">means_by()</a></code> . Neste caso, a média de cada genótipo é calculada internamente para cada variável numérica e a distãncia é computada utilizando estas médias. A função <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> pode ser usada para plotar um dendrograma. Uma linha é desenhada no ponto de corte sugerido de acordo com <span class="citation">Mojena (<a href="refer%C3%AAncias.html#ref-Mojena1977" role="doc-biblioref">1977</a>)</span>.</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mgen</span> <span class="op">&lt;-</span> 
  <span class="va">maize</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/metan/man/utils_stats.html">means_by</a></span><span class="op">(</span><span class="va">GEN</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"GEN"</span><span class="op">)</span>
<span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/clustering.html">clustering</a></span><span class="op">(</span><span class="va">mgen</span>, <span class="va">NKR</span>, <span class="va">TKW</span>, <span class="va">NKE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">d2</span>, horiz <span class="op">=</span> <span class="cn">FALSE</span>, ylab <span class="op">=</span> <span class="st">"Distância euclidiana"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-302-1.png" width="672" style="display: block; margin: auto;"></div>
<p>No dendrograma exibido acima, cada <em>folha</em> corresponde a um genótipo. À medida que subimos na <em>árvore</em>, genótipos que são semelhantes uns aos outros são combinados em <em>ramos</em>, que vão sendo fundidos a uma altura cada vez maior maior. A altura da fusão, fornecida no eixo vertical, indica a (di)similaridade/distância entre dois genótipos. Quanto maior a altura da fusão, menos semelhantes são os genótipos.</p>

<div class="vcsabia">
As inferências sobre a proximidade de dois genótipos são realizadas apenas com base na altura em que as ramificações que contêm estes dois genótipos são fundidas. Não podemos usar a proximidade de dois genótipos ao longo do eixo horizontal como critério de similaridade. Por exemplo, é incorreto dizer que os genotipos <strong>H6</strong> e <strong>H9</strong> são dissimilares só porque eles estão nos extremos do dendrograma.
</div>
<p>Após a confecção do dendrograma , convém avaliar se as distâncias (ou seja, as alturas) na árvore refletem as distâncias originais com precisão. Uma maneira de medir o quão bem o dendrograma gerado reflete seus dados é calcular a correlação entre as distâncias cofenéticas e a matriz de de distância originais. No procedimento anterior o dendrograma não foi mostrado, no entanto, o coeficiente de correlação cofenético foi calculado. Para isto basta incluir o seguinte comando:</p>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d2</span><span class="op">$</span><span class="va">cophenetic</span>
<span class="co"># [1] 0.8640355</span></code></pre></div>
<p>Quanto mais próximo o valor do coeficiente de correlação for de 1, mais precisamente o dendrograma  refletirá as distâncias originais. Valores acima de 0,75 são considerados bons. O método de ligação “average”, ou UPGMA (padrão na função <code><a href="https://rdrr.io/pkg/metan/man/clustering.html">clustering()</a></code> parece produzir altos valores dessa estatística. Esta pode ser uma das razões por que ele é tão popular.</p>
</div>
<div id="seleção-de-variáveis-1" class="section level3" number="13.2.3">
<h3>
<span class="header-section-number">13.2.3</span> Seleção de variáveis<a class="anchor" aria-label="anchor" href="#sele%C3%A7%C3%A3o-de-vari%C3%A1veis-1"><i class="fas fa-link"></i></a>
</h3>
<p>A função <code><a href="https://rdrr.io/pkg/metan/man/clustering.html">clustering()</a></code>  também conta com um algorítimo de seleção de variáveis . O objetivo é selecionar um grupo de variáveis que mais contribuam para explicar a variabilidade dos dados originais. Digamos que se algumas poucas variáveis pudessem ser utilizadas para agrupar os genótipos sem que haja perda de informação, recursos humanos e financeiros poderiam ser poupados. Assim ao envés de avaliarmos 15 variáveis (em nosso exemplo), poderiamos avaliar somente aquelas que realmente contribuiem para a distinção dos genótipos.</p>
<p>O algoritmo de seleção de variáveis é executado quando o argumento <code>selvar = TRUE</code> é incluído na função. A seleção das variáveis é baseada na solução de autovalores/autovetores baseada nos seguintes passos: <strong>1:</strong> calcular a matriz de distância e a correlação cofenética com as variáveis originais (todas as variáveis numéricas no conjunto de dados); <strong>2:</strong> calcular os autovalores e autovetores da matriz de correlação entre as variáveis; <strong>3:</strong> deletar a variável com o maior peso (maior autovetor no menor autovalor); <strong>4:</strong> calcular a matriz de distância e correlação cofenética com as variáveis que restaram; <strong>5:</strong> calcular a correlação de Mantel entre a matriz de distâncias obtidas e a matriz de distância original; <strong>6:</strong> iterar os passos 2 a 5 <em>p</em> - 2 vezes, onde <em>p</em> é o número de variáveis originais. No final das iterações, um resumo dos modelos é retornado. A distância é calculada com as variáveis que geraram o modelo com a maior correlação copenética. Sugerimos uma avaliação criteriosa com o objetivo de escolher um modelo parcimonioso, ou seja, aquele com menor número de variáveis, que apresente correlação cofenética aceitável e alta similaridade com as distâncias originais.</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/clustering.html">clustering</a></span><span class="op">(</span><span class="va">mgen</span>, selvar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># Model 1 with 15 variables. 'EH' excluded in this step (7.1%).</span>
<span class="co"># Model 2 with 14 variables. 'EP' excluded in this step (14.3%).</span>
<span class="co"># Model 3 with 13 variables. 'CDED' excluded in this step (21.4%).</span>
<span class="co"># Model 4 with 12 variables. 'PH' excluded in this step (28.6%).</span>
<span class="co"># Model 5 with 11 variables. 'CL' excluded in this step (35.7%).</span>
<span class="co"># Model 6 with 10 variables. 'NR' excluded in this step (42.9%).</span>
<span class="co"># Model 7 with 9 variables. 'PERK' excluded in this step (50%).</span>
<span class="co"># Model 8 with 8 variables. 'EL' excluded in this step (57.1%).</span>
<span class="co"># Model 9 with 7 variables. 'CD' excluded in this step (64.3%).</span>
<span class="co"># Model 10 with 6 variables. 'ED' excluded in this step (71.4%).</span>
<span class="co"># Model 11 with 5 variables. 'KW' excluded in this step (78.6%).</span>
<span class="co"># Model 12 with 4 variables. 'CW' excluded in this step (85.7%).</span>
<span class="co"># Model 13 with 3 variables. 'NKR' excluded in this step (92.9%).</span>
<span class="co"># Model 14 with 2 variables. 'TKW' excluded in this step (100%).</span>
<span class="co"># Done! </span>
<span class="co"># -------------------------------------------------------------------------- </span>
<span class="co"># </span>
<span class="co"># Summary of the adjusted models </span>
<span class="co"># -------------------------------------------------------------------------- </span>
<span class="co">#     Model excluded cophenetic remaining cormantel    pvmantel</span>
<span class="co">#   Model 1        -  0.8656190        15 1.0000000 0.000999001</span>
<span class="co">#   Model 2       EH  0.8656191        14 1.0000000 0.000999001</span>
<span class="co">#   Model 3       EP  0.8656191        13 1.0000000 0.000999001</span>
<span class="co">#   Model 4     CDED  0.8656191        12 1.0000000 0.000999001</span>
<span class="co">#   Model 5       PH  0.8656189        11 1.0000000 0.000999001</span>
<span class="co">#   Model 6       CL  0.8655939        10 0.9999996 0.000999001</span>
<span class="co">#   Model 7       NR  0.8656719         9 0.9999982 0.000999001</span>
<span class="co">#   Model 8     PERK  0.8657259         8 0.9999977 0.000999001</span>
<span class="co">#   Model 9       EL  0.8657904         7 0.9999972 0.000999001</span>
<span class="co">#  Model 10       CD  0.8658997         6 0.9999964 0.000999001</span>
<span class="co">#  Model 11       ED  0.8658274         5 0.9999931 0.000999001</span>
<span class="co">#  Model 12       KW  0.8643556         4 0.9929266 0.000999001</span>
<span class="co">#  Model 13       CW  0.8640355         3 0.9927593 0.000999001</span>
<span class="co">#  Model 14      NKR  0.8648384         2 0.9925396 0.000999001</span>
<span class="co"># --------------------------------------------------------------------------</span>
<span class="co"># Suggested variables to be used in the analysis </span>
<span class="co"># -------------------------------------------------------------------------- </span>
<span class="co"># The clustering was calculated with the  Model 10 </span>
<span class="co"># The variables included in this model were...</span>
<span class="co">#  ED CW KW NKR TKW NKE </span>
<span class="co"># --------------------------------------------------------------------------</span></code></pre></div>
<p>A saída acima nos mostra o progresso do algorítmo, indicando qual foi a variável excluída em cada passo. Isto pode ser omitido, indicando <code>verbose = FALSE</code> na função. O resumo do modelo (<em>Summary of the adjusted models</em>) nos fornece duas informações muito úteis. Primeira: ao reduzir o número de variáveis utilziadas na estimativa das distâncias, o coeficiente de correlação cofenético não reduziu significativamente, apresentando variação apenas na terceira casa decimal. A segunda, e talvez mais importante, é a correlação de mantel realizada com a matriz de distâncias em cada passo da análise com a matriz de distâncias inicial, que foi computada com todas as variáveis. Percebe-se que utilizando apenas duas variáveis, as distâncias calculadas foram praticamente idênticas (r = 0.992) às distâncias calculadas com todas as variáveis. Por padrão, o algorítmo estima a matriz de distâncias considerando as variáveis do modelo com maior coeficiente de correlação cofenética. Em nosso exemplo, as variáveis utilizadas foram ED, CW, KW, NKR, TKW, e NKE. Veja que reduzimos em um terço o número de variáveis necessárias para diferenciar os tratamentos, sem perda de informação. Salienta-se, no entanto, que este resultado pode não ser reproduzido em um conjunto de dados diferente, cabendo usuário decidir qual é o melhor modelo a ser utilizado.</p>
</div>
<div id="escolha-do-número-de-clusters" class="section level3" number="13.2.4">
<h3>
<span class="header-section-number">13.2.4</span> Escolha do número de clusters<a class="anchor" aria-label="anchor" href="#escolha-do-n%C3%BAmero-de-clusters"><i class="fas fa-link"></i></a>
</h3>
<p>Um dos problemas com o agrupamento  hierárquico é que ele não nos informa quantos clusters existem ou onde cortar o dendrograma  para formar os clusters. Você pode cortar a árvore hierárquica a uma determinada altura, digamos, na média das distâncias, no entanto esta decisão é puramente impirica. Por exemplo, se o ponto de corte for muito alto, tendemos a agrupar genótipos que podem, de fato, não ser semelhantes. Um ponto de corte muito baixo, por outro lado, pode resultar em fracassos na seleção, pois consideramos que os genótipos são distintos, podendo não o serem. Procedimentos estatisticos à exemplo de <span class="citation">Milligan and Cooper (<a href="refer%C3%AAncias.html#ref-Milligan1985" role="doc-biblioref">1985</a>)</span>, <span class="citation">Scott and Symons (<a href="refer%C3%AAncias.html#ref-Scott1971" role="doc-biblioref">1971</a>)</span>, <span class="citation">Krzanowski and Lai (<a href="refer%C3%AAncias.html#ref-Krzanowski1988" role="doc-biblioref">1988</a>)</span>, <span class="citation">Halkidi, Batistakis, and Vazirgiannis (<a href="refer%C3%AAncias.html#ref-Halkidi2001" role="doc-biblioref">2001</a>)</span> e <span class="citation">Hubert and Arabie (<a href="refer%C3%AAncias.html#ref-Hubert1985" role="doc-biblioref">1985</a>)</span> são recomendados para esta escolha. Estes algorítimos estão implementados no pacote <code>NbClust</code> <span class="citation">(Charrad et al. <a href="refer%C3%AAncias.html#ref-Charrad2014" role="doc-biblioref">2014</a>)</span> pode ser utilizado para este fim. Por padrão, a função fornece o ponto de corte calculado pelo método de <span class="citation">Mojena (<a href="refer%C3%AAncias.html#ref-Mojena1977" role="doc-biblioref">1977</a>)</span>.</p>
<p>Procedimentos baseado em reamostragens bootstrap que calcula a probabilidade de erro de cada <em>galho</em> do dendrograma  podem ser utilizados. O código abaixo estima p-valores para cada junção no dendrograma do modelo <code>d3</code>. Para maiore detalhes sobre o métoddo veja <span class="citation">Suzuki and Shimodaira (<a href="refer%C3%AAncias.html#ref-Suzuki2006" role="doc-biblioref">2006</a>)</span>.</p>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pv_clust</span> <span class="op">&lt;-</span> <span class="fu">pvclust</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">d3</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>, nboot <span class="op">=</span> <span class="fl">100</span>, method.dist <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span>
<span class="co"># Bootstrap (r = 0.5)... Done.</span>
<span class="co"># Bootstrap (r = 0.67)... Done.</span>
<span class="co"># Bootstrap (r = 0.83)... Done.</span>
<span class="co"># Bootstrap (r = 1.0)... Done.</span>
<span class="co"># Bootstrap (r = 1.17)... Done.</span>
<span class="co"># Bootstrap (r = 1.33)... Done.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pv_clust</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="fu">pvrect</span><span class="op">(</span><span class="va">pv_clust</span>, alpha <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-306-1.png" width="672" style="display: block; margin: auto;"></div>
<p>O resultado do procedimento bootstrap indicou a formação de dois clusters, com probabilidade de erro de 5%. Assim, nas próximas funções, serão demostrados os diferentes dendrogramas  que podem ser gerados</p>
</div>
<div id="dendrogramas-personalizados" class="section level3" number="13.2.5">
<h3>
<span class="header-section-number">13.2.5</span> Dendrogramas personalizados<a class="anchor" aria-label="anchor" href="#dendrogramas-personalizados"><i class="fas fa-link"></i></a>
</h3>
<p>O pacote <a href="https://cran.r-project.org/web/packages/dendextend/vignettes/introduction.html">factoextra</a> oferece um conjunto de funções para estender objetos dendrogramas em R. Um exemplo simples é dado abaixo.</p>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">de1</span> <span class="op">&lt;-</span> <span class="fu">fviz_dend</span><span class="op">(</span><span class="va">d3</span><span class="op">$</span><span class="va">hc</span>,
                 k <span class="op">=</span> <span class="fl">2</span>,
                 xlab <span class="op">=</span> <span class="st">"Genótipos"</span>,
                 ylab <span class="op">=</span>  <span class="st">"Distância euclidiana"</span>,
                 main <span class="op">=</span> <span class="st">""</span><span class="op">)</span> 
<span class="va">de2</span> <span class="op">&lt;-</span> <span class="fu">fviz_dend</span><span class="op">(</span><span class="va">d3</span><span class="op">$</span><span class="va">hc</span>,
                 k <span class="op">=</span> <span class="fl">2</span>,
                 type <span class="op">=</span> <span class="st">"circular"</span><span class="op">)</span>
<span class="va">de3</span> <span class="op">&lt;-</span> <span class="fu">fviz_dend</span><span class="op">(</span><span class="va">d3</span><span class="op">$</span><span class="va">hc</span>,
                 k <span class="op">=</span> <span class="fl">2</span>,
                 type <span class="op">=</span> <span class="st">"phylogenic"</span>,
                 repel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">de4</span> <span class="op">&lt;-</span> <span class="fu">fviz_dend</span><span class="op">(</span><span class="va">d1</span><span class="op">$</span><span class="va">hc</span>,
                 k <span class="op">=</span> <span class="fl">5</span>,
                 xlab <span class="op">=</span> <span class="st">"Genótipos"</span>,
                 ylab <span class="op">=</span>  <span class="st">"Distância euclidiana"</span>,
                 palette <span class="op">=</span> <span class="st">"jco"</span>,
                 show_labels <span class="op">=</span> <span class="cn">FALSE</span>,
                 main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">cp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">de1</span>, <span class="va">de2</span>, <span class="va">de3</span>, nrow <span class="op">=</span> <span class="fl">1</span>,
                 labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"de1"</span>, <span class="st">"de2"</span>, <span class="st">"de3"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">cp1</span>, <span class="va">de4</span>, rows <span class="op">=</span> <span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"de4"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-307-1.png" width="1152" style="display: block; margin: auto;"></div>
</div>
<div id="distancias-para-cada-ambiente" class="section level3" number="13.2.6">
<h3>
<span class="header-section-number">13.2.6</span> Distancias para cada ambiente<a class="anchor" aria-label="anchor" href="#distancias-para-cada-ambiente"><i class="fas fa-link"></i></a>
</h3>
<p>O seguinte código computa as distâncias para cada nível do fator <strong>AMB</strong> do conjunto de dados maize. A função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>  é utilizada para criar uma lista onde cada elemento conterá os dados de cada ambiente. Note que o argumento <code>keep_factors = TRUE</code> foi utilizado para manter as colunas de fatores. Assim é possível computar a média para cada genótipo quando informado o argumento <code>means_by = GEN</code> na função <code><a href="https://rdrr.io/pkg/metan/man/clustering.html">clustering()</a></code> . O resultado desta função é então passado para a função <code><a href="https://rdrr.io/pkg/metan/man/pairs_mantel.html">pairs_mantel()</a></code>.  Esta função é utilizada para avaliar a associação entre as quatro matrizes de distância.</p>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d4</span> <span class="op">&lt;-</span> 
  <span class="va">maize</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ENV</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/metan/man/clustering.html">clustering</a></span><span class="op">(</span><span class="va">NKR</span>, <span class="va">TKW</span>, <span class="va">NKE</span>, nclust <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/pairs_mantel.html">pairs_mantel</a></span><span class="op">(</span><span class="va">d4</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>, <span class="st">"A4"</span><span class="op">)</span>,
             maxsize <span class="op">=</span> <span class="fl">5</span>, minsize <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-308-1.png" width="288" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="componentes-principais" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> Componentes principais<a class="anchor" aria-label="anchor" href="#componentes-principais"><i class="fas fa-link"></i></a>
</h2>
<div id="conceito" class="section level3" number="13.3.1">
<h3>
<span class="header-section-number">13.3.1</span> Conceito<a class="anchor" aria-label="anchor" href="#conceito"><i class="fas fa-link"></i></a>
</h3>
<p>O objetivo básico da análise de componentes principais (<em>Principal Component Analysis</em>, PCA) é descrever a variação em um conjunto de variáveis correlacionadas <span class="math inline">\(x^T = (x_1, ..., x_q)\)</span>, em termos de um novo conjunto de variáveis não correlacionadas, <span class="math inline">\(y^T = (y_1, ..., y_q)\)</span>, onde cada variável é uma combinação linear das variáveis <em>x</em>. As novas variáveis são ordenadas em ordem decrescente de “importância”, no sentido de que <span class="math inline">\(y_1\)</span> é responsável pelo máximo possível da variação dos dados originais entre todas as combinações lineares de <em>x</em>. Então <span class="math inline">\(y_2\)</span> é escolhido para explicar o máximo possível da variação restante, sujeito a ser não correlacionado com <span class="math inline">\(y_1\)</span>, e assim por diante. As novas variáveis definidas por este processo, <span class="math inline">\(y_1, ..., y_q\)</span>, são os componentes principais. A principal vantagem da análise de componentes principais é que os primeiros componentes serão responsáveis por uma proporção substancial da variação nas variáveis originais, e podem, conseqüentemente, serem usados para fornecer um resumo de dimensões inferiores dessas variáveis.</p>
</div>
<div id="pacotes-r" class="section level3" number="13.3.2">
<h3>
<span class="header-section-number">13.3.2</span> Pacotes R<a class="anchor" aria-label="anchor" href="#pacotes-r"><i class="fas fa-link"></i></a>
</h3>
<p>Diversas funções de diferentes pacotes estão disponíveis no software R para realização da PCA, no entanto, a função <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code> do pacote <strong>stats</strong> (nativa do R) será utilizada aqui. Para a confecção de biplots e extração dos resultados, funções do pacote <a href="https://rpkgs.datanovia.com/factoextra/index.html">factoextra</a> serão utilizadas. O primeiro passo é realizar a instalação e o carregamento do pacote.</p>
</div>
<div id="formato-dos-dados" class="section level3" number="13.3.3">
<h3>
<span class="header-section-number">13.3.3</span> Formato dos dados<a class="anchor" aria-label="anchor" href="#formato-dos-dados"><i class="fas fa-link"></i></a>
</h3>
<p>Para realizar a aplicação da técnica de componentes principais, os dados em <em>data_ge2</em> serão utilizados. Precisamos, primeiramente, organizar os dados de modo que tenhamos uma matriz de dupla entrada, contendo os genótipos nas linhas e as variáveis nas colunas.</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">data_pca</span> <span class="op">&lt;-</span> 
  <span class="va">data_ge2</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/metan/man/utils_stats.html">means_by</a></span><span class="op">(</span><span class="va">GEN</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"GEN"</span><span class="op">)</span></code></pre></div>
<p>Em PCA, as variáveis são frequentemente dimensionadas (isto é, padronizadas). Isto é particularmente recomendado quando as variáveis são medidas em diferentes escalas (quilogramas, quilômetros, centímetros, …). Caso contrário, os resultados da PCA podem ser severamente afetados. Geralmente as variáveis são escalonadas para média zero e variáncia unitária, de acordo com a seguinte fórmula.</p>
<p><span class="math display">\[
x_s = \frac{x_i- mean(x)}{sd(x)}
\]</span></p>
<p>onde <span class="math inline">\(mean(x)\)</span> é a média dos valores de x e <span class="math inline">\(sd(x)\)</span> é o desvio padrão. A função nativa do R <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code> pode ser utilizada para padronizar os dados. Isto pode ser realizado, no entanto, utilizando o argumento <code>scale. = TRUE</code> na função <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code>.</p>
</div>
<div id="código-r" class="section level3" number="13.3.4">
<h3>
<span class="header-section-number">13.3.4</span> Código R<a class="anchor" aria-label="anchor" href="#c%C3%B3digo-r"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res.pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">data_pca</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Para ajudar na interpretação do PCA realizado acima, usaremos funções do pacote factoextra. Essas funções incluem:
<code>get_eigenvalue(res.pca)</code>: Extrai os autovalores/variâncias dos componentes principais
<code>fviz_eig(res.pca)</code>: Para visualizar os autovalores
<code>get_pca_ind(res.pca)</code>, <code>get_pca_var(res.pca)</code>: Para extrair os resultados dos genótipos e variáveis, respectivamente.
<code>fviz_pca_ind(res.pca)</code>, <code>fviz_pca_var(res.pca)</code>: Para visualizar os resultados dos genótipos e variáveis, respectivamente.
<code>fviz_pca_biplot(res.pca)</code>: Para confecção de biplots.</p>
</div>
<div id="autovalores" class="section level3" number="13.3.5">
<h3>
<span class="header-section-number">13.3.5</span> Autovalores<a class="anchor" aria-label="anchor" href="#autovalores"><i class="fas fa-link"></i></a>
</h3>
<p>Os autovalores medem a quantidade de variância retida por cada componente principal. Autovalores são grandes para os primeiros PCs e pequenos para os PCs subseqüentes. Ou seja, os primeiros PCs correspondem às direções com a quantidade máxima de variação no conjunto de dados. Examinamos os autovalores para determinar o número de componentes principais a serem considerados. Os autovalores e a proporção de variâncias (isto é, informação) retidos pelos componentes principais (PCs) são extraídos usando a função <code>get_eigenvalue()</code>.</p>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eig.val</span> <span class="op">&lt;-</span> <span class="fu">get_eigenvalue</span><span class="op">(</span><span class="va">res.pca</span><span class="op">)</span></code></pre></div>
<p>A soma de todos os autovalores resulta em uma variância total de 15 A proporção de variação explicada por cada autovalor é dada na segunda coluna. Por exemplo, 7.623 dividido por 15 é igual a 0.5082, ou, cerca de 50.82% da variação é explicada por este primeiro autovalor. A porcentagem acumulada explicada é obtida adicionando as proporções sucessivas de variação explicadas. Por exemplo, 50.82% mais 18.13% é igual a 68.95% e assim por diante. Assim, cerca de 59,627% da variação é explicada pelos dois primeiros autovalores.</p>

<div class="vcsabia">
<p>Um autovalor maior que 1 indica que os componentes principais são responsáveis por mais variâncias do que as contabilizadas por uma das variáveis originais nos dados padronizados. Isso é comumente usado como um ponto de corte para o qual os PCs são mantidos <span class="citation">(Kaiser <a href="refer%C3%AAncias.html#ref-Kaiser1961" role="doc-biblioref">1961</a>)</span>. No entanto, isto vale apenas quando os dados são padronizados.</p>
</div>
<p>Infelizmente, não há maneira objetiva bem aceita de decidir quantos componentes principais são suficientes. Em nossa análise, os três primeiros componentes principais explicam 83.62% da variação. Esta é uma percentagem aceitavelmente grande. Um método alternativo para determinar o número de componentes principais é olhar para um Scree Plot, que é o gráfico de autovalores ordenados do maior para o menor. O número de componentes é determinado no ponto, além do qual os autovalores remanescentes são todos relativamente pequenos.</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">fviz_eig</span><span class="op">(</span><span class="va">res.pca</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">fviz_eig</span><span class="op">(</span><span class="va">res.pca</span>,
               addlabels <span class="op">=</span> <span class="cn">TRUE</span>,
               geom <span class="op">=</span> <span class="st">"bar"</span>,
               barfill <span class="op">=</span> <span class="st">"orange"</span>,
               barcolor <span class="op">=</span> <span class="st">"black"</span>,
               xlab <span class="op">=</span> <span class="st">"Componentes Principais"</span>,
               ylab <span class="op">=</span> <span class="st">"Percentagem da variância explicada"</span>,
               main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-313"></span>
<img src="html_r_files/figure-html/unnamed-chunk-313-1.png" alt="Autovalores e variância acumulada na análise de componentes principais" width="960"><p class="caption">
Figure 13.1: Autovalores e variância acumulada na análise de componentes principais
</p>
</div>
</div>
<div id="gráfico-das-variáveis" class="section level3" number="13.3.6">
<h3>
<span class="header-section-number">13.3.6</span> Gráfico das variáveis<a class="anchor" aria-label="anchor" href="#gr%C3%A1fico-das-vari%C3%A1veis"><i class="fas fa-link"></i></a>
</h3>
<p>Um método simples para extrair os resultados, para variáveis, de uma saída da função <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code>  é usar a função <code>get_pca_var()</code> . Esta função fornece uma lista de matrizes contendo todos os seguintes resultados:</p>
<ul>
<li>coord: coordenadas de variáveis para criar um gráfico de dispersão.</li>
<li>cos2: representa a qualidade da representação para variáveis no mapa de fatores. É equivalente ao quadrado das coordenadas.</li>
<li>contrib: contém as contribuições (em percentagem) das variáveis para os componentes principais.</li>
</ul>
<div id="círculo-de-correlação" class="section level4" number="13.3.6.1">
<h4>
<span class="header-section-number">13.3.6.1</span> Círculo de correlação<a class="anchor" aria-label="anchor" href="#c%C3%ADrculo-de-correla%C3%A7%C3%A3o"><i class="fas fa-link"></i></a>
</h4>
<p>A correlação entre uma variável e um componente principal (PC) é usada como as coordenadas da variável no PC. Um gráfico pode ser obtido utilizando a função <code>fviz_pca_var()</code>, </p>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">fviz_pca_var</span><span class="op">(</span><span class="va">res.pca</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">fviz_pca_var</span><span class="op">(</span><span class="va">res.pca</span>,
                   col.circle <span class="op">=</span> <span class="st">"red"</span>,
                   xlab <span class="op">=</span> <span class="st">"PCA1 (50,8%)"</span>,
                   ylab <span class="op">=</span> <span class="st">"PCA2 (18,1%)"</span>,
                   geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point"</span>, <span class="st">"arrow"</span>, <span class="st">"text"</span><span class="op">)</span>,
                   title <span class="op">=</span> <span class="st">"Gráfico das variáveis"</span>,
                   repel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-314-1.png" width="960" style="display: block; margin: auto;"></div>
<p>O gráfico acima mostra as relações entre todas as variáveis. Ele pode ser interpretado da seguinte forma:</p>
<ul>
<li>Variáveis positivamente correlacionadas são agrupadas.</li>
<li>Variáveis negativamente correlacionadas são posicionadas em lados opostos da origem do gráfico (quadrantes opostos).</li>
<li>A distância entre as variáveis e a origem mede a qualidade das variáveis no mapa de fatores. Variáveis que estão longe da origem (próximas ao círculo) estão bem representadas no mapa de fatores.</li>
</ul>
</div>
<div id="representação-e-contribuição-das-variáveis" class="section level4" number="13.3.6.2">
<h4>
<span class="header-section-number">13.3.6.2</span> Representação e contribuição das variáveis<a class="anchor" aria-label="anchor" href="#representa%C3%A7%C3%A3o-e-contribui%C3%A7%C3%A3o-das-vari%C3%A1veis"><i class="fas fa-link"></i></a>
</h4>
<p>A qualidade e a contribuição das variáveis pode ser exibida no mapa de fatores utilizando o argumento <code>col.var = "cos2"</code> e <code>col.var = "contrib"</code>, respectivamente. Note que é possível também colorir as variáveis utilizando uma variável categórica. Para fins didáticos criaremos uma variável categórica com três neíveis, baseado no algorítmo kmeans aplicado nas coordenadas das variáveis.</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">fviz_pca_var</span><span class="op">(</span><span class="va">res.pca</span>,
                   col.var <span class="op">=</span> <span class="st">"cos2"</span>,
                   geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point"</span>, <span class="st">"arrow"</span>, <span class="st">"text"</span><span class="op">)</span>,
                   repel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">res.km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="fu">get_pca_var</span><span class="op">(</span><span class="va">res.pca</span><span class="op">)</span><span class="op">$</span><span class="va">coord</span>, centers <span class="op">=</span> <span class="fl">3</span>, nstart <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>
<span class="va">grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">res.km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">fviz_pca_var</span><span class="op">(</span><span class="va">res.pca</span>,
                   col.var <span class="op">=</span> <span class="va">grp</span>,
                   palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>,
                   geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point"</span>, <span class="st">"arrow"</span>, <span class="st">"text"</span><span class="op">)</span>,
                   repel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-315-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="gráfico-de-indivíduos" class="section level3" number="13.3.7">
<h3>
<span class="header-section-number">13.3.7</span> Gráfico de indivíduos<a class="anchor" aria-label="anchor" href="#gr%C3%A1fico-de-indiv%C3%ADduos"><i class="fas fa-link"></i></a>
</h3>
<p>Os resultados, para indivíduos, podem ser extraídos usando a função <code>get_pca_ind()</code>. Similarmente ao <code>get_pca_var()</code>, esta função fornece uma lista de matrizes contendo todos os resultados para os indivíduos (coordenadas, correlação entre indivíduos e eixos, quadrado das distâncias e contribuições). A função <code>fviz_pca_ind()</code> é usada para produzir o gráfico de indivíduos.</p>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">fviz_pca_ind</span><span class="op">(</span><span class="va">res.pca</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">fviz_pca_ind</span><span class="op">(</span><span class="va">res.pca</span>,
                   pointsize <span class="op">=</span> <span class="st">"cos2"</span>, 
                   pointshape <span class="op">=</span> <span class="fl">21</span>,
                   fill <span class="op">=</span> <span class="st">"#E7B800"</span>,
                   repel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-316-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
<div id="gráfico-biplot" class="section level3" number="13.3.8">
<h3>
<span class="header-section-number">13.3.8</span> Gráfico biplot<a class="anchor" aria-label="anchor" href="#gr%C3%A1fico-biplot"><i class="fas fa-link"></i></a>
</h3>
<p>Um gráfico biplot combina os marcadores de variáveis e indivíduos em um mesmo gráfico. A função <code>fviz_pca_biplot()</code> é utilizada para gerar este tipo de gráfico. O primeiro biplot (p1) é confeccionado com o exemplo em <code>res.pca</code>. Um exemplo um pouco mais complexo será mostrado utilizando o banco de dados do R iris. Neste exemplo, os indivíduos são coloridos por grupos (cor discreta) e variáveis por suas contribuições para os componentes principais (cores de gradiente). Além disso, alteraremos a transparência das variáveis por suas contribuições usando o argumento <code>alpha.var</code>. </p>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">fviz_pca_biplot</span><span class="op">(</span><span class="va">res.pca</span><span class="op">)</span>

<span class="va">iris.pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="op">-</span><span class="fl">5</span><span class="op">]</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">fviz_pca_biplot</span><span class="op">(</span><span class="va">iris.pca</span>, 
                <span class="co"># indivíduos</span>
                geom.ind <span class="op">=</span> <span class="st">"point"</span>,
                fill.ind <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, col.ind <span class="op">=</span> <span class="st">"black"</span>,
                pointshape <span class="op">=</span> <span class="fl">21</span>, pointsize <span class="op">=</span> <span class="fl">2</span>,
                palette <span class="op">=</span> <span class="st">"jco"</span>,
                addEllipses <span class="op">=</span> <span class="cn">TRUE</span>,
                repel <span class="op">=</span> <span class="cn">TRUE</span>,
                <span class="co"># variáveis</span>
                alpha.var <span class="op">=</span><span class="st">"contrib"</span>, col.var <span class="op">=</span> <span class="st">"contrib"</span>,
                gradient.cols <span class="op">=</span> <span class="st">"RdYlBu"</span>,
                legend.title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Especies"</span>,
                                    color <span class="op">=</span> <span class="st">"Contribuição"</span>,
                                    alpha <span class="op">=</span> <span class="st">"Contribuição"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span><span class="op">)</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-317-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="k-means" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> K-means<a class="anchor" aria-label="anchor" href="#k-means"><i class="fas fa-link"></i></a>
</h2>
<div id="conceito-1" class="section level3" number="13.4.1">
<h3>
<span class="header-section-number">13.4.1</span> Conceito<a class="anchor" aria-label="anchor" href="#conceito-1"><i class="fas fa-link"></i></a>
</h3>
<p>A idéia básica por trás do agrupamento  <em>k</em>-means consiste em definir clusters para que a variação total dentro do cluster seja minimizada. Existem vários algoritmos <em>k</em>-means disponíveis. O algoritmo padrão e o mais utilizado é o algoritmo de Hartigan-Wong <span class="citation">(Hartigan and Wong <a href="refer%C3%AAncias.html#ref-Hartigan1979" role="doc-biblioref">1979</a>)</span>, que define a variação total dentro do cluster como a soma das distâncias Euclidianas quadráticas entre os itens e o centróide correspondente. Os passos básicos para a análise são os que seguem:</p>
<ol style="list-style-type: decimal">
<li>Especifique o número de clusters (<em>k</em>) a serem criados;</li>
<li>Selecione aleatoriamente k objetos do conjunto de dados como os centros de clusters iniciais ou médias;</li>
<li>Atribua cada observação ao seu centróide mais próximo, com base na distância euclidiana entre o objeto e o centróide;</li>
<li>Para cada um dos <em>k</em> clusters, atualize o centróide do cluster calculando os novos valores médios de todos os pontos de dados no cluster. O centróide do <em>k</em>-ésimo cluster é um vetor de comprimento p (p = número de variáveis) contendo as médias de todas as variáveis para as observações no <em>k</em>-ésimo cluster;</li>
<li>Iterativamente, minimize a soma de quadrados total dentro do cluster; isto é, iterar as etapas 3 e 4 até que as atribuições do cluster parem de mudar ou até que o número máximo de iterações sejam atingidas. Por padrão, o software R usa 10 como o valor padrão para o número máximo de iterações.</li>
</ol>
</div>
<div id="pacotes-r-1" class="section level3" number="13.4.2">
<h3>
<span class="header-section-number">13.4.2</span> Pacotes R<a class="anchor" aria-label="anchor" href="#pacotes-r-1"><i class="fas fa-link"></i></a>
</h3>
<p>Para implementar o método <em>k</em>-means, a função <code><a href="https://rdrr.io/r/stats/kmeans.html">kmeans()</a></code> do pacote <strong>stats</strong> (nativa do R) será utilizada. Para a confecção do gráfico, a função <code>fviz_cluster()</code>  do pacote <a href="https://rpkgs.datanovia.com/factoextra/index.html">factoextra</a> será utilizada.</p>
</div>
<div id="formato-dos-dados-e-códigos-r" class="section level3" number="13.4.3">
<h3>
<span class="header-section-number">13.4.3</span> Formato dos dados e códigos R<a class="anchor" aria-label="anchor" href="#formato-dos-dados-e-c%C3%B3digos-r"><i class="fas fa-link"></i></a>
</h3>
<p>O formato dos dados utilizados é o mesmo dos utilizados para realizar a <a href="multivariate.html#componentes-principais">análise de componentes principais</a>. Assim, neste exemplo, somente criaremos um novo conjunto renomeando os dados organizados anteriormente (<code>data_pca</code>) para <code>data_km</code>. O próximo passo é ajustar o modelo <em>k</em>-means e armazenar em um objeto, em nosso exemplo, <code>kmres</code>. Posteriormente, a função <code>fviz_cluster()</code> é utilizada para confeccionar o gráfico.</p>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_km</span> <span class="op">&lt;-</span> <span class="va">data_pca</span>
<span class="va">km.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">data_km</span>, <span class="fl">2</span>, nstart <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">fviz_cluster</span><span class="op">(</span><span class="va">km.res</span>, data <span class="op">=</span> <span class="va">data_pca</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">fviz_cluster</span><span class="op">(</span><span class="va">km.res</span>,
                   data <span class="op">=</span> <span class="va">data_pca</span>,
                   ellipse <span class="op">=</span> <span class="cn">TRUE</span>,
                   main <span class="op">=</span> <span class="st">""</span>,
                   ellipse.type <span class="op">=</span> <span class="st">"confidence"</span>,
                   ggtheme <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/themes.html">theme_metan</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-318-1.png" width="960" style="display: block; margin: auto;"></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="relations.html"><span class="header-section-number">12</span> Relações lineares entre variáveis</a></div>
<div class="next"><a href="interaction.html"><span class="header-section-number">14</span> Interação genótipo-vs-ambiente</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#multivariate"><span class="header-section-number">13</span> Análise multivariada</a></li>
<li><a class="nav-link" href="#correla%C3%A7%C3%B5es-can%C3%B4nicas"><span class="header-section-number">13.1</span> Correlações canônicas</a></li>
<li>
<a class="nav-link" href="#an%C3%A1lise-de-agrupamento"><span class="header-section-number">13.2</span> Análise de agrupamento</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#todas-as-linhas-e-todas-as-vari%C3%A1veis-num%C3%A9ricas"><span class="header-section-number">13.2.1</span> Todas as linhas e todas as variáveis numéricas</a></li>
<li><a class="nav-link" href="#com-base-na-m%C3%A9dia-de-cada-gen%C3%B3tipo"><span class="header-section-number">13.2.2</span> Com base na média de cada genótipo</a></li>
<li><a class="nav-link" href="#sele%C3%A7%C3%A3o-de-vari%C3%A1veis-1"><span class="header-section-number">13.2.3</span> Seleção de variáveis</a></li>
<li><a class="nav-link" href="#escolha-do-n%C3%BAmero-de-clusters"><span class="header-section-number">13.2.4</span> Escolha do número de clusters</a></li>
<li><a class="nav-link" href="#dendrogramas-personalizados"><span class="header-section-number">13.2.5</span> Dendrogramas personalizados</a></li>
<li><a class="nav-link" href="#distancias-para-cada-ambiente"><span class="header-section-number">13.2.6</span> Distancias para cada ambiente</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#componentes-principais"><span class="header-section-number">13.3</span> Componentes principais</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#conceito"><span class="header-section-number">13.3.1</span> Conceito</a></li>
<li><a class="nav-link" href="#pacotes-r"><span class="header-section-number">13.3.2</span> Pacotes R</a></li>
<li><a class="nav-link" href="#formato-dos-dados"><span class="header-section-number">13.3.3</span> Formato dos dados</a></li>
<li><a class="nav-link" href="#c%C3%B3digo-r"><span class="header-section-number">13.3.4</span> Código R</a></li>
<li><a class="nav-link" href="#autovalores"><span class="header-section-number">13.3.5</span> Autovalores</a></li>
<li><a class="nav-link" href="#gr%C3%A1fico-das-vari%C3%A1veis"><span class="header-section-number">13.3.6</span> Gráfico das variáveis</a></li>
<li><a class="nav-link" href="#gr%C3%A1fico-de-indiv%C3%ADduos"><span class="header-section-number">13.3.7</span> Gráfico de indivíduos</a></li>
<li><a class="nav-link" href="#gr%C3%A1fico-biplot"><span class="header-section-number">13.3.8</span> Gráfico biplot</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#k-means"><span class="header-section-number">13.4</span> K-means</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#conceito-1"><span class="header-section-number">13.4.1</span> Conceito</a></li>
<li><a class="nav-link" href="#pacotes-r-1"><span class="header-section-number">13.4.2</span> Pacotes R</a></li>
<li><a class="nav-link" href="#formato-dos-dados-e-c%C3%B3digos-r"><span class="header-section-number">13.4.3</span> Formato dos dados e códigos R</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/TiagoOlivoto/e-bookr/blob/master/13-multivariate.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/TiagoOlivoto/e-bookr/edit/master/13-multivariate.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Software R para avaliação de dados experimentais</strong>: Um foco em experimentos agronômicos" was written by Tiago Olivoto, Bruno Giacomini Sari. It was last built on 2021-01-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
