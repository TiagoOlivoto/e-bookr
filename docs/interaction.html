<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 14 Interação genótipo-vs-ambiente | Software R para avaliação de dados experimentais</title>
<meta name="author" content="Tiago Olivoto, Bruno Giacomini Sari">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.17/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><script src="libs/jszip-1.10.20/jszip.min.js"></script><link href="libs/dt-ext-buttons-1.10.20/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-buttons-1.10.20/js/dataTables.buttons.min.js"></script><script src="libs/dt-ext-buttons-1.10.20/js/buttons.flash.min.js"></script><script src="libs/dt-ext-buttons-1.10.20/js/buttons.html5.min.js"></script><script src="libs/dt-ext-buttons-1.10.20/js/buttons.colVis.min.js"></script><script src="libs/dt-ext-buttons-1.10.20/js/buttons.print.min.js"></script><link href="libs/dt-ext-fixedcolumns-1.10.20/css/fixedColumns.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-fixedcolumns-1.10.20/js/dataTables.fixedColumns.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Um foco em experimentos agronômicos">Software R para avaliação de dados experimentais</a>:
        <small class="text-muted">Um foco em experimentos agronômicos</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefácio</a></li>
<li><a class="" href="sobre-os-autores.html">Sobre os autores</a></li>
<li><a class="" href="detalhes-importantes.html">Detalhes importantes</a></li>
<li class="book-part">O ambiente R</li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introdução ao ambiente R</a></li>
<li><a class="" href="objects.html"><span class="header-section-number">2</span> Tipos de objetos</a></li>
<li><a class="" href="math.html"><span class="header-section-number">3</span> Operações matemáticas</a></li>
<li><a class="" href="loops.html"><span class="header-section-number">4</span> Loops</a></li>
<li><a class="" href="dataframe.html"><span class="header-section-number">5</span> Construindo uma tabela</a></li>
<li class="book-part">Organização, manipulação e apresentação de dados</li>
<li><a class="" href="entrada.html"><span class="header-section-number">6</span> Entrada de dados</a></li>
<li><a class="" href="manipula.html"><span class="header-section-number">7</span> Manipulação de dados</a></li>
<li><a class="" href="graph.html"><span class="header-section-number">8</span> Gráficos com o pacote ggplot2</a></li>
<li><a class="" href="exporta.html"><span class="header-section-number">9</span> Exportando dados</a></li>
<li class="book-part">Análise de dados</li>
<li><a class="" href="analdata.html"><span class="header-section-number">10</span> Análise de dados experimentais</a></li>
<li><a class="" href="reg.html"><span class="header-section-number">11</span> Análise de regressão</a></li>
<li><a class="" href="relations.html"><span class="header-section-number">12</span> Relações lineares entre variáveis</a></li>
<li><a class="" href="multivariate.html"><span class="header-section-number">13</span> Análise multivariada</a></li>
<li><a class="active" href="interaction.html"><span class="header-section-number">14</span> Interação genótipo-vs-ambiente</a></li>
<li><a class="" href="refer%C3%AAncias.html"><span class="header-section-number">15</span> Referências</a></li>
<li class="book-part">Apêndices</li>
<li><a class="" href="resposta-dos-exerc%C3%ADcios.html"><span class="header-section-number">A</span> Resposta dos exercícios</a></li>
<li><a class="" href="tabela-de-distribui%C3%A7%C3%B5es.html"><span class="header-section-number">B</span> Tabela de distribuições</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/TiagoOlivoto/e-bookr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="interaction" class="section level1" number="14">
<h1>
<span class="header-section-number">Capítulo 14</span> Interação genótipo-<em>vs</em>-ambiente<a class="anchor" aria-label="anchor" href="#interaction"><i class="fas fa-link"></i></a>
</h1>
<p>Uma cultura pode ser vista como um sistema complexo com resultados (por exemplo, rendimento de grãos) que são afetados por informações genéticas, fisiológicas, pedoclimáticas e de manejo. Melhoristas e geneticistas se esforçam continuamente para aumentar a produtividade das culturas visando suprir a demanda mundial cada vez maior por alimentos. É na fase final de um programa de melhoramento de plantas que muito esforço e recursos precisam ser investidos na avaliação dos genótipos (<em><em>g</em></em>) a serem selecionados. Geralmente algumas centenas de genótipos precisam ser avaliados em um grande número de ambientes (<em><em>e</em></em>). Estes ensaios são conhecidos como ensaios multi-ambientes () e os dados destes experimentos resultam em uma matriz <strong><em>M</em></strong> de dimensões <span class="math inline">\(g \times e\)</span> . É nesta fase do processo que surge um dos maiores desafios da análise de : compreender a interação genótipo-<em>vs</em>-ambiente buscando novas formas de explorá-la e utilizá-la a favor da seleção de genótipos com estabilidade  produtiva satisfatória.</p>
<p>Funções do pacote <code>metan</code>, acrônimo para <strong>m</strong>ulti <strong>e</strong>nvironment <strong>t</strong>rial <strong>an</strong>alysis serão utilizadas para análise de dados de ensaios multi-ambientes. <img style="float: right;" src="figures/metan.png" width="160" height="181.2"> O foi desenvolvido em linguagem R e é distribuído sob a licença GPL (General Public Licence) 3.0. Isto significa que qualquer pessoa pode: (i) utilizar o código sem nenhuma restrição/pagamento; (ii) estudar o código e adaptá-lo às suas necessidades; (iii) sugerir modificações/melhorias no código de modo a aperfeiçoá-lo para uma comunidade maior de usuários, mantendo, porém, os direitos do autor. O pacote <code>metan</code> fornece funções úteis para analisar dados de ensaios multi-ambientes usando métodos paramétricos e não paramétricos, incluindo, mas não limitados a:</p>
<ul>
<li>Análise gráfica da interação genótipo-<em>vs</em>-ambiente;</li>
<li>Análise de variância individual</li>
<li>Procedimentos de validação cruzada para modelos da família AMMI e BLUP;</li>
<li>Estimativas usando AMMI com diferentes números de termos multiplicativos;</li>
<li>Índices de estabilidade baseados em AMMI;</li>
<li>Biplots baseados no modelo GGE;</li>
<li>Predição baseada em modelos de efeito misto;</li>
<li>Índices de estabilidade baseados em BLUP;</li>
<li>Componentes de variância e parâmetros genéticos em modelos de efeito misto;</li>
<li>Ferramentas gráficas para confecção de biplots.</li>
<li>Estatísticas de estabilidade paramétrica e não paramétrica.</li>
</ul>
<p>Nesta seção, usaremos o conjunto de dados <code>data_ge</code> disponível no pacote <code>metan</code>. Para mais informações, por favor, consulte <code><a href="https://rdrr.io/pkg/metan/man/data_ge.html">?data_ge</a></code>. Outros conjuntos de dados podem ser usados desde que as seguintes colunas estejam no conjunto de dados: ambiente, genótipo, bloco e variável(eis) resposta.</p>
<div id="análise-gráfica-da-interação" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> Análise gráfica da interação<a class="anchor" aria-label="anchor" href="#an%C3%A1lise-gr%C3%A1fica-da-intera%C3%A7%C3%A3o"><i class="fas fa-link"></i></a>
</h2>
<p>A função <code><a href="https://rdrr.io/pkg/metan/man/ge_plot.html">ge_plot()</a></code> pode ser usada para visualizar o desempenho do genótipo através dos ambientes. O losango preto mostra a média para cada ambiente.</p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/ge_plot.html">ge_plot</a></span> <span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span><span class="op">)</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/ge_plot.html">ge_plot</a></span> <span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span> <span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-319-1.png" width="960" style="display: block; margin: auto;"></div>
<p>Para identificar o genótipo vencedor em cada ambiente, podemos usar a função <code><a href="https://rdrr.io/pkg/metan/man/ge_winners.html">ge_winners()</a></code>.</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/metan/man/ge_winners.html">ge_winners</a></span><span class="op">(</span><span class="va">data_ge2</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, resp <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co"># # A tibble: 4 x 16</span>
<span class="co">#   ENV   PH    EH    EP    EL    ED    CL    CD    CW    KW    NR    NKR   CDED </span>
<span class="co">#   &lt;fct&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co"># 1 A1    H3    H1    H1    H6    H6    H8    H6    H6    H6    H2    H4    H8   </span>
<span class="co"># 2 A2    H2    H1    H1    H6    H2    H2    H6    H2    H2    H2    H6    H13  </span>
<span class="co"># 3 A3    H13   H13   H6    H4    H13   H6    H2    H7    H13   H13   H4    H6   </span>
<span class="co"># 4 A4    H5    H5    H10   H7    H11   H5    H7    H5    H7    H11   H9    H10  </span>
<span class="co"># # ... with 3 more variables: PERK &lt;chr&gt;, TKW &lt;chr&gt;, NKE &lt;chr&gt;</span></code></pre></div>
<p>Ou obtenha a classificação dos genótipos em cada ambiente.</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/metan/man/ge_winners.html">ge_winners</a></span><span class="op">(</span><span class="va">data_ge2</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, resp <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span> <span class="op">(</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"ranks"</span><span class="op">)</span>
<span class="co"># # A tibble: 52 x 16</span>
<span class="co">#    ENV   PH    EH    EP    EL    ED    CL    CD    CW    KW    NR    NKR   CDED </span>
<span class="co">#    &lt;fct&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#  1 A1    H3    H1    H1    H6    H6    H8    H6    H6    H6    H2    H4    H8   </span>
<span class="co">#  2 A1    H9    H4    H10   H11   H13   H9    H11   H8    H13   H13   H5    H9   </span>
<span class="co">#  3 A1    H4    H9    H4    H10   H10   H6    H9    H9    H9    H3    H6    H7   </span>
<span class="co">#  4 A1    H5    H10   H7    H4    H9    H10   H10   H7    H2    H7    H11   H12  </span>
<span class="co">#  5 A1    H2    H7    H12   H5    H8    H13   H5    H5    H1    H12   H3    H11  </span>
<span class="co">#  6 A1    H10   H5    H11   H9    H2    H7    H4    H13   H4    H8    H2    H10  </span>
<span class="co">#  7 A1    H7    H3    H6    H3    H3    H12   H8    H4    H3    H6    H1    H6   </span>
<span class="co">#  8 A1    H13   H11   H9    H7    H1    H11   H3    H12   H8    H10   H13   H13  </span>
<span class="co">#  9 A1    H6    H13   H13   H1    H7    H5    H7    H10   H5    H4    H8    H5   </span>
<span class="co"># 10 A1    H11   H6    H5    H12   H4    H1    H1    H3    H10   H1    H12   H1   </span>
<span class="co"># # ... with 42 more rows, and 3 more variables: PERK &lt;chr&gt;, TKW &lt;chr&gt;, NKE &lt;chr&gt;</span></code></pre></div>
<p>Para mais detalhes sobre os testes, podemos usar <code><a href="https://rdrr.io/pkg/metan/man/ge_details.html">ge_details()</a></code></p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/metan/man/ge_details.html">ge_details</a></span><span class="op">(</span><span class="va">data_ge2</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, resp <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co"># # A tibble: 10 x 16</span>
<span class="co">#    Parameters PH    EH    EP    EL    ED    CL    CD    CW    KW    NR    NKR  </span>
<span class="co">#    &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#  1 Mean       "2.4~ "1.3~ "0.5~ "15.~ "49.~ "29.~ "15.~ "24.~ "172~ "16.~ "32.~</span>
<span class="co">#  2 SE         "0.0~ "0.0~ "0"   "0.1" "0.2~ "0.1~ "0.0~ "0.5" "2.6~ "0.1~ "0.2~</span>
<span class="co">#  3 SD         "0.3~ "0.2~ "0.0~ "1.2~ "2.7~ "2.3" "1.1~ "6.2~ "32.~ "1.6~ "3.4~</span>
<span class="co">#  4 CV         "13.~ "21.~ "10.~ "8.2~ "5.5~ "7.9~ "7.3~ "25.~ "18.~ "10.~ "10.~</span>
<span class="co">#  5 Min        "1.7~ "0.7~ "0.3~ "11.~ "43.~ "23.~ "12.~ "11.~ "105~ "12.~ "23.~</span>
<span class="co">#  6 Max        "3.0~ "1.8~ "0.6~ "17.~ "54.~ "34.~ "18.~ "38.~ "250~ "21.~ "42 ~</span>
<span class="co">#  7 MinENV     "A3 ~ "A3 ~ "A3 ~ "A3 ~ "A3 ~ "A3 ~ "A3 ~ "A3 ~ "A3 ~ "A3 ~ "A3 ~</span>
<span class="co">#  8 MaxENV     "A1 ~ "A1 ~ "A1 ~ "A1 ~ "A1 ~ "A1 ~ "A1 ~ "A1 ~ "A1 ~ "A1 ~ "A1 ~</span>
<span class="co">#  9 MinGEN     "H10~ "H8 ~ "H8 ~ "H12~ "H9 ~ "H12~ "H12~ "H11~ "H9 ~ "H9 ~ "H12~</span>
<span class="co"># 10 MaxGEN     "H1 ~ "H1 ~ "H1 ~ "H6 ~ "H6 ~ "H6 ~ "H5 ~ "H5 ~ "H6 ~ "H13~ "H4 ~</span>
<span class="co"># # ... with 4 more variables: CDED &lt;chr&gt;, PERK &lt;chr&gt;, TKW &lt;chr&gt;, NKE &lt;chr&gt;</span></code></pre></div>
</div>
<div id="análise-de-variância-individual" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> Análise de variância individual<a class="anchor" aria-label="anchor" href="#an%C3%A1lise-de-vari%C3%A2ncia-individual"><i class="fas fa-link"></i></a>
</h2>
<p>A função <code><a href="https://rdrr.io/pkg/metan/man/anova_ind.html">anova_ind()</a></code>  pode ser utilziada para realizar uma análise de variância para cada ambiente, conforme o seguinte código.</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/anova_ind.html">anova_ind</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ind</span><span class="op">$</span><span class="va">GY</span><span class="op">$</span><span class="va">individual</span><span class="op">)</span>
<span class="co"># # A tibble: 14 x 12</span>
<span class="co">#    ENV    MEAN   MSG   FCG     PFG    MSB    FCB     PFB    MSE    CV    h2</span>
<span class="co">#    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 E1     2.52 0.337  2.34 5.94e-2 0.0652  0.453 6.43e-1 0.144  15.1  0.573</span>
<span class="co">#  2 E10    2.18 0.296 11.1  1.10e-5 0.654  24.5   7.28e-6 0.0267  7.51 0.910</span>
<span class="co">#  3 E11    1.37 0.151  1.44 2.44e-1 0.377   3.59  4.86e-2 0.105  23.7  0.304</span>
<span class="co">#  4 E12    1.61 0.320  5.98 6.47e-4 0.0919  1.72  2.08e-1 0.0535 14.4  0.833</span>
<span class="co">#  5 E13    2.91 0.713  7.18 2.10e-4 0.0767  0.772 4.77e-1 0.0994 10.8  0.861</span>
<span class="co">#  6 E14    1.78 0.131  1.73 1.53e-1 0.104   1.37  2.78e-1 0.0753 15.4  0.423</span>
<span class="co">#  7 E2     3.18 0.207  1.16 3.76e-1 0.698   3.91  3.88e-2 0.179  13.3  0.136</span>
<span class="co">#  8 E3     4.06 0.335  1.87 1.23e-1 0.489   2.73  9.21e-2 0.179  10.4  0.466</span>
<span class="co">#  9 E4     3.68 0.531  3.86 7.12e-3 0.116   0.846 4.46e-1 0.138  10.1  0.741</span>
<span class="co"># 10 E5     3.91 0.526  7.93 1.10e-4 0.219   3.30  6.02e-2 0.0664  6.59 0.874</span>
<span class="co"># 11 E6     2.66 0.135  2.30 6.35e-2 0.160   2.73  9.22e-2 0.0586  9.09 0.565</span>
<span class="co"># 12 E7     1.99 0.337  3.70 8.73e-3 0.381   4.19  3.22e-2 0.0910 15.2  0.730</span>
<span class="co"># 13 E8     2.54 0.215  7.72 1.31e-4 0.817  29.4   2.15e-6 0.0278  6.57 0.870</span>
<span class="co"># 14 E9     3.06 0.679  6.12 5.62e-4 0.583   5.25  1.60e-2 0.111  10.9  0.837</span>
<span class="co"># # ... with 1 more variable: AS &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="baseada-em-regressão" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> Baseada em regressão<a class="anchor" aria-label="anchor" href="#baseada-em-regress%C3%A3o"><i class="fas fa-link"></i></a>
</h2>
<p><span class="citation">Eberhart and Russell (<a href="refer%C3%AAncias.html#ref-Eberhart1966" role="doc-biblioref">1966</a>)</span> popularizaram a análise de estabilidade baseada em regressão. Nesse procedimento, a análise de adaptabilidade e estabilidade é realizada por meio de ajustes de equações de regressão onde a variável dependente é estimada em função de um índice ambiental, conforme o seguinte modelo:</p>
<p><span class="math display">\[
\mathop Y\nolimits_{ij}  = {\beta _{0i}} + {\beta _{1i}}{I_j} + {\delta _{ij}} + {\bar \varepsilon _{ij}}
\]</span></p>
<p>onde <span class="math inline">\({\beta _{0i}}\)</span> é a média geral do genótipo <em>i</em> (<em>i</em> = 1, 2, …, I); <span class="math inline">\({\beta _{1i}}\)</span> é a respota linear do genótipo <em>i</em> ao índice ambiental; <em>Ij</em> é o índice ambiental (<em>j</em> = 1, 2, …, <em>e</em>), onde <span class="math inline">\({I_j} = [(y_{.j}/g)- (y_{..}/ge)]\)</span>, <span class="math inline">\({\delta _{ij}}\)</span> é o desvio da regressão, e <span class="math inline">\({\bar \varepsilon _{ij}}\)</span> é o erro experimental.
O modelo é ajustado com a função <code><a href="https://rdrr.io/pkg/metan/man/ge_reg.html">ge_reg()</a></code> . Os métodos S3 <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> e <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> podem ser utilizados para explorar os resultados.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/ge_reg.html">ge_reg</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span><span class="op">)</span>
<span class="va">reg_model</span><span class="op">$</span><span class="va">GY</span><span class="op">$</span><span class="va">anova</span>
<span class="co"># # A tibble: 17 x 6</span>
<span class="co">#    SV                       Df `Sum Sq` `Mean Sq` `F value`  `Pr(&gt;F)`</span>
<span class="co">#    &lt;chr&gt;                 &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#  1 "Total"                 139  324.       2.33      NA     NA       </span>
<span class="co">#  2 "GEN"                     9   13.0      1.44       6.28   3.05e- 7</span>
<span class="co">#  3 "ENV + (GEN x ENV)"     130  311.       2.39      NA     NA       </span>
<span class="co">#  4 "ENV (linear)"            1  280.     280.        NA     NA       </span>
<span class="co">#  5 " GEN x ENV (linear)"     9    3.61     0.402      1.75   8.58e- 2</span>
<span class="co">#  6 "Pooled deviation"      120   27.6      0.230     NA     NA       </span>
<span class="co">#  7 "G1"                     12    1.11     0.0924     1.06   3.92e- 1</span>
<span class="co">#  8 "G10"                    12    7.54     0.629      7.22   1.66e-11</span>
<span class="co">#  9 "G2"                     12    2.95     0.246      2.82   1.14e- 3</span>
<span class="co"># 10 "G3"                     12    0.699    0.0582     0.669  7.81e- 1</span>
<span class="co"># 11 "G4"                     12    2.23     0.186      2.14   1.48e- 2</span>
<span class="co"># 12 "G5"                     12    1.49     0.124      1.42   1.55e- 1</span>
<span class="co"># 13 "G6"                     12    1.27     0.106      1.22   2.71e- 1</span>
<span class="co"># 14 "G7"                     12    3.25     0.270      3.11   3.72e- 4</span>
<span class="co"># 15 "G8"                     12    2.54     0.211      2.43   5.15e- 3</span>
<span class="co"># 16 "G9"                     12    4.54     0.378      4.34   2.42e- 6</span>
<span class="co"># 17 "Pooled error"          280   24.4      0.0870    NA     NA</span>
<span class="va">reg_model</span><span class="op">$</span><span class="va">GY</span><span class="op">$</span><span class="va">regression</span>
<span class="co"># # A tibble: 10 x 6</span>
<span class="co">#    GEN       Y slope deviations  RMSE    R2</span>
<span class="co">#    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 G1     2.60 1.06    -0.00142 0.162 0.966</span>
<span class="co">#  2 G10    2.47 1.12     0.177   0.424 0.823</span>
<span class="co">#  3 G2     2.74 1.05     0.0497  0.265 0.913</span>
<span class="co">#  4 G3     2.96 1.03    -0.0128  0.129 0.977</span>
<span class="co">#  5 G4     2.64 0.937    0.0298  0.231 0.917</span>
<span class="co">#  6 G5     2.54 0.887    0.00902 0.188 0.937</span>
<span class="co">#  7 G6     2.53 0.861    0.00304 0.174 0.942</span>
<span class="co">#  8 G7     2.74 0.819    0.0579  0.278 0.852</span>
<span class="co">#  9 G8     3.00 1.03     0.0382  0.246 0.922</span>
<span class="co"># 10 G9     2.51 1.19     0.0938  0.329 0.897</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">reg_model</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-324-1.png" width="480" style="display: block; margin: auto;"></div>
</div>
<div id="índice-de-confiança-genotípico" class="section level2" number="14.4">
<h2>
<span class="header-section-number">14.4</span> Índice de confiança genotípico<a class="anchor" aria-label="anchor" href="#%C3%ADndice-de-confian%C3%A7a-genot%C3%ADpico"><i class="fas fa-link"></i></a>
</h2>
<p><span class="citation">Annicchiarico (<a href="refer%C3%AAncias.html#ref-Annicchiarico1992" role="doc-biblioref">1992</a>)</span> propôs um método de estabilidade em que o parâmetro de estabilidade é medido pela superioridade do genótipo em relação à média de cada ambiente, de acordo com o seguinte modelo:</p>
<p><span class="math display">\[
{Z_ {ij}} = \frac{{{Y_ {i}}}} {{{{\bar Y} _ {. J}}}} \times 100
\]</span></p>
<p>O índice de confiança genotípico do genótipo <em>i</em> (<span class="math inline">\(W_i\)</span>) é então estimado da seguinte forma:</p>
<p><span class="math display">\[
W_i = Z_{i.} / E - \alpha \times sd (Z_{i.})
\]</span></p>
<p>Onde <span class="math inline">\(\alpha\)</span> é o quantil da distribuição normal padrão a uma dada probabilidade de erro (<span class="math inline">\(\alpha \approx 1.64\)</span> a 0.05). O método é implementado usando a função <code><a href="https://rdrr.io/pkg/metan/man/Annicchiarico.html">Annicchiarico()</a></code> . O índice de confiança é estimado considerando todos os ambientes, os ambientes favoráveis (índice positivo) e os ambientes desfavoráveis (índice negativo), como segue:</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ann</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/Annicchiarico.html">Annicchiarico</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span><span class="op">)</span>
<span class="va">ann</span><span class="op">$</span><span class="va">GY</span><span class="op">$</span><span class="va">general</span>
<span class="co"># # A tibble: 10 x 6</span>
<span class="co">#    GEN       Y Mean_rp Sd_rp    Wi  rank</span>
<span class="co">#    &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 G1     2.60    96.5  7.38  91.5     6</span>
<span class="co">#  2 G10    2.47    90.3 18.9   77.5    10</span>
<span class="co">#  3 G2     2.74   103.  12.1   94.5     4</span>
<span class="co">#  4 G3     2.96   111.   4.59 108.      1</span>
<span class="co">#  5 G4     2.64    99.1  8.03  93.7     5</span>
<span class="co">#  6 G5     2.54    95.5  7.74  90.2     8</span>
<span class="co">#  7 G6     2.53    95.5  7.61  90.4     7</span>
<span class="co">#  8 G7     2.74   105.  12.5   96.0     3</span>
<span class="co">#  9 G8     3.00   113.   8.87 107.      2</span>
<span class="co"># 10 G9     2.51    91.6 13.8   82.3     9</span></code></pre></div>
</div>
<div id="índice-de-superioridade-genotípico" class="section level2" number="14.5">
<h2>
<span class="header-section-number">14.5</span> Índice de superioridade genotípico<a class="anchor" aria-label="anchor" href="#%C3%ADndice-de-superioridade-genot%C3%ADpico"><i class="fas fa-link"></i></a>
</h2>
<p>A função <code><a href="https://rdrr.io/pkg/metan/man/superiority.html">superiority()</a></code> implementa o método não-paramétrico proposto por <span class="citation">Lin and Binns (<a href="refer%C3%AAncias.html#ref-Lin1988" role="doc-biblioref">1988</a>)</span>, que considera que a medida de superioridade geral da cultivar para dados de cultivar x localização é definida como quadrado médio da distância entre a resposta da cultivar e a média de resposta máxima em todas as localidades, de acordo com o seguinte modelo.</p>
<p><span class="math display">\[
P_i = \sum \limits_{j = 1} ^ n {(y_ {ij} - y _ {. J}) ^ 2 / (2n)}
\]</span>
onde <em>n</em> é o número de ambientes. Da mesma forma que o índice de confiança genotípico, o índice de superioridade é calculado por todos os ambientes, para os favoráveis e para os desfavoráveis.</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">super</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/superiority.html">superiority</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span><span class="op">)</span>
<span class="va">super</span><span class="op">$</span><span class="va">GY</span><span class="op">$</span><span class="va">index</span>
<span class="co"># # A tibble: 10 x 8</span>
<span class="co">#    GEN       Y   Pi_a   R_a   Pi_f   R_f    Pi_u   R_u</span>
<span class="co">#    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 G1     2.60 0.169      5 0.228      4 0.125       6</span>
<span class="co">#  2 G10    2.47 0.344     10 0.475     10 0.245      10</span>
<span class="co">#  3 G2     2.74 0.126      3 0.149      3 0.108       5</span>
<span class="co">#  4 G3     2.96 0.0410     1 0.0723     1 0.0175      2</span>
<span class="co">#  5 G4     2.64 0.173      6 0.289      5 0.0853      4</span>
<span class="co">#  6 G5     2.54 0.240      8 0.382      8 0.133       7</span>
<span class="co">#  7 G6     2.53 0.238      7 0.377      7 0.134       8</span>
<span class="co">#  8 G7     2.74 0.149      4 0.318      6 0.0214      3</span>
<span class="co">#  9 G8     3.00 0.0412     2 0.0882     2 0.00588     1</span>
<span class="co"># 10 G9     2.51 0.291      9 0.390      9 0.217       9</span></code></pre></div>
</div>
<div id="estratificação-ambiental" class="section level2" number="14.6">
<h2>
<span class="header-section-number">14.6</span> Estratificação ambiental<a class="anchor" aria-label="anchor" href="#estratifica%C3%A7%C3%A3o-ambiental"><i class="fas fa-link"></i></a>
</h2>
<p>Um método que combina análise de estabilidade e estratificação ambiental usando análise fatorial foi proposto por <span class="citation">Murakami and Cruz (<a href="refer%C3%AAncias.html#ref-murakami2004" role="doc-biblioref">2004</a>)</span>. Este método é implementado com a função <code><a href="https://rdrr.io/pkg/metan/man/ge_factanal.html">ge_factanal()</a></code>, como segue:</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fato</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/ge_factanal.html">ge_factanal</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fato</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-327-1.png" width="480" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fato</span><span class="op">$</span><span class="va">GY</span><span class="op">$</span><span class="va">PCA</span><span class="op">)</span>
<span class="co"># # A tibble: 14 x 4</span>
<span class="co">#    PCA   Eigenvalues  Variance Cumul_var</span>
<span class="co">#    &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#  1 PC1      5.60e+ 0  4.00e+ 1      40.0</span>
<span class="co">#  2 PC2      2.51e+ 0  1.79e+ 1      58.0</span>
<span class="co">#  3 PC3      2.41e+ 0  1.72e+ 1      75.1</span>
<span class="co">#  4 PC4      1.37e+ 0  9.80e+ 0      84.9</span>
<span class="co">#  5 PC5      1.13e+ 0  8.05e+ 0      93.0</span>
<span class="co">#  6 PC6      4.87e- 1  3.48e+ 0      96.5</span>
<span class="co">#  7 PC7      3.03e- 1  2.16e+ 0      98.6</span>
<span class="co">#  8 PC8      1.29e- 1  9.25e- 1      99.6</span>
<span class="co">#  9 PC9      6.24e- 2  4.46e- 1     100  </span>
<span class="co"># 10 PC10     1.72e-16  1.23e-15     100  </span>
<span class="co"># 11 PC11     1.41e-16  1.01e-15     100  </span>
<span class="co"># 12 PC12    -1.74e-16 -1.25e-15     100  </span>
<span class="co"># 13 PC13    -2.67e-16 -1.91e-15     100  </span>
<span class="co"># 14 PC14    -3.01e-16 -2.15e-15     100</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fato</span><span class="op">$</span><span class="va">GY</span><span class="op">$</span><span class="va">FA</span><span class="op">)</span>
<span class="co"># # A tibble: 14 x 8</span>
<span class="co">#    Env        FA1     FA2      FA3     FA4     FA5 Communality Uniquenesses</span>
<span class="co">#    &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;</span>
<span class="co">#  1 E1    -0.881    0.327   0.00927 -0.0631  0.274        0.963      0.0369 </span>
<span class="co">#  2 E10   -0.942   -0.158  -0.0820   0.113   0.174        0.962      0.0380 </span>
<span class="co">#  3 E11   -0.929   -0.233  -0.0336  -0.242   0.110        0.989      0.0111 </span>
<span class="co">#  4 E12   -0.848    0.135   0.0263   0.0941  0.241        0.805      0.195  </span>
<span class="co">#  5 E13   -0.940    0.108  -0.0842  -0.0637 -0.235        0.961      0.0391 </span>
<span class="co">#  6 E14   -0.150   -0.123  -0.916   -0.0872  0.265        0.954      0.0463 </span>
<span class="co">#  7 E2    -0.198   -0.0521 -0.126   -0.969   0.0328       0.997      0.00266</span>
<span class="co">#  8 E3    -0.0806   0.910   0.341   -0.0173 -0.110        0.963      0.0370 </span>
<span class="co">#  9 E4     0.209    0.543  -0.272   -0.728  -0.120        0.957      0.0433 </span>
<span class="co"># 10 E5    -0.777    0.392  -0.269   -0.0470 -0.267        0.904      0.0963 </span>
<span class="co"># 11 E6    -0.524    0.569  -0.309   -0.174  -0.238        0.781      0.219  </span>
<span class="co"># 12 E7    -0.244    0.342  -0.520    0.297   0.619        0.918      0.0820 </span>
<span class="co"># 13 E8     0.00161 -0.0589 -0.914   -0.226  -0.143        0.911      0.0891 </span>
<span class="co"># 14 E9    -0.0794  -0.291  -0.0183  -0.0539  0.927        0.954      0.0463</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fato</span><span class="op">$</span><span class="va">GY</span><span class="op">$</span><span class="va">env_strat</span><span class="op">)</span>
<span class="co"># # A tibble: 14 x 6</span>
<span class="co">#    Env   Factor  Mean   Min   Max    CV</span>
<span class="co">#    &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 E1    FA1     2.52 1.97   2.90 13.3 </span>
<span class="co">#  2 E10   FA1     2.18 1.54   2.57 14.4 </span>
<span class="co">#  3 E11   FA1     1.37 0.899  1.68 16.4 </span>
<span class="co">#  4 E12   FA1     1.61 1.02   2    20.3 </span>
<span class="co">#  5 E13   FA1     2.91 1.83   3.52 16.8 </span>
<span class="co">#  6 E5    FA1     3.91 3.37   4.81 10.7 </span>
<span class="co">#  7 E3    FA2     4.06 3.43   4.57  8.22</span>
<span class="co">#  8 E6    FA2     2.66 2.34   2.98  7.95</span>
<span class="co">#  9 E14   FA3     1.78 1.43   2.06 11.7 </span>
<span class="co"># 10 E8    FA3     2.54 2.05   2.88 10.5 </span>
<span class="co"># 11 E2    FA4     3.18 2.61   3.61  8.25</span>
<span class="co"># 12 E4    FA4     3.68 3.02   4.27 11.5 </span>
<span class="co"># 13 E7    FA5     1.99 1.39   2.55 16.8 </span>
<span class="co"># 14 E9    FA5     3.06 1.94   3.72 15.6</span></code></pre></div>
<p>A maneira mais fácil de calcular os índices de estabilidade acima mencionados é usando a função <code><a href="https://rdrr.io/pkg/metan/man/ge_stats.html">ge_stats()</a></code>. </p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stat_ge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/ge_stats.html">ge_stats</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span><span class="op">)</span></code></pre></div>
<p>Se você deseja exportar um resumo dos resultados, a maneira mais simples é usando função <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>.</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">stat_ge</span>, export <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Este comando criará um arquivo de texto chamado <em>ge_stats summary.txt </em> no diretório de trabalho atual.</p>
</div>
<div id="o-modelo-ammi" class="section level2" number="14.7">
<h2>
<span class="header-section-number">14.7</span> O modelo AMMI<a class="anchor" aria-label="anchor" href="#o-modelo-ammi"><i class="fas fa-link"></i></a>
</h2>
<p>O modelo linear mais simples com efeito de interação usado na análise de EMA é</p>
<p><span class="math display">\[
{y_{ijk}} = {\rm{ }}\mu {\rm{ }} + \mathop \alpha \nolimits_i  + \mathop \tau \nolimits_j  + \mathop {(\alpha \tau )}\nolimits_{ij}  + \mathop \gamma \nolimits_{jk}  + {\rm{ }}\mathop \varepsilon \nolimits_{ijk}
\]</span></p>
<p>onde <span class="math inline">\({y_{ijk}}\)</span> é a variável resposta observada no <em>k</em>-ésimo bloco do <em>i</em>-ésimo genótipo no <em>j</em>-ésimo ambiente (<em>i</em> = 1, 2, …, <em>g</em>; <em>j</em> = 1, 2, …, <em>e</em>; <em>k</em> = 1, 2, …, <em>b</em>); <span class="math inline">\(\mu\)</span> é a média geral; <span class="math inline">\(\mathop\alpha\nolimits_i\)</span> é o efeito principal do genótipo <em>i</em>; <span class="math inline">\(\mathop \tau \nolimits_j\)</span> é o principal efeito do ambiente <em>j</em>; <span class="math inline">\(\mathop {(\alpha \tau )}\nolimits_{ij}\)</span> é o efeito de interação do genótipo <em>i</em> com o ambiente <em>j</em>; <span class="math inline">\(\mathop \gamma \nolimits_{jk}\)</span> é o efeito do bloco <em>k</em> no ambiente <em>j</em>; e <span class="math inline">\({\rm{ }}\mathop \varepsilon \nolimits_{ijk}\)</span> é o erro aleatório assumindo <span class="math inline">\(i.i.d \sim N(0, \sigma^2 )\)</span>.</p>
<p>Métodos que combinam diferentes princípios estatísticos ganharam espaço na análise de  por volta da década 1960, com destaque especial ao estudo de <span class="citation">Gollob (<a href="refer%C3%AAncias.html#ref-Gollob1968" role="doc-biblioref">1968</a>)</span>, que propôs um método que combina os benefícios da análise de fatores e análise de variância em um único método para estudar a estabilidade . Naquela época este método era conhecido como FANOVA. Atualmente este mesmo método foi popularizado por <span class="citation">Gauch (<a href="refer%C3%AAncias.html#ref-Gauch1988" role="doc-biblioref">1988</a>)</span> com o acrônimo AMMI.</p>
<p>A análise AMMI utiliza análise aditiva de variância aos fatores principais (genótipo e ambiente) e decomposição por valores singulares ao residual do modelo aditivo, isto é, o efeito da interação genótipo-<em>vs</em>-ambiente somado ao erro experimental. Esta matriz dos efeitos não aditivos, então, pode ser aproximadamente exibida por meio de biplots  <span class="citation">Gabriel (<a href="refer%C3%AAncias.html#ref-Gabriel1971" role="doc-biblioref">1971</a>)</span>. Este método tem ganhado destaque nas últimas décadas, principalmente devido a rápida evolução computacional, o que tornou possível as complexas decomposições de matrizes de alta ordem.</p>
<p>De posse de uma matriz de dupla entrada oriunda de ensaios multiambientes, a estimativa da variável resposta do <em>i</em>-ésimo genótipo no <em>j</em>-ésimo ambiente é obtida utilizando AMMI de acordo com o seguinte modelo:</p>
<p><span class="math display">\[
{y_{ij}} = \mu  + {\alpha_i} + {\tau_j} + \sum\limits_{k = 1}^k {{\lambda _k}{a_{ik}}} {t_{jk}} + {\rho _{ij}} + {\varepsilon _{ij}}
\]</span></p>
<p>onde <span class="math inline">\({\lambda_k}\)</span> é o valor singular para o <em>k</em>-ésimo eixo do componente principal; <span class="math inline">\(a_{ik}\)</span> é o <em>i</em>-ésimo elemento do <em>k</em>-ésimo autovetor de genótipos; <span class="math inline">\(t_{jk}\)</span> é o <em>j</em>-ésimo elemento do <em>k</em>-ésimo autovetor de ambientes. Um resíduo <span class="math inline">\(\rho _{ij}\)</span> permanece, se todos os <em>k</em>-PCAs não são considerados, onde <em>k</em> = <span class="math inline">\(min(G-1; E-1)\)</span>.</p>
<div id="ajuste-do-modelo" class="section level3" number="14.7.1">
<h3>
<span class="header-section-number">14.7.1</span> Ajuste do modelo<a class="anchor" aria-label="anchor" href="#ajuste-do-modelo"><i class="fas fa-link"></i></a>
</h3>
<p>O modelo AMMI é ajustado com a função <code><a href="https://rdrr.io/pkg/metan/man/performs_ammi.html">performs_ammi()</a></code>. O primeiro argumento é os dados, no nosso exemplo <code>data_ge</code>. Os próximos argumentos (<code>ENV</code>, <code>GEN</code> e <code>REP</code>) são os nomes das colunas que contém os níveis dos fatores ambiente, genótipo, repetição, respectivamente. No argumento <code>resp</code> são declaradas as variáveis resposta. Uma única variável pode ser analizada (como em nosso exemplo) ou, um vetor de variáveis, usando, por exemplo <code>resp = c(GY, HM)</code>.</p>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">AMMI_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/performs_ammi.html">performs_ammi</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span><span class="op">)</span>
<span class="co"># variable GY </span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># AMMI analysis table</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co">#     Source  Df  Sum Sq Mean Sq F value   Pr(&gt;F) Proportion Accumulated</span>
<span class="co">#        ENV  13 279.574 21.5057   62.33 0.00e+00          .           .</span>
<span class="co">#   REP(ENV)  28   9.662  0.3451    3.57 3.59e-08          .           .</span>
<span class="co">#        GEN   9  12.995  1.4439   14.93 2.19e-19          .           .</span>
<span class="co">#    GEN:ENV 117  31.220  0.2668    2.76 1.01e-11          .           .</span>
<span class="co">#        PC1  21  10.749  0.5119    5.29 0.00e+00       34.4        34.4</span>
<span class="co">#        PC2  19   9.924  0.5223    5.40 0.00e+00       31.8        66.2</span>
<span class="co">#        PC3  17   4.039  0.2376    2.46 1.40e-03       12.9        79.2</span>
<span class="co">#        PC4  15   3.074  0.2049    2.12 9.60e-03        9.8          89</span>
<span class="co">#        PC5  13   1.446  0.1113    1.15 3.18e-01        4.6        93.6</span>
<span class="co">#        PC6  11   0.932  0.0848    0.88 5.61e-01          3        96.6</span>
<span class="co">#        PC7   9   0.567  0.0630    0.65 7.53e-01        1.8        98.4</span>
<span class="co">#        PC8   7   0.362  0.0518    0.54 8.04e-01        1.2        99.6</span>
<span class="co">#        PC9   5   0.126  0.0252    0.26 9.34e-01        0.4         100</span>
<span class="co">#  Residuals 252  24.367  0.0967      NA       NA          .           .</span>
<span class="co">#      Total 536 389.036  0.7258      NA       NA       &lt;NA&gt;        &lt;NA&gt;</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># </span>
<span class="co"># All variables with significant (p &lt; 0.05) genotype-vs-environment interaction</span>
<span class="co"># Done!</span></code></pre></div>

<div class="dica">
<p>Note que os argumentos inseridos na função obedecem a ordem dos argumentos requiridos na função [veja <code><a href="https://rdrr.io/r/base/args.html">args(waas)</a></code>]. Se obedecida esta ordem de avaliação, não é necessário declarar qual argumento está sendo inserido. Por exemplo, se mudássemos a ordem de entrada, teríamos um código semelhante a <code><a href="https://rdrr.io/pkg/metan/man/waas.html">waas(data_ge, gen = GEN, env =  ENV, REP, resp = c(PH, ED, TKW, NKR))</a></code>.</p>
</div>
</div>
<div id="analise-residual" class="section level3" number="14.7.2">
<h3>
<span class="header-section-number">14.7.2</span> Analise residual<a class="anchor" aria-label="anchor" href="#analise-residual"><i class="fas fa-link"></i></a>
</h3>
<p>O pacote <code>metan</code> conta com uma opção para análise residual do modelo AMMI ajustado. Gráficos podem ser obtidos utilizando o seguinte comando.</p>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">AMMI_model</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-332-1.png" width="768" style="display: block; margin: auto;"></div>
<p>A figura acima, obtida com a função <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code>, mostra 4 gráficos. Os dois primeiros são os mais importantes. O primeiro (<em>Residual vs fitted</em>) pode ser utilizado para identificar a homogeneidade das variâncias. Uma distribuição aleatória dos pontos no gráfico deve ser observada. Quando um padrão de distibuição é observado –como, por exemplo, a distribuição dos pontos em forma de funil– uma investigação deve ser realizada, pois este padrão indica a possiblidade de heterogeneidade das variâncias. O segundo gráfico (<em>Normal Q-Q</em>) nos informa quanto a normalidade dos resíduos, ou seja, é desejado que os pontos sejam distribuídos ao redor da linha diagonal.</p>
</div>
<div id="escolha-do-número-de-termos-multiplicativos" class="section level3" number="14.7.3">
<h3>
<span class="header-section-number">14.7.3</span> Escolha do número de termos multiplicativos<a class="anchor" aria-label="anchor" href="#escolha-do-n%C3%BAmero-de-termos-multiplicativos"><i class="fas fa-link"></i></a>
</h3>
<p>Conforme já discutido, a análise AMMI aplica a técnica de decomposição por valores singulares na matriz dos efeitos não aditivos do modelo (<strong><em>A</em></strong>). Logo, esta matriz pode ser aproximada pela pelo seguinte modelo: <span class="math inline">\(A = U \lambda V^T\)</span>, onde onde <strong>U</strong> é uma matriz <em>g</em> <span class="math inline">\(\times\)</span> <em>e</em> contendo os vetores singulares de <span class="math inline">\(AA^T\)</span> e formam a base ortonormal para os efeitos de genótipos; <span class="math inline">\(V^T\)</span> é uma matriz <em>e</em> <span class="math inline">\(\times\)</span> <em>e</em> que contém os vetores singulares de <span class="math inline">\(\mathbf{A^TA}\)</span> e formam a base ortonormal para os efeitos de ambientes; e <span class="math inline">\(\lambda\)</span> é uma matriz diagonal <em>e</em> <span class="math inline">\(\times\)</span> <em>e</em> contendo <em>k</em>-valores singulares de <span class="math inline">\(A^TA\)</span> , onde <em>k</em> = <span class="math inline">\(min(G-1; E-1)\)</span>. Assim, diferentes modelos (dependendo do número de termos multiplicativos utilizados) podem ser utilziados para predizer o rendimento do genótipo <em>i</em> no ambiente <em>j</em>. A tabela abaixo mostra os possíveis modelos. No modelo AMMI0 apenas os efeitos aditivos são considerados. No modelo AMMI1, o primeiro termo multiplicativo é considerado, e assim por diante, até o modelo AMMIF, onde <span class="math inline">\(min(G-1;E-1)\)</span> termos são considerados.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="18%">
<col width="81%">
</colgroup>
<thead><tr class="header">
<th align="left">Família AMMI</th>
<th align="left">Resposta esperado do genótipo <em>i</em> no ambiente <em>j</em>
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">AMMI0</td>
<td align="left"><span class="math inline">\(\hat{y}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..}\)</span></td>
</tr>
<tr class="even">
<td align="left">AMMI1</td>
<td align="left"><span class="math inline">\(\hat{y}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..} +\lambda_1 a_{i1}t_{j1}\)</span></td>
</tr>
<tr class="odd">
<td align="left">AMMI2</td>
<td align="left"><span class="math inline">\(\hat{y}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..} +\lambda_1 a_{i1}t_{j1}+\lambda_2 a_{i2}t_{j2}\)</span></td>
</tr>
<tr class="even">
<td align="left">…</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">AMMIF</td>
<td align="left"><span class="math inline">\(\hat{y}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..} +\lambda_1 a_{i1}t_{j1}+\lambda_2 a_{i2}t_{j2}+...+\lambda_p a_{ip}t_{jp}\)</span></td>
</tr>
</tbody>
</table></div>
<p>A escolha do número de termos multiplicativos a ser utilizado é baseada em basicamente dois critérios de sucesso de análise: <strong>Postdiscritive sucess</strong> e <strong>Predictive sucess</strong>. Por definição, <strong>Predictive sucess</strong> significa literalmente a afirmação prévia do que acontecerá em algum momento futuro. Neste contexto, testes de validação cruzada (cross-validation) podem ser utilizadas para avaliar o sucesso preditivo dos membros de modelos da familia AMMI <span class="citation">(Tiago Olivoto, Lúcio, et al. <a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">2019</a><a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">a</a>)</span>. Por outro lado, <strong>Postdiscritive sucess</strong> significa fazer uma afirmação ou dedução sobre algo que aconteceu no passado. Na escolha do número de termos multiplicativos da análise AMMI este sucesso pode ser calculado utilizando testes como o proposto por <span class="citation">Gollob (<a href="refer%C3%AAncias.html#ref-Gollob1968" role="doc-biblioref">1968</a>)</span>.</p>
<div id="postdiscritive-sucess" class="section level4" number="14.7.3.1">
<h4>
<span class="header-section-number">14.7.3.1</span> Postdiscritive sucess<a class="anchor" aria-label="anchor" href="#postdiscritive-sucess"><i class="fas fa-link"></i></a>
</h4>
<p>No objeto <code>anova</code>  gerado pela função <code><a href="https://rdrr.io/pkg/metan/man/waas.html">waas()</a></code>  testes de hipóteses são realizados e probabilidades de erro são atribuídas para cada modelo considerando a distribuição de graus de liberdade proposto por <span class="citation">Gollob (<a href="refer%C3%AAncias.html#ref-Gollob1968" role="doc-biblioref">1968</a>)</span>. Assim é possível identificar qual é o número ideal de termos a ser considerado na predição. Em nosso exemplo, dois termos foram significativos a 5% de probabilidade de erro.</p>
</div>
<div id="predictive-sucess" class="section level4" number="14.7.3.2">
<h4>
<span class="header-section-number">14.7.3.2</span> Predictive sucess<a class="anchor" aria-label="anchor" href="#predictive-sucess"><i class="fas fa-link"></i></a>
</h4>
<p>O pacote <code>metan</code> fornece uma solução completa para validaçao cruzada do modelo AMMI. Utilizando a função <code><a href="https://rdrr.io/pkg/metan/man/cv_ammif.html">cv_ammif()</a></code> , por exemplo, é possível realizar um teste de <em>cross-validation</em> para a família de modelos AMMI (AMMI0-AMMIF) usando dados com repetições. Automaticamente, a primeira validação é realizada considerando a AMMIF (todos possíveis IPCAs são usados). Considerando esse modelo, o conjunto de dados original é dividido em dois conjuntos de dados: dados de modelagem e dados de validação. O conjunto de dados “modelagem” possui todas as combinações (genótipo <em>vs</em> ambiente) com R-1 repetições. O conjunto de dados “validação” tem uma repetição. O diagrama abaixo representa o procedimento realizado.</p>
<p>A divisão do conjunto de dados em dados de modelagem e validação depende do design informado. Considerando um delineamento de blocos completos casualizados (DBC), blocos completos são aleatoriamente selecionados dentro de ambientes, como mostrado por <span class="citation">Tiago Olivoto, Lúcio, et al. (<a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">2019</a><a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">a</a>)</span>. O bloco restante serve dados de validação. Se <code>design = "CRD"</code> for informado, assim declarando que um delineamento intericamente casualizado (DIC)  foi usado, observações são aleatoriamente selecionadas para cada tratamento (combinação genótipo-<em>vs</em>-ambiente). Este é o mesmo procedimento sugerido por <span class="citation">Gauch (<a href="refer%C3%AAncias.html#ref-Gauch1988" role="doc-biblioref">1988</a>)</span>. Os valores estimados para o membro da família AMMI em estudo são então comparados com os dados de “validação” e um erro de predição <span class="math inline">\(\hat{z}_{ij}\)</span> é estimado para cada tratamento. A raiz quadrada do quadrado médio da diferença de predição (RMSPD) é calculado. Este procedimento é repetido <em>n</em> vezes, utilizando o argumento <code>nboot = n</code>. Ao final do procedimento, o algorítimo armazena as <em>n</em> estimativas do RMSPD para o modelo em questão, e um novo modelo é então testado seguindo os mesmos passos.</p>
<p>Como exemplo, a função <code><a href="https://rdrr.io/pkg/metan/man/cv_ammi.html">cv_ammi()</a></code> é usada para calcular um procedimento de validação cruzada para os modelos AMMI0, AMMI2 e AMMIF (9 eixos).</p>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">AMMI0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/cv_ammi.html">cv_ammi</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span>, naxis <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># AMMI0</span>
<span class="va">AMMI2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/cv_ammi.html">cv_ammi</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span>, naxis <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># AMMI2</span>
<span class="va">AMMI9</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/cv_ammi.html">cv_ammi</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span>, naxis <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="co"># AMMIF</span></code></pre></div>
<ul>
<li>
<strong>AMMI0 para AMMIF</strong>
A função <code><a href="https://rdrr.io/pkg/metan/man/cv_ammif.html">cv_ammif()</a></code> é usada para calcular um procedimento de validação cruzada para todos os membros do modelo da família AMMI. Nesse caso, AMMI0-AMMI9.</li>
</ul>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">AMMIF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/cv_ammif.html">cv_ammif</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span><span class="op">)</span></code></pre></div>
<ul>
<li><p><strong>Validação cruzada para previsão de BLUP</strong>
A função <code><a href="https://rdrr.io/pkg/metan/man/cv_blup.html">cv_blup ()</a></code> fornece uma validação cruzada de dados baseados em replicação usando modelos mistos. Por padrão, blocos completos são selecionados aleatoriamente para cada ambiente. Usando o argumento `random ’, é possível escolher os efeitos aleatórios do modelo, como mostrado abaixo.</p></li>
<li><p><strong>Genótipo e genótipo versus ambiente como efeitos aleatórios</strong></p></li>
</ul>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">BLUP_g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/cv_blup.html">cv_blup</a></span><span class="op">(</span><span class="va">dados_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span>, random <span class="op">=</span> <span class="st">"gen"</span><span class="op">)</span></code></pre></div>
<ul>
<li><strong>Ambiente, replicação dentro do ambiente e interação como efeitos aleatórios</strong></li>
</ul>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">BLUP_e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/cv_blup.html">cv_blup</a></span><span class="op">(</span><span class="va">dados_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span>, random <span class="op">=</span> <span class="st">"env"</span><span class="op">)</span></code></pre></div>
<ul>
<li><strong>Um modelo aleatório (todos os termos como efeitos aleatórios)</strong></li>
</ul>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">BLUP_ge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/cv_blup.html">cv_blup</a></span><span class="op">(</span><span class="va">dados_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span>, random <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div id="imprimindo-os-meios-das-estimativas-rmspd" class="section level2" number="14.8">
<h2>
<span class="header-section-number">14.8</span> Imprimindo os meios das estimativas RMSPD<a class="anchor" aria-label="anchor" href="#imprimindo-os-meios-das-estimativas-rmspd"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bind_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/bind_cv.html">bind_cv</a></span><span class="op">(</span><span class="va">AMMIF</span>, <span class="va">BLUP_g</span>, bind <span class="op">=</span> <span class="st">"means"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">bind_mod</span><span class="op">$</span><span class="va">RMSPD</span><span class="op">)</span>
<span class="co"># # A tibble: 11 x 6</span>
<span class="co">#    MODEL        mean     sd      se  Q2.5 Q97.5</span>
<span class="co">#    &lt;fct&gt;       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 BLUP_g_RCBD 0.405 0.0249 0.00176 0.357 0.453</span>
<span class="co">#  2 AMMI2       0.411 0.0242 0.00171 0.369 0.460</span>
<span class="co">#  3 AMMI4       0.416 0.0234 0.00166 0.373 0.462</span>
<span class="co">#  4 AMMI3       0.416 0.0215 0.00152 0.377 0.457</span>
<span class="co">#  5 AMMI5       0.422 0.0232 0.00164 0.377 0.464</span>
<span class="co">#  6 AMMI6       0.422 0.0219 0.00155 0.381 0.462</span>
<span class="co">#  7 AMMI7       0.425 0.0199 0.00141 0.381 0.458</span>
<span class="co">#  8 AMMI8       0.427 0.0204 0.00145 0.387 0.462</span>
<span class="co">#  9 AMMIF       0.429 0.0213 0.00150 0.390 0.469</span>
<span class="co"># 10 AMMI1       0.430 0.0251 0.00178 0.384 0.479</span>
<span class="co"># 11 AMMI0       0.430 0.0283 0.00200 0.370 0.485</span></code></pre></div>
<p>A tabela acima mostra as estatísticas descritivas (média, desvio padrão, erro padrão da média e quantis 2,5% e 97,5%) das 100 estimativas RMSPD para cada modelo, e são apresentadas a partir do modelo mais preciso (menor média RMSPD) para o modelo menos preciso (maior média RMSPD).</p>
</div>
<div id="plotagem-dos-valores-rmspd" class="section level2" number="14.9">
<h2>
<span class="header-section-number">14.9</span> Plotagem dos valores RMSPD<a class="anchor" aria-label="anchor" href="#plotagem-dos-valores-rmspd"><i class="fas fa-link"></i></a>
</h2>
<p>Os valores das estimativas RMSPD obtidas no processo de validação cruzada podem ser plotados usando a função <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot ()</a></code>.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="interaction.html#cb305-1"></a><span class="kw">library</span>(metan)</span>
<span id="cb305-2"><a href="interaction.html#cb305-2"></a>bind1 &lt;-<span class="st"> </span><span class="kw">bind_cv</span>(AMMI0, AMMI2, AMMI9)</span>
<span id="cb305-3"><a href="interaction.html#cb305-3"></a>bind2 &lt;-<span class="st"> </span><span class="kw">bind_cv</span> (AMMIF, BLUP_g, BLUP_e, BLUP_ge)</span>
<span id="cb305-4"><a href="interaction.html#cb305-4"></a>a &lt;-<span class="st"> </span><span class="kw">plot</span>(bind1, <span class="dt">violino =</span> <span class="ot">TRUE</span>)</span>
<span id="cb305-5"><a href="interaction.html#cb305-5"></a>b &lt;-<span class="st"> </span><span class="kw">plot</span>(bind2,</span>
<span id="cb305-6"><a href="interaction.html#cb305-6"></a>          <span class="dt">width.boxplot =</span> <span class="fl">0.6</span>,</span>
<span id="cb305-7"><a href="interaction.html#cb305-7"></a>          <span class="dt">order_box =</span> <span class="ot">TRUE</span>,</span>
<span id="cb305-8"><a href="interaction.html#cb305-8"></a>          <span class="dt">plot_theme =</span> <span class="kw">theme_metan_minimal</span> ())</span>
<span id="cb305-9"><a href="interaction.html#cb305-9"></a><span class="kw">arrange_ggplot</span>(a, b, <span class="dt">tag_levels =</span> <span class="kw">list</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]))</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-340-1.png" width="960"></div>
<p>Seis estatísticas são mostradas neste boxplot. A média (losango preto), a mediana (linha preta), as dobradiças inferior e superior que correspondem ao primeiro e terceiro quartis (percentis 25 e 75, respectivamente). O bigode superior se estende da dobradiça até o maior valor não mais que <span class="math inline">\(1,5 \times {IQR}\)</span> a partir da dobradiça (em que IQR é o intervalo entre quartis). O bigode mais baixo se estende da dobradiça ao menor valor, no máximo <span class="math inline">\(1,5 \times {IQR}\)</span> da dobradiça. Dados além do final dos bigodes são considerados pontos extremos. Se a condição <code>violin = TRUE</code>, uma plotagem de violino é adicionada junto com o boxplot. Um gráfico de violino é uma exibição compacta de uma distribuição contínua exibida da mesma maneira que um gráfico de caixa.</p>
<div id="valores-estimados-pelo-modelo-ammi" class="section level3" number="14.9.1">
<h3>
<span class="header-section-number">14.9.1</span> Valores estimados pelo modelo AMMI<a class="anchor" aria-label="anchor" href="#valores-estimados-pelo-modelo-ammi"><i class="fas fa-link"></i></a>
</h3>
<p>Em nosso exemplo, o modelo AMMI2 foi o que apresentou o menor RMSPD, sendo então o mais indicado para estimar a variável GY. A estimativa considerando dois termos multiplicativos pode realizada utilizando a função <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code>, tendo como argumentos o modelo AMMI ajustado (<code>AMMI_model</code>) e o número de termos multiplicativos considerados na estimação (<code>naxis</code>). </p>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">AMMI_model</span>, naxis <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">predicted</span><span class="op">$</span><span class="va">GY</span>
<span class="co"># # A tibble: 140 x 8</span>
<span class="co">#    ENV   GEN       Y RESIDUAL Ypred ResAMMI[,1] YpredAMMI[,1] AMMI0</span>
<span class="co">#    &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 E1    G1     2.37  -0.0843  2.45     0.0693           2.52  2.45</span>
<span class="co">#  2 E1    G10    1.97  -0.344   2.32    -0.360            1.96  2.32</span>
<span class="co">#  3 E1    G2     2.90   0.311   2.59     0.0735           2.66  2.59</span>
<span class="co">#  4 E1    G3     2.89   0.0868  2.80    -0.00963          2.79  2.80</span>
<span class="co">#  5 E1    G4     2.59   0.100   2.49     0.0144           2.50  2.49</span>
<span class="co">#  6 E1    G5     2.19  -0.196   2.38    -0.0317           2.35  2.38</span>
<span class="co">#  7 E1    G6     2.30  -0.0797  2.38     0.0238           2.40  2.38</span>
<span class="co">#  8 E1    G7     2.77   0.186   2.59     0.186            2.77  2.59</span>
<span class="co">#  9 E1    G8     2.90   0.0493  2.85     0.0852           2.94  2.85</span>
<span class="co"># 10 E1    G9     2.33  -0.0307  2.36    -0.0515           2.31  2.36</span>
<span class="co"># # ... with 130 more rows</span></code></pre></div>
<p>As seguintes variáveis são retornadas: <strong>ENV</strong> é o ambiente; <strong>GEN</strong> é o genótipo; <strong>Y</strong> é o valor observado; <strong>resOLS</strong> é o residual (<span class="math inline">\(\hat{z}_{ij}\)</span>) estimado pelos Mínimos Quadrados Ordinários, onde <span class="math inline">\(\hat{z}_{ij} = y_{ij} - \bar{y}_{i.} - \bar{y}_{.j} + \bar{y}_{..}\)</span>; <strong>Ypred</strong> é o valor estimado pelos mínimos quadrados ordinários (<span class="math inline">\(\hat{y}_{ij} = y_{ij} -\hat{z}_{ij}\)</span>); <strong>ResAMMI</strong> é o residual estimado pelo modelo AMMI (<span class="math inline">\(\hat{a}_{ij}\)</span>) considerando o número de termos multiplicativos informado na função (neste caso 2), onde <span class="math inline">\(\hat{a}_{ij} = \lambda_1a_{i1}t_{j1}\)</span>; <strong>YpredAMMI</strong> é o valor estimado pelo modelo AMMI <span class="math inline">\(\hat{ya}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..}+\hat{a}_{ij}\)</span>; e <strong>AMMI0</strong> é o valor estimado quando nenhum termo multiplicativo é usado, ou seja, <span class="math inline">\(\hat{y}_{ij} = \bar{y}_{i.} + \bar{y}_{.j} - \bar{y}_{..}\)</span>.</p>
</div>
<div id="índices-de-estabilidade-baseados-em-ammi" class="section level3" number="14.9.2">
<h3>
<span class="header-section-number">14.9.2</span> Índices de estabilidade baseados em AMMI<a class="anchor" aria-label="anchor" href="#%C3%ADndices-de-estabilidade-baseados-em-ammi"><i class="fas fa-link"></i></a>
</h3>
<p><span class="citation">(Tiago Olivoto, Lúcio, et al. <a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">2019</a><a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">a</a>)</span> demonstraram que a média ponderada dos escores absolutos (WAAS, <strong>W</strong>eighted <strong>A</strong>verage of <strong>A</strong>bsolute <strong>S</strong>cores), pode ser utilizada como um índice quantitativo de estabilidade na análise AMMI. Utilizando a função <code><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data()</a></code> é possível obter facilmente este índice para diversas variáveis com poucas linhas de código. Veja o exemplo abaixo, com quatro variáveis. Este índice também é computado em uma estrutura de modelo misto. <a href="interaction.html#wsb">Veja o exemplo aqui</a>.</p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/metan/man/waas.html">waas</a></span><span class="op">(</span><span class="va">data_ge2</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>,
     resp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">PH</span>, <span class="va">ED</span>, <span class="va">TKW</span>, <span class="va">NKR</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
 <span class="fu"><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data</a></span><span class="op">(</span>what <span class="op">=</span> <span class="st">"WAAS"</span><span class="op">)</span>
<span class="co"># variable PH </span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># AMMI analysis table</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co">#     Source  Df Sum Sq Mean Sq F value   Pr(&gt;F) Proportion Accumulated</span>
<span class="co">#        ENV   3  7.719  2.5728 127.913 4.25e-07          .           .</span>
<span class="co">#   REP(ENV)   8  0.161  0.0201   0.897 5.22e-01          .           .</span>
<span class="co">#        GEN  12  1.865  0.1554   6.929 6.89e-09          .           .</span>
<span class="co">#    GEN:ENV  36  5.397  0.1499   6.686 5.01e-14          .           .</span>
<span class="co">#        PC1  14  4.466  0.3190  14.230 0.00e+00       82.8        82.8</span>
<span class="co">#        PC2  12  0.653  0.0545   2.430 8.40e-03       12.1        94.9</span>
<span class="co">#        PC3  10  0.277  0.0277   1.240 2.76e-01        5.1         100</span>
<span class="co">#  Residuals  96  2.153  0.0224      NA       NA          .           .</span>
<span class="co">#      Total 191 22.692  0.1188      NA       NA       &lt;NA&gt;        &lt;NA&gt;</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># </span>
<span class="co"># variable ED </span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># AMMI analysis table</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co">#     Source  Df Sum Sq Mean Sq F value   Pr(&gt;F) Proportion Accumulated</span>
<span class="co">#        ENV   3  306.0  101.99  43.386 2.70e-05          .           .</span>
<span class="co">#   REP(ENV)   8   18.8    2.35   0.906 5.15e-01          .           .</span>
<span class="co">#        GEN  12  212.9   17.74   6.838 8.95e-09          .           .</span>
<span class="co">#    GEN:ENV  36  398.2   11.06   4.263 7.60e-09          .           .</span>
<span class="co">#        PC1  14  212.2   15.16   5.840 0.00e+00       53.3        53.3</span>
<span class="co">#        PC2  12  134.7   11.23   4.330 0.00e+00       33.8        87.1</span>
<span class="co">#        PC3  10   51.3    5.13   1.980 4.38e-02       12.9         100</span>
<span class="co">#  Residuals  96  249.1    2.59      NA       NA          .           .</span>
<span class="co">#      Total 191 1583.2    8.29      NA       NA       &lt;NA&gt;        &lt;NA&gt;</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># </span>
<span class="co"># variable TKW </span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># AMMI analysis table</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co">#     Source  Df Sum Sq Mean Sq F value   Pr(&gt;F) Proportion Accumulated</span>
<span class="co">#        ENV   3  37013   12338   11.13 3.16e-03          .           .</span>
<span class="co">#   REP(ENV)   8   8869    1109    1.21 3.03e-01          .           .</span>
<span class="co">#        GEN  12  44633    3719    4.05 4.41e-05          .           .</span>
<span class="co">#    GEN:ENV  36 164572    4571    4.98 1.73e-10          .           .</span>
<span class="co">#        PC1  14 104276    7448    8.11 0.00e+00       63.4        63.4</span>
<span class="co">#        PC2  12  33361    2780    3.03 1.20e-03       20.3        83.6</span>
<span class="co">#        PC3  10  26935    2694    2.93 3.00e-03       16.4         100</span>
<span class="co">#  Residuals  96  88171     918      NA       NA          .           .</span>
<span class="co">#      Total 191 507829    2659      NA       NA       &lt;NA&gt;        &lt;NA&gt;</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># </span>
<span class="co"># variable NKR </span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># AMMI analysis table</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co">#     Source  Df Sum Sq Mean Sq F value   Pr(&gt;F) Proportion Accumulated</span>
<span class="co">#        ENV   3  237.0   79.01  15.843 0.000997          .           .</span>
<span class="co">#   REP(ENV)   8   39.9    4.99   0.635 0.746348          .           .</span>
<span class="co">#        GEN  12  227.8   18.99   2.418 0.008726          .           .</span>
<span class="co">#    GEN:ENV  36  602.7   16.74   2.132 0.001839          .           .</span>
<span class="co">#        PC1  14  337.4   24.10   3.070 0.000600         56          56</span>
<span class="co">#        PC2  12  192.2   16.02   2.040 0.028500       31.9        87.9</span>
<span class="co">#        PC3  10   73.1    7.31   0.930 0.509500       12.1         100</span>
<span class="co">#  Residuals  96  753.7    7.85      NA       NA          .           .</span>
<span class="co">#      Total 191 2463.8   12.90      NA       NA       &lt;NA&gt;        &lt;NA&gt;</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># </span>
<span class="co"># All variables with significant (p &lt; 0.05) genotype-vs-environment interaction</span>
<span class="co"># Done!</span>
<span class="co"># Class of the model: waas</span>
<span class="co"># Variable extracted: WAAS</span>
<span class="co"># # A tibble: 13 x 5</span>
<span class="co">#    GEN      PH    ED   TKW   NKR</span>
<span class="co">#    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 H1    0.318 0.667 2.72  0.929</span>
<span class="co">#  2 H10   0.230 0.973 2.15  0.506</span>
<span class="co">#  3 H11   0.201 0.649 1.26  0.836</span>
<span class="co">#  4 H12   0.364 0.315 0.558 0.228</span>
<span class="co">#  5 H13   0.363 0.838 0.514 0.946</span>
<span class="co">#  6 H2    0.342 1.08  4.41  0.404</span>
<span class="co">#  7 H3    0.374 0.486 4.10  0.252</span>
<span class="co">#  8 H4    0.294 0.378 3.07  0.281</span>
<span class="co">#  9 H5    0.168 0.567 0.738 0.611</span>
<span class="co"># 10 H6    0.270 0.409 1.64  1.60 </span>
<span class="co"># 11 H7    0.228 0.384 3.44  0.518</span>
<span class="co"># 12 H8    0.315 0.653 4.91  0.941</span>
<span class="co"># 13 H9    0.146 0.907 5.50  0.888</span></code></pre></div>
<p>Além do índice WAAS mostrado acima, os seguintes índices de estabilidade baseados em AMMI podem ser calculados usando a função <code><a href="https://rdrr.io/pkg/metan/man/AMMI_indexes.html">AMMI_indexes()</a></code>:</p>
<ul>
<li><strong>AMMI stability value, ASV, <span class="citation">(Purchase, Hatting, and Deventer <a href="refer%C3%AAncias.html#ref-Purchase2000" role="doc-biblioref">2000</a>)</span>.</strong></li>
</ul>
<p><span class="math display">\[
ASV = \sqrt {{{\left[ {\frac{{IPCA{1_{ss}}}}{{IPCA{2_{ss}}}} \times \left( {IPCA{1_{score}}} \right)} \right]}^2} + {{\left( {IPCA{2_{score}}} \right)}^2}}
\]</span></p>
<ul>
<li><strong>Soma dos valores absolutos dos escores IPCA, SIPC</strong></li>
</ul>
<p><span class="math display">\[
SIP{C_i} = \sum\nolimits_{k = 1}^P {\left| {\mathop {\lambda }\nolimits_k^{0.5} {a_{ik}}} \right|}
\]</span></p>
<ul>
<li><strong>Média dos autovetores elevados ao quadrado, EV</strong></li>
</ul>
<p><span class="math display">\[
E{V_i} = \sum\nolimits_{k = 1}^P {\mathop a\nolimits_{ik}^2 } /P
\]</span></p>
<p>descritos por <span class="citation">Sneller, Kilgore-Norquest, and Dombek (<a href="refer%C3%AAncias.html#ref-Sneller1997" role="doc-biblioref">1997</a>)</span>, onde <em>P</em> é o número de IPCA retido por meio de testes F</p>
<ul>
<li><strong>valor absoluto da contribuição relativa dos IPCAs para a interação <span class="citation">(Zali et al. <a href="refer%C3%AAncias.html#ref-Zali2012" role="doc-biblioref">2012</a>)</span>.</strong></li>
</ul>
<p><span class="math display">\[
Z{a_i} = \sum\nolimits_{k = 1}^P {{\theta _k}{a_{ik}}}
\]</span></p>
<p>Onde <span class="math inline">\({\theta _k}\)</span> é o percentual da soma de quadrados explicada pelo <em>k</em> -ésimo IPCA. índices de selecção simultâneas (SSI) são calculados pela soma dos ranques dos índices Za ASV, SIPC e EV e o ranque da variável dependente <span class="citation">(Farshadfar <a href="refer%C3%AAncias.html#ref-Farshadfar2008" role="doc-biblioref">2008</a>)</span> que resulta em ssiASV, ssiSIPC, ssiEV, e ssiZa, respectivamente.</p>
<p>A função <code>AMMI_index ()</code> tem dois argumentos. O primeiro (x) é o modelo, que deve ser um objeto da classe <code>waas</code>. O segundo, (order.y) é a ordem para a variável resposta. Por padrão, ele é definido como nulo, o que significa que a variável resposta é ordenada em ordem decrescente. Se <code>x</code> é uma lista com mais de uma variável, então <code>order.y</code> deve ser um vetor com o mesmo comprimento de x. Cada elemento do vetor deve ser um dos “h” ou “l”. Se “h” for usado, a variável resposta será ordenada em ordem decrescente. Se “l” for usado, a variável resposta será ordenada em ordem crescente da média dos genótipos. Usando o operador <em>%&gt;% </em> é possível estruturar uma sequência lógica de operações. Vamos construir esse modelo.</p>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stab_indexes</span> <span class="op">&lt;-</span> 
  <span class="va">data_ge</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/metan/man/waas.html">waas</a></span><span class="op">(</span><span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/metan/man/AMMI_indexes.html">AMMI_indexes</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">stab_indexes</span><span class="op">)</span>
<span class="co"># Variable GY </span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># AMMI-based stability indexes</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># # A tibble: 10 x 7</span>
<span class="co">#    GEN       Y   ASV  SIPC     EV     ZA  WAAS</span>
<span class="co">#    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 G1     2.60 0.346 0.463 0.0149 0.100  0.151</span>
<span class="co">#  2 G10    2.47 1.23  2.07  0.210  0.437  0.652</span>
<span class="co">#  3 G2     2.74 0.249 1.54  0.179  0.216  0.283</span>
<span class="co">#  4 G3     2.96 0.113 0.552 0.0207 0.0797 0.106</span>
<span class="co">#  5 G4     2.64 0.594 1.04  0.0521 0.219  0.326</span>
<span class="co">#  6 G5     2.54 0.430 0.997 0.0433 0.186  0.270</span>
<span class="co">#  7 G6     2.53 0.265 1.14  0.0911 0.172  0.233</span>
<span class="co">#  8 G7     2.74 0.663 1.79  0.191  0.303  0.428</span>
<span class="co">#  9 G8     3.00 0.574 1.18  0.0669 0.225  0.327</span>
<span class="co"># 10 G9     2.51 0.983 1.50  0.131  0.336  0.507</span></code></pre></div>
</div>
<div id="biplots" class="section level3" number="14.9.3">
<h3>
<span class="header-section-number">14.9.3</span> Biplots<a class="anchor" aria-label="anchor" href="#biplots"><i class="fas fa-link"></i></a>
</h3>
<p>O pacote <code>metan</code> conta com gráficos gerados pelo pacote <strong>ggplot2</strong>, o que lhe confere um alto nível de personalização. A função utilizada para obtenção dos diferentes tipos de biplots será a <code><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores()</a></code>. Para maiores detalhes veja <code>?plot_._scores</code>.</p>
<div id="biplot-tipo-2-gy-x-pc1" class="section level4" number="14.9.3.1">
<h4>
<span class="header-section-number">14.9.3.1</span> Biplot tipo 2: GY x PC1<a class="anchor" aria-label="anchor" href="#biplot-tipo-2-gy-x-pc1"><i class="fas fa-link"></i></a>
</h4>
<p>O biplot conhecido como <strong>AMMI1</strong> é confeccionado utilizando o argumento <code>type = 2</code> na função <code><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores()</a></code>. O biplot <strong>AMMI1</strong> é utilizado para identificar tanto a estabilidade quando a produtividade dos genótipos. Neste tipo de biplot, os genótipos com escores do PC1 próximos de zero e à direita da linha vertical, são considerados os mais estáveis e com rendimento superior a média geral.</p>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p3</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores</a></span><span class="op">(</span><span class="va">AMMI_model</span><span class="op">)</span>
<span class="va">p4</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores</a></span><span class="op">(</span><span class="va">AMMI_model</span>,
                 col.segm.env <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span> <span class="op">+</span>
                 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
                 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span>,
                       legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p3</span>, <span class="va">p4</span>, tag_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p3"</span>,<span class="st">"p4"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-344"></span>
<img src="html_r_files/figure-html/unnamed-chunk-344-1.png" alt="Biplot AMMI1 gerado pelo pacote metan" width="960"><p class="caption">
Figure 14.1: Biplot AMMI1 gerado pelo pacote metan
</p>
</div>
</div>
<div id="biplot-tipo-1-ipca1-x-ipca2" class="section level4" number="14.9.3.2">
<h4>
<span class="header-section-number">14.9.3.2</span> biplot tipo 1: IPCA1 x IPCA2<a class="anchor" aria-label="anchor" href="#biplot-tipo-1-ipca1-x-ipca2"><i class="fas fa-link"></i></a>
</h4>
<p>O biplot conhecido como <strong>AMMI2</strong> é confeccionado utilizando o argumento <code>type = 1</code> (padrão) na função <code><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores()</a></code>. O biplot <strong>AMMI2</strong> representa os dois primeiros IPCAs oriundos da decomposição por valor singular da matriz dos efeitos da interação e é utilizado para realizar inferências quanto aos padrões da interação genótipo <em>vs</em> ambiente. Neste caso, os dois primeiros IPCAs explicam 66.2% da da soma de quadrados da interação.</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">p1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores</a></span><span class="op">(</span><span class="va">AMMI_model</span>, type <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores</a></span><span class="op">(</span><span class="va">AMMI_model</span>,
                 type <span class="op">=</span> <span class="fl">2</span>,
                 polygon <span class="op">=</span> <span class="cn">TRUE</span>,
                 col.gen <span class="op">=</span> <span class="st">"black"</span>,
                 col.env <span class="op">=</span> <span class="st">"gray70"</span>,
                 col.segm.env <span class="op">=</span> <span class="st">"gray70"</span>,
                 axis.expand <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, tag_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p1"</span>,<span class="st">"p2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-345"></span>
<img src="html_r_files/figure-html/unnamed-chunk-345-1.png" alt="Biplot AMMI2, gerado pelo pacote metan" width="960"><p class="caption">
Figure 14.2: Biplot AMMI2, gerado pelo pacote metan
</p>
</div>
</div>
<div id="rendimento-nominal-x-ipca1" class="section level4" number="14.9.3.3">
<h4>
<span class="header-section-number">14.9.3.3</span> Rendimento nominal x IPCA1<a class="anchor" aria-label="anchor" href="#rendimento-nominal-x-ipca1"><i class="fas fa-link"></i></a>
</h4>
<p>Com o objetivo de identificar possíveis mega-ambientes, bem como visualizar o padrão <em>which-won-where</em> do conjunto de dados, um gráfico com o rendimento nominal (<span class="math inline">\(\mathop {\hat y} \nolimits_ {ij}^*\)</span> ) em função dos escores PCA1 dos ambientes é também confecionado pela função <code><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores()</a></code> utilizando o argumento <code>type = 4</code>. Neste gráfico, cada genótipo é representado por uma linha reta com a equação <span class="math inline">\(\hat y_{ij}^* = \mu_i + PCA1_i \times PCA1_j\)</span> , onde <span class="math inline">\(\hat y_{ij}^*\)</span> é o rendimento nominal para o genótipo <em>i</em> no ambiente <em>J</em>; <span class="math inline">\(\mu\)</span> é a média geral do genótipo <em>i</em>; <span class="math inline">\(PC{1_i}\)</span> é o escore PCA1 do genótipo <em>i</em> e <span class="math inline">\(PC{1_j}\)</span> é o escore PCA1 do ambiente <em>j</em>. O genótipo vencedor em um determinado ambiente possui o maior rendimento nominal nesse ambiente.</p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores</a></span><span class="op">(</span><span class="va">AMMI_model</span>,
            type <span class="op">=</span> <span class="fl">4</span>,
            size.tex.pa <span class="op">=</span> <span class="fl">2</span>,
            x.lab <span class="op">=</span> <span class="st">"Rendimento nominal (Mg/ha)"</span>,
            y.lab <span class="op">=</span> <span class="st">"Escore dos ambientes no PCA1"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-346"></span>
<img src="html_r_files/figure-html/unnamed-chunk-346-1.png" alt="Gráfico do tipo 'which-won-where' baseado no modelo AMMI" width="384"><p class="caption">
Figure 14.3: Gráfico do tipo ‘which-won-where’ baseado no modelo AMMI
</p>
</div>
</div>
</div>
</div>
<div id="o-modelo-gge" class="section level2" number="14.10">
<h2>
<span class="header-section-number">14.10</span> O modelo GGE<a class="anchor" aria-label="anchor" href="#o-modelo-gge"><i class="fas fa-link"></i></a>
</h2>
<p>O modelo GGE (Genotype plus Genotype-vs-Environment interaction) tem sido amplamente utilizado para avaliação de genótipos e identificação de mega-ambientes em ensaios multi-ambientais (MET). Este modelo considera um biplot que é construído pelos dois primeiros componentes principais (PC1 e PC2) derivados da decomposição por valores singulares de dados oriundos de um MET centrados no ambiente <span class="citation">(Yan et al. <a href="refer%C3%AAncias.html#ref-Yan2007" role="doc-biblioref">2007</a>)</span>.</p>
<p>Comunmente, o rendimento médio do genótipo <em>i</em> no ambiente <em>j</em> é descrito pelo seguinte modelo linear geral, ignorando quaisquer erros aleatórios</p>
<p><span class="math display">\[
\hat y_{ij} + \mu + \alpha_i + \beta_j + \phi_{ij}
\]</span></p>
<p>onde <span class="math inline">\(\hat y_{ij}\)</span> é o rendimento médio do genótipo <em>i</em> no ambiente <em>j</em>, <span class="math inline">\(i = 1, ... g; j = 1, ... e\)</span> sendo <em>g</em> e <em>e</em> o número de genótipos e ambientes, respectivamente; <span class="math inline">\(\mu\)</span> é a média geral; <span class="math inline">\(\alpha_i\)</span> é o efeito principal do genótipo <em>i</em>; <span class="math inline">\(\beta_j\)</span> é o efeito principal do ambiente <em>j</em> e <span class="math inline">\(\phi_{ij}\)</span> é o efeito de interação entre genótipo <em>i</em> e o ambiente <em>j</em>. Quando <span class="math inline">\(\phi_{ij}\)</span> é submetido a Decomposição por Valor Singular (SVD), temos o bem conhecido modelo AMMI, visto anteriormente. No modelo GGE, o termo <span class="math inline">\(\alpha_i\)</span> é deletado do modelo acima, permitindo que a variação explicada por este termo seja absorvida por <span class="math inline">\(\phi_{ij}\)</span>. Em seguida, esta matriz de dados –agora centrada no ambiente– é submetida a SVD <span class="citation">(Yan et al. <a href="refer%C3%AAncias.html#ref-Yan2007" role="doc-biblioref">2007</a>; Yan and Kang <a href="refer%C3%AAncias.html#ref-Yan2003" role="doc-biblioref">2003</a>)</span>. Explicitamente, temos</p>
<p><span class="math display">\[
{\phi_{ij} =  \hat y_{ij}} - \mu - \beta_j  = \sum\limits_{k = 1}^p \xi_{ik}^*\eta_{jk}^*
\]</span></p>
<p>onde <span class="math inline">\(\xi_{ik}^* = \lambda_k^ \alpha \xi_{ik}\)</span>; <span class="math inline">\(\eta_{jk}^* = \lambda_k^{1-\alpha}\eta_{jk}\)</span> sendo <span class="math inline">\(\lambda_k\)</span> o <em>k</em>-ésimo autovalor da SVD (<span class="math inline">\(k = 1, ... p\)</span>), com <span class="math inline">\(p \le min (e, g)\)</span>; <span class="math inline">\(\alpha\)</span> é o fator de partição do valor singular para o Componente Principal (PC) <em>k</em> <span class="citation">(Yan <a href="refer%C3%AAncias.html#ref-Yan2002b" role="doc-biblioref">2002</a>)</span>; <span class="math inline">\(\xi_{ik}^*\)</span> e <span class="math inline">\(\eta_{jk}^*\)</span> são os escores do PC <em>k</em> para genótipo <em>i</em> e ambiente <em>j</em>, respectivamente.</p>
<p>A função <code><a href="https://rdrr.io/pkg/metan/man/gge.html">gge()</a></code> do pacote <code>metan</code> é usada para ajustar o modelo GGE. De acordo com <span class="citation">Yan and Kang (<a href="refer%C3%AAncias.html#ref-Yan2003" role="doc-biblioref">2003</a>)</span>, a função suporta quatro métodos de centralização de dados, dois métodos de escalonamento de dados e três opções para particionamento de valor singular:</p>
<div id="data-centering" class="section level3" number="14.10.1">
<h3>
<span class="header-section-number">14.10.1</span> Data centering<a class="anchor" aria-label="anchor" href="#data-centering"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>0 ou <code>none</code>: para dados não centralizados;</li>
<li>1 ou <code>global</code>: para dados centralizados globalmente (E + G + GE);</li>
<li>2 ou <code>environment</code>: (padrão), para dados centrados no ambiente (G + GE);</li>
<li>3 ou <code>double</code>: para dados centrados duplamente (GE). Um biplot não pode ser produzido sem modelos produzidos sem centralização.</li>
</ul>
</div>
<div id="data-scaling" class="section level3" number="14.10.2">
<h3>
<span class="header-section-number">14.10.2</span> Data scaling<a class="anchor" aria-label="anchor" href="#data-scaling"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>0 ou <code>none</code>: (padrão) para nenhum escalonamento;</li>
<li>1 ou <code>sd</code>: Cada valor é dividido pelo desvio padrão do seu ambiente correspondente (coluna). Isso colocará todos os ambientes com aproximadamente o mesmo intervalo de valores.</li>
</ul>
</div>
<div id="singular-value-partition" class="section level3" number="14.10.3">
<h3>
<span class="header-section-number">14.10.3</span> Singular value partition<a class="anchor" aria-label="anchor" href="#singular-value-partition"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>1 ou <code>genotype</code>: O valor singular é inteiramente particionado nos autovetores de Genótipo (<span class="math inline">\(\alpha = 1\)</span>), Também chamado de <em>row metric preserving</em>;</li>
<li>2 ou <code>environment</code>: (padrão) O valor singular é inteiramente particionado nos autovetores de ambiente (<span class="math inline">\(\alpha = 0\)</span>), também chamado de <em>column metric preserving</em>;</li>
<li>3 ou <code>symmetrical</code>: O valor singular é simetricamente dividida nos autovetores de genótipo e ambiente (<span class="math inline">\(\alpha = 0,5\)</span>). Esta partição é mais frequentemente usada na análise AMMI.</li>
</ul>
</div>
<div id="ajustando-o-modelo-gge" class="section level3" number="14.10.4">
<h3>
<span class="header-section-number">14.10.4</span> Ajustando o modelo GGE<a class="anchor" aria-label="anchor" href="#ajustando-o-modelo-gge"><i class="fas fa-link"></i></a>
</h3>
<p>Para ajustar o modelo GGE, usaremos os dados em <code>data_ge</code>, que contém dados do rendimento de grãos avaliados em 10 genótipos conduzidos em 14 ambientes. Primeiro de tudo, vamos criar uma tabela bidirecional para esses dados usando a função <code><a href="https://rdrr.io/pkg/metan/man/make_mat.html">make_mat()</a></code>. </p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ge_table</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/make_mat.html">make_mat</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">GEN</span>, <span class="va">ENV</span>, <span class="va">GY</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.dataframe.html">print.data.frame</a></span><span class="op">(</span><span class="va">ge_table</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co">#       E1  E10   E11  E12  E13  E14   E2   E3   E4   E5   E6   E7   E8   E9</span>
<span class="co"># G1  2.37 2.31 1.356 1.34 3.00 1.53 3.04 4.08 3.49 4.17 2.81 1.90 2.27 2.78</span>
<span class="co"># G10 1.97 1.54 0.899 1.02 1.83 1.86 3.15 4.11 4.27 3.37 2.48 2.24 2.70 3.15</span>
<span class="co"># G2  2.90 2.30 1.491 1.99 3.03 1.43 3.23 4.57 3.72 3.83 2.54 1.99 2.05 3.36</span>
<span class="co"># G3  2.89 2.34 1.568 1.76 3.47 2.06 3.61 4.13 4.13 4.13 2.98 2.16 2.85 3.29</span>
<span class="co"># G4  2.59 2.17 1.370 1.53 2.64 1.86 3.19 3.85 3.30 3.78 2.70 1.98 2.30 3.72</span>
<span class="co"># G5  2.19 2.14 1.326 1.69 2.57 1.78 3.14 3.74 3.38 3.47 2.43 1.66 2.71 3.30</span>
<span class="co"># G6  2.30 2.21 1.501 1.39 2.91 1.80 3.29 3.43 3.40 3.57 2.34 1.76 2.54 3.04</span>
<span class="co"># G7  2.77 2.44 1.364 1.95 3.18 1.94 2.61 4.10 3.02 4.05 2.67 2.55 2.58 3.14</span>
<span class="co"># G8  2.90 2.57 1.683 2.00 3.52 1.99 3.44 4.11 4.14 4.81 2.91 2.26 2.88 2.83</span>
<span class="co"># G9  2.33 1.74 1.125 1.41 2.95 1.57 3.09 4.51 3.90 3.93 2.77 1.39 2.49 1.94</span></code></pre></div>
<p>A função <code><a href="https://rdrr.io/pkg/metan/man/gge.html">gge()</a></code> ajusta um modelo GGE baseado em uma tabela bidirecional (<code>ge_table</code> em nosso caso) com genótipos nas linhas e ambientes em colunas, ou em um data.frame contendo pelo menos as colunas para genótipos, ambientes e variável(is) resposta.
</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Usando um data frame</span>
<span class="va">gge_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/gge.html">gge</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span><span class="op">)</span></code></pre></div>
<p>O modelo acima foi ajustado considerando (i) <em>column metric preserving</em> (onde o valor singular é inteiramente particionado nos autovetores do ambiente); (ii) <em>environment centered</em> (o biplot conterá uma informação mista de G + GEI); e nenhum método de escalonamento. Para alterar estas configurações padrão, use os argumentos <code>svp</code>, <code>centering</code> e <code>scaling</code>, respectivamente. Por favor, note que no segundo exemplo o argumento <code>table</code> foi definido como <code>TRUE</code> para indicar que os dados de entrada são uma tabela bidirecional.</p>
</div>
<div id="valores-estimados-pelo-modelo-gge" class="section level3" number="14.10.5">
<h3>
<span class="header-section-number">14.10.5</span> Valores estimados pelo modelo GGE<a class="anchor" aria-label="anchor" href="#valores-estimados-pelo-modelo-gge"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">gge_model</span>, naxis <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">$</span><span class="va">GY</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co"># # A tibble: 10 x 14</span>
<span class="co">#       E1   E10   E11   E12   E13   E14    E2    E3    E4    E5    E6    E7    E8</span>
<span class="co">#  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1  2.51  2.14 1.35   1.59  2.95  1.76  3.20  4.14  3.78  3.97  2.70  1.95  2.56</span>
<span class="co">#  2  1.93  1.62 0.988  1.07  2.07  1.66  3.08  3.99  3.78  3.28  2.43  1.69  2.48</span>
<span class="co">#  3  2.67  2.33 1.47   1.75  3.09  1.82  3.19  4.04  3.59  4.03  2.70  2.08  2.54</span>
<span class="co">#  4  2.83  2.44 1.56   1.88  3.40  1.83  3.26  4.18  3.73  4.32  2.83  2.10  2.59</span>
<span class="co">#  5  2.50  2.25 1.39   1.64  2.71  1.83  3.09  3.81  3.32  3.65  2.52  2.11  2.47</span>
<span class="co">#  6  2.32  2.06 1.27   1.46  2.52  1.78  3.09  3.87  3.46  3.54  2.49  1.99  2.47</span>
<span class="co">#  7  2.40  2.11 1.31   1.52  2.65  1.78  3.12  3.92  3.52  3.66  2.54  2.00  2.49</span>
<span class="co">#  8  2.78  2.49 1.56   1.88  3.17  1.87  3.17  3.93  3.40  4.04  2.68  2.21  2.52</span>
<span class="co">#  9  2.99  2.54 1.64   2.00  3.71  1.84  3.33  4.33  3.89  4.61  2.96  2.11  2.64</span>
<span class="co"># 10  2.27  1.78 1.15   1.30  2.82  1.64  3.28  4.43  4.28  4.03  2.79  1.65  2.62</span>
<span class="co"># # ... with 1 more variable: E9 &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="visualizando-o-biplot" class="section level3" number="14.10.6">
<h3>
<span class="header-section-number">14.10.6</span> Visualizando o Biplot<a class="anchor" aria-label="anchor" href="#visualizando-o-biplot"><i class="fas fa-link"></i></a>
</h3>
<p>A função genérica <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> é usada para gerar um biplot usando como entrada o modelo ajustado da classe <code>gge</code>. O tipo de biplot é escolhido pelo argumento <code>type</code> na função. Dez tipos de biplots estão disponíveis de acordo com <span class="citation">Yan and Kang (<a href="refer%C3%AAncias.html#ref-Yan2003" role="doc-biblioref">2003</a>)</span>.</p>
<ul>
<li>
<code>type = 1</code> Um biplot básico.</li>
<li>
<code>type = 2</code> Desempenho médio vs. estabilidade</li>
<li>
<code>type = 3</code> Que ganhou onde.</li>
<li>
<code>type = 4</code> Descriminação vs. representatividade</li>
<li>
<code>type = 5</code> Examinar um ambiente.</li>
<li>
<code>type = 6</code> Ranquear os ambientes.</li>
<li>
<code>type = 7</code> Examinar um genótipo.</li>
<li>
<code>type = 8</code> Ranquear os genótipos.</li>
<li>
<code>type = 9</code> Comparar dois genótipos.</li>
<li>
<code>type = 10</code> Relação entre os ambientes.</li>
</ul>
<p>Neste material, para cada tipo de biplot, dois gráficos são produzidos. Um com as configurações padrão e outro para mostrar algumas opções gráficas da função.</p>
<div id="biplot-tipo-1-um-biplot-básico" class="section level4" number="14.10.6.1">
<h4>
<span class="header-section-number">14.10.6.1</span> Biplot tipo 1: Um biplot básico<a class="anchor" aria-label="anchor" href="#biplot-tipo-1-um-biplot-b%C3%A1sico"><i class="fas fa-link"></i></a>
</h4>
<p>Esta é a configuração padrão no gráfico da função, portanto, este biplot é produzido apenas chamando <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(model)</a></code>, como mostrado abaixo.
</p>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>,
           col.gen <span class="op">=</span> <span class="st">"blue"</span>,
           size.text.env <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-350-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
<div id="biplot-tipo-2-desempenho-médio-vs.-estabilidade" class="section level4" number="14.10.6.2">
<h4>
<span class="header-section-number">14.10.6.2</span> Biplot tipo 2: Desempenho médio vs. estabilidade<a class="anchor" aria-label="anchor" href="#biplot-tipo-2-desempenho-m%C3%A9dio-vs.-estabilidade"><i class="fas fa-link"></i></a>
</h4>
<p>Neste biplot, a visualização da média e da estabilidade dos genótipos é obtida desenhando uma coordenada média de ambiente (AEC) no biplot obtido com <em>row metric preserving</em>. Primeiro, um ambiente médio, representado pelo pequeno círculo, é definido pelas médias dos escores PC1 e PC2 dos ambientes. A linha que passa pela origem do biplot e pelo AEC pode ser chamada de média. As projeções de marcadores genotípicos nesse eixo deve, portanto, aproximar o rendimento médio dos genótipos. Assim, o G8 foi claramente o genótipo de maior rendimento, em média.</p>
<p>A ordenada de AEC é a linha que passa pela origem do biplot e é perpendicular à abscissa do AEC. Portanto, se a abscissa AEC representa o G, a ordenada AEC deve aproximar o GEI associado a cada genótipo, que é uma medida de variabilidade ou instabilidade dos genótipos <span class="citation">(Yan et al. <a href="refer%C3%AAncias.html#ref-Yan2007" role="doc-biblioref">2007</a>)</span>. Uma projeção maior na ordenada AEC, independentemente da direção, significa maior instabilidade. Em nosso exemplo, o G3 foi o mais estável e o segundo genótipo mais produtivo, enquanto o G9 apresentou alta instabilidade.
</p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gge_model</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/metan/man/gge.html">gge</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span>, svp <span class="op">=</span> <span class="st">"genotype"</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>, type <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>,
          type <span class="op">=</span> <span class="fl">2</span>,
          col.gen <span class="op">=</span> <span class="st">"black"</span>,
          col.env <span class="op">=</span> <span class="st">"gray"</span>,
          axis_expand <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-351-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
<div id="biplot-tipo-3-quem-ganhou-onde" class="section level4" number="14.10.6.3">
<h4>
<span class="header-section-number">14.10.6.3</span> Biplot tipo 3: quem ganhou onde<a class="anchor" aria-label="anchor" href="#biplot-tipo-3-quem-ganhou-onde"><i class="fas fa-link"></i></a>
</h4>
<p>Neste biplot (obtido com particionamento de valores singulares simétrico) um polígono é desenhado juntando os genótipos (G7, G8, G9, G10 e G4) que estão localizadas mais distante da origem do biplot fazendo com que todos os outros genótipos fiquem contidos no polígono. Os <em>genótipos vértex</em> têm os vetores mais longos, em suas respectivas direções, que é uma medida da capacidade de resposta aos ambientes. Estes genótipos estão, portanto, entre os genótipos mais responsivos. Todos os outros genótipos são menos responsivos em suas respectivas direções.</p>
<p>As linhas perpendiculares aos lados do polígono dividem o biplot em setores. Cada setor tem um genótipo vértice. Por exemplo, o setor com o genótipo-vértice G4 pode ser referido como o setor G4. Um ambiente (E9), foi enquadrado neste setor. Como regra geral, o genótipo vértex é o genótipo de mais alto rendimento em todos os ambientes que compartilham o setor com ele <span class="citation">(Yan et al. <a href="refer%C3%AAncias.html#ref-Yan2007" role="doc-biblioref">2007</a>)</span>. Neste caso, G4 teve o maior rendimento em E9, como mostrado na tabela acima.
</p>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gge_model</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/metan/man/gge.html">gge</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span>, svp <span class="op">=</span> <span class="st">"symmetrical"</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>, type <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>,
          type <span class="op">=</span> <span class="fl">3</span>,
          size.shape.win <span class="op">=</span> <span class="fl">5</span>,
          large_label <span class="op">=</span> <span class="fl">6</span>,
          col.gen <span class="op">=</span> <span class="st">"black"</span>,
          col.env <span class="op">=</span> <span class="st">"gray"</span>,
          annotation <span class="op">=</span> <span class="cn">FALSE</span>,
          title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-352-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
<div id="biplot-tipo-4-discriminação-vs.-representatividade" class="section level4" number="14.10.6.4">
<h4>
<span class="header-section-number">14.10.6.4</span> Biplot tipo 4: Discriminação vs. representatividade<a class="anchor" aria-label="anchor" href="#biplot-tipo-4-discrimina%C3%A7%C3%A3o-vs.-representatividade"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>, type <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>,
          type <span class="op">=</span> <span class="fl">4</span>,
          plot_theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-353-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
<div id="biplot-tipo-5-examinar-um-ambiente" class="section level4" number="14.10.6.5">
<h4>
<span class="header-section-number">14.10.6.5</span> Biplot tipo 5: Examinar um ambiente<a class="anchor" aria-label="anchor" href="#biplot-tipo-5-examinar-um-ambiente"><i class="fas fa-link"></i></a>
</h4>
<p>A identificação de genótipos mais adaptados a um ambiente pode ser facilmente alcançada utilizando o biplot GGE. Por exemplo, para visualizar o desempenho de diferentes genótipos em um dado ambiente, por exemplo, E10, simplesmente desenhe uma linha que passa pela origem biplot e o marcador do E10. Os genótipos podem ser classificados de acordo com suas projeções no eixo E10 com base em seu desempenho neste ambiente, na direção apontada pela seta. Em nosso exemplo, no E10, o genótipo de maior rendimento foi o genótipo G8 e o genótipo de menor rendimento foi G10. A ordem dos genótipos foi G8 &gt; G7 &gt; G3 &gt; G2 &gt; G4 &gt; G1 &gt; G6 &gt; G5 &gt; G9 &gt; G10.
</p>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gge_model</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/metan/man/gge.html">gge</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span>, svp <span class="op">=</span> <span class="st">"symmetrical"</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>, type <span class="op">=</span> <span class="fl">5</span>, sel_env <span class="op">=</span> <span class="st">"E10"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>,
          type <span class="op">=</span> <span class="fl">5</span>,
          sel_env <span class="op">=</span> <span class="st">"E10"</span>,
          col.gen <span class="op">=</span> <span class="st">"black"</span>,
          col.env <span class="op">=</span> <span class="st">"black"</span>,
          size.text.env <span class="op">=</span> <span class="fl">10</span>,
          axis_expand <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-354-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
<div id="biplot-tipo-6-ranquear-os-ambientes" class="section level4" number="14.10.6.6">
<h4>
<span class="header-section-number">14.10.6.6</span> Biplot tipo 6: ranquear os ambientes<a class="anchor" aria-label="anchor" href="#biplot-tipo-6-ranquear-os-ambientes"><i class="fas fa-link"></i></a>
</h4>
<p>Neste biplot o ambiente “ideal” é usado como o centro de um conjunto de linhas concêntricas que servem para medir a distância entre um ambiente e o ambiente “ideal”. Como o foco principal neste biplot são os ambientes, a partição de valor singular usada é “ambiente” (padrão). Pode ser visto que E13 é o mais próximo do ambiente ideal e, portanto, é o mais desejável de todos os 14 ambientes. E4 e E9 foram os ambientes de teste menos desejados.
</p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gge_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/gge.html">gge</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>, type <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>,
           type <span class="op">=</span> <span class="fl">6</span>,
           col.gen <span class="op">=</span> <span class="st">"black"</span>,
           col.env <span class="op">=</span> <span class="st">"black"</span>,
           size.text.env <span class="op">=</span> <span class="fl">10</span>,
           axis_expand <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-355-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
<div id="biplot-tipo-7-examinar-um-genótipo" class="section level4" number="14.10.6.7">
<h4>
<span class="header-section-number">14.10.6.7</span> Biplot tipo 7: examinar um genótipo<a class="anchor" aria-label="anchor" href="#biplot-tipo-7-examinar-um-gen%C3%B3tipo"><i class="fas fa-link"></i></a>
</h4>
<p>Semelhante à visualização dos desempenhos genotípicos em um determinado ambiente (biplot 5), a visualização da média e da estabilidade dos genótipos é obtida desenhando-se uma AEC no biplot com foco no genótipo, ou <em>row metric preserving</em> <span class="citation">(Yan et al. <a href="refer%C3%AAncias.html#ref-Yan2007" role="doc-biblioref">2007</a>)</span>.
</p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gge_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/gge.html">gge</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span>, svp <span class="op">=</span> <span class="st">"genotype"</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>, type <span class="op">=</span> <span class="fl">7</span>, sel_gen <span class="op">=</span> <span class="st">"G8"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>,
           type <span class="op">=</span> <span class="fl">7</span>,
           sel_gen <span class="op">=</span> <span class="st">"G8"</span>,
           col.gen <span class="op">=</span> <span class="st">"black"</span>,
           col.env <span class="op">=</span> <span class="st">"black"</span>,
           size.text.env <span class="op">=</span> <span class="fl">10</span>,
           axis_expand <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-356-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
<div id="biplot-tipo-8-ranquear-os-genótipos" class="section level4" number="14.10.6.8">
<h4>
<span class="header-section-number">14.10.6.8</span> Biplot tipo 8: ranquear os genótipos<a class="anchor" aria-label="anchor" href="#biplot-tipo-8-ranquear-os-gen%C3%B3tipos"><i class="fas fa-link"></i></a>
</h4>
<p>Este biplot compara todos os genótipos com o genótipo “ideal”. O genótipo ideal, representado pelo pequeno círculo com uma seta apontando para ele, é definido como tendo o maior rendimento em todos os ambientes. Ou seja, tem o maior rendimento médio e é absolutamente estável. Os genótipos são classificados com base em sua distância do genótipo ideal <span class="citation">(Yan et al. <a href="refer%C3%AAncias.html#ref-Yan2007" role="doc-biblioref">2007</a>)</span>. Em nosso exemplo, o G3 e o G8 superaram os outros genótipos.
</p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gge_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/gge.html">gge</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span>, svp <span class="op">=</span> <span class="st">"genotype"</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>, type <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>,
           type <span class="op">=</span> <span class="fl">8</span>,
           col.gen <span class="op">=</span> <span class="st">"black"</span>,
           col.env <span class="op">=</span> <span class="st">"gray"</span>,
           size.text.gen <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-357-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
<div id="biplot-tipo-9-comparar-dois-genótipos" class="section level4" number="14.10.6.9">
<h4>
<span class="header-section-number">14.10.6.9</span> Biplot tipo 9: comparar dois genótipos<a class="anchor" aria-label="anchor" href="#biplot-tipo-9-comparar-dois-gen%C3%B3tipos"><i class="fas fa-link"></i></a>
</h4>
<p>Para comparar dois genótipos, por exemplo, G10 e G8, desenhe uma linha de conexão para conectá-los e trace uma linha perpendicular que passa pela origem do biplot e é perpendicular à linha de conexão. Vemos que um ambiente, E9, está do mesmo lado da linha perpendicular do G10, e os outros 13 ambientes estão do outro lado da linha perpendicular, junto com o G8. Isso indica que G10 produziu mais do que o G8 no E9, mas G8 produziu mais que o G10 nos outros 13 ambientes <span class="citation">(Yan et al. <a href="refer%C3%AAncias.html#ref-Yan2007" role="doc-biblioref">2007</a>)</span>.
</p>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gge_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/gge.html">gge</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span>, svp <span class="op">=</span> <span class="st">"symmetrical"</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>, type <span class="op">=</span> <span class="fl">9</span>, sel_gen1 <span class="op">=</span> <span class="st">"G8"</span>, sel_gen2 <span class="op">=</span> <span class="st">"G10"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>,
           type <span class="op">=</span> <span class="fl">9</span>,
           sel_gen1 <span class="op">=</span> <span class="st">"G8"</span>,
           sel_gen2 <span class="op">=</span> <span class="st">"G10"</span>,
           col.gen <span class="op">=</span> <span class="st">"black"</span>,
           title <span class="op">=</span> <span class="cn">FALSE</span>,
           annotation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-358-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
<div id="biplot-tipo-10-relação-entre-os-ambientes" class="section level4" number="14.10.6.10">
<h4>
<span class="header-section-number">14.10.6.10</span> Biplot tipo 10: relação entre os ambientes<a class="anchor" aria-label="anchor" href="#biplot-tipo-10-rela%C3%A7%C3%A3o-entre-os-ambientes"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gge_model</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/metan/man/gge.html">gge</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">GY</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>, type <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gge_model</span>,
          type <span class="op">=</span> <span class="fl">10</span>,
          col.gen <span class="op">=</span> <span class="st">"black"</span>,
          title <span class="op">=</span> <span class="cn">FALSE</span>,
          annotation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-359-1.png" width="960" style="display: block; margin: auto;"></div>
</div>
</div>
</div>
<div id="modelos-mistos-na-avaliação-de-met" class="section level2" number="14.11">
<h2>
<span class="header-section-number">14.11</span> Modelos mistos na avaliação de MET<a class="anchor" aria-label="anchor" href="#modelos-mistos-na-avalia%C3%A7%C3%A3o-de-met"><i class="fas fa-link"></i></a>
</h2>
<p>Assumindo <span class="math inline">\(\mathop\alpha\nolimits_i\)</span> e <span class="math inline">\(\mathop {(\alpha \tau )}\nolimits_{ij}\)</span> como sendo de efeitos aleatórios, o modelo em  pode ser convenientemente reescrito utilizando o seguinte modelo linear misto:
<span class="math display">\[ \label{meq}
{\boldsymbol{y  = X\beta  + Zu + \varepsilon }}
\]</span></p>
<p>onde <strong>y</strong> é um vetor <span class="math inline">\(n[ = \sum\nolimits_{j = 1}^e {(gb)]} \times 1\)</span>, <span class="math inline">\({\boldsymbol{y}} = {\rm{ }}{\left[ {{y_{111}},{\rm{ }}{y_{112}},{\rm{ }} \ldots ,{\rm{ }}{y_{geb}}} \right]^\prime }\)</span>; <span class="math inline">\(\boldsymbol{\beta}\)</span> é um vetor <span class="math inline">\(eb \times 1\)</span> de efeitos fixos, <span class="math inline">\({\boldsymbol{\beta }} = [\mathop \gamma \nolimits_{11} ,\mathop \gamma \nolimits_{12} ,...,\mathop \gamma \nolimits_{eb} ]'\)</span>; <strong>u</strong> é um vetor <span class="math inline">\(m[ = g + ge] \times 1\)</span> de efeitos aleatórios, <span class="math inline">\({\boldsymbol{u}} = {\rm{ }}{\left[ {{\alpha _1},{\alpha _2},...,{\alpha _g},\mathop {(\alpha \tau )}\nolimits_{11} ,\mathop {(\alpha \tau )}\nolimits_{12} ,...,\mathop {(\alpha \tau )}\nolimits_{ge} } \right]^\prime }\)</span>; <strong>X</strong> é uma matriz delineamento de dimensão <span class="math inline">\(n \times eb\)</span> relacionando <strong>y</strong> a <span class="math inline">\({\boldsymbol{\beta }}\)</span>; <strong>Z</strong> é uma matriz delineamento de dimensão <span class="math inline">\(m\times n\)</span> relacionando <strong>y</strong> a <span class="math inline">\(\boldsymbol{u}\)</span>; e <span class="math inline">\({\boldsymbol{\varepsilon }}\)</span> é um vetor n×1 de erros aleatórios, <span class="math inline">\({\boldsymbol{\varepsilon }} = {\rm{ }}{\left[ {{y_{111}},{\rm{ }}{y_{112}},{\rm{ }} \ldots ,{\rm{ }}{y_{geb}}} \right]^\prime }\)</span></p>
<p>Os vetores aleatórios <span class="math inline">\({\boldsymbol{\beta }}\)</span> e <span class="math inline">\(\boldsymbol{u}\)</span> são assumidos como normais e independentemente distribuídos com média zero e matrizes de variância-covariância <strong>G</strong> e <strong>R</strong>, respectivamente, de tal forma que</p>
<p><span class="math display">\[
\left[ \begin{array}{l}{\boldsymbol{u}}\\{\boldsymbol{\varepsilon }}\end{array} \right]\sim N\left( {\left[ \begin{array}{l}{\boldsymbol{0}}\\{\boldsymbol{0}}\end{array} \right]{\boldsymbol{,}}\left[ {\begin{array}{*{20}{c}}{\boldsymbol{G}}&amp;{\boldsymbol{0}}\\{\boldsymbol{0}}&amp;{\boldsymbol{R}}\end{array}} \right]} \right)
\]</span></p>
<p>A matriz de variância-covariância <strong>G</strong> tem muitas formas possíveis. A estrutura mais simples -e a opção padrão na maioria dos pacotes estatísticos para modelos mistos- são os componentes de variância, de modo que</p>
<p><span class="math display">\[
{\boldsymbol{G}} = \left[ {\begin{array}{*{20}{c}}{\mathop {\hat \sigma }\nolimits_\alpha ^2 {{\boldsymbol{I}}_g}}&amp;0\\0&amp;{\mathop {\hat \sigma }\nolimits_{\alpha \tau }^2 {{\boldsymbol{I}}_{ge}}}\end{array}} \right]
\]</span></p>
<p>e <span class="math inline">\({\boldsymbol{R}} = \mathop {\hat \sigma }\nolimits_\varepsilon ^2 {{\boldsymbol{I}}_n}\)</span>, sendo <span class="math inline">\(\mathop {\hat \sigma }\nolimits_\alpha ^2\)</span>, <span class="math inline">\(\mathop {\hat \sigma }\nolimits_{\alpha \tau }^2\)</span> e <span class="math inline">\(\mathop {\hat \sigma }\nolimits_\varepsilon ^2\)</span> as variâncias para genótipo, interação genótipo-ambiente e erros aleatórios, respectivamente.</p>
<p>Os vetores <span class="math inline">\({\boldsymbol{\beta }}\)</span> e <span class="math inline">\(\boldsymbol{u}\)</span> são estimados considerando a bem conhecida equação de modelo misto <span class="citation">Henderson (<a href="refer%C3%AAncias.html#ref-Henderson1975" role="doc-biblioref">1975</a>)</span>.</p>
<p><span class="math display">\[ \label{ad}
\left[ {\begin{array}{*{20}{c}}{{\boldsymbol{\hat \beta }}}\\{{\boldsymbol{\hat u}}}\end{array}} \right]{\boldsymbol{ = }}{\left[ {\begin{array}{*{20}{c}}{{\boldsymbol{X'}}{{\boldsymbol{R}}^{\ - {\boldsymbol{1}}}}{\boldsymbol{X}}}&amp;{{\boldsymbol{X'}}{{\boldsymbol{R}}^{ - {\boldsymbol{1}}}}{\boldsymbol{Z}}}\\{{\boldsymbol{Z'}}{{\boldsymbol{R}}^{ - {\boldsymbol{1}}}}{\boldsymbol{X}}}&amp;{{\boldsymbol{Z'}}{{\boldsymbol{R}}^{ - {\boldsymbol{1}}}}{\boldsymbol{Z + }}{{\boldsymbol{G}}^{ - {\boldsymbol{1}}}}}\end{array}} \right]^ - }\left[ {\begin{array}{*{20}{c}}{{\boldsymbol{X'}}{{\boldsymbol{R}}^{ - {\boldsymbol{1}}}}{\boldsymbol{y}}}\\{{\boldsymbol{Z'}}{{\boldsymbol{R}}^{ - {\boldsymbol{1}}}}{\boldsymbol{y}}}\end{array}} \right]
\]</span></p>
<p>Onde o sobescrito <span class="math inline">\(^{-1}\)</span> e <span class="math inline">\(^-\)</span> representam as inversas e inversas generalizadas das matrizes, respectivamente. A estimativa dos componentes de variância em <span class="math inline">\({\boldsymbol{\hat G}}\)</span> e <span class="math inline">\({\boldsymbol{\hat R}}\)</span>, pode ser realizada sem maiores problemas utilizando ANOVA  convencional quando os dados são balanceados. Quando este pressuposto não é cumprido, a estimativa baseada em Restricted Maximum Likelihood (REML)  utilizando o algoritmo Expectation-Maximization <span class="citation">(Dempster, Laird, and Rubin <a href="refer%C3%AAncias.html#ref-Dempster1977" role="doc-biblioref">1977</a>)</span> é a mais indicada.</p>
<p>Desde a década de 1990, os modelos mistos vêm ganhando cada vez mais espaço na avaliação de MET, pois permitem a estimativa de parâmetros genéticos  e ambientais, bem como a predição dos valores genotípicos de forma não-viciada <span class="citation">(Smith, Cullis, and Thompson <a href="refer%C3%AAncias.html#ref-Smith2005" role="doc-biblioref">2005</a>)</span>. Da mesma forma, modelos mistos reduzem os ruídos de análises realizadas com dados desbalanceados e também de variáveis que não assumem aditividade, características frequentemente observadas em MET <span class="citation">(Hu <a href="refer%C3%AAncias.html#ref-Hu2015" role="doc-biblioref">2015</a>)</span>. Na avaliação dos dados oriundos de MET é de interesse do pesquisador predizer o “verdadeiro” rendimento <span class="math inline">\(w_{ij}\)</span> dado os rendimentos observados <span class="math inline">\(y_{ij}\)</span>. Quando um fator é considerado fixo, as inferências são limitadas apenas aos níveis testados deste fator e os efeitos são estimados por Best Linear Unbiased Estimator, ou BLUE . Para efeitos aleatórios, onde deseja-se expandir as inferências para uma população de tratamentos (ou ambientes), a predição é realizada por Best Linear Unbiased Predictor, ou BLUP  <span class="citation">(Henderson <a href="refer%C3%AAncias.html#ref-Henderson1975" role="doc-biblioref">1975</a>)</span>.
Eq. </p>
<div id="ajustando-o-modelo" class="section level3" number="14.11.1">
<h3>
<span class="header-section-number">14.11.1</span> Ajustando o modelo<a class="anchor" aria-label="anchor" href="#ajustando-o-modelo"><i class="fas fa-link"></i></a>
</h3>
<p>A função <code><a href="https://rdrr.io/pkg/metan/man/waasb.html">waasb()</a></code>  do pacote <code>metan</code> será utilizada para a análise dos dados de nosso exemplo utilizando o modelo misto descrito acima, considerando como aleatório os efeitos de genótipo e da interação genótipo-<em>vs</em>-ambiente.</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">BLUP_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/waasb.html">waasb</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>,
                    resp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">GY</span>, <span class="va">HM</span><span class="op">)</span>,
                    verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>A função <code><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data()</a></code> pode ser utilizada para extrair importantes informações do modelo ajustado com a função <code><a href="https://rdrr.io/pkg/metan/man/waasb.html">waasb()</a></code>.</p>
<ul>
<li>Resumo do experimento</li>
</ul>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data</a></span><span class="op">(</span><span class="va">BLUP_model</span>, <span class="st">"details"</span><span class="op">)</span>
<span class="co"># # A tibble: 14 x 3</span>
<span class="co">#    Parameters GY                  HM              </span>
<span class="co">#    &lt;chr&gt;      &lt;chr&gt;               &lt;chr&gt;           </span>
<span class="co">#  1 Mean       "2.67"              "48.09"         </span>
<span class="co">#  2 SE         "0.05"              "0.21"          </span>
<span class="co">#  3 SD         "0.92"              "4.37"          </span>
<span class="co">#  4 CV         "34.56"             "9.09"          </span>
<span class="co">#  5 Min        "0.67 (G10 in E11)" "38 (G2 in E14)"</span>
<span class="co">#  6 Max        "5.09 (G8 in E5)"   "58 (G8 in E11)"</span>
<span class="co">#  7 MinENV     "E11 (1.37)"        "E14 (41.03)"   </span>
<span class="co">#  8 MaxENV     "E3 (4.06)"         "E11 (54.2)"    </span>
<span class="co">#  9 MinGEN     "G10 (2.47) "       "G2 (46.66) "   </span>
<span class="co"># 10 MaxGEN     "G8 (3) "           "G5 (49.3) "    </span>
<span class="co"># 11 wresp      "50"                "50"            </span>
<span class="co"># 12 mresp      "100"               "100"           </span>
<span class="co"># 13 Ngen       "10"                "10"            </span>
<span class="co"># 14 Nenv       "14"                "14"</span></code></pre></div>
<ul>
<li>Teste de razão de máxima verossimilhanças (LRT)</li>
</ul>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data</a></span><span class="op">(</span><span class="va">BLUP_model</span>, <span class="st">"lrt"</span><span class="op">)</span>
<span class="co"># # A tibble: 4 x 8</span>
<span class="co">#   VAR   model    npar logLik   AIC   LRT    Df `Pr(&gt;Chisq)`</span>
<span class="co">#   &lt;chr&gt; &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;</span>
<span class="co"># 1 GY    GEN        44  -224.  537. 19.3      1     1.11e- 5</span>
<span class="co"># 2 GY    GEN:ENV    44  -237.  562. 44.8      1     2.15e-11</span>
<span class="co"># 3 HM    GEN        44  -867. 1821.  7.86     1     5.07e- 3</span>
<span class="co"># 4 HM    GEN:ENV    44  -894. 1876. 62.8      1     2.27e-15</span></code></pre></div>
<p>O teste LRT  indicou diferenças significativas para os efeitos aleatórios de genótipo e interação genótipo-<em>vs</em>-ambiente. Assim, a utilização de modelos mistos é indicada para predição do rendimento em nosso exemplo.</p>
<ul>
<li>Componentes da variância</li>
</ul>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data</a></span><span class="op">(</span><span class="va">BLUP_model</span>, <span class="st">"vcomp"</span><span class="op">)</span>
<span class="co"># # A tibble: 3 x 3</span>
<span class="co">#   Group        GY    HM</span>
<span class="co">#   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co"># 1 GEN      0.0280 0.490</span>
<span class="co"># 2 GEN:ENV  0.0567 2.19 </span>
<span class="co"># 3 Residual 0.0967 2.84</span></code></pre></div>
</div>
<div id="análise-dos-resíduos-2" class="section level3" number="14.11.2">
<h3>
<span class="header-section-number">14.11.2</span> Análise dos resíduos<a class="anchor" aria-label="anchor" href="#an%C3%A1lise-dos-res%C3%ADduos-2"><i class="fas fa-link"></i></a>
</h3>
<p>A função <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> também pode ser utilizada para a investigação dos pressupostos do modelo neste exemplo. Dois gráficos que são gerados mas não mostrados por padrão são vistos neste exemplo.</p>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">BLUP_model</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-364-1.png" width="768" style="display: block; margin: auto;"></div>
</div>
<div id="parâmetros-genéticos" class="section level3" number="14.11.3">
<h3>
<span class="header-section-number">14.11.3</span> Parâmetros genéticos<a class="anchor" aria-label="anchor" href="#par%C3%A2metros-gen%C3%A9ticos"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data</a></span><span class="op">(</span><span class="va">BLUP_model</span>, <span class="st">"genpar"</span><span class="op">)</span>
<span class="co"># Class of the model: waasb</span>
<span class="co"># Variable extracted: genpar</span>
<span class="co"># # A tibble: 9 x 3</span>
<span class="co">#   Parameters              GY     HM</span>
<span class="co">#   &lt;chr&gt;                &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co"># 1 Phenotypic variance  0.181 5.52  </span>
<span class="co"># 2 Heritability         0.154 0.0887</span>
<span class="co"># 3 GEIr2                0.313 0.397 </span>
<span class="co"># 4 h2mg                 0.815 0.686 </span>
<span class="co"># 5 Accuracy             0.903 0.828 </span>
<span class="co"># 6 rge                  0.370 0.435 </span>
<span class="co"># 7 CVg                  6.26  1.46  </span>
<span class="co"># 8 CVr                 11.6   3.50  </span>
<span class="co"># 9 CV ratio             0.538 0.415</span></code></pre></div>
<p>Além dos componentes de variância  para os efeitos aleatórios declarados, alguns importantes parâmetros genéticos  são mostrados. <strong>Heribatility</strong> é a herdabilidade no sentido amplo (<span class="math inline">\(\mathop h\nolimits_g^2\)</span>) estimada por <span class="math inline">\(\mathop h\nolimits_g^2 = \mathop \sigma \nolimits_g^2 /\left( {\mathop \sigma \nolimits_g^2 + \mathop \sigma \nolimits_i^2 + \mathop \sigma \nolimits_e^2 } \right)\)</span> onde <span class="math inline">\((\mathop \sigma \nolimits_g^2 )\)</span> é a variância genotípica; <span class="math inline">\((\mathop \sigma \nolimits_i^2 )\)</span> é a variância da interação GE; e <span class="math inline">\((\mathop \sigma \nolimits_e^2 )\)</span> é a variância residual. <strong>GEIr2</strong> é o coeficiente de determinação do efeito da interação GE (<span class="math inline">\(\mathop r\nolimits_i^2\)</span> ) estimado por <span class="math inline">\(\mathop r\nolimits_i^2 = \mathop \sigma \nolimits_i^2 /\left( {\mathop \sigma \nolimits_g^2 + \mathop \sigma \nolimits_i^2 + \mathop \sigma \nolimits_e^2 } \right)\)</span>; <strong>Heribatility of means</strong> é a herdabilidade da média assumindo ausência de valores perdidos <span class="math inline">\((\mathop h\nolimits_{gm}^2 )\)</span>, estimada por <span class="math inline">\(\mathop h\nolimits_{gm}^2 = \mathop \sigma \nolimits_g^2 /\left[ {\mathop \sigma \nolimits_g^2 + \mathop \sigma \nolimits_i^2 /a + \mathop \sigma \nolimits_e^2 /\left( {ab} \right)} \right]\)</span>, onde <em>a</em> e <em>b</em> são o número de ambientes e blocos, respectivamente; <strong>Accuracy</strong> é a acurácia de seleção (<em>Ac</em>), estimada por <span class="math inline">\(Ac = \sqrt{\mathop h\nolimits_{gm}^2}\)</span> ; <strong>rge</strong> é a correlação genótipo-ambiente <span class="math inline">\((\mathop r\nolimits_{ge})\)</span> estimada por <span class="math inline">\(\mathop r\nolimits_{ge} = \mathop \sigma \nolimits_g^2 /\left({\mathop \sigma \nolimits_g^2 + \mathop \sigma \nolimits_i^2} \right)\)</span>; <strong>CVg</strong> é o coeficiente de variação genotípico, estimado por <span class="math inline">\({\left({\mathop \sigma \nolimits_g^2 /\mu } \right)^{0.5}} \times 100\)</span>, onde <span class="math inline">\(\mu\)</span> é a média geral; <strong>CVr</strong> é o coeficiente de variação residual, estimado por <span class="math inline">\({\left( {\mathop \sigma \nolimits_e^2 /\mu} \right)^{0.5}} \times 100\)</span> ; <strong>CV ratio</strong> é a razão entre o coeficiente de variação genotípico e residual.</p>
</div>
<div id="médias-preditas" class="section level3" number="14.11.4">
<h3>
<span class="header-section-number">14.11.4</span> Médias preditas<a class="anchor" aria-label="anchor" href="#m%C3%A9dias-preditas"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Imprimindo os BLUPs preditos para genótipos</li>
</ul>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">BLUP_model</span><span class="op">$</span><span class="va">GY</span><span class="op">$</span><span class="va">BLUPgen</span><span class="op">)</span>
<span class="co"># # A tibble: 10 x 6</span>
<span class="co">#     Rank GEN     BLUPg Predicted    LL    UL</span>
<span class="co">#    &lt;dbl&gt; &lt;fct&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1     1 G8     0.269       2.94  2.78  3.11</span>
<span class="co">#  2     2 G3     0.229       2.90  2.74  3.07</span>
<span class="co">#  3     3 G2     0.0570      2.73  2.57  2.90</span>
<span class="co">#  4     4 G7     0.0543      2.73  2.56  2.89</span>
<span class="co">#  5     5 G4    -0.0264      2.65  2.48  2.81</span>
<span class="co">#  6     6 G1    -0.0575      2.62  2.45  2.78</span>
<span class="co">#  7     7 G5    -0.112       2.56  2.40  2.73</span>
<span class="co">#  8     8 G6    -0.114       2.56  2.39  2.73</span>
<span class="co">#  9     9 G9    -0.134       2.54  2.37  2.71</span>
<span class="co"># 10    10 G10   -0.166       2.51  2.34  2.67</span></code></pre></div>
<p><code>blupGEN</code> mostra a média predita para os genótipos testados. <strong>BLUPg</strong> é o efeito genotípico <span class="math inline">\((\hat{g}_{i})\)</span> estimado por <span class="math inline">\(\hat{g}_{i} = h_g^2(\bar{y}_{i.}-\bar{y}_{..})\)</span> onde <span class="math inline">\(h_g^2\)</span> é o efeito <em>shrinkage</em> para genótipo, estimado por <span class="math inline">\(\mathop h\nolimits_g^2 = (\mathop {\hat \sigma }\nolimits_i^2 + E\mathop {\hat \sigma }\nolimits_g^2 )/(\mathop {\hat \sigma }\nolimits_i^2 + \mathop {\hat \sigma }\nolimits_\varepsilon ^2 + E\mathop {\hat \sigma }\nolimits_g^2 ).\)</span>. <strong>Predicted</strong> é a média predita por <span class="math inline">\(\hat{g}_{i}+\mu\)</span> onde <span class="math inline">\(\mu\)</span> é a média geral. <strong>LL</strong> e <strong>UL</strong> são os limites inferiore e superior, respectivamente estimado por <span class="math inline">\((\hat{g}_{i}+\mu)\pm{CI}\)</span>. <span class="math inline">\(CI\)</span> é o intervalo de confiança para predição BLUP, assumindo uma dada probabilidade de erro, onde <span class="math inline">\(CI = t\times\sqrt{((1-Ac)\times{\mathop \sigma \nolimits_g^2)}}\)</span> onde <span class="math inline">\(t\)</span> é o valor <em>t</em>-Student para um teste bilateral a uma dada probabilidade de erro; <span class="math inline">\(Ac\)</span> é a acurácia de seleçao; e <span class="math inline">\(\mathop \sigma \nolimits_g^2\)</span> é a variância genotípica.</p>
<ul>
<li>plotando os BLUPs preditos para genótipos</li>
</ul>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_blup.html">plot_blup</a></span><span class="op">(</span><span class="va">BLUP_model</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_blup.html">plot_blup</a></span><span class="op">(</span><span class="va">BLUP_model</span>,
               col.shape  <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gray20"</span>, <span class="st">"gray80"</span><span class="op">)</span>,
               y.lab <span class="op">=</span> <span class="st">"Genótipos"</span>,
               x.lab <span class="op">=</span> <span class="st">"Rendimento de grãos predito"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, tag_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-367"></span>
<img src="html_r_files/figure-html/unnamed-chunk-367-1.png" alt="Médias preditas para genótipos considerando um modelo misto" width="960"><p class="caption">
Figure 14.4: Médias preditas para genótipos considerando um modelo misto
</p>
</div>
<ul>
<li>Imprimindo os BLUPs estimados para as combinações genótipo x ambiente (primeiras 10 entradas)</li>
</ul>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">BLUP_model</span><span class="op">$</span><span class="va">GY</span><span class="op">$</span><span class="va">BLUPint</span><span class="op">)</span>
<span class="co"># # A tibble: 420 x 7</span>
<span class="co">#    ENV   GEN   REP     BLUPg  BLUPge `BLUPg+ge` Predicted</span>
<span class="co">#    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#  1 E1    G1    1     -0.0575 -0.0621    -0.120       2.46</span>
<span class="co">#  2 E1    G1    2     -0.0575 -0.0621    -0.120       2.44</span>
<span class="co">#  3 E1    G1    3     -0.0575 -0.0621    -0.120       2.31</span>
<span class="co">#  4 E1    G2    1      0.0570  0.207      0.264       2.84</span>
<span class="co">#  5 E1    G2    2      0.0570  0.207      0.264       2.82</span>
<span class="co">#  6 E1    G2    3      0.0570  0.207      0.264       2.69</span>
<span class="co">#  7 E1    G3    1      0.229   0.0885     0.318       2.89</span>
<span class="co">#  8 E1    G3    2      0.229   0.0885     0.318       2.87</span>
<span class="co">#  9 E1    G3    3      0.229   0.0885     0.318       2.75</span>
<span class="co"># 10 E1    G4    1     -0.0264  0.0601     0.0337      2.61</span>
<span class="co"># # ... with 410 more rows</span></code></pre></div>
<p>A saída acima os BLUPs  estimados para as combinações genótipo x ambiente. <strong>BLUPg</strong> é o efeito genotípico, descrito acima; <strong>BLUPge</strong> é o efeito genotípico do genótipo <em>i</em> no ambiente <em>j</em> <span class="math inline">\((\hat{g}_{ij})\)</span> estimado por <span class="math inline">\(\hat{g}_{ij} = h_g^2(\bar{y}_{i.}-\bar{y}_{..})+h_{ge}^2(y_{ij}-\bar{y}_{i.}-\bar{y}_{.j}+\bar{y}_{..})\)</span>, onde <span class="math inline">\(h_{ge}^2\)</span> é o efeito <em>shrinkage</em> para a interação GE, estimado por <span class="math inline">\(\mathop h\nolimits_{ge}^2 = \mathop {\hat \sigma }\nolimits_i^2 /(\mathop {\hat \sigma }\nolimits_i^2 + \mathop {\hat \sigma }\nolimits_\varepsilon ^2)\)</span>; <strong>BLUPg+ge</strong> é <span class="math inline">\(BLUP_g+BLUP_{ge}\)</span>; <strong>Predicted</strong> é a média predita (<span class="math inline">\(\hat{y}_{ij}\)</span>) estimada por <span class="math inline">\(\hat{y}_{ij} = \bar{y}_{.j}+BLUP_{g+ge}\)</span>.</p>
<p>Para obter os valores acima para cada variável do modelo basta utilizar a função <code><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data()</a></code>, por exemplo:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data(BLUP_model, "blupg")</a></code> para as médias preditas de genótipos;</li>
<li>
<code><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data(BLUP_model, "blupge")</a></code> para as médias preditas de genótipos em ambientes;</li>
</ul>
</div>
<div id="índices-de-estabilidade-baseados-em-blup" class="section level3" number="14.11.5">
<h3>
<span class="header-section-number">14.11.5</span> Índices de estabilidade baseados em BLUP<a class="anchor" aria-label="anchor" href="#%C3%ADndices-de-estabilidade-baseados-em-blup"><i class="fas fa-link"></i></a>
</h3>
<div id="wsb" class="section level4" number="14.11.5.1">
<h4>
<span class="header-section-number">14.11.5.1</span> O índice WAASB<a class="anchor" aria-label="anchor" href="#wsb"><i class="fas fa-link"></i></a>
</h4>
<p>Recentemente, <span class="citation">(Tiago Olivoto, Lúcio, et al. <a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">2019</a><a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">a</a>)</span> propuseram um índice de estabilidade, WAASB (<strong>W</strong>eighted <strong>A</strong>verage of <strong>A</strong>bsolute <strong>S</strong>cores), que combina as características do modelo AMMI e BLUP. O índice é baseado na média ponderada dos escores absolutos obtidos pela decomposição por valores singulares da matriz BLUP dos efeitos da interação em um modelo de efeito misto, conforme a seguite equação.</p>
<p><span class="math display">\[
        WAASB_i  =
        \sum_{k = 1}^{p} |IPCA_{ik} \times EP_k|/ \sum_{k = 1}^{p}EP_k
\]</span></p>
<p>onde <span class="math inline">\(WAASB_i\)</span> é a média ponderada dos escores absolutos do genótipo <em>i</em>; <span class="math inline">\(IPCA_{ik}\)</span> é o escore do genótipo <em>i</em> no <em>k</em>-esimo IPCA; e <span class="math inline">\(EP_k\)</span> é a variância explicada pelo <em>k</em> IPCA para <span class="math inline">\(k = 1,2, .., p\)</span>, sendo <span class="math inline">\(p = min (g-1; e-1)\)</span>. O genótipo mais estável é aquele com o menor valor de WAASB <span class="citation">(Tiago Olivoto, Lúcio, et al. <a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">2019</a><a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">a</a>)</span>.</p>
<p>Devido a aplicação da ténica de decomposição por valores singulares, é possível a confecção de biplots semelhantes ao método AMMI, considerando agora, um modelo de efeito misto. Para isto, a função <code>plot_scores</code>  é utilizada utilizando como argumento de o modelo ajustado <code>BLUP_model</code>. <span class="citation">Tiago Olivoto, Lúcio, et al. (<a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">2019</a><a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">a</a>)</span> e <span class="citation">Tiago Olivoto, Lúcio, et al. (<a href="refer%C3%AAncias.html#ref-Olivoto2019a" role="doc-biblioref">2019</a><a href="refer%C3%AAncias.html#ref-Olivoto2019a" role="doc-biblioref">b</a>)</span> propuseram a utilização do índice WAASB na ordenada do biplot AMMI1, substituindo os valores do IPCA1 pelos valores do WAASB. Este biplot é criado utilizando <code>type = 3</code> na função.</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p5</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores</a></span><span class="op">(</span><span class="va">BLUP_model</span>, type <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">p6</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_scores.html">plot_scores</a></span><span class="op">(</span><span class="va">BLUP_model</span>, type <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
                 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
                 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span>,
                       legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p5</span>, <span class="va">p6</span>, tag_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p5"</span>,<span class="st">"p6"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-369"></span>
<img src="html_r_files/figure-html/unnamed-chunk-369-1.png" alt="Biplot AMMI2 gerado pelo pacote metan" width="960"><p class="caption">
Figure 14.5: Biplot AMMI2 gerado pelo pacote metan
</p>
</div>
<p>Os quadrantes propostos nesta interpretação representam as quatro classificações propostas por <span class="citation">Tiago Olivoto, Lúcio, et al. (<a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">2019</a><a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">a</a>)</span> em relação à interpretação conjunta da produtividade e estabilidade. Os genótipos ou ambientes incluídos no quadrante I podem ser considerados genótipos instáveis –ou ambientes com alta capacidade de discriminação, mas com produtividade abaixo da média geral. No quadrante II estão incluídos os genótipos instáveis, embora com produtividade acima da média geral. Os ambientes incluídos neste quadrante merecem atenção especial, pois, além de fornecerem altas magnitudes da variável resposta, apresentam boa capacidade de discriminação. Os genótipos dentro do quadrante III têm baixa produtividade, mas podem ser considerados estáveis devido aos valores mais baixos do WAASB. Quanto menor esse valor, mais estável o genótipo pode ser considerado. Os ambientes incluídos neste quadrante podem ser considerados pouco produtivos e com baixa capacidade de discriminação. Os genótipos dentro do quadrante IV são altamente produtivos e estáveis.</p>
</div>
<div id="o-índice-waasby" class="section level4" number="14.11.5.2">
<h4>
<span class="header-section-number">14.11.5.2</span> O índice WAASBY<a class="anchor" aria-label="anchor" href="#o-%C3%ADndice-waasby"><i class="fas fa-link"></i></a>
</h4>
<p>Um novo índice de superioridade que considera tanto a estabilidade quanto a produtividade para a classificação dos genótipos também foi proposto por <span class="citation">Tiago Olivoto, Lúcio, et al. (<a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">2019</a><a href="refer%C3%AAncias.html#ref-Olivoto2019" role="doc-biblioref">a</a>)</span>, considerando a seguinte equação.</p>
<p><span class="math display">\[
WAASB{Y_i} = \frac{{\left( {r{G_i} \times {\theta _Y}} \right) + \left( {r{W_i} \times {\theta _S}} \right)}}{{{\theta _Y} + {\theta _S}}}
\]</span></p>
<p>onde <span class="math inline">\(WAASBY_i\)</span> é o índice de superioridade para o genótipo <em>i</em> que pondera entre desempenho e estabilidade; <span class="math inline">\(rG_i\)</span> e <span class="math inline">\(rW_i\)</span> são os valores escalonados (0-100) para GY e WAASB, respectivamente; <span class="math inline">\(\theta_Y\)</span> e <span class="math inline">\(\theta_S\)</span> são os pesos para GY e WAASB, respectivamente.</p>
<p>Este índice permite atribuir pesos para estabilidade e produtividade na classificação dos genótipos. Para isto, o argumento <code>wresp</code> da função <code><a href="https://rdrr.io/pkg/metan/man/waasb.html">waasb()</a></code>  é usado. Por exemplo, se o objetivo é selecionar genótipos com alto rendimento (independentemente de sua estabilidade), então o <code>wresp = 100</code> deve ser usado. Nesse caso, a classificação do índice WAASBY corresponderá perfeitamente à classificação da variável de resposta. Por outro lado, visando selecionar genótipos altamente estáveis (independentemente da produtividade), então o <code>wresp = 0</code> deve ser usado. Nesse caso, a classificação do índice WAASBY corresponderá perfeitamente à classificação do índice WAASB. Qualquer valor entre 0 e 100 pode ser usado no argumento <code>wresp</code> para ponderar entre o desempenho médio e a estabilidade. Em nosso exemplo, o índice WAASBY foi calculado considerando <code>wresp = 50</code> (padrão da função), o que significa pesos iguais para desempenho e estabilidade médios. Para plotar os valores de WAASBY, o código a seguir é usado.</p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_waasby.html">plot_waasby</a></span><span class="op">(</span><span class="va">BLUP_model</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/plot_waasby.html">plot_waasby</a></span><span class="op">(</span><span class="va">BLUP_model</span>,
                  col.shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>

<div class="dica">
<p>O reescalonamento da variável resposta e do índice WAASB é necessário para que eles sejam diretamente comparáveis. Por padrão, a variável resposta é reescalonada de forma que o valor máximo (genótipo com a maior média) seja 100 e o valor mínimo (genótipo com a menor média) seja 0. Digamos que para uma determinada variável, menores valores são desejados, então o argumento <code>mresp = 100</code> (padrão) deve ser ajustado para <code>mresp = 0</code>.</p>
</div>
<p>Par obter o índice WAASBY para múltiplas variáveis, por exemplo, basta utilizar a função <code><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data()</a></code>, como mostrado abaixo.</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/metan/man/waas.html">waas</a></span><span class="op">(</span><span class="va">data_ge2</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>,
     resp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">PH</span>, <span class="va">ED</span>, <span class="va">TKW</span>, <span class="va">NKR</span><span class="op">)</span>,
     wresp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
 <span class="fu"><a href="https://rdrr.io/pkg/metan/man/get_model_data.html">get_model_data</a></span><span class="op">(</span>what <span class="op">=</span> <span class="st">"WAASY"</span><span class="op">)</span>
<span class="co"># variable PH </span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># AMMI analysis table</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co">#     Source  Df Sum Sq Mean Sq F value   Pr(&gt;F) Proportion Accumulated</span>
<span class="co">#        ENV   3  7.719  2.5728 127.913 4.25e-07          .           .</span>
<span class="co">#   REP(ENV)   8  0.161  0.0201   0.897 5.22e-01          .           .</span>
<span class="co">#        GEN  12  1.865  0.1554   6.929 6.89e-09          .           .</span>
<span class="co">#    GEN:ENV  36  5.397  0.1499   6.686 5.01e-14          .           .</span>
<span class="co">#        PC1  14  4.466  0.3190  14.230 0.00e+00       82.8        82.8</span>
<span class="co">#        PC2  12  0.653  0.0545   2.430 8.40e-03       12.1        94.9</span>
<span class="co">#        PC3  10  0.277  0.0277   1.240 2.76e-01        5.1         100</span>
<span class="co">#  Residuals  96  2.153  0.0224      NA       NA          .           .</span>
<span class="co">#      Total 191 22.692  0.1188      NA       NA       &lt;NA&gt;        &lt;NA&gt;</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># </span>
<span class="co"># variable ED </span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># AMMI analysis table</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co">#     Source  Df Sum Sq Mean Sq F value   Pr(&gt;F) Proportion Accumulated</span>
<span class="co">#        ENV   3  306.0  101.99  43.386 2.70e-05          .           .</span>
<span class="co">#   REP(ENV)   8   18.8    2.35   0.906 5.15e-01          .           .</span>
<span class="co">#        GEN  12  212.9   17.74   6.838 8.95e-09          .           .</span>
<span class="co">#    GEN:ENV  36  398.2   11.06   4.263 7.60e-09          .           .</span>
<span class="co">#        PC1  14  212.2   15.16   5.840 0.00e+00       53.3        53.3</span>
<span class="co">#        PC2  12  134.7   11.23   4.330 0.00e+00       33.8        87.1</span>
<span class="co">#        PC3  10   51.3    5.13   1.980 4.38e-02       12.9         100</span>
<span class="co">#  Residuals  96  249.1    2.59      NA       NA          .           .</span>
<span class="co">#      Total 191 1583.2    8.29      NA       NA       &lt;NA&gt;        &lt;NA&gt;</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># </span>
<span class="co"># variable TKW </span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># AMMI analysis table</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co">#     Source  Df Sum Sq Mean Sq F value   Pr(&gt;F) Proportion Accumulated</span>
<span class="co">#        ENV   3  37013   12338   11.13 3.16e-03          .           .</span>
<span class="co">#   REP(ENV)   8   8869    1109    1.21 3.03e-01          .           .</span>
<span class="co">#        GEN  12  44633    3719    4.05 4.41e-05          .           .</span>
<span class="co">#    GEN:ENV  36 164572    4571    4.98 1.73e-10          .           .</span>
<span class="co">#        PC1  14 104276    7448    8.11 0.00e+00       63.4        63.4</span>
<span class="co">#        PC2  12  33361    2780    3.03 1.20e-03       20.3        83.6</span>
<span class="co">#        PC3  10  26935    2694    2.93 3.00e-03       16.4         100</span>
<span class="co">#  Residuals  96  88171     918      NA       NA          .           .</span>
<span class="co">#      Total 191 507829    2659      NA       NA       &lt;NA&gt;        &lt;NA&gt;</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># </span>
<span class="co"># variable NKR </span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># AMMI analysis table</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co">#     Source  Df Sum Sq Mean Sq F value   Pr(&gt;F) Proportion Accumulated</span>
<span class="co">#        ENV   3  237.0   79.01  15.843 0.000997          .           .</span>
<span class="co">#   REP(ENV)   8   39.9    4.99   0.635 0.746348          .           .</span>
<span class="co">#        GEN  12  227.8   18.99   2.418 0.008726          .           .</span>
<span class="co">#    GEN:ENV  36  602.7   16.74   2.132 0.001839          .           .</span>
<span class="co">#        PC1  14  337.4   24.10   3.070 0.000600         56          56</span>
<span class="co">#        PC2  12  192.2   16.02   2.040 0.028500       31.9        87.9</span>
<span class="co">#        PC3  10   73.1    7.31   0.930 0.509500       12.1         100</span>
<span class="co">#  Residuals  96  753.7    7.85      NA       NA          .           .</span>
<span class="co">#      Total 191 2463.8   12.90      NA       NA       &lt;NA&gt;        &lt;NA&gt;</span>
<span class="co"># ---------------------------------------------------------------------------</span>
<span class="co"># </span>
<span class="co"># All variables with significant (p &lt; 0.05) genotype-vs-environment interaction</span>
<span class="co"># Done!</span>
<span class="co"># Class of the model: waas</span>
<span class="co"># Variable extracted: WAASY</span>
<span class="co"># # A tibble: 13 x 5</span>
<span class="co">#    GEN      PH    ED   TKW   NKR</span>
<span class="co">#    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 H1     73.6 78.1   84.5  42.7</span>
<span class="co">#  2 H10    22.0 18.8   34.8  56.3</span>
<span class="co">#  3 H11    42.5 39.2   56.6  56.3</span>
<span class="co">#  4 H12    27.5 51.5   41.0  35  </span>
<span class="co">#  5 H13    49.2 60.2   70.7  25.1</span>
<span class="co">#  6 H2     66.3 54.9   62.5  51.6</span>
<span class="co">#  7 H3     59.4 57.9   52.1  48.5</span>
<span class="co">#  8 H4     68.6 59.4   59.8  98.7</span>
<span class="co">#  9 H5     85.3 61.6   69.9  75.2</span>
<span class="co"># 10 H6     67.5 95.7   90.3  34.5</span>
<span class="co"># 11 H7     41.4 62.8   55.8  42.6</span>
<span class="co"># 12 H8     11.6 32.2   17.3  29.2</span>
<span class="co"># 13 H9     45.5  7.93   0    48.4</span></code></pre></div>
</div>
<div id="diferentes-cenários-para-a-estimativa-do-waasby" class="section level4" number="14.11.5.3">
<h4>
<span class="header-section-number">14.11.5.3</span> Diferentes cenários para a estimativa do WAASBY<a class="anchor" aria-label="anchor" href="#diferentes-cen%C3%A1rios-para-a-estimativa-do-waasby"><i class="fas fa-link"></i></a>
</h4>
<p>No exemplo a seguir, aplicaremos a função <code><a href="https://rdrr.io/pkg/metan/man/wsmp.html">wsmp()</a></code>  (<strong>w</strong>eighting the <strong>s</strong>tability and the <strong>m</strong>ean <strong>p</strong>erformance) ao modelo previamente ajustado <code>BLUP_model</code> visando planejar diferentes cenários de estimação do WAASBY alterando os pesos atribuídos à estabilidade e ao desempenho médio. O número de cenários é definido pelo argumento <code>increment</code>. Por padrão, vinte e um cenários diferentes são simulados. Neste caso, o índice de superioridade WAASBY é calculado considerando os seguintes pesos: estabilidade = 100; desempenho médio = 0. Em outras palavras, apenas a estabilidade é considerada para a classificação dos genótipos. Na próxima iteração, os pesos se tornam 95/5 (uma vez que <code>increment = 5</code>). No terceiro cenário, os pesos se tornam 90/10, e assim por diante até esses pesos se tornarem 0/100. Na última iteração, a classificação do genótipo para o WAASBY corresponde perfeitamente às classificações da variável resposta.</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/wsmp.html">wsmp</a></span><span class="op">(</span><span class="va">BLUP_model</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">scenarios</span>, type <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, tag_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-373-1.png" width="1152" style="display: block; margin: auto;"></div>
<p>A função genérica <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>  é então usada para plotar o objeto. Dois <em>heatmaps</em> são criados. O primeiro tipo mostra a classificação do genótipo dependendo do número de eixos de componentes principais usados para estimar o índice WAASB. Um dendrograma baseado na distância euclidiana é usado para agrupar a classificação dos genótipos. O segundo tipo mostra a classificação do genótipo dependendo da relação WAASB/GY. As classificações obtidas no cenário 100/0 consideram exclusivamente a estabilidade para o ranking de genótipos. Por outro lado, o cenário 0/100 considera exclusivamente a produtividade para o ranking de genótipos.</p>
</div>
<div id="performance-e-média-harmônica-dos-valores-genotípicos" class="section level4" number="14.11.5.4">
<h4>
<span class="header-section-number">14.11.5.4</span> Performance e média harmônica dos valores genotípicos<a class="anchor" aria-label="anchor" href="#performance-e-m%C3%A9dia-harm%C3%B4nica-dos-valores-genot%C3%ADpicos"><i class="fas fa-link"></i></a>
</h4>
<p>A função <code><a href="https://rdrr.io/pkg/metan/man/Resende_indexes.html">Resende_indexes()</a></code> computa os índices Média Harmônica dos Valores Genotípicos (MHVG), Performance Relativa dos Valores Genotípicos (PRVG) e Média Harmônica da Performance Relativa dos Valores Genotipicos (MHPRVG), conforme descrito em <span class="citation">Colombari Filho et al. (<a href="refer%C3%AAncias.html#ref-ColombariFilho2013" role="doc-biblioref">2013</a>)</span>. Estes índices são calculados para cada genótipo de acordo com as seguintes equações.</p>
<p><span class="math display">\[
MHVG_i = \frac{1}{e}\sum\limits_{j = 1}^e {\frac{1}{{G{v_{ij}}}}}
\]</span></p>
<p><span class="math display">\[
PRVG_i = \frac{1}{e}\sum\limits_{j = 1}^e {G{v_{ij}}/{\mu_j}}
\]</span></p>
<p><span class="math display">\[
MHPRVG_i = \frac{1}{e}\sum\limits_{j = 1}^e {\frac{1}{{G{v_{ij}}/{\mu_j}}}}
\]</span></p>
<p>onde <em>e</em> é o número de ambientes incluídos na análise, <span class="math inline">\(Gv_{ij}\)</span> é o valor genotípico (BLUP) para o genótipo <em>i</em> no ambiente <em>j</em>.</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Indexes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/Resende_indexes.html">Resende_indexes</a></span><span class="op">(</span><span class="va">BLUP_model</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">Indexes</span><span class="op">$</span><span class="va">GY</span><span class="op">)</span>
<span class="co"># # A tibble: 10 x 10</span>
<span class="co">#    GEN       Y  HMGV HMGV_R  RPGV RPGV_Y RPGV_R HMRPGV HMRPGV_Y HMRPGV_R</span>
<span class="co">#    &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#  1 G1     2.60  2.32      6 0.969   2.59      6  0.967     2.59        6</span>
<span class="co">#  2 G10    2.47  2.11     10 0.913   2.44     10  0.896     2.40       10</span>
<span class="co">#  3 G2     2.74  2.47      4 1.03    2.74      4  1.02      2.73        4</span>
<span class="co">#  4 G3     2.96  2.68      2 1.11    2.96      2  1.10      2.95        2</span>
<span class="co">#  5 G4     2.64  2.39      5 0.990   2.65      5  0.988     2.64        5</span>
<span class="co">#  6 G5     2.54  2.30      8 0.954   2.55      7  0.952     2.55        8</span>
<span class="co">#  7 G6     2.53  2.30      7 0.954   2.55      8  0.952     2.55        7</span>
<span class="co">#  8 G7     2.74  2.52      3 1.04    2.77      3  1.03      2.76        3</span>
<span class="co">#  9 G8     3.00  2.74      1 1.13    3.01      1  1.12      3.00        1</span>
<span class="co"># 10 G9     2.51  2.18      9 0.926   2.48      9  0.917     2.45        9</span></code></pre></div>
</div>
</div>
</div>
<div id="ammi-ou-blup-decisão-em-cada-caso" class="section level2" number="14.12">
<h2>
<span class="header-section-number">14.12</span> AMMI ou BLUP? Decisão em cada caso!<a class="anchor" aria-label="anchor" href="#ammi-ou-blup-decis%C3%A3o-em-cada-caso"><i class="fas fa-link"></i></a>
</h2>
<p>Vimos anteriormente que um membro da família de modelos AMMI (AMMI2) é o mais preciso na predição da variável resposta em nosso exemplo. Após analizar-mos os mesmos dados utilizando modelos mistos, nos surge a seguinte questão. Qual é o método mais preciso para predizer a variável resposta em nosso exemplo? A resposta a esta pergunda será dada agora. O pacote <code>metan</code> também conta com uma função para <em>cross-validation</em> considerando o modelo misto acima. A idéia é simples. Relizaremos uma validação cruzada semelhante àquela realizada no modelo AMMI e compararemos o RMSPD dos valores preditos utilizando BLUP com aqueles obtidos pelo modelo AMMI.</p>
<p>A função <code><a href="https://rdrr.io/pkg/metan/man/cv_blup.html">cv_blup()</a></code> realiza uma validação cruzada para experimentos com repetição usando modelos mistos. Por padrão, blocos completos são selecionados aleatoriamente em cada ambiente. O procedimento para calcular o RMSPD é idêntico ao apresentado na análise AMMI.</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">valida_blup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/cv_blup.html">cv_blup</a></span><span class="op">(</span><span class="va">data_ge</span>, <span class="va">ENV</span>, <span class="va">GEN</span>, <span class="va">REP</span>, <span class="va">GY</span>, nboot <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></code></pre></div>
<p>Para unir os resultados obtidos pelas funções <code><a href="https://rdrr.io/pkg/metan/man/cv_ammif.html">cv_ammif()</a></code> e <code><a href="https://rdrr.io/pkg/metan/man/cv_blup.html">cv_blup()</a></code> a função <code><a href="https://rdrr.io/pkg/metan/man/bind_cv.html">bind_cv()</a></code>. Usando o argumento <code>bind = "means"</code> é possível concatenar os valores médios obtidos por cada modelo.   </p>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">val_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/bind_cv.html">bind_cv</a></span><span class="op">(</span><span class="va">AMMIF</span>, <span class="va">valida_blup</span>, bind <span class="op">=</span> <span class="st">"means"</span><span class="op">)</span>
<span class="va">val_means</span><span class="op">$</span><span class="va">RMSPD</span>
<span class="co"># # A tibble: 11 x 6</span>
<span class="co">#    MODEL        mean     sd      se  Q2.5 Q97.5</span>
<span class="co">#    &lt;fct&gt;       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#  1 BLUP_g_RCBD 0.408 0.0232 0.00518 0.370 0.439</span>
<span class="co">#  2 AMMI2       0.411 0.0242 0.00171 0.369 0.460</span>
<span class="co">#  3 AMMI4       0.416 0.0234 0.00166 0.373 0.462</span>
<span class="co">#  4 AMMI3       0.416 0.0215 0.00152 0.377 0.457</span>
<span class="co">#  5 AMMI5       0.422 0.0232 0.00164 0.377 0.464</span>
<span class="co">#  6 AMMI6       0.422 0.0219 0.00155 0.381 0.462</span>
<span class="co">#  7 AMMI7       0.425 0.0199 0.00141 0.381 0.458</span>
<span class="co">#  8 AMMI8       0.427 0.0204 0.00145 0.387 0.462</span>
<span class="co">#  9 AMMIF       0.429 0.0213 0.00150 0.390 0.469</span>
<span class="co"># 10 AMMI1       0.430 0.0251 0.00178 0.384 0.479</span>
<span class="co"># 11 AMMI0       0.430 0.0283 0.00200 0.370 0.485</span></code></pre></div>
<p>Um gráfico boxplot também pode ser obtido utilizando o argumento <code>bind = "boot"</code> (padrão).</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">val_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metan/man/bind_cv.html">bind_cv</a></span><span class="op">(</span><span class="va">AMMIF</span>, <span class="va">valida_blup</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">val_plot</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">val_plot</span>,
          width.boxplot <span class="op">=</span> <span class="fl">0.6</span>,
          col.boxplot <span class="op">=</span> <span class="st">"cyan"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/metan/man/arrange_ggplot.html">arrange_ggplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="html_r_files/figure-html/unnamed-chunk-377-1.png" width="960" style="display: block; margin: auto;"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="multivariate.html"><span class="header-section-number">13</span> Análise multivariada</a></div>
<div class="next"><a href="refer%C3%AAncias.html"><span class="header-section-number">15</span> Referências</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#interaction"><span class="header-section-number">14</span> Interação genótipo-vs-ambiente</a></li>
<li><a class="nav-link" href="#an%C3%A1lise-gr%C3%A1fica-da-intera%C3%A7%C3%A3o"><span class="header-section-number">14.1</span> Análise gráfica da interação</a></li>
<li><a class="nav-link" href="#an%C3%A1lise-de-vari%C3%A2ncia-individual"><span class="header-section-number">14.2</span> Análise de variância individual</a></li>
<li><a class="nav-link" href="#baseada-em-regress%C3%A3o"><span class="header-section-number">14.3</span> Baseada em regressão</a></li>
<li><a class="nav-link" href="#%C3%ADndice-de-confian%C3%A7a-genot%C3%ADpico"><span class="header-section-number">14.4</span> Índice de confiança genotípico</a></li>
<li><a class="nav-link" href="#%C3%ADndice-de-superioridade-genot%C3%ADpico"><span class="header-section-number">14.5</span> Índice de superioridade genotípico</a></li>
<li><a class="nav-link" href="#estratifica%C3%A7%C3%A3o-ambiental"><span class="header-section-number">14.6</span> Estratificação ambiental</a></li>
<li>
<a class="nav-link" href="#o-modelo-ammi"><span class="header-section-number">14.7</span> O modelo AMMI</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ajuste-do-modelo"><span class="header-section-number">14.7.1</span> Ajuste do modelo</a></li>
<li><a class="nav-link" href="#analise-residual"><span class="header-section-number">14.7.2</span> Analise residual</a></li>
<li><a class="nav-link" href="#escolha-do-n%C3%BAmero-de-termos-multiplicativos"><span class="header-section-number">14.7.3</span> Escolha do número de termos multiplicativos</a></li>
</ul>
</li>
<li><a class="nav-link" href="#imprimindo-os-meios-das-estimativas-rmspd"><span class="header-section-number">14.8</span> Imprimindo os meios das estimativas RMSPD</a></li>
<li>
<a class="nav-link" href="#plotagem-dos-valores-rmspd"><span class="header-section-number">14.9</span> Plotagem dos valores RMSPD</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#valores-estimados-pelo-modelo-ammi"><span class="header-section-number">14.9.1</span> Valores estimados pelo modelo AMMI</a></li>
<li><a class="nav-link" href="#%C3%ADndices-de-estabilidade-baseados-em-ammi"><span class="header-section-number">14.9.2</span> Índices de estabilidade baseados em AMMI</a></li>
<li><a class="nav-link" href="#biplots"><span class="header-section-number">14.9.3</span> Biplots</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#o-modelo-gge"><span class="header-section-number">14.10</span> O modelo GGE</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-centering"><span class="header-section-number">14.10.1</span> Data centering</a></li>
<li><a class="nav-link" href="#data-scaling"><span class="header-section-number">14.10.2</span> Data scaling</a></li>
<li><a class="nav-link" href="#singular-value-partition"><span class="header-section-number">14.10.3</span> Singular value partition</a></li>
<li><a class="nav-link" href="#ajustando-o-modelo-gge"><span class="header-section-number">14.10.4</span> Ajustando o modelo GGE</a></li>
<li><a class="nav-link" href="#valores-estimados-pelo-modelo-gge"><span class="header-section-number">14.10.5</span> Valores estimados pelo modelo GGE</a></li>
<li><a class="nav-link" href="#visualizando-o-biplot"><span class="header-section-number">14.10.6</span> Visualizando o Biplot</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#modelos-mistos-na-avalia%C3%A7%C3%A3o-de-met"><span class="header-section-number">14.11</span> Modelos mistos na avaliação de MET</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ajustando-o-modelo"><span class="header-section-number">14.11.1</span> Ajustando o modelo</a></li>
<li><a class="nav-link" href="#an%C3%A1lise-dos-res%C3%ADduos-2"><span class="header-section-number">14.11.2</span> Análise dos resíduos</a></li>
<li><a class="nav-link" href="#par%C3%A2metros-gen%C3%A9ticos"><span class="header-section-number">14.11.3</span> Parâmetros genéticos</a></li>
<li><a class="nav-link" href="#m%C3%A9dias-preditas"><span class="header-section-number">14.11.4</span> Médias preditas</a></li>
<li><a class="nav-link" href="#%C3%ADndices-de-estabilidade-baseados-em-blup"><span class="header-section-number">14.11.5</span> Índices de estabilidade baseados em BLUP</a></li>
</ul>
</li>
<li><a class="nav-link" href="#ammi-ou-blup-decis%C3%A3o-em-cada-caso"><span class="header-section-number">14.12</span> AMMI ou BLUP? Decisão em cada caso!</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/TiagoOlivoto/e-bookr/blob/master/14-interaction.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/TiagoOlivoto/e-bookr/edit/master/14-interaction.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Software R para avaliação de dados experimentais</strong>: Um foco em experimentos agronômicos" was written by Tiago Olivoto, Bruno Giacomini Sari. It was last built on 2021-01-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
